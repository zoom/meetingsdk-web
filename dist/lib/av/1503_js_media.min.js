!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JsMediaSDK_Instance=t():e.JsMediaSDK_Instance=t()}(window,(function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=61)}([function(e,t,r){"use strict";var i=r(14),a=r(8),n=r(6),o=r(26),s=r.n(o),u=r(36),d=r.n(u),c=r(28),h=r.n(c),l=r(11),p=r.n(l),f=r(12),m=r.n(f),g=r(13);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=h()(e);if(t){var a=h()(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return d()(this,r)}}var S=Object(g.a)("sdk.init"),_=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";p()(this,e),this.name=r,this.handler=null,this.wasm=null,this.socket=null,this.defered=new n.a,this.initSuccessPromise=this.defered.promise,this.wasmDefered=new n.a,this.wasmSuccessPromise=this.wasmDefered.promise,this.handlerDefered=new n.a,this.handlerSuccessPromise=this.handlerDefered.promise,this.socketDefered=new n.a,this.socketSuccessPromise=this.socketDefered.promise,Promise.all([this.wasmSuccessPromise,this.handlerSuccessPromise,this.socketSuccessPromise]).then((function(e){var r=e.every((function(e){return!0===e}));t.defered.resolve(r),r||S.error(t.name,{handler:t.handler,wasm:t.wasm,socket:t.socket})}))}return m()(e,[{key:"setHanderSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.handler=e,this.handlerDefered.resolve(e)}},{key:"setWasmSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.wasm=e,this.wasmDefered.resolve(e)}},{key:"setSocketSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.socket=e,this.socketDefered.resolve(e)}},{key:"checkInitSuccess",value:function(){var e=this.handler&&this.wasm&&this.socket;return e&&this.defered.resolve(!0),e}},{key:"isSocketInitSuccess",value:function(){return this.socket}},{key:"waitforInitSuccess",value:function(){return this.initSuccessPromise}}]),e}(),C=function(e){s()(r,e);var t=v(r);function r(e){return p()(this,r),t.call(this,e)}return m()(r)}(_),y=function(e){s()(r,e);var t=v(r);function r(e){return p()(this,r),t.call(this,e)}return m()(r)}(_),b=function(e){s()(r,e);var t=v(r);function r(e){return p()(this,r),t.call(this,e)}return m()(r)}(_),A=r(2),k=Object(g.a)("sdk.variables");function E(){}E.prototype.initDB=function(){var e,t={},r=this;t.init=function(i){if(this.db_name=i.db_name,this.db_version=i.db_version,this.db_store_name=i.db_store_name,indexedDB){try{e=indexedDB.open(this.db_name,this.db_version)}catch(e){return a.a.error("Error opening IndexedDB",e),void(r.indexDbObject=null)}e.onerror=function(e){r.indexDbObject=null},e.onupgradeneeded=function(e){this.db=e.target.result,this.db.createObjectStore(t.db_store_name)},e.onsuccess=function(e){t.db=e.target.result,r.openIndexFlag=!0,r.indexDbObject.select("delay")}}else r.indexDbObject=null},t.put=function(e,r){try{var i=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).put(e,r);i.onsuccess=function(){},i.onerror=function(e){a.a.error("Set Delay failed!",e)}}catch(e){a.a.error("IndexDb put Failed!",e)}},t.delete=function(r){(e=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).delete(r)).onsuccess=function(){k("Delete the key:"+r)}},t.select=function(e){try{var i=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name);if(e)var n=i.get(e);else n=i.getAll();n.onsuccess=function(){r.audioDelay=n.result},n.onerror=function(){r.audioDelay=0}}catch(e){a.a.error("IndexDb Select Failed",e)}},t.clear=function(){t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).clear().onsuccess=function(){k("Clear the IndexDb Successfully")}},t.close=function(){t.db&&t.db.close()},this.indexDbObject=t,this.indexDbObject.init({db_name:"AEC",db_version:1,db_store_name:"delay"})},E.prototype.Notify_APPUI_SAFE=function(){this._Notify_APPUI&&(k("Notify_APPUI_SAFE",arguments),this._Notify_APPUI.apply(this,arguments))},E.prototype.Notify_APPUI=function(){this._Notify_APPUI&&(k("Notify_APPUI",arguments),this._Notify_APPUI.apply(this,arguments))},E.prototype.queueMessageToRwg=function(e,t){this.rwgMessageList.push({jsEvent:e,message:t})},E.prototype.clearMessageToRwg=function(){var e=this;this.rwgConnectSuccess=!0,this.rwgMessageList.length>0&&(this.rwgAgent||this._Notify_APPUI)&&(this.rwgMessageList.forEach((function(t){var r=t.jsEvent,i=t.message;e.sendMessageToRwg(r,i,!1,!1)})),this.rwgMessageList=[])},E.prototype.destroyQueueMessageToRwg=function(){this.rwgConnectSuccess=!1,this.rwgMessageList=[]},E.prototype.sendMessageToRwg=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.rwgConnectSuccess&&(this.rwgAgent||this._Notify_APPUI)||!r){this.rwgConnectSuccess&&i&&this.clearMessageToRwg();try{this.rwgAgent?this.rwgAgent.sendMessageToRwg(t):this.Notify_APPUI_SAFE(e,t)}catch(e){a.a.error("Error sending message to RWG",e)}}else this.queueMessageToRwg(e,t)},E.prototype.reinit=function(){this.SPECIAL_ID=0,this._Notify_APPUI=null,this.localAudioDecMGR=null,this.localVideoDecMGR=null,this.localAudioEncMGR=null,this.localVideoEncMGR=null,this.localSharingDecMGR=null,this.localMouseDecMGR=null,this.localSharingEncMGR=null,this.localAudioPara=null,this.localVideoPara=null,this.localSharingPara=null,this.Audio_WebSocket_Ip_Address=null,this.Audio_Web_Transport_Ip_Address=null,this.Video_WebSocket_Ip_Address=null,this.Video_Web_Transport_Ip_Address=null,this.Sharing_WebSocket_Ip_Address=null,this.mediaSDKHandle=null,this.audio_pcm_queue=new i.a,this.int16Array=null,this.isInitialFailed=!1,this.isAudioEncodeWASMOK=!1,this.isAudioDecodeWASMOK=!1,this.isVideoEncodeWASMOK=!1,this.isVideoDecodeWASMOK=!1,this.isSharingDecodeWASMOK=!1,this.isSharingEncodeWASMOK=!1,this.audioEncWorkerPath="",this.audioDecWorkerPath="",this.videoDecWorkerPath="",this.videoEncWorkerPath="",this.sharingDecWorkerPath="",this.sharingEncWorkerPath="",this.isAudioEncodePostStart=!1,this.isAudioDecodePostStart=!1,this.isVideoDecodePostStart=!1,this.isVideoEncodePostStart=!1,this.isSharingDecodePostStart=!1,this.isSharingEncodePostStart=!1,this.isAudioEncodeThreadStart=!1,this.isAudioDecodeThreadStart=!1,this.isVideoDecodeThreadStart=!1,this.isSharingDecodeThreadStart=!1,this.isVideoEncodeThreadStart=!1,this.isSharingEncodeThreadStart=!1,this.isAudioPlayWork=!1,this.isVideoPlayWork=!1,this.isSharingPlayWork=!1,this.shareBufferSampleNumb=30,this.audioWasmInfo=null,this.audioWasm=null,this.initialSuccessNumb=0,this.TotalWaitEvent=0,this.audioPostInterval=null,this.sharedBuffer=null,this.decoderinworklet=null,this.decoderinworkletOP=null,this.chromeWideAEC=null,this.shareSystemAudio=!1,this.indexDbObject=null,this.audioDelay=0,this.openIndexFlag=!1,this.audioBufferSize=n.g.browser.isFirefox?30:15,this.monitorEncodeVideo=null,this.monitorDecodeVideo=null,this.monitorEncodeSharing=null,this.monitorDecodeSharing=null,this.monitorEncodeAudio=null,this.monitorDecodeAudio=null,this.monitorVideoCapture=null,this.monitorVideoReadyCaptureWidth=0,this.monitorVideoReadyCaptureHeight=0,this.monitorIntervalHandle=null,this.monitorVideoUserID=null,this.monitorSharingUserID=null,this.monitorSharingEncodeAPPInfo=null,this.monitorVideoDecodeAPPInfo=null,this.monitorVideoEncodeAPPInfo=null,this.monitorCid=null,this.e2eencrypt=!1,this.AudioNode=null,this.SharingAudioNode=null,this.CurrentSSRC=0,this.CurrentSSRCTime=0,this.audioPlayTime=0,this.videoDecResponseText=null,this.videoEncResponseText=null,this.sharingDecodeResponse=null,this.sharingEncodeResponse=null,this.sharingDecInitInstance=new C(A.g.SHARING_DECODE),this.sharingEncInitInstance=new C(A.g.SHARING_ENCODE),this.videoDecInitInstance=new y(A.g.VIDEO_DECODE),this.videoInitInstance=new y(A.g.VIDEO_ENCODE),this.audioDecInitInstance=new b(A.g.AUDIO_DECODE),this.audioEncodeInitInstance=new b(A.g.AUDIO_ENCODE),this.audioDecodeResponse=null,this.audioEncodeResponse=null,this.ivObj={},this.userNodeList=[],this.rwgAgent=null,this.ComputerAudioStatus=A.a.ComputerAudio_Null,this.DesktopAudioStatus=A.a.DesktopAudio_Null,this.initDB(),this.resourceManager=null,this.vbarraybuffer=null,this.vbbin=null,this.vbjson=null,this.tfjsurl=null,this.afnbin=null,this.afnjson=null,this.basebin=null,this.basejson=null,this.interpretationMessage=new i.a,this.workletWasmInitSuccess=!1,this.videoEncodeInitSuccess=null,this.vbPreloadSuccess=null,this.enableAduioBridge=!1,this.audioMode=-1,this.isPreviewMode={audioEncode:!1,audioDecode:!1,videoEncode:!1,videoDecode:!1},this.rwgConnectSuccess=!1,this.rwgMessageList=[],this.localSsrc=0};var I=new E;t.a=I},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"qd",(function(){return a})),r.d(t,"ad",(function(){return n})),r.d(t,"nd",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"pd",(function(){return u})),r.d(t,"Id",(function(){return d})),r.d(t,"lc",(function(){return c})),r.d(t,"W",(function(){return h})),r.d(t,"ab",(function(){return l})),r.d(t,"T",(function(){return p})),r.d(t,"Z",(function(){return f})),r.d(t,"U",(function(){return m})),r.d(t,"bc",(function(){return g})),r.d(t,"dc",(function(){return v})),r.d(t,"Eb",(function(){return S})),r.d(t,"S",(function(){return _})),r.d(t,"Te",(function(){return C})),r.d(t,"Xb",(function(){return y})),r.d(t,"Tb",(function(){return b})),r.d(t,"fd",(function(){return A})),r.d(t,"rd",(function(){return k})),r.d(t,"wd",(function(){return E})),r.d(t,"cd",(function(){return I})),r.d(t,"Qd",(function(){return w})),r.d(t,"P",(function(){return M})),r.d(t,"bd",(function(){return D})),r.d(t,"gd",(function(){return R})),r.d(t,"od",(function(){return T})),r.d(t,"sd",(function(){return P})),r.d(t,"rc",(function(){return x})),r.d(t,"Bc",(function(){return O})),r.d(t,"bb",(function(){return V})),r.d(t,"V",(function(){return N})),r.d(t,"db",(function(){return L})),r.d(t,"Ac",(function(){return W})),r.d(t,"Zd",(function(){return U})),r.d(t,"Rd",(function(){return B})),r.d(t,"sc",(function(){return F})),r.d(t,"Md",(function(){return G})),r.d(t,"hf",(function(){return H})),r.d(t,"Y",(function(){return j})),r.d(t,"Jc",(function(){return K})),r.d(t,"Yd",(function(){return q})),r.d(t,"Nd",(function(){return Q})),r.d(t,"jc",(function(){return z})),r.d(t,"hd",(function(){return J})),r.d(t,"Fc",(function(){return X})),r.d(t,"i",(function(){return Y})),r.d(t,"A",(function(){return Z})),r.d(t,"q",(function(){return $})),r.d(t,"p",(function(){return ee})),r.d(t,"o",(function(){return te})),r.d(t,"pe",(function(){return re})),r.d(t,"Ld",(function(){return ie})),r.d(t,"Od",(function(){return ae})),r.d(t,"Gb",(function(){return ne})),r.d(t,"jd",(function(){return oe})),r.d(t,"me",(function(){return se})),r.d(t,"ne",(function(){return ue})),r.d(t,"Vb",(function(){return de})),r.d(t,"Zb",(function(){return ce})),r.d(t,"Hc",(function(){return he})),r.d(t,"ec",(function(){return le})),r.d(t,"Se",(function(){return pe})),r.d(t,"ae",(function(){return fe})),r.d(t,"Pd",(function(){return me})),r.d(t,"Kc",(function(){return ge})),r.d(t,"Yc",(function(){return ve})),r.d(t,"N",(function(){return Se})),r.d(t,"M",(function(){return _e})),r.d(t,"Cb",(function(){return Ce})),r.d(t,"Ab",(function(){return ye})),r.d(t,"yd",(function(){return be})),r.d(t,"ld",(function(){return Ae})),r.d(t,"Sd",(function(){return ke})),r.d(t,"vd",(function(){return Ee})),r.d(t,"kd",(function(){return Ie})),r.d(t,"de",(function(){return we})),r.d(t,"ce",(function(){return Me})),r.d(t,"ee",(function(){return De})),r.d(t,"Db",(function(){return Re})),r.d(t,"xd",(function(){return Te})),r.d(t,"X",(function(){return Pe})),r.d(t,"oc",(function(){return xe})),r.d(t,"nc",(function(){return Oe})),r.d(t,"O",(function(){return Ve})),r.d(t,"pc",(function(){return Ne})),r.d(t,"h",(function(){return Le})),r.d(t,"g",(function(){return We})),r.d(t,"Jb",(function(){return Ue})),r.d(t,"vc",(function(){return Be})),r.d(t,"uc",(function(){return Fe})),r.d(t,"Ue",(function(){return Ge})),r.d(t,"m",(function(){return He})),r.d(t,"Gc",(function(){return je})),r.d(t,"md",(function(){return Ke})),r.d(t,"fc",(function(){return qe})),r.d(t,"E",(function(){return Qe})),r.d(t,"C",(function(){return ze})),r.d(t,"G",(function(){return Je})),r.d(t,"J",(function(){return Xe})),r.d(t,"Ae",(function(){return Ye})),r.d(t,"ye",(function(){return Ze})),r.d(t,"Ce",(function(){return $e})),r.d(t,"Ge",(function(){return et})),r.d(t,"Ee",(function(){return tt})),r.d(t,"Bd",(function(){return rt})),r.d(t,"l",(function(){return it})),r.d(t,"Dd",(function(){return at})),r.d(t,"Fd",(function(){return nt})),r.d(t,"zd",(function(){return ot})),r.d(t,"sb",(function(){return st})),r.d(t,"Ie",(function(){return ut})),r.d(t,"we",(function(){return dt})),r.d(t,"hc",(function(){return ct})),r.d(t,"Pc",(function(){return ht})),r.d(t,"Ye",(function(){return lt})),r.d(t,"We",(function(){return pt})),r.d(t,"Xe",(function(){return ft})),r.d(t,"K",(function(){return mt})),r.d(t,"Je",(function(){return gt})),r.d(t,"zb",(function(){return vt})),r.d(t,"e",(function(){return St})),r.d(t,"Pe",(function(){return _t})),r.d(t,"Mc",(function(){return Ct})),r.d(t,"ic",(function(){return yt})),r.d(t,"Oc",(function(){return bt})),r.d(t,"oe",(function(){return At})),r.d(t,"le",(function(){return kt})),r.d(t,"ie",(function(){return Et})),r.d(t,"n",(function(){return It})),r.d(t,"Hd",(function(){return wt})),r.d(t,"Ke",(function(){return Mt})),r.d(t,"r",(function(){return Dt})),r.d(t,"s",(function(){return Rt})),r.d(t,"se",(function(){return Tt})),r.d(t,"re",(function(){return Pt})),r.d(t,"Gd",(function(){return xt})),r.d(t,"Zc",(function(){return Ot})),r.d(t,"Uc",(function(){return Vt})),r.d(t,"c",(function(){return Nt})),r.d(t,"pb",(function(){return Lt})),r.d(t,"Kb",(function(){return Wt})),r.d(t,"cf",(function(){return Ut})),r.d(t,"D",(function(){return Bt})),r.d(t,"B",(function(){return Ft})),r.d(t,"F",(function(){return Gt})),r.d(t,"I",(function(){return Ht})),r.d(t,"H",(function(){return jt})),r.d(t,"ze",(function(){return Kt})),r.d(t,"xe",(function(){return qt})),r.d(t,"Be",(function(){return Qt})),r.d(t,"Fe",(function(){return zt})),r.d(t,"De",(function(){return Jt})),r.d(t,"Ad",(function(){return Xt})),r.d(t,"L",(function(){return Yt})),r.d(t,"Ed",(function(){return Zt})),r.d(t,"Cd",(function(){return $t})),r.d(t,"He",(function(){return er})),r.d(t,"kc",(function(){return tr})),r.d(t,"Qe",(function(){return rr})),r.d(t,"Sb",(function(){return ir})),r.d(t,"Qb",(function(){return ar})),r.d(t,"Rb",(function(){return nr})),r.d(t,"Xd",(function(){return or})),r.d(t,"qb",(function(){return sr})),r.d(t,"Wc",(function(){return ur})),r.d(t,"Vc",(function(){return dr})),r.d(t,"ke",(function(){return cr})),r.d(t,"hb",(function(){return hr})),r.d(t,"id",(function(){return lr})),r.d(t,"ud",(function(){return pr})),r.d(t,"ed",(function(){return fr})),r.d(t,"R",(function(){return mr})),r.d(t,"xc",(function(){return gr})),r.d(t,"gc",(function(){return vr})),r.d(t,"lb",(function(){return Sr})),r.d(t,"tb",(function(){return _r})),r.d(t,"cb",(function(){return Cr})),r.d(t,"Nc",(function(){return yr})),r.d(t,"zc",(function(){return br})),r.d(t,"Ec",(function(){return Ar})),r.d(t,"d",(function(){return kr})),r.d(t,"Qc",(function(){return Er})),r.d(t,"Hb",(function(){return Ir})),r.d(t,"Ub",(function(){return wr})),r.d(t,"Wb",(function(){return Mr})),r.d(t,"Yb",(function(){return Dr})),r.d(t,"ac",(function(){return Rr})),r.d(t,"Lb",(function(){return Tr})),r.d(t,"Mb",(function(){return Pr})),r.d(t,"Le",(function(){return xr})),r.d(t,"Pb",(function(){return Or})),r.d(t,"Nb",(function(){return Vr})),r.d(t,"Ob",(function(){return Nr})),r.d(t,"Vd",(function(){return Lr})),r.d(t,"y",(function(){return Wr})),r.d(t,"ve",(function(){return Ur})),r.d(t,"z",(function(){return Br})),r.d(t,"Wd",(function(){return Fr})),r.d(t,"Td",(function(){return Gr})),r.d(t,"td",(function(){return Hr})),r.d(t,"dd",(function(){return jr})),r.d(t,"Q",(function(){return Kr})),r.d(t,"yc",(function(){return qr})),r.d(t,"be",(function(){return Qr})),r.d(t,"Ud",(function(){return zr})),r.d(t,"ub",(function(){return Jr})),r.d(t,"wb",(function(){return Xr})),r.d(t,"vb",(function(){return Yr})),r.d(t,"v",(function(){return Zr})),r.d(t,"xb",(function(){return $r})),r.d(t,"j",(function(){return ei})),r.d(t,"f",(function(){return ti})),r.d(t,"Oe",(function(){return ri})),r.d(t,"Rc",(function(){return ii})),r.d(t,"Ne",(function(){return ai})),r.d(t,"Me",(function(){return ni})),r.d(t,"Re",(function(){return oi})),r.d(t,"cc",(function(){return si})),r.d(t,"ue",(function(){return ui})),r.d(t,"qc",(function(){return di})),r.d(t,"x",(function(){return ci})),r.d(t,"w",(function(){return hi})),r.d(t,"u",(function(){return li})),r.d(t,"Xc",(function(){return pi})),r.d(t,"je",(function(){return fi})),r.d(t,"k",(function(){return mi})),r.d(t,"ff",(function(){return gi})),r.d(t,"gf",(function(){return vi})),r.d(t,"df",(function(){return Si})),r.d(t,"ef",(function(){return _i})),r.d(t,"Fb",(function(){return Ci})),r.d(t,"Ze",(function(){return yi})),r.d(t,"af",(function(){return bi})),r.d(t,"bf",(function(){return Ai})),r.d(t,"wc",(function(){return ki})),r.d(t,"ib",(function(){return Ei})),r.d(t,"mb",(function(){return Ii})),r.d(t,"Sc",(function(){return wi})),r.d(t,"Tc",(function(){return Mi})),r.d(t,"ge",(function(){return Di})),r.d(t,"he",(function(){return Ri})),r.d(t,"Lc",(function(){return Ti})),r.d(t,"Jd",(function(){return Pi})),r.d(t,"Kd",(function(){return xi})),r.d(t,"Ib",(function(){return Oi})),r.d(t,"gb",(function(){return Vi})),r.d(t,"fb",(function(){return Ni})),r.d(t,"ob",(function(){return Li})),r.d(t,"eb",(function(){return Wi})),r.d(t,"nb",(function(){return Ui})),r.d(t,"te",(function(){return Bi})),r.d(t,"Ic",(function(){return Fi})),r.d(t,"rb",(function(){return Gi})),r.d(t,"Cc",(function(){return Hi})),r.d(t,"Dc",(function(){return ji})),r.d(t,"Ve",(function(){return Ki})),r.d(t,"t",(function(){return qi})),r.d(t,"qe",(function(){return Qi})),r.d(t,"fe",(function(){return zi})),r.d(t,"mc",(function(){return Ji})),r.d(t,"if",(function(){return Xi})),r.d(t,"kb",(function(){return Yi})),r.d(t,"jb",(function(){return Zi})),r.d(t,"Bb",(function(){return $i})),r.d(t,"tc",(function(){return ea})),r.d(t,"yb",(function(){return ta}));var i=1,a=2,n=3,o=4,s=5,u=6,d=7,c=8,h=9,l=10,p=11,f=12,m=13,g=15,v=16,S=17,_=18,C=19,y=21,b=22,A=23,k=24,E=25,I=26,w=27,M=28,D=30,R=30.1,T=31,P=31.1,x=32,O=33,V=34,N=36,L=40,W=41,U=43,B=44,F=45,G=46,H=48,j=49,K=50,q=51,Q=52,z=53,J=54,X=55,Y=57,Z=58,$=59,ee=60,te=61,re=62,ie=63,ae=64,ne=65,oe=66,se=70,ue=71,de=72,ce=73,he=74,le=75,pe=77,fe=80,me=81,ge=82,ve=83,Se=84,_e=85,Ce=86,ye=87,be=90,Ae=91,ke=92,Ee=93,Ie=94,we=96,Me=97,De=98,Re=99,Te=101,Pe=100,xe=110,Oe=111,Ve=112,Ne=113,Le=114,We=115,Ue=116,Be=117,Fe=118,Ge=120,He=121,je=122,Ke=123,qe=124,Qe=1,ze=2,Je=3,Xe=4,Ye=7,Ze=8,$e=9,et=10,tt=11,rt=12,it=14,at=15,nt=16,ot=17,st=18,ut=19,dt=20,ct=21,ht=3021,lt=22,pt=23,ft=24,mt=26,gt=27,vt=30,St=31,_t=35,Ct=36,yt=37,bt=38,At=39,kt=40,Et=41,It=42,wt=46,Mt=47,Dt=48,Rt=49,Tt=50,Pt=51,xt=52,Ot=53,Vt=54,Nt=56,Lt=57,Wt=58,Ut=60,Bt=-1,Ft=-2,Gt=-3,Ht=-4,jt=-5,Kt=-7,qt=-8,Qt=-9,zt=-10,Jt=-11,Xt=-12,Yt=-13,Zt=-14,$t=-15,er=-16,tr=-26,rr=-27,ir=1.1,ar=1.2,nr=1.3,or=2,sr=3,ur=6,dr=6.1,cr=7,hr=8,lr=9,pr=10,fr=11,mr=12,gr=13,vr=14,Sr=15,_r=16,Cr=17,yr=18,br=19,Ar=20,kr=21,Er=23,Ir=24,wr=24,Mr=25,Dr=26,Rr=27,Tr=28,Pr=29,xr=30,Or=-1.1,Vr=-1.2,Nr=-1.3,Lr=-2,Wr=-3,Ur=-4,Br=-6,Fr=-8,Gr=-9,Hr=-10,jr=-11,Kr=-12,qr=-14,Qr=-15,zr=-16,Jr=-17,Xr=-18,Yr=-20,Zr=-21,$r=-22,ei=-23,ti=-24,ri=-28,ii=-27,ai=-29,ni=-31,oi=-32,si=-33,ui=-34,di=-35,ci=0,hi=1,li=2,pi="SHARING_PARAM_INFO_FROM_SOCKET",fi="VIDEO_DATA_FROM_WORKER",mi="AUDIO_DATA_FROM_WORKER",gi=24321,vi=24322,Si=24322,_i=24323,Ci=24322,yi=4300,bi=4299,Ai=7939,ki={ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",END_MEDIA:"END_MEDIA",DESTROY:"DESTROY",DC_COMING_MESSAGE:"DC_COMING_MESSAGE",AUDIO_BRIDGE_WS_TOKEN:"AUDIO_BRIDGE_WS_TOKEN"},Ei=67,Ii=68,wi=69,Mi=70,Di=71,Ri=72,Ti=73,Pi=75,xi=76,Oi=78,Vi=105,Ni=106,Li=107,Wi=108,Ui=109,Bi=110,Fi=1,Gi=0,Hi=108,ji=104,Ki=120,qi="AUDIO_QOS_DATA",Qi="VIDEO_QOS_DATA",zi="VIDEOSHARE_QOS_DATA",Ji="NETWORK_QUALITY_CHANGE",Xi={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},Yi=66.5,Zi=66.6,$i="ENABLE_REUSE_STREAM",ea="PRESET_MEDIA_CONSTRAINTS",ta="DESTORY_REUSE_STREAM"},function(e,t,r){"use strict";r.d(t,"h",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"f",(function(){return o})),r.d(t,"i",(function(){return s})),r.d(t,"g",(function(){return u})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return c})),r.d(t,"a",(function(){return h}));var i={ZOOM_CONNECTION_COMMAND:0,ZOOM_CONNECTION_AUDIO:1,ZOOM_CONNECTION_VIDEO:2,ZOOM_CONNECTION_SHARING_JPEG:3,ZOOM_CONNECTION_SHARING_VIDEO:4,ZOOM_CONNECTION_MEDIA_LOG:5,ZOOM_CONNECTION_SHARING_REMOTE_CONTROL:6,ZOOM_CONNECTION_UNKNOW:7},a={encode:1,decode:2},n={AUDIO:1,SHARING:2,VIDEO:3},o={UNKNOWN:0,WIN:1,MAC:2,PAD:3,MOBILE:4,CALL_IN:5,LINUX:6,WEB:7,CHROME:8},s={0:"27D10C2BC0312F11BE79BF9AA0668220",1:"D5AC365D95ACF72EE1E8D0FED594C0CD",2:"AEF36FC5C22CE7AAF5DC05913633EDF7",3:"BD3DF97B715748F6B6A5F59271A2D1A0",4:"D0AEDC804599C31391A946904C74595F",5:"65DEAF0AA73F220ED401B90CFFCDFF23"},u={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},d={SET_USER_NODE_LIST:"SET_USER_NODE_LIST"},c={CLOSE:"CLOSE",CLOSE_SUCCESS:"CLOSE_SUCCESS",CLOSE_FAIL:"CLOSE_FAIL",IS_CLOSED:"IS_CLOSED",START_SHARING_IE:"START_SHARING_IE",START_SHARING_IE_CALLBACK:"START_SHARING_IE_CALLBACK",SHARING_PARAM_DATA_IE_CALLBACK:"SHARING_PARAM_DATA_IE_CALLBACK",SHARING_MORE_INFO_DATA_IE_CALLBACK:"SHARING_MORE_INFO_DATA_IE_CALLBACK",SHARING_BINARY_CURSOR_DATA_AND_POS_INDICATION_TYPE:"SHARING_BINARY_CURSOR_DATA_AND_POS_INDICATION_TYPE",SHARING_BINARY_CONTENT_DATA_AND_POS_INDICATION_TYPE:"SHARING_BINARY_CONTENT_DATA_AND_POS_INDICATION_TYPE"},h={ComputerAudio_Null:0,ComputerAudio_Connecting:1,ComputerAudio_Connected:2,DesktopAudio_Null:0,DesktopAudio_Connecting:1,DesktopAudio_Connected:2}},function(e,t,r){var i=r(45)();e.exports=i;try{regeneratorRuntime=i}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},function(e,t,r){"use strict";var i=r(1),a=r(0),n=r(8),o={MWCGLF:"WebGL context failed to be restored",VCFF:"Captured video format is not supported",SHHF:"Initialization of sharing decode WASM failed",SDSF:"Sharing decode WebSocket failed to connect after 10 attempts",SESF:"Initialization of sharing encode WASM failed",SEHF:"Sharing encode WebSocket failed to connect after 10 attempts",ADHF:"Initialization of audio decode WASM failed",ADSF:"Audio decode WebSocket failed to connect after 10 attempts",AEHF:"Initialization of audio encode WASM failed",AESF:"Audio encode WebSocket failed to connect after 10 attempts",VDHF:"Initialization of video decode WASM failed",VDSF:"Video decode WebSocket failed to connect after 10 attempts",VEHF:"Initialization of video encode WASM failed",VESF:"Video encode WebSocket failed to connect after 10 attempts",DCERROR:"WebRTC DataChannel received error",INITVDCERR:"An error occurred when initializing video WebRTC DataChannel",INITADCERR:"An error occurred when initializing audio WebRTC DataChannel",VBFF:"An error occurred when trying to obtain the virtual background file"},s=function(){function e(){this.base_time=null,this.monitor="",this.last_get_monitor_time=0,this.checkIsNecessaryLogMap=new Map,this.highfrequencyerror=new Map}return e.prototype={init:function(){this.base_time=(new Date).getTime(),this.checkIsNecessaryLogMap=new Map},add_monitor:function(e,t){if(e)try{if(o[e]){var r=o[e];t&&(r="".concat(r,". Additional information: ").concat(t)),n.a.error(r)}var i=!1;"F"!=e[e.length-1]&&"f"!=e[e.length-1]||(i=!0);var a=(new Date).getTime()-this.base_time;this.monitor?this.monitor=this.monitor+e+"("+Math.ceil(a)+")":this.monitor=e+"("+Math.ceil(a)+")",this.monitor.length>2e3&&(i=!0),i&&this.send_instant_monitor()}catch(e){n.a.error("Error when adding data to the monitor log",e)}},get_monitor:function(){var e=this.monitor,t=(new Date).getTime();return null!=e&&(e.length>80||t-this.last_get_monitor_time>180)?(this.last_get_monitor_time=t,this.monitor=null,"WCL_M, "+e):""},get_instant_monitor:function(){var e=this.monitor;return this.monitor=null,"WCL_M, "+e},send_instant_monitor:function(){var e=this.get_instant_monitor();e&&a.a.sendMessageToRwg(i.gc,{evt:4167,seq:1,body:{data:e}})},add_monitor2:function(e){e&&(this.monitor?this.monitor=this.monitor+e+"()":this.monitor=e+"()")},add_monitor3:function(e){e&&(this.highfrequencyerror[e]?this.highfrequencyerror[e]+=1:this.highfrequencyerror[e]=1,Object(n.b)(this.highfrequencyerror[e])&&this.add_monitor(e,"Occurred ".concat(this.highfrequencyerror[e]," times")))},checkIsNecessaryExceptionLogAndReturnRepeatTimes:function(e){var t=this,r=!0,i=0;try{return this.checkIsNecessaryLogMap.get(e)&&this.checkIsNecessaryLogMap.get(e)%100!=0&&(r=!1),{isNecessary:r,repeatNumber:void 0===(i=this.checkIsNecessaryLogMap.get(e))?0:i}}catch(e){return{isNecessary:!0,repeatNumber:0}}finally{var a=this.checkIsNecessaryLogMap.get(e)||0;if(this.checkIsNecessaryLogMap.set(e,a+1),this.checkIsNecessaryLogMap.size>200){var n=Array.from(this.checkIsNecessaryLogMap.keys()).slice(0,20);console.log("delete log cache keys",n),n.forEach((function(e){return t.checkIsNecessaryLogMap.delete(e)}))}}}},new e}();t.a=s},function(e,t,r){"use strict";r.r(t),r.d(t,"setUserNodeListToWorker",(function(){return W})),r.d(t,"UpdateAudioPlayStatus",(function(){return U})),r.d(t,"UpdateVideoPlayStatus",(function(){return B})),r.d(t,"UpdateSharingPlayStatus",(function(){return F})),r.d(t,"preserveMessageController",(function(){return H})),r.d(t,"previewController",(function(){return j})),r.d(t,"initVideoEncode",(function(){return K})),r.d(t,"initVideoDecode",(function(){return Q})),r.d(t,"initAudioEncode",(function(){return J})),r.d(t,"initAudioDecode",(function(){return Y})),r.d(t,"initSharingDecode",(function(){return $})),r.d(t,"initSharingEncode",(function(){return te})),r.d(t,"Sharing_Decode_Post_message",(function(){return ie})),r.d(t,"Sharing_Encode_Post_message",(function(){return ne})),r.d(t,"addAudioMonitorLog",(function(){return ge})),r.d(t,"setSharingEngineInitProperties",(function(){return Ee})),r.d(t,"setAudioEngineInitProperties",(function(){return Ie})),r.d(t,"setVideoEngineInitProperties",(function(){return we})),r.d(t,"Set_Audio_WebSocket_Ip_Address",(function(){return Me})),r.d(t,"Set_Audio_Web_Transport_Ip_Address",(function(){return De})),r.d(t,"Set_Video_WebSocket_Ip_Address",(function(){return Re})),r.d(t,"Set_Video_Web_Transport_Ip_Address",(function(){return Te})),r.d(t,"JsAudioEngine_UnInit",(function(){return Pe})),r.d(t,"JsVideoEngine_UnInit",(function(){return xe})),r.d(t,"JsSharingEngine_UnInit",(function(){return Oe})),r.d(t,"Video_Encode_Frame",(function(){return Ve})),r.d(t,"Sharing_Encode_Frame",(function(){return Ne})),r.d(t,"Put_Video_Frame_Buffer",(function(){return We})),r.d(t,"Clear_Decoded_Sharing_Frame",(function(){return Ue})),r.d(t,"Add_Video_Decode_Thread",(function(){return Ge})),r.d(t,"Add_Audio_Decode_Thread",(function(){return Xe})),r.d(t,"Get_SSRC_Latest_Time",(function(){return Ze})),r.d(t,"Get_Video_SSRC_Latest_Time",(function(){return $e})),r.d(t,"Meeting_Fail_Over",(function(){return et})),r.d(t,"Modify_Audio_SampleRate",(function(){return nt})),r.d(t,"Notify_Audio_Thread_Status",(function(){return ot})),r.d(t,"Notify_Audio_Thread_AEC_Status",(function(){return st})),r.d(t,"Notify_Audio_Thread_Msg_Channel",(function(){return ut})),r.d(t,"Notify_Video_Thread_Msg_Channel",(function(){return dt})),r.d(t,"Notify_Video_Sharing_Msg_Channel",(function(){return ct})),r.d(t,"Notify_Audio_Thread_Msg_Channel2",(function(){return ht})),r.d(t,"Notify_Audio_Thread_Msg_Channel3",(function(){return lt})),r.d(t,"Notify_Audio_Video_Thread_Msg_Channel",(function(){return pt})),r.d(t,"Notify_Video_Encode_Thread",(function(){return ft})),r.d(t,"Notify_Video_Encode_Thread_Transferable_Data",(function(){return mt})),r.d(t,"Notify_Video_Decode_Thread",(function(){return gt})),r.d(t,"Notify_Sharing_Video_Encode_Thread_Transferable_Data",(function(){return vt})),r.d(t,"Notify_Sharing_Encode_Thread_Transferable_Data",(function(){return St})),r.d(t,"Notify_Sharing_Video_Decode_Thread",(function(){return _t})),r.d(t,"Notify_Sharing_Decode_Thread",(function(){return Ct})),r.d(t,"Notify_Audio_Thread_CurrentSSRC",(function(){return yt})),r.d(t,"Notify_Audio_Encode_Thread",(function(){return bt})),r.d(t,"Notify_Audio_Decode_Thread",(function(){return At})),r.d(t,"Notify_Audio_Thread_Interpretation_Enable",(function(){return kt})),r.d(t,"Notify_Audio_Thread_CC_Set_Lang",(function(){return Et})),r.d(t,"Notify_Audio_Thread_Interpretation_Set_Lang",(function(){return It})),r.d(t,"Notify_Audio_Thread_Interpretation_Mute",(function(){return wt})),r.d(t,"Notify_Audio_Thread_Interpretation_Set_Interpreter",(function(){return Mt})),r.d(t,"Reset_Aec",(function(){return Dt})),r.d(t,"Set_Aec_Delay",(function(){return Rt})),r.d(t,"Start_Monitor",(function(){return xt})),r.d(t,"Send_Render_Monitor_Log",(function(){return Ot})),r.d(t,"Stop_Monitor",(function(){return Vt})),r.d(t,"Update_Video_Encrpt",(function(){return Nt})),r.d(t,"Update_Sharing_Encrpt",(function(){return Lt})),r.d(t,"Update_Sharing_Video_Encode_Status",(function(){return Wt})),r.d(t,"Update_Sharing_Encode_Status",(function(){return Ut})),r.d(t,"Notify_Sharing_Video_Encode_Thread",(function(){return Bt})),r.d(t,"Notify_Sharing_Encode_Thread",(function(){return Ft})),r.d(t,"Update_Audio_Encrpt",(function(){return Gt})),r.d(t,"disableSocketReconnect",(function(){return Ht})),r.d(t,"closeAllMedia",(function(){return jt})),r.d(t,"destroyAllWorkers",(function(){return Kt})),r.d(t,"pushMessageToWorker",(function(){return Jt})),r.d(t,"isVideoEncodeHandleReady",(function(){return Yt})),r.d(t,"transportSettingCanvas",(function(){return Zt})),r.d(t,"initResourceManager",(function(){return $t})),r.d(t,"prepareVBfile",(function(){return tr})),r.d(t,"transportImageBitMap",(function(){return rr})),r.d(t,"transportBgImageBitMap",(function(){return ir})),r.d(t,"transportVBBgImageBitMap",(function(){return ar})),r.d(t,"transportMaskImageBitMap",(function(){return nr})),r.d(t,"MirrorSendVideo",(function(){return or})),r.d(t,"isSharingNotClearChromeVersion",(function(){return sr})),r.d(t,"MEDIA_INIT_SUCCESS_CALLBACK_METADATA",(function(){return ur}));var i,a=r(16),n=r.n(a),o=r(35),s=r.n(o),u=r(15),d=r.n(u),c=r(19),h=r.n(c),l=r(7),p=r.n(l),f=r(3),m=r.n(f),g=r(1),v=r(9),S=r(18),_=r(6),C=r(13),y=r(8),b=r(10),A=r(4),k=r(2),E=r(0),I=["name","messageParams","direction"];function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){n()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D=Object(C.a)("sdk.engine"),R=_.g.isSupportVideoShareSend()&&_.g.isSupportVideoShareReceive();function T(e,t){return P.apply(this,arguments)}function P(){return(P=p()(m.a.mark((function e(t,r){var i,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===k.g.VIDEO_ENCODE?3:e.t0===k.g.VIDEO_DECODE?5:e.t0===k.g.AUDIO_ENCODE?7:e.t0===k.g.AUDIO_DECODE?9:e.t0===k.g.SHARING_DECODE?11:e.t0===k.g.SHARING_ENCODE?13:15;break;case 3:return i=E.a.videoEncResponseText,e.abrupt("break",15);case 5:return i=E.a.videoDecResponseText,e.abrupt("break",15);case 7:return i=E.a.audioEncodeResponse,e.abrupt("break",15);case 9:return i=E.a.audioDecodeResponse,e.abrupt("break",15);case 11:return i=E.a.sharingDecodeResponse,e.abrupt("break",15);case 13:return i=E.a.sharingEncodeResponse,e.abrupt("break",15);case 15:if(i){e.next=19;break}return e.next=18,O(r.workerJsFileUrl,r.integrityHelper);case 18:i=e.sent;case 19:return a="wasmUrl = '"+r.workerWasmFileUrl+"';","self.__wasmCodeDataEndFlag = 1;",n=/self\.__wasmCodeDataEndFlag\s*=\s*1[;|,]/,e.abrupt("return",i.replace(n,a+"self.__wasmCodeDataEndFlag = 1;"));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=p()(m.a.mark((function e(t,r,i,a,n){var o,s,u;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.isDestroy){e.next=3;break}return A.a.add_monitor("ZIDX",a),e.abrupt("return",D("WorkerType:".concat(a,";The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. ")));case 3:if(o={},k.i[a]&&Object.assign(o,{name:k.i[a]}),!1,a==k.g.AUDIO_ENCODE?window.AEW&&(s=window.AEW):a==k.g.AUDIO_DECODE&&window.ADW&&(s=window.ADW),s){e.next=23;break}return e.t0=window.URL,e.t1=Blob,e.next=12,T(a,t);case 12:e.t2=e.sent,e.t3=[e.t2],e.t4=new e.t1(e.t3),u=e.t0.createObjectURL.call(e.t0,e.t4),(s=new Worker(u,o)).addEventListener("error",(function(e){y.a.error("Uncaught exception in worker of type ".concat(a),e)})),s.addEventListener("unhandledrejection",(function(e){y.a.error("Unhandled Promise rejection in worker of type ".concat(a,": ").concat(e.reason))})),a===k.g.VIDEO_ENCODE&&s.postMessage({command:"WORKER_BOLB_URL",blobUrl:u}),E.a.mediaSDKHandle.is32bitbrowser&&(a==k.g.AUDIO_ENCODE?window.AEW=s:a==k.g.AUDIO_DECODE&&(window.ADW=s)),e.next=24;break;case 23:a==k.g.AUDIO_ENCODE?window.AEWF=!0:a==k.g.AUDIO_DECODE&&(window.ADWF=!0);case 24:r&&r.call(i,s);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){var r=null;return t&&(r=t.getIntegrity()),_.g.download(e,r)}function V(e,t,r,i,a){var n=this;return new Promise((function(o,s){!function(e,t,r,i,a){x.apply(this,arguments)}(e,(function(e){var a=E.a.SPECIAL_ID;t&&(A.a.add_monitor("WAM"+i),t.Add(a,e)),e.onmessage=function(e){r(e)},o()}),n,i,a)}))}function N(e,t){var r=t.data;[L].forEach((function(t){try{t.call(null,e,r)}catch(e){y.a.error("Error from allWorkersListener_AES_IV",e)}}))}function L(e,t){-1!==[k.g.AUDIO_ENCODE,k.g.VIDEO_ENCODE,k.g.SHARING_ENCODE].indexOf(e)&&t.status===g.c&&(D("allWorkersListener_AES_IV",e,t),E.a.Notify_APPUI_SAFE(g.d,{workerType:e,iv:_.g.buffer2stringSplitByComma(t.data)}))}function W(e){var t=E.a.userNodeList||[],r=e.concat(t);E.a.userNodeList=_.g.removeDuplicates(r,(function(e,t){return e.userid!==t.userid})),[k.g.AUDIO_ENCODE,k.g.AUDIO_DECODE,k.g.VIDEO_ENCODE,k.g.VIDEO_DECODE,k.g.SHARING_ENCODE,k.g.SHARING_DECODE].forEach(function(){var e=p()(m.a.mark((function e(t){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===k.g.AUDIO_ENCODE?3:e.t0===k.g.AUDIO_DECODE?5:e.t0===k.g.VIDEO_ENCODE?7:e.t0===k.g.VIDEO_DECODE?9:e.t0===k.g.SHARING_ENCODE?11:e.t0===k.g.SHARING_DECODE?13:15;break;case 3:return r=E.a.audioEncodeInitInstance,e.abrupt("break",15);case 5:return r=E.a.audioDecInitInstance,e.abrupt("break",15);case 7:return r=E.a.videoInitInstance,e.abrupt("break",15);case 9:return r=E.a.videoDecInitInstance,e.abrupt("break",15);case 11:return r=E.a.sharingEncInitInstance,e.abrupt("break",15);case 13:return r=E.a.sharingDecInitInstance,e.abrupt("break",15);case 15:return e.prev=15,e.next=18,r.waitforInitSuccess();case 18:D("setUserNodeListToWorker init success",t),Jt(t,{userNodeList:E.a.userNodeList},k.d.SET_USER_NODE_LIST,!1,!0),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(15),y.a.error("Error when sending user node list to worker",e.t1);case 25:case"end":return e.stop()}}),e,null,[[15,22]])})));return function(t){return e.apply(this,arguments)}}())}function U(e){E.a.isAudioPlayWork=e}function B(e){E.a.isVideoPlayWork=e,Jt(k.g.VIDEO_DECODE,{isVideoPlayWork:e},"VideoPlayStatus",!1,!0)}function F(e){E.a.isSharingPlayWork=e}var G,H=(G={SDK_TO_WORKER:"SDK_TO_WORKER",SDK_TO_WORKER_WAIT_OK:"SDK_TO_WORKER_WAIT_OK",SDK_TO_APP:"SDK_TO_APP",SDK_TO_SDK:"SDK_TO_SDK"},{nameMap:{INIT_VIDEO_ENCODE_SUCCESS:"INIT_VIDEO_ENCODE_SUCCESS",INIT_VIDEO_DECODE_SUCCESS:"INIT_VIDEO_DECODE_SUCCESS",CREATE_VIDEO_ENCODE_HANDLE_SUCCESS:"CREATE_VIDEO_ENCODE_HANDLE_SUCCESS",CREATE_VIDEO_DECODE_HANDLE_SUCCESS:"CREATE_VIDEO_DECODE_HANDLE_SUCCESS",CREATE_AUDIO_ENCODE_HANDLE_SUCCESS:"CREATE_AUDIO_ENCODE_HANDLE_SUCCESS",CREATE_AUDIO_DECODE_HANDLE_SUCCESS:"CREATE_AUDIO_DECODE_HANDLE_SUCCESS"},map:new Map,direction:G,clear:function(){this.map.clear()},subscribeMessage:function(e){var t=this.map.get(e);t&&(t.forEach((function(e){var t=e.direction,r=e.messageParams,i=e.handler;if(t===G.SDK_TO_APP)E.a.Notify_APPUI.apply(E.a,h()(r));else if(t===G.SDK_TO_WORKER_WAIT_OK)Jt.apply(void 0,h()(r));else if(t===G.SDK_TO_WORKER){var a=d()(r,2),n=a[0],o=a[1],s=qt(n);s&&s.postMessage(o)}else t===G.SDK_TO_SDK&&i&&i(r)})),this.map.delete(e))},enqueueMessage:function(e){var t=e.name,r=e.messageParams,i=e.direction,a=s()(e,I);this.map.has(t)||this.map.set(t,[]),this.map.get(t).push(M({direction:i,messageParams:r||[]},a))}}),j={resetAudioEncode:function(e){!e&&E.a.isPreviewMode.audioEncode&&(E.a.isAudioEncodePostStart=!1),E.a.isPreviewMode.audioEncode=!!e},resetAudioDecode:function(e){!e&&E.a.isPreviewMode.audioDecode&&(E.a.isAudioDecodePostStart=!1),E.a.isPreviewMode.audioDecode=!!e},resetVideoEncode:function(e){!e&&E.a.isPreviewMode.videoEncode&&(E.a.isVideoEncodePostStart=!1),E.a.isPreviewMode.videoEncode=!!e},resetVideoDecode:function(e){!e&&E.a.isPreviewMode.videoDecode&&(E.a.isVideoDecodePostStart=!1),E.a.isPreviewMode.videoDecode=!!e}};function K(e,t){return q.apply(this,arguments)}function q(){return(q=p()(m.a.mark((function e(t,r){var i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.a.localVideoEncMGR||(E.a.localVideoEncMGR=new S.d),E.a.videoEncWorkerPath=t.workerJsFileUrl,e.next=4,O(t.workerJsFileUrl,t.integrityHelper);case 4:return i=e.sent,E.a.videoEncResponseText=i,e.next=8,qe(0,null,r,t);case 8:return H.subscribeMessage(H.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS),e.next=11,je();case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t){return z.apply(this,arguments)}function z(){return(z=p()(m.a.mark((function e(t,r){var i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.a.localVideoDecMGR||(E.a.localVideoDecMGR=new S.d),E.a.videoDecWorkerPath=t.workerJsFileUrl,e.next=4,O(t.workerJsFileUrl,t.integrityHelper);case 4:return i=e.sent,E.a.videoDecResponseText=i,e.next=8,Ge(0,null,r,t);case 8:return H.subscribeMessage(H.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS),e.next=11,Be();case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t){return X.apply(this,arguments)}function X(){return(X=p()(m.a.mark((function e(t,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ae();case 2:return E.a.localAudioEncMGR||(E.a.localAudioEncMGR=new S.a),E.a.audioEncWorkerPath=t.workerJsFileUrl,e.next=6,O(t.workerJsFileUrl,t.integrityHelper);case 6:return E.a.audioEncodeResponse=e.sent,e.next=9,it(0,r,t);case 9:return H.subscribeMessage(H.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS),e.next=12,tt();case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return Z.apply(this,arguments)}function Z(){return(Z=p()(m.a.mark((function e(t,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ae();case 2:return E.a.localAudioDecMGR||(E.a.localAudioDecMGR=new S.a),E.a.audioDecWorkerPath=t.workerJsFileUrl,e.next=6,O(t.workerJsFileUrl,t.integrityHelper);case 6:return E.a.audioDecodeResponse=e.sent,"string"==typeof E.a.audioDecodeResponse?A.a.add_monitor("DAFL"+E.a.audioDecodeResponse.length):A.a.add_monitor("DAFF"),e.next=10,Xe(0,null,r,t);case 10:return H.subscribeMessage(H.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS),A.a.add_monitor("ADTS"),e.next=14,ze();case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return ee.apply(this,arguments)}function ee(){return(ee=p()(m.a.mark((function e(t,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.a.localSharingDecMGR||(E.a.localSharingDecMGR=new S.b),E.a.localMouseDecMGR||(E.a.localMouseDecMGR=new S.b),E.a.sharingDecWorkerPath=t.workerJsFileUrl,e.next=5,O(t.workerJsFileUrl,t.integrityHelper);case 5:return E.a.sharingDecodeResponse=e.sent,e.next=8,ye(r,t);case 8:return e.next=10,ie();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t){return re.apply(this,arguments)}function re(){return(re=p()(m.a.mark((function e(t,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.a.localSharingEncMGR||(E.a.localSharingEncMGR=new S.b),E.a.sharingEncWorkerPath=t.workerJsFileUrl,e.next=4,O(t.workerJsFileUrl,t.integrityHelper);case 4:return E.a.sharingEncodeResponse=e.sent,e.next=7,_e(r,t);case 7:return e.next=9,ne();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=p()(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.sharingDecInitInstance.wasmSuccessPromise;case 2:(t=E.a.localSharingDecMGR.Get(E.a.SPECIAL_ID))&&!E.a.isSharingDecodePostStart&&(t.postMessage({command:"startMedia",websocket_ip_address:E.a.Sharing_WebSocket_Ip_Address,confId:E.a.localSharingPara.userid,confKey:"",logon:E.a.localSharingPara.logon,meetingid:E.a.localSharingPara.meetingid,meetingnumb:E.a.localSharingPara.meetingnumb,multiThreadNum:1,enableReplaceCanvasWhenContextLost:E.a.enableReplaceCanvasWhenContextLost}),E.a.isSharingDecodePostStart=!0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){return oe.apply(this,arguments)}function oe(){return(oe=p()(m.a.mark((function e(){var t,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.sharingEncInitInstance.wasmSuccessPromise;case 2:(t=E.a.localSharingEncMGR.Get(E.a.SPECIAL_ID))&&!E.a.isSharingEncodePostStart&&(1,A.a.add_monitor2("STN1"),r=null,E.a.ivObj&&(r=E.a.ivObj[k.g.SHARING_ENCODE],r=_.g.stringSplitByComma2Buffer(r)),t.postMessage({command:"startMedia",encode:!0,websocket_ip_address:E.a.Sharing_WebSocket_Ip_Address,confId:E.a.localSharingPara.userid,confKey:"",logon:E.a.localSharingPara.logon,isChromeOrEdge:_.g.browser.isChrome,meetingid:E.a.localSharingPara.meetingid,meetingnumb:E.a.localSharingPara.meetingnumb,multiThreadNum:1,iv:r,uplimit:E.a.uplimit}),E.a.isSharingEncodePostStart=!0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){var t=e.data;E.a.SPECIAL_ID;try{!function(){if(t.status===g.zd)(function(e){try{var t=e.ssrcFromPDU;if(null==t)return!0;return(4294966272&E.a.localSharingPara.userid)!=(4294966272&t)}catch(e){return!0}})(t.data)&&Le(t.data);else if(t.status===g.Gd)b.a.publish(g.Xc,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}}),E.a.Notify_APPUI(g.Wc,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}});else if(t.status===g.Ib)E.a.Notify_APPUI(g.Hb,t.ssrc);else if(t.status===g.Zc)A.a.add_monitor2(t.data);else if(t.status===g.Sc)E.a.Notify_APPUI(g.Tc,{ssrc:t.ssrc});else if(t.status===g.Mc)!function(e,t,r,i,a,n,o,s,u,d,c,h,l){if(!E.a.isSharingPlayWork)return;var p={yuvdata:t,ntptime:r,ssrc:e,width:i,height:a,r_x:n,r_y:o,r_w:s,r_h:u,logic_w:d,logic_h:c,yuv_limited:h,isFromMainSession:l};E.a.mediaSDKHandle.SharingRenderObj.Put_Sharing_Data_From_Queue(p)}(t.sharing_ssrc,t.data,t.sharing_timestamp,t.sharing_width,t.sharing_height,t.rendering_x,t.rendering_y,t.rendering_w,t.rendering_h,t.logic_w,t.logic_h,t.yuv_limited,t.isFromMainSession);else if(t.status===g.ic)!function(e,t,r,i,a,n,o,s,u,d){if(!E.a.isSharingPlayWork)return;var c={buffer:t,ntptime:r,ssrc:e,width:i,height:a,r_x:n,r_y:o,mLogic_w:s,mLogic_h:u,sync_id:d};E.a.mediaSDKHandle.SharingRenderObj.Put_Mouse_Data_Into_Queue(c)}(t.mouse_ssrc,t.data,t.mouse_timestamp,t.mouse_width,t.mouse_height,t.mouse_x,t.mouse_y,t.mLogic_w,t.mLogic_h,t.sync_id);else if(t.status===g.Oc)E.a.Notify_APPUI(g.Nc,{ssrc:t.ssrc,size:t.size,fps:t.size});else if(t.status===g.fe){var r=M({encoding:!1},t.data);E.a.Notify_APPUI_SAFE(g.fe,r)}else if(t.status===g.Bd)A.a.add_monitor("SDWS"),E.a.isSharingDecodeWASMOK=!0,E.a.sharingDecInitInstance.setWasmSuccess();else if(t.status===g.Ad)A.a.add_monitor("SDWF"),E.a.sharingDecInitInstance.setWasmSuccess(!1);else if(t.status===g.Fd)A.a.add_monitor("SDHS"),E.a.sharingDecInitInstance.setHanderSuccess();else if(t.status===g.Ed)A.a.add_monitor("SHHF"),E.a.sharingDecInitInstance.setHanderSuccess(!1);else if(t.status===g.Dd)A.a.add_monitor("SDSS"),E.a.sharingDecInitInstance.setSocketSuccess();else if(t.status===g.Cd)A.a.add_monitor("SDSF"),E.a.sharingDecInitInstance.isSocketInitSuccess()&&E.a.Notify_APPUI_SAFE(g.ve,null),E.a.sharingDecInitInstance.setSocketSuccess(!1);else{if(t.status==g.hc)return void Pt(t.data);if(t.status===g.zb){var i=E.a.localSharingDecMGR.map.get(E.a.SPECIAL_ID);pe(t.url,i)}else if(t.status==g.e)E.a.monitorSharingDecodeAPPInfo=t,Pt(E.a.monitorSharingDecodeAPPInfo.data),E.a.monitorSharingDecodeAPPInfo=null;else if(t.status==g.Pe)A.a.add_monitor("SD"+t.data);else if(t.status==v.g)y.a.error("Error from sharing decode worker: ".concat(t.errorMessage),t.errorEvent);else if(t.status==g.kc)E.a.Notify_APPUI(g.Re,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas});else if(t.status==g.Pc)E.a.monitorDecodeSharing=t;else if(t.status==g.oe){var a=t.data;b.a.triggerSync(g.je,a)}else"SHARING_DECODE_PTR"==t.status?b.a.triggerSync("SHARING_DECODE_PTR",t):"WFMO"==t.status?le(k.g.SHARING_DECODE):N(k.g.SHARING_DECODE,e)}}()}catch(e){D.error(e)}}function ue(e){var t=e.data;E.a.SPECIAL_ID;try{!function(){if(t.status===g.zd)Le(t.data);else if(t.status===g.Uc)A.a.add_monitor("GIDF");else if(t.status===g.Bd)A.a.add_monitor("SEWS"),E.a.isSharingEncodeWASMOK=!0,E.a.sharingEncInitInstance.setWasmSuccess();else if(t.status===g.Ad)A.a.add_monitor("SEWF"),E.a.sharingEncInitInstance.setWasmSuccess(!1);else if(t.status===g.Fd)A.a.add_monitor("SEHS"),E.a.sharingEncInitInstance.setHanderSuccess();else if(t.status===g.Ed)A.a.add_monitor("SEHF"),E.a.sharingEncInitInstance.setHanderSuccess(!1);else if(t.status===g.Dd)A.a.add_monitor("SESS"),E.a.sharingEncInitInstance.setSocketSuccess();else if(t.status===g.Cd)A.a.add_monitor("SEWF"),E.a.sharingEncInitInstance.isSocketInitSuccess()&&E.a.Notify_APPUI_SAFE(g.ve,null),E.a.sharingEncInitInstance.setSocketSuccess(!1);else if(t.status==g.Lc)A.a.add_monitor2("SCFOK");else if(t.status==g.Jd)A.a.add_monitor("SCFF"+t.format);else if(t.status==g.we)E.a.mediaSDKHandle.isSupportVideoTrackReader?(E.a.mediaSDKHandle.canISendNextSharingFrame=!0,E.a.mediaSDKHandle.Process_Sharing()):E.a.mediaSDKHandle.Process_Sharing();else if(t.status==g.cf)E.a.mediaSDKHandle.Process_Sharing();else if(t.status===g.mb)E.a.Notify_APPUI(g.lb,{width:t.width,height:t.height});else{if(t.status==g.hc)return void Pt(t.data);if(t.status==g.zb){var r=E.a.localSharingEncMGR.map.get(E.a.SPECIAL_ID);pe(t.url,r)}else if(t.status===g.fe){var i=M({encoding:!0},t.data);E.a.Notify_APPUI_SAFE(g.fe,i)}else t.status==g.e?(E.a.monitorSharingEncodeAPPInfo=t,Pt(E.a.monitorSharingEncodeAPPInfo.data),E.a.monitorSharingEncodeAPPInfo=null):t.status==g.Pe?A.a.add_monitor("SE"+t.data):t.status==g.kc?E.a.Notify_APPUI(g.Re,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas}):t.status==v.g?y.a.error("Error from sharing encode worker: ".concat(t.errorMessage),t.errorEvent):t.status==g.Ve?E.a.Notify_APPUI(g.Le,{data:t.data}):"WFMO"==t.status?le(k.g.SHARING_ENCODE):N(k.g.SHARING_ENCODE,e)}}()}catch(e){D.error(e)}}function de(e){var t=e.data,r=(E.a.SPECIAL_ID,!0);try{!function(){if(t.status===g.ie);else if("NewActiveSpeakerFirstframeCallback"===t.status)E.a.Notify_APPUI(g.nc,{ssrc:t.ssrc});else if(t.status===g.se)E.a.Notify_APPUI(g.qb,{width:t.width,height:t.height});else if(t.status===g.oe){var i=t.data;b.a.triggerSync(g.je,i)}else if(t.status===g.Xe){var a=E.a.mediaSDKHandle.videoDecodeFrameBackSABRingBufferConsumer;a&&a.consumeAll(E.a.mediaSDKHandle.bVideoDecodeFrameBackSABRingBufferConsumeCopyData)}else if(t.status===g.re)A.a.add_monitor2(t.data);else if(t.status==g.kc)A.a.add_monitor("MWGLF"),E.a.Notify_APPUI(g.Re,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas});else if(t.status==g.Qe)A.a.add_monitor("MWCGLF");else if(t.status===g.le){var n=t.data;b.a.triggerSync(g.je,n)}else if(0===t.status)We(t.video_ssrc,t.data,t.video_timestamp,t.video_width,t.video_height,t.rendering_x,t.rendering_y,t.rendering_w,t.rendering_h,t.rotation,t.yuv_limited);else if(t.status===g.Ae)A.a.add_monitor("VDWS"),E.a.isVideoDecodeWASMOK=!0,E.a.videoDecInitInstance.setWasmSuccess(),E.a.videoDecInitInstance.setSocketSuccess(),E.a.isPreviewMode.videoDecode&&E.a.Notify_APPUI_SAFE(g.vc);else if(t.status===g.sb){var o=t.size;_.g.isGoogleNestChrome()&&(o=o<=2?o:2),E.a.Notify_APPUI(g.ke,{ssrc:t.ssrc,size:o}),A.a.add_monitor("VDMS:"+o)}else if(t.status===g.ze)A.a.add_monitor("VDWF"),E.a.videoDecInitInstance.setWasmSuccess(!1);else if(t.status===g.ye)A.a.add_monitor("VDHS"),E.a.videoDecInitInstance.setHanderSuccess();else if(t.status===g.xe)A.a.add_monitor("VDHF"),E.a.videoDecInitInstance.setHanderSuccess(!1);else if(t.status===g.Ce)A.a.add_monitor("VDSS");else if(t.status===g.Be)A.a.add_monitor("VDSF"),E.a.videoDecInitInstance.isSocketInitSuccess()&&E.a.Notify_APPUI_SAFE(g.ve,null),E.a.videoDecInitInstance.setSocketSuccess(!1);else if(t.status===g.gb)A.a.add_monitor("VDWPS");else if(t.status===g.fb)A.a.add_monitor("VDWPCLOSE"),E.a.sendMessageToRwg(g.Ec,{evt:g.ef,body:{flag:2,type:k.h.ZOOM_CONNECTION_VIDEO}},!1);else if(t.status===g.eb)A.a.add_monitor("VDWSCLOSE");else if(t.status===g.ob)A.a.add_monitor("VDTTP:"+t.type);else if(t.status==g.hc)E.a.monitorDecodeVideo=t,Pt(t.data),r=!1;else if(t.status==g.e)E.a.monitorVideoDecodeAPPInfo=t,E.a.sendMessageToRwg(g.gc,{evt:4167,seq:1,body:{data:E.a.monitorVideoDecodeAPPInfo.data}}),E.a.monitorVideoDecodeAPPInfo=null;else if(t.status==g.zb){var s=E.a.localVideoDecMGR.map.get(E.a.SPECIAL_ID);pe(t.url,s)}else if(t.status==g.Pe)A.a.add_monitor("VD"+t.data);else if(t.status==v.g)y.a.error("Error from video decode worker: ".concat(t.errorMessage),t.errorEvent);else if(t.status===g.kb)E.a.Notify_APPUI_SAFE(g.kb,t.data);else if(t.status===g.jb)E.a.Notify_APPUI_SAFE(g.jb,t.data);else if(t.status===g.qe){var u=M({encoding:!1},t.data);E.a.Notify_APPUI_SAFE(g.qe,u)}else t.status===g.Kb?A.a.add_monitor(t.data):"VIDEO_DECODE_PTR"===t.status?b.a.triggerSync("VIDEO_DECODE_PTR",t):"FIRST_VIDEO_FRAME"===t.status?E.a.Notify_APPUI_SAFE(g.Jb):t.status===g.mc?E.a.Notify_APPUI_SAFE(g.mc,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):"WFMO"==t.status?le(k.g.VIDEO_DECODE):N(k.g.VIDEO_DECODE,e)}()}catch(e){D.error(e)}r&&R&&se(e)}function ce(e){var t=e.data,r=(E.a.SPECIAL_ID,!0);if(t!==g.Ye){try{!function(){if(t.status===g.ie);else if("VBPredictDone"===t.status)A.a.add_monitor("VBPOK"+t.predictCostTime),E.a.isPreviewMode.videoEncode&&H.enqueueMessage({name:H.nameMap.INIT_VIDEO_ENCODE_SUCCESS,messageParams:[g.ee,null],direction:H.direction.SDK_TO_APP}),E.a.Notify_APPUI(g.ee,null);else if("VBPredictAbout3s"===t.status)A.a.add_monitor("VBP3S"),E.a.Notify_APPUI(g.de,null);else if("VBPredictAbout10s"===t.status)A.a.add_monitor("VBP10S"),E.a.Notify_APPUI(g.ce,null);else if(t.status===g.oe){var i=t.data;b.a.triggerSync(g.je,i)}else if(0===t.status);else if(t.status===g.Ge||t.status===g.Ae)A.a.add_monitor("VEWS"),E.a.isVideoEncodeWASMOK=!0,E.a.videoInitInstance.setWasmSuccess();else if(t.status===g.Fe)A.a.add_monitor("VEWF"),E.a.videoInitInstance.setWasmSuccess(!1);else if(t.status===g.Ee||g.ye===t.status)A.a.add_monitor("VEHS"),E.a.videoInitInstance.setHanderSuccess();else if(t.status===g.De||g.xe===t.status)A.a.add_monitor("VEHF"),E.a.videoInitInstance.setHanderSuccess(!1);else if(t.status===g.Ie||g.Ce===t.status)A.a.add_monitor("VESS"),E.a.videoInitInstance.setSocketSuccess();else if(t.status===g.He||t.status===g.Be)A.a.add_monitor("VESF"),E.a.videoInitInstance.isSocketInitSuccess()&&E.a.Notify_APPUI_SAFE(g.ve,null),E.a.videoInitInstance.setSocketSuccess(!1);else if(t.status===g.gb)A.a.add_monitor("VEWPS");else if(t.status===g.fb)A.a.add_monitor("VEWPCLOSE");else if(t.status===g.eb)A.a.add_monitor("VEWSCLOSE");else if(t.status===g.ob)A.a.add_monitor("VETTP:"+t.type);else if(t.status===g.nb)A.a.add_monitor("VEHORS:"+t.type);else if(t.status===g.we)E.a.mediaSDKHandle.Process_Video();else if(t.status===g.ib)E.a.Notify_APPUI(g.hb,{width:t.width,height:t.height});else if(t.status===g.ge)A.a.add_monitor("VCRC"+t.width),E.a.mediaSDKHandle.Change_Video_Capture_Resolution(t.width,t.height);else if(t.status==g.he)A.a.add_monitor2("VCFOK");else if(t.status==g.Kd)A.a.add_monitor("VCFF","format: ".concat(t.format));else{if(t.status==g.hc)return r=!1,void Pt(t.data);if(t.status==g.e)E.a.monitorVideoEncodeAPPInfo=t,Pt(E.a.monitorVideoEncodeAPPInfo.data),E.a.monitorVideoEncodeAPPInfo=null;else if(t.status==g.Pc)E.a.monitorEncodeSharing=t;else if(t.status===g.zb){var a=E.a.localVideoEncMGR.map.get(E.a.SPECIAL_ID);pe(t.url,a)}else if(t.status==g.Pe)A.a.add_monitor("VE"+t.data);else if(t.status==v.g)y.a.error("Error from video encode worker: ".concat(t.errorMessage),t.errorEvent);else if(t.status==g.Hd){var n=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR)(o=E.a.localVideoDecMGR.map.get(n))&&o.postMessage({command:"encodedbuffer",wasmMemory:t.wasmMemory})}else if(t.status==g.Ke){var o,s=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR)(o=E.a.localVideoDecMGR.map.get(s))&&o.postMessage({command:"encodedimagebitmapwasmptr",data:t.data,wasmMemory:t.wasmMemory});else E.a.isPreviewMode.videoEncode&&H.enqueueMessage({name:H.nameMap.INIT_VIDEO_DECODE_SUCCESS,messageParams:[k.g.VIDEO_DECODE,{command:"encodedimagebitmapwasmptr",data:t.data,wasmMemory:t.wasmMemory}],direction:H.direction.SDK_TO_WORKER})}else if(t.status===g.qe){var u=M({encoding:!0},t.data);E.a.Notify_APPUI_SAFE(g.qe,u)}else if(t.status===g.fe){var d=M({encoding:!0},t.data);E.a.Notify_APPUI_SAFE(g.fe,d)}else t.status==g.kc?E.a.Notify_APPUI(g.Re,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas}):"VIDEO_ENCODE_PTR"===t.status?b.a.triggerSync("VIDEO_ENCODE_PTR",t):t.status===g.Je?E.a.mediaSDKHandle.init_Notify_APPUI(!0,k.g.VIDEO_ENCODE):t.status==g.te?E.a.mediaSDKHandle.Change_Sharing_Capture_Resolution(t.mode):t.status===g.mc?E.a.Notify_APPUI_SAFE(g.mc,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):"WFMO"==t.status?le(k.g.VIDEO_ENCODE):N(k.g.VIDEO_ENCODE,e)}}()}catch(e){D.error(e)}r&&R&&ue(e)}else{var i=E.a.mediaSDKHandle.videoEncodeRingbufferConsumer;i&&i.consumeAll()}}function he(e,t){return new WebAssembly.Memory({initial:e,maximum:t,shared:!0})}function le(e){var t,r,i=!1,a=_.g.isIphoneOrIpadBrowser()?4096:8192;(e==k.g.VIDEO_ENCODE?(r=E.a.localVideoEncMGR.map.get(0),window.VE?i=!0:(R&&(a=16384),window.VE=he(1024,a)),t=window.VE):e==k.g.VIDEO_DECODE?(r=E.a.localVideoDecMGR.map.get(0),window.VD?i=!0:(R&&(a=16384),window.VD=he(1024,a)),t=window.VD):e==k.g.SHARING_ENCODE?(r=E.a.localSharingEncMGR.map.get(0),window.SE?i=!0:window.SE=he(1024,a),t=window.SE):e==k.g.SHARING_DECODE&&(r=E.a.localSharingDecMGR.map.get(0),window.SD?i=!0:window.SD=he(1024,a),t=window.SD),i)&&new Uint8Array(t.buffer).fill(0);r.postMessage({command:"wasmMemory",data:t})}function pe(e,t){_.g.downloadBinary(e).then((function(e){t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_OK",data:e})})).catch((function(e){t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_FAILED",data:e.message})}))}var fe,me,ge=(fe={send:null,recv:null},me=null,{push:function(e){var t=e.log,r=e.isSend;t&&(-1===t.indexOf("SPEECHOUTPUT")&&-1===t.indexOf("SPEECHINPUT")||(r?fe.send=t:fe.recv=t,this._clearTImer(),me=setTimeout((function(){if(fe.send||fe.recv){var e=/(WCL_MCM_AUDIO)(.*?)(\d+)(.*?)(\{\[SPEECHOUTPUT\]\})(.*?)(\{\[NETWORK\]\})(.*?)(\{\[END\]\})/.exec(fe.send||"")||[],t=/(WCL_MCM_AUDIO)(.*?)(\d+)(.*?)(\{\[SPEECHINPUT\]\})(.*?)(\{\[SEND\]\})(.*?)(\{\[DENOISE\]\})(.*?)(\{\[END\]\})/.exec(fe.recv||"")||[],r="".concat(e[1]||t[1]).concat(e[2]||t[2]||"").concat(e[3]||t[3]).concat(e[4]||t[4]||""),i=(t[6]||",0,0,0,").trim(),a=(e[6]||",0,0,0,").trim();","===i[i.length-1]&&","===a[0]?i=i.slice(0,i.length-1):","!==i[i.length-1]&&","!==a[0]&&(i+=",");var n="{[SPEECH]}".concat(i).concat(a,"{[NETWORK]}").concat(e[8]||",0,0,0,","{[SEND]}").concat(t[8]||",0,0,","{[DENOISE]}").concat(t[10],"{[END]}"),o="".concat(r).concat(n);E.a.sendMessageToRwg(g.gc,{evt:4167,seq:1,body:{data:o}})}}),2e3)))},_clearTImer:function(){clearTimeout(me),me=null},clear:function(){fe={send:null,recv:null},this._clearTImer()}});function ve(e){var t=e.data;E.a.SPECIAL_ID;try{!function(){if(0===t.status)t.time?E.a.AudioNode&&E.a.AudioNode.postData("data",{ssrc:E.a.CurrentSSRC,data:t.data,time:t.time}):E.a.AudioNode&&E.a.AudioNode.postData("data",{ssrc:E.a.CurrentSSRC,data:t.data,time:null});else if(t.status===g.J||t.status===g.E)A.a.add_monitor("ADWS"),E.a.isAudioDecodeWASMOK=!0,E.a.audioDecInitInstance.setWasmSuccess(),E.a.isPreviewMode.audioDecode&&E.a.Notify_APPUI_SAFE(g.uc);else if(t.status===g.D)A.a.add_monitor("ADWF"),E.a.audioDecInitInstance.setWasmSuccess(!1);else if(t.status===g.C)A.a.add_monitor("ADHS"),E.a.audioDecInitInstance.setHanderSuccess();else if(t.status===g.B)A.a.add_monitor("ADHF"),E.a.audioDecInitInstance.setHanderSuccess(!1);else if(t.status===g.G)A.a.add_monitor("ADSS"),E.a.audioDecInitInstance.setSocketSuccess();else if(t.status===g.F)A.a.add_monitor("ADSF"),E.a.audioDecInitInstance.isSocketInitSuccess()&&E.a.Notify_APPUI_SAFE(g.y,null),E.a.audioDecInitInstance.setSocketSuccess(!1);else if(t.status===g.gb)A.a.add_monitor("ADWPS");else if(t.status===g.fb)A.a.add_monitor("ADWPCLOSE"),E.a.sendMessageToRwg(g.Ec,{evt:g.ef,body:{flag:2,type:k.h.ZOOM_CONNECTION_AUDIO}},!1);else if(t.status===g.eb)A.a.add_monitor("ADWSCLOSE");else if(t.status===g.ob)A.a.add_monitor("ADTTP:"+t.type);else if(t.status==g.hc)E.a.monitorDecodeAudio=t;else if(t.status===g.zb){var r=E.a.localAudioDecMGR.map.get(E.a.SPECIAL_ID);pe(t.url,r)}else if(t.status==g.Pe)A.a.add_monitor("AD"+t.data);else if(t.status==v.g)y.a.error("Error from audio decode worker: ".concat(t.errorMessage),t.errorEvent);else if(t.status==g.pb)t.at&&E.a.CurrentSSRCTime!==t.at&&(E.a.CurrentSSRCTime=t.at,E.a.audioPlayTime=Date.now()),t.st&&E.a.mediaSDKHandle.SharingRenderObj&&E.a.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);else if("multiCurrentTime"==t.status){if(E.a.localVideoDecMGR){var i=E.a.localVideoDecMGR.map.get(E.a.SPECIAL_ID);i&&i.postMessage({command:"audioDecodeTime",data:t.data,status:1})}}else if(t.status==g.n)b.a.triggerSync(g.k,t.data);else if(t.status===g.r)ge.push({log:t.data,isSend:!0});else if(t.status===g.t){var a=M({encoding:!1},t.data);E.a.Notify_APPUI_SAFE(g.t,a)}else"AUDIO_WASM_INFO"===t.status?E.a.audioWasmInfo=t.data:N(k.g.AUDIO_DECODE,e)}()}catch(e){D.error(e)}}function Se(e){if(E.a.localAudioDecMGR||E.a.isPreviewMode.audioEncode)try{!function(){var t=e.data;if(t.status===g.We){var r=E.a.mediaSDKHandle.audioEncodeRingBufferConsumer;r&&r.consumeAll(!0)}else if(0==t.status){var i=E.a.SPECIAL_ID,a=E.a.localAudioDecMGR.map.get(i);a&&a.postMessage({command:"EncodedAudioFrame",data:t.data},[t.data.buffer])}else if(t.status==g.n)b.a.triggerSync(g.k,t.data);else if(t.status===g.J||t.status===g.E)A.a.add_monitor("AEWS"),E.a.isAudioEncodeWASMOK=!0,E.a.audioEncodeInitInstance.setWasmSuccess();else if(t.status===g.I||t.status===g.D)A.a.add_monitor("AEWF"),E.a.audioEncodeInitInstance.setWasmSuccess(!1);else if(t.status===g.C)A.a.add_monitor("AEHS"),E.a.audioEncodeInitInstance.setHanderSuccess();else if(t.status===g.G)A.a.add_monitor("AESS"),E.a.audioEncodeInitInstance.setSocketSuccess();else if(t.status===g.F)A.a.add_monitor("AESF"),E.a.audioEncodeInitInstance.isSocketInitSuccess()&&E.a.Notify_APPUI_SAFE(g.y,null),E.a.audioEncodeInitInstance.setSocketSuccess(!1);else if(t.status===g.B)A.a.add_monitor("AEHF"),E.a.audioEncodeInitInstance.setHanderSuccess(!1);else if(t.status===g.H)E.a.Notify_APPUI_SAFE(g.H,null);else if(t.status===g.gb)A.a.add_monitor("AEWPS");else if(t.status===g.fb)A.a.add_monitor("AEWPCLOSE");else if(t.status===g.eb)A.a.add_monitor("AEWSCLOSE");else if(t.status===g.ob)A.a.add_monitor("AETTP:"+t.type);else if(t.status===g.L)E.a.Notify_APPUI&&E.a.Notify_APPUI(g.z,null);else if(t.status===g.l)E.a.indexDbObject.put(t.delay,"delay"),E.a.openIndexFlag&&E.a.indexDbObject.select("delay");else if(t.status===g.zb){var n=E.a.localAudioEncMGR.map.get(E.a.SPECIAL_ID);pe(t.url,n)}else if(t.status==g.Pe)A.a.add_monitor("AE"+t.data);else if(t.status==v.g)y.a.error("Error from audio encode worker: ".concat(t.errorMessage),t.errorEvent);else if(t.status==g.j);else if(t.status===g.r)ge.push({log:t.data,isSend:!1});else if(t.status===g.t){var o=M({encoding:!0},t.data);E.a.Notify_APPUI_SAFE(g.t,o)}else t.status===g.K?E.a.mediaSDKHandle.init_Notify_APPUI(!0,k.g.AUDIO_ENCODE):"AUDIO_WASM_INFO"===t.status?E.a.audioWasmInfo=t.data:N(k.g.AUDIO_ENCODE,e)}()}catch(e){D.error(e)}}function _e(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=p()(m.a.mark((function e(t,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.isDestroy){e.next=2;break}return e.abrupt("return",D("WorkerType:sharingEnc;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(E.a.isSharingEncodeThreadStart){e.next=6;break}return E.a.isSharingEncodeThreadStart=!0,e.next=6,V(r,E.a.localSharingEncMGR,ue,k.g.SHARING_ENCODE,t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e,t){return be.apply(this,arguments)}function be(){return(be=p()(m.a.mark((function e(t,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.isDestroy){e.next=2;break}return e.abrupt("return",D("WorkerType:sharingDec;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(E.a.isSharingDecodeThreadStart){e.next=6;break}return E.a.isSharingDecodeThreadStart=!0,e.next=6,V(r,E.a.localSharingDecMGR,se,k.g.SHARING_DECODE,t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(){return ke.apply(this,arguments)}function ke(){return(ke=p()(m.a.mark((function e(){var t,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_.g.browser.isSafari&&_.g.getMacSafariMajorVersion()<16,E.a.sharedBuffer||!_.g.isSupportSharedArrayBuffer()||t||(D("LP2PSP"),r=1,_.g.browser.isFirefox&&(r=48),E.a.sharedBuffer={inputState:new SharedArrayBuffer(24),inputBuffer:new SharedArrayBuffer(640*r*4*4),sharingInputState:new SharedArrayBuffer(24),sharingInputBuffer:new SharedArrayBuffer(640*r*4*4),outputState:new SharedArrayBuffer(24),outputBuffer:new SharedArrayBuffer(640*r*4*4),rtpBuffer:new SharedArrayBuffer(120008)}),A.a.add_monitor("INITSAB"+!!E.a.sharedBuffer),E.a.decoderinworklet=E.a.decoderinworkletOP&&E.a.sharedBuffer;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e,t){var r;E.a.localSharingPara?Object.assign(E.a.localSharingPara,t):E.a.localSharingPara=t,r=e,E.a.Sharing_WebSocket_Ip_Address=r}function Ie(e,t){E.a.localAudioPara?Object.assign(E.a.localAudioPara,t):E.a.localAudioPara=t,Me(e)}function we(e,t){E.a.localVideoPara?Object.assign(E.a.localVideoPara,t):E.a.localVideoPara=t,Re(e)}function Me(e){E.a.Audio_WebSocket_Ip_Address=e}function De(e){E.a.Audio_Web_Transport_Ip_Address=e}function Re(e){E.a.Video_WebSocket_Ip_Address=e}function Te(e){E.a.Video_Web_Transport_Ip_Address=e}function Pe(){!function(e){if(e=E.a.SPECIAL_ID,E.a.localAudioEncMGR){var t=E.a.localAudioEncMGR.map.get(e);t&&(t.postMessage({command:"closeMedia"}),E.a.localAudioEncMGR.map.delete(e)),E.a.isAudioEncodePostStart=!1}}(E.a.SPECIAL_ID),function(e){if(e=E.a.SPECIAL_ID,E.a.localAudioDecMGR){var t=E.a.localAudioDecMGR.map.get(E.a.SPECIAL_ID);t&&(t.postMessage({command:"closeMedia"}),E.a.localAudioDecMGR.map.delete(e)),E.a.isAudioDecodePostStart=!1}}(E.a.SPECIAL_ID),E.a.localAudioDecMGR=null,E.a.localAudioEncMGR=null}function xe(){!function(e){if(e=E.a.SPECIAL_ID,E.a.localVideoDecMGR){var t=E.a.localVideoDecMGR.map.get(e);t&&(t.postMessage({command:"closeMedia"}),E.a.localVideoDecMGR.map.delete(e)),E.a.isVideoDecodePostStart=!1}}(E.a.SPECIAL_ID),E.a.localVideoDecMGR=null,E.a.localVideoEncMGR=null}function Oe(){!function(){var e=E.a.SPECIAL_ID;if(E.a.localSharingDecMGR){var t=E.a.localSharingDecMGR.Get(e);t&&(t.postMessage({command:"closeMedia"}),E.a.localSharingDecMGR=null),E.a.isSharingDecodeThreadStart=!1}}()}function Ve(e,t,r,i,a){if(E.a.localVideoEncMGR){var n=E.a.localVideoEncMGR.map.get(e);if(n){var o={command:"encodeVideoFrame",data:t,stride:r,x:i,y:a};n.postMessage(o,[o.data.buffer])}}}function Ne(e,t,r,i,a,n){var o,s;(o=R?E.a.localVideoEncMGR.map.get(e):E.a.localSharingEncMGR.map.get(e))&&(t?(s={command:"encodeSharingFrame",data:t,width:a,height:n},o.postMessage(s,[s.data.buffer])):(s={command:"encodeSharingFrame"},o.postMessage(s)))}function Le(e){E.a.localSharingDecMGR&&("sharingPara"==e.type&&(A.a.add_monitor("SHPA"),b.a.publish(g.Xc,e.data),E.a.Notify_APPUI(g.Wc,e.data)),E.a.isSharingPlayWork&&E.a.localSharingDecMGR.PutData(e))}function We(e,t,r,i,a,n,o,s,u,d,c){if(E.a.isVideoPlayWork){var h={yuvdata:t,ntptime:r,ssrc:e,width:i,height:a,r_x:n,r_y:o,r_w:s,r_h:u,rotation:d,yuv_limited:c};h.ssrc=h.ssrc>>10<<10,E.a.mediaSDKHandle.VideoRenderObj.Put_Video_Data_Queue(h)}}function Ue(){return E.a.localSharingDecMGR?E.a.localSharingDecMGR.SharingQueueMGR.ClearQueue():E.a.localMouseDecMGR?E.a.localMouseDecMGR.SharingQueueMGR.ClearQueue():0}function Be(){return Fe.apply(this,arguments)}function Fe(){return(Fe=p()(m.a.mark((function e(){var t,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E.a.isPreviewMode.videoDecode){e.next=2;break}return e.abrupt("return");case 2:if(E.a.localVideoDecMGR){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,E.a.videoDecInitInstance.wasmSuccessPromise;case 6:(t=E.a.localVideoDecMGR.map.get(E.a.SPECIAL_ID))&&!E.a.isVideoDecodePostStart&&(E.a.isVideoDecodePostStart=!0,r=M(M({command:"startMedia",websocket_ip_address:E.a.Video_WebSocket_Ip_Address+"&mode=5",confId:E.a.localVideoPara.confId,confKey:"",logon:E.a.localVideoPara.logon,mtu_size:0,meetingid:E.a.localVideoPara.meetingid,meetingnumb:E.a.localVideoPara.meetingnumb,videoencodethreadnumb:1,videodecodethreadnumb:E.a.localVideoPara.videodecodethreadnumb,isFirefox:E.a.localVideoPara.isFirefox,isSupportMultiThread:E.a.localVideoPara.isSupportMultiThread,isSupportVideoTrackReader:E.a.localVideoPara.isSupportVideoTrackReader,isSupportOffscreenCanvas:E.a.localVideoPara.isSupportOffscreenCanvas,isenablehw:E.a.localVideoPara.isenablehw,isEnableVideoDecodeHardWareThread:E.a.localVideoPara.isEnableVideoDecodeHardWareThread,qoson:E.a.localVideoPara.qoson,isEnableHardWareThread:E.a.localVideoPara.isEnableHardWareThread,isTeslaMode:E.a.localVideoPara.isTeslaMode,enableMultiDecodeVideoWithoutSAB:!!E.a.enableMultiDecodeVideoWithoutSAB,enableReplaceCanvasWhenContextLost:E.a.enableReplaceCanvasWhenContextLost},E.a.Video_Web_Transport_Ip_Address?{webtransportURL:E.a.Video_Web_Transport_Ip_Address+"&mode=1"}:{}),{},{enableAudioBridge:E.a.enableAudioBridge}),t.postMessage(r),E.a.isVideoDecodePostStart=!0);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(e,t,r,i){return He.apply(this,arguments)}function He(){return(He=p()(m.a.mark((function e(t,r,i,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||!i.isDestroy){e.next=2;break}return e.abrupt("return",D("WorkerType:videoDec;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(E.a.isVideoDecodeThreadStart){e.next=6;break}return E.a.isVideoDecodeThreadStart=!0,e.next=6,V(a,E.a.localVideoDecMGR,de,k.g.VIDEO_DECODE,i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(){return Ke.apply(this,arguments)}function Ke(){return(Ke=p()(m.a.mark((function e(){var t,r,i,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E.a.localVideoEncMGR){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,E.a.videoInitInstance.wasmSuccessPromise;case 4:(t=E.a.localVideoEncMGR.map.get(E.a.SPECIAL_ID))&&!E.a.isVideoEncodePostStart&&(E.a.isVideoEncodePostStart=!0,r=0,r="firefox"===_.g.browserType.browser?1080:1070,E.a.mediaSDKHandle.mtu_size=r,i=null,E.a.ivObj&&(i=E.a.ivObj[k.g.VIDEO_ENCODE],i=_.g.stringSplitByComma2Buffer(i)),a=M(M({command:"startMedia",websocket_ip_address:E.a.Video_WebSocket_Ip_Address+"&mode=2",confId:E.a.localVideoPara.confId,confKey:"",logon:E.a.localVideoPara.logon,sendvideo:!0,isChromeOrEdge:_.g.browser.isChrome,mtu_size:r,meetingid:E.a.localVideoPara.meetingid,meetingnumb:E.a.localVideoPara.meetingnumb,videoencodethreadnumb:E.a.localVideoPara.videoencodethreadnumb,iv:i,videodecodethreadnumb:E.a.localVideoPara.videodecodethreadnumb,isSupportMultiThread:E.a.localVideoPara.isSupportMultiThread,qoson:E.a.localVideoPara.qoson,isSupportVirtualBackground:E.a.localVideoPara.isSupportVirtualBackground,uplimit:E.a.uplimit,isSupportWebCodecEnocde:E.a.localVideoPara.isSupportWebCodecEnocde,initWebCodecFlag:E.a.localVideoPara.initWebCodecFlag,is360penablehw:E.a.localVideoPara.is360penablehw,enable720p:E.a.localVideoPara.enable720p,enableReplaceCanvasWhenContextLost:E.a.enableReplaceCanvasWhenContextLost,isPreviewMode:E.a.isPreviewMode.videoEncode},E.a.Video_Web_Transport_Ip_Address?{webtransportURL:E.a.Video_Web_Transport_Ip_Address+"&mode=2"}:{}),{},{enableAudioBridge:E.a.enableAudioBridge,platformType:E.a.localVideoPara.platformType}),t.postMessage(a),E.a.tfjsurl&&t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:E.a.tfjsurl,type:"js"}),E.a.vbbin&&E.a.vbjson&&t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:E.a.vbbin,json:E.a.vbjson},index:0}),E.a.afnbin&&E.a.afnjson&&(t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:E.a.afnbin,json:E.a.afnjson},index:1}),E.a.basebin&&E.a.basejson&&t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:E.a.basebin,json:E.a.basejson},index:2})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e,t,r,i){return Qe.apply(this,arguments)}function Qe(){return(Qe=p()(m.a.mark((function e(t,r,i,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||!i.isDestroy){e.next=2;break}return e.abrupt("return",D("WorkerType:videoEnc;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(E.a.localVideoEncMGR){e.next=4;break}return e.abrupt("return");case 4:if(E.a.isVideoEncodeThreadStart){e.next=8;break}return E.a.isVideoEncodeThreadStart=!0,e.next=8,V(a,E.a.localVideoEncMGR,ce,k.g.VIDEO_ENCODE,i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(){return Je.apply(this,arguments)}function Je(){return(Je=p()(m.a.mark((function e(){var t,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E.a.isPreviewMode.audioDecode){e.next=3;break}return A.a.add_monitor("ZISA"),e.abrupt("return");case 3:return t=E.a.localAudioDecMGR.map.get(E.a.SPECIAL_ID),window.ADWF&&t.postMessage({command:"RIWM"}),r=E.a.localVideoPara.videodecodethreadnumb>1,e.next=8,E.a.audioDecInitInstance.wasmSuccessPromise;case 8:if(t&&!E.a.isAudioDecodePostStart){if(E.a.isAudioDecodePostStart=!0,i=M({command:"startMedia",websocket_ip_address:E.a.Audio_WebSocket_Ip_Address+"&mode=5",sampleRate:E.a.localAudioPara.sampleRate,userid:E.a.localAudioPara.userid,logon:E.a.localAudioPara.logon,decode:1,meetingid:E.a.localAudioPara.meetingid,meetingnumb:E.a.localAudioPara.meetingnumb,videodecodethreadnumb:E.a.localAudioPara.videodecodethreadnumb,isSupportMultiThread:E.a.localAudioPara.isSupportMultiThread,qoson:E.a.localAudioPara.qoson,decoderInWorklet:E.a.decoderinworklet,multiView:r,shouldNotChangeSampleRate:_.g.browser.isFirefox||_.g.browser.isSafari},E.a.Audio_Web_Transport_Ip_Address?{webtransportURL:E.a.Audio_Web_Transport_Ip_Address+"&mode=1"}:{}),A.a.add_monitor("ADSM"),t.postMessage(i),E.a.sharedBuffer){D("post audioDec sab");try{t.postMessage({command:"sharedBuffer",data:E.a.sharedBuffer})}catch(e){t.postMessage({command:"sharedBuffer",data:E.a.sharedBuffer},[E.a.sharedBuffer])}}}else A.a.add_monitor("ADSME"+!!t+!!E.a.isAudioDecodePostStart);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xe(e,t,r,i){return Ye.apply(this,arguments)}function Ye(){return(Ye=p()(m.a.mark((function e(t,r,i,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A.a.add_monitor("AADT"),!i||!i.isDestroy){e.next=4;break}return A.a.add_monitor("ZID"),e.abrupt("return",D("WorkerType:audioDec;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 4:if(E.a.isAudioDecodeThreadStart){e.next=8;break}return E.a.isAudioDecodeThreadStart=!0,e.next=8,V(a,E.a.localAudioDecMGR,ve,k.g.AUDIO_DECODE,i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e){if(e>>=10,E.a.localAudioDecMGR){var t=E.a.localAudioDecMGR.GetSSRCTimeMap(e);return null===t?0:t}}function $e(e){return{currentSSRCTime:E.a.CurrentSSRCTime,audioPlayTime:E.a.audioPlayTime}}function et(e,t){var r=E.a.SPECIAL_ID,i=E.a.localVideoDecMGR.map.get(r);i.postMessage({command:"failover",websocket_ip_address:t}),(i=E.a.localAudioDecMGR.map.get(r)).postMessage({command:"failover",websocket_ip_address:e})}function tt(){return rt.apply(this,arguments)}function rt(){return(rt=p()(m.a.mark((function e(){var t,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.a.localAudioEncMGR.map.get(E.a.SPECIAL_ID),window.AEWF&&t.postMessage({command:"RIWM"}),e.next=4,E.a.audioEncodeInitInstance.wasmSuccessPromise;case 4:if(t&&!E.a.isAudioEncodePostStart&&(E.a.isAudioEncodePostStart=!0,r=null,E.a.ivObj&&(r=E.a.ivObj[k.g.AUDIO_ENCODE],r=_.g.stringSplitByComma2Buffer(r)),i=M({command:"startMedia",websocket_ip_address:E.a.Audio_WebSocket_Ip_Address+"&mode=2",sampleRate:E.a.localAudioPara.sampleRate,userid:E.a.localAudioPara.userid,encode:1,meetingid:E.a.localAudioPara.meetingid,meetingnumb:E.a.localAudioPara.meetingnumb,iv:r,qoson:E.a.localAudioPara.qoson,shouldNotChangeSampleRate:_.g.browser.isFirefox||_.g.browser.isSafari,isPreviewMode:E.a.isPreviewMode.audioEncode},E.a.Audio_Web_Transport_Ip_Address?{webtransportURL:E.a.Audio_Web_Transport_Ip_Address+"&mode=2"}:{}),t.postMessage(i),E.a.sharedBuffer)){D("post audioEnc sab");try{t.postMessage({command:"sharedBuffer",data:E.a.sharedBuffer})}catch(e){t.postMessage({command:"sharedBuffer",data:E.a.sharedBuffer},[E.a.sharedBuffer])}}case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e,t,r){return at.apply(this,arguments)}function at(){return(at=p()(m.a.mark((function e(t,r,i){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||!r.isDestroy){e.next=2;break}return e.abrupt("return",D("WorkerType:audioEnc;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(E.a.isAudioEncodeThreadStart){e.next=6;break}return E.a.isAudioEncodeThreadStart=!0,e.next=6,V(i,E.a.localAudioEncMGR,Se,k.g.AUDIO_ENCODE,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e){for(var t,r=E.a.SPECIAL_ID,i=E.a.audio_pcm_queue.dequeue();i;)i=E.a.audio_pcm_queue.dequeue();E.a.localAudioEncMGR&&(t=E.a.localAudioEncMGR.map.get(r))&&E.a.isAudioEncodePostStart&&t.postMessage({command:"modifySampleRate",sampleRate:e}),E.a.localAudioDecMGR&&(t=E.a.localAudioDecMGR.map.get(r))&&E.a.isAudioDecodePostStart&&t.postMessage({command:"modifySampleRate",sampleRate:e})}function ot(e,t,r){var i;(e=E.a.SPECIAL_ID,E.a.localAudioDecMGR)&&((i=E.a.localAudioDecMGR.map.get(e))&&i.postMessage({command:"mute",bOn:t,fakeLeave:r}));E.a.localAudioEncMGR&&((i=E.a.localAudioEncMGR.map.get(e))&&i.postMessage({command:"mute",bOn:t,fakeLeave:r}))}function st(e,t){var r;(e=E.a.SPECIAL_ID,E.a.localAudioDecMGR)&&((r=E.a.localAudioDecMGR.map.get(e))&&r.postMessage({command:"AecFlag",flag:t}));E.a.localAudioEncMGR&&((r=E.a.localAudioEncMGR.map.get(e))&&r.postMessage({command:"AecFlag",flag:t}))}function ut(e,t){var r,i=E.a.SPECIAL_ID;E.a.localAudioDecMGR&&((r=E.a.localAudioDecMGR.map.get(i))&&r.postMessage({command:"decodeAudioPort"},[e.port2]));E.a.localAudioEncMGR&&((r=E.a.localAudioEncMGR.map.get(i))&&r.postMessage({command:"encodeAudioPort"},[t.port1]))}function dt(e,t){var r=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR){var i=E.a.localVideoDecMGR.map.get(r);i&&i.postMessage({command:"decodeVideoPort"},[e.port1])}if(E.a.localVideoEncMGR){var a=E.a.localVideoEncMGR.map.get(r);a&&a.postMessage({command:"encodeVideoPort"},[t.port2])}}function ct(e,t){var r=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR){var i=E.a.localVideoDecMGR.map.get(r);i&&i.postMessage({command:"vsport"},[e.port1])}if(E.a.localVideoEncMGR){var a=E.a.localSharingDecMGR.map.get(r);a&&a.postMessage({command:"vsport"},[t.port2])}}function ht(e){var t=E.a.SPECIAL_ID;if(E.a.localAudioDecMGR){var r=E.a.localAudioDecMGR.map.get(t);r&&r.postMessage({command:"decodeAudioPort2"},[e.port2])}}function lt(e){var t=E.a.SPECIAL_ID;if(E.a.localAudioEncMGR){var r=E.a.localAudioEncMGR.map.get(t);r&&r.postMessage({command:"shareAudioDecodeAudioPort2"},[e.port2])}}function pt(e){var t=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR){var r=E.a.localVideoDecMGR.map.get(t);r&&r.postMessage({command:"decodeVideoPortWithAudio",port:e.port1},[e.port1])}}function ft(e){var t=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var r=E.a.localVideoEncMGR.map.get(t);r&&r.postMessage(e)}}function mt(e,t){var r=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var i=E.a.localVideoEncMGR.map.get(r);i&&i.postMessage({command:e,data:t},[t])}}function gt(e){var t=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR){var r=E.a.localVideoDecMGR.map.get(t);r&&r.postMessage(e)}}function vt(e,t){var r=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var i=E.a.localVideoEncMGR.map.get(r);i&&i.postMessage({command:e,data:t},[t])}}function St(e,t){var r=E.a.SPECIAL_ID;if(E.a.localSharingEncMGR){var i=E.a.localSharingEncMGR.map.get(r);i&&i.postMessage({command:e,data:t},[t])}}function _t(e){if(E.a.localVideoDecMGR){var t=E.a.localVideoDecMGR.map.get(E.a.SPECIAL_ID);t&&t.postMessage(e)}}function Ct(e){var t=E.a.SPECIAL_ID;if(E.a.localSharingDecMGR){var r=E.a.localSharingDecMGR.map.get(t);r&&r.postMessage(e)}}function yt(e){var t=E.a.SPECIAL_ID;if(E.a.localAudioDecMGR){var r=E.a.localAudioDecMGR.map.get(t);r&&r.postMessage({command:"updateCurrentSSRC",SSRC:e})}}function bt(e){var t=E.a.SPECIAL_ID;if(E.a.localAudioEncMGR){var r=E.a.localAudioEncMGR.map.get(t);r&&r.postMessage(e)}}function At(e){var t=E.a.SPECIAL_ID;if(E.a.localAudioDecMGR){var r=E.a.localAudioDecMGR.map.get(t);r&&r.postMessage(e)}}function kt(e){var t={command:"interpretation_enable",enable:e};bt(t),E.a.decoderinworklet?E.a.workletWasmInitSuccess?E.a.AudioNode.postCMD("interpretation_enable",t):E.a.interpretationMessage.enqueue(t):At(t)}function Et(e){bt({command:"cc_set_lang",lang:e})}function It(e){var t={command:"interpretation_set_lang",lang:e};bt(t),E.a.decoderinworklet?E.a.workletWasmInitSuccess?E.a.AudioNode.postCMD("interpretation_set_lang",t):E.a.interpretationMessage.enqueue(t):At(t)}function wt(e){var t={command:"interpretation_mute_origin",mute:e};bt(t),E.a.decoderinworklet?E.a.workletWasmInitSuccess?E.a.AudioNode.postCMD("interpretation_mute_origin",t):E.a.interpretationMessage.enqueue(t):At(t)}function Mt(e){var t={command:"interpretation_set_interpreter",interpreterList:e};bt(t),E.a.decoderinworklet?E.a.workletWasmInitSuccess?E.a.AudioNode.postCMD("interpretation_set_interpreter",t):E.a.interpretationMessage.enqueue(t):At(t)}function Dt(){var e=E.a.SPECIAL_ID;if(E.a.localAudioEncMGR){var t=E.a.localAudioEncMGR.map.get(e);t&&t.postMessage({command:"resetAec"})}}function Rt(){var e=E.a.SPECIAL_ID,t=20;if(E.a.audioDelay&&(t=E.a.audioDelay),E.a.localAudioEncMGR){var r=E.a.localAudioEncMGR.map.get(e);r&&r.postMessage({command:"SetAECDelay",delay:t})}}function Tt(e){try{if(A.a&&e){var t=["ERR:",e.message,"f"].join(""),r=A.a.checkIsNecessaryExceptionLogAndReturnRepeatTimes(t);r.isNecessary?(D("error repeat ".concat(r.repeatNumber),t),A.a.add_monitor(t+"(repeat:".concat(r.repeatNumber,")"))):D("error but ignore",e.message)}}catch(e){D("_listenWindowErrorEvent error",e)}}function Pt(e){E.a.sendMessageToRwg(g.gc,{evt:4167,seq:1,body:{data:e}})}function xt(){A.a.init(),window.addEventListener("error",Tt),function(){try{A.a.add_monitor(["BSAGT:",navigator.userAgent].join("")),A.a.add_monitor("BSLITEND:"+(_.g.isLittleEndian()?1:0)),window.navigator.hardwareConcurrency&&A.a.add_monitor("OSCPUS:"+window.navigator.hardwareConcurrency)}catch(e){}}(),E.a.monitorIntervalHandle=setInterval((function(){var e,t=A.a.get_monitor();(t&&Pt(t),null!=E.a.monitorEncodeVideo||null!=E.a.monitorDecodeVideo||null!=E.a.monitorVideoCapture||null!=E.a.monitorEncodeSharing||null!=E.a.monitorDecodeSharing||null!=E.a.monitorSharingEncodeAPPInfo||null!=E.a.monitorVideoDecodeAPPInfo||null!=E.a.monitorVideoEncodeAPPInfo)&&(null!=E.a.monitorVideoCapture&&(e=function(e,t){if(t<=0)return e;for(var r=0;r<t;r++)e+=",";return e}(e="WCL_CAMERA,"+E.a.monitorVideoUserID+",0,,"+E.a.monitorVideoCapture+",,"+E.a.monitorVideoReadyCaptureWidth+","+E.a.monitorVideoReadyCaptureHeight,3),Pt(e+=",{[END]}"),E.a.monitorVideoCapture=null),null!=E.a.monitorSharingEncodeAPPInfo&&(Pt(E.a.monitorSharingEncodeAPPInfo.data),E.a.monitorSharingEncodeAPPInfo=null),null!=E.a.monitorVideoDecodeAPPInfo&&(Pt(E.a.monitorVideoDecodeAPPInfo.data),E.a.monitorVideoDecodeAPPInfo=null),null!=E.a.monitorVideoEncodeAPPInfo&&(Pt(E.a.monitorVideoEncodeAPPInfo.data),E.a.monitorVideoEncodeAPPInfo=null))}),1e4)}function Ot(e){A.a.add_monitor2(e)}function Vt(){window.removeEventListener("error",Tt),clearInterval(E.a.monitorIntervalHandle),A.a.send_instant_monitor()}function Nt(e){var t=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var r=E.a.localVideoEncMGR.map.get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Lt(e){var t=E.a.SPECIAL_ID;if(E.a.localSharingEncMGR){var r=E.a.localSharingEncMGR.Get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Wt(e){if(E.a.localVideoEncMGR){var t=E.a.localVideoEncMGR.map.get(E.a.SPECIAL_ID);t&&t.postMessage(e)}}function Ut(e){if(E.a.localSharingEncMGR){var t=E.a.localSharingEncMGR.map.get(E.a.SPECIAL_ID);t&&t.postMessage(e)}}function Bt(e){if(E.a.localVideoEncMGR){var t=E.a.localVideoEncMGR.map.get(E.a.SPECIAL_ID);t&&t.postMessage(e)}}function Ft(e){if(E.a.localSharingEncMGR){var t=E.a.localSharingEncMGR.map.get(E.a.SPECIAL_ID);t&&t.postMessage(e)}}function Gt(e){var t=E.a.SPECIAL_ID;if(E.a.localAudioEncMGR){var r=E.a.localAudioEncMGR.map.get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Ht(){var e=E.a.SPECIAL_ID;[E.a.localAudioDecMGR,E.a.localAudioEncMGR,E.a.localVideoDecMGR,E.a.localVideoEncMGR,E.a.localSharingDecMGR,E.a.localSharingEncMGR].forEach((function(t){t&&t.map.get(e)&&t.map.get(e).postMessage({command:"SOCKET_RECONNECT",disable:!0})}))}function jt(){var e=E.a.SPECIAL_ID;[E.a.localVideoDecMGR,E.a.localVideoEncMGR,E.a.localSharingDecMGR,E.a.localSharingEncMGR].forEach((function(t){t&&t.map.get(e)&&t.map.get(e).postMessage({command:"closeMedia"})}))}function Kt(){var e=E.a.SPECIAL_ID,t=[E.a.localVideoDecMGR,E.a.localVideoEncMGR,E.a.localSharingDecMGR,E.a.localSharingEncMGR];t.forEach((function(t){t&&t.map.get(e)&&t.map.get(e).terminate()})),t=[E.a.localAudioDecMGR,E.a.localAudioEncMGR],E.a.mediaSDKHandle.is32bitbrowser?t.forEach((function(t){t&&t.map.get(e)&&t.map.get(e).postMessage({command:"closeMedia"})})):t.forEach((function(t){t&&t.map.get(e)&&t.map.get(e).terminate()}))}function qt(e){var t;switch(e){case k.g.AUDIO_DECODE:t=E.a.localAudioDecMGR;break;case k.g.AUDIO_ENCODE:t=E.a.localAudioEncMGR;break;case k.g.VIDEO_DECODE:t=E.a.localVideoDecMGR;break;case k.g.VIDEO_ENCODE:t=E.a.localVideoEncMGR;break;case k.g.SHARING_DECODE:t=E.a.localSharingDecMGR;break;case k.g.SHARING_ENCODE:t=E.a.localSharingEncMGR}var r=E.a.SPECIAL_ID;return t&&t.map.get(r)?t.map.get(r):null}function Qt(e){return zt.apply(this,arguments)}function zt(){return(zt=p()(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===k.g.VIDEO_ENCODE?3:e.t0===k.g.VIDEO_DECODE?6:e.t0===k.g.AUDIO_ENCODE?9:e.t0===k.g.AUDIO_DECODE?12:e.t0===k.g.SHARING_ENCODE?15:e.t0===k.g.SHARING_DECODE?18:21;break;case 3:return e.next=5,E.a.videoInitInstance.initSuccessPromise;case 5:return e.abrupt("break",23);case 6:return e.next=8,E.a.videoDecInitInstance.initSuccessPromise;case 8:return e.abrupt("break",23);case 9:return e.next=11,E.a.audioEncodeInitInstance.initSuccessPromise;case 11:return e.abrupt("break",23);case 12:return e.next=14,E.a.audioDecInitInstance.initSuccessPromise;case 14:return e.abrupt("break",23);case 15:return e.next=17,E.a.sharingEncInitInstance.initSuccessPromise;case 17:return e.abrupt("break",23);case 18:return e.next=20,E.a.sharingDecInitInstance.initSuccessPromise;case 20:return e.abrupt("break",23);case 21:return y.a.error("No matched worker type: ".concat(t)),e.abrupt("break",23);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(e,t){return Xt.apply(this,arguments)}function Xt(){return(Xt=p()(m.a.mark((function e(t,r){var i,a,n,o,s=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>2&&void 0!==s[2]?s[2]:"PUSH_MESSAGE_FROM_MAIN_TO_WORKER",a=s.length>3&&void 0!==s[3]&&s[3],!(n=s.length>4&&void 0!==s[4]&&s[4])){e.next=6;break}return e.next=6,Qt(t);case 6:if(o=qt(t)){e.next=17;break}if(n){e.next=13;break}return D("worker handle not ready, drop!",t,r,i),e.abrupt("return",!1);case 13:if(D.warn("worker handle not ready, waiting!",t,r,i),o=qt(t)){e.next=17;break}return e.abrupt("return");case 17:return a?o.postMessage({command:i,data:r},[r]):o.postMessage({command:i,data:r}),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(){return null!==qt(k.g.VIDEO_ENCODE)}function Zt(e,t,r){var i=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var a=E.a.localVideoEncMGR.map.get(i);a&&(e?a.postMessage({command:t,canvas:e,rendercanvasID:r},[e]):a.postMessage({command:t,canvas:e,rendercanvasID:r}))}}function $t(e){var t;return t=new e({storeOptions:{nameSpaceId:"vbFile"}}),new Promise((function(e,r){t.on("ready",(function(){e(t)}))}))}function er(e,t,r){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,e)}function tr(e,t){var r={};(E.a.resourceManager?Promise.resolve(E.a.resourceManager):$t(t)).then((function(t){E.a.resourceManager=t;for(var i,a,n=function(t){"bin"==e[t].type?E.a.resourceManager.getFile(e[t].path,{saveRootPath:e[t].path,downloadOptions:{xhrParams:{headers:r,url:e[t].path,encoding:"arraybuffer",method:"GET"}}}).getResult().then((function(r){A.a.add_monitor("VDBIN"),E.a.vbarraybuffer=r.data;try{e[t].path.indexOf("dual")>=0&&(i=r.data,a=new Uint8Array(i,0,12),n=new Uint8Array(i,12,32),window.crypto.subtle.importKey("raw",n,"AES-GCM",!0,["encrypt","decrypt"]).then((function(e){var t=a.length+n.length,r=new Uint32Array(i.slice(t,t+4))[0];t+=4;var o=i.slice(t,t+r);t+=r,r=new Uint32Array(i.slice(t,t+4))[0],t+=4;var s=new Uint8Array(i,t,r);t+=r,r=new Uint32Array(i.slice(t,t+4))[0],t+=4;var u=i.slice(t,t+r);t+=r,r=new Uint32Array(i.slice(t,t+4))[0],t+=4;var d=new Uint8Array(i,t,r);E.a.basebin=o,E.a.afnbin=u,er(d,e,a).then((function(e){E.a.afnjson=(new TextDecoder).decode(e);var t=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var r=E.a.localVideoEncMGR.map.get(t);r&&E.a.afnbin&&E.a.afnjson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:E.a.afnbin,json:E.a.afnjson},index:1})}})),er(s,e,a).then((function(e){E.a.basejson=(new TextDecoder).decode(e);var t=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var r=E.a.localVideoEncMGR.map.get(t);r&&E.a.basebin&&E.a.basejson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:E.a.basebin,json:E.a.basejson},index:2})}}))})))}catch(e){y.a.error("An error occurred when decrypting the virtual background file",e),A.a.add_monitor("VBDECRYPTF"),E.a.Notify_APPUI(g.ue,4)}var i,a,n})).catch((function(e){y.a.error("An error occurred when trying to obtain the virtual background file",e),A.a.add_monitor("VBFF"),E.a.Notify_APPUI(g.ue,4)})):"js"==e[t].type&&(A.a.add_monitor("VDTF"),E.a.tfjsurl=e[t].path,i=E.a.SPECIAL_ID,E.a.localVideoEncMGR&&(a=E.a.localVideoEncMGR.map.get(i))&&a.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:E.a.tfjsurl,type:"js"}))},o=0;o<e.length;o++)n(o)}))}function rr(e){var t=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var r=E.a.localVideoEncMGR.map.get(t);r&&(e?r.postMessage({command:"imagebitmap",data:e},[e]):r.postMessage({command:"imagebitmap"}))}}function ir(e,t){var r=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var i=E.a.localVideoEncMGR.map.get(r);i&&(e?i.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e},[e]):i.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e}))}}function ar(e,t){var r=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var i=E.a.localVideoEncMGR.map.get(r);i&&(e?i.postMessage({command:"vbbgimagebitmap",imagename:t,data:e},[e]):i.postMessage({command:"vbbgimagebitmap",imagename:t,data:e}))}}function nr(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=E.a.SPECIAL_ID;if(E.a.localVideoEncMGR){var o=E.a.localVideoEncMGR.map.get(n);o&&(e?o.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:r,width:i,height:a},[e]):o.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:r,width:i,height:a}))}}function or(e){var t=E.a.SPECIAL_ID;if(E.a.localVideoDecMGR){var r=E.a.localVideoDecMGR.map.get(t);r&&r.postMessage(e)}}function sr(){try{return _.g.browser.isChrome&&-1!==["85","86"].indexOf(_.g.getBrowserVersion())}catch(e){return D(e),!1}}var ur=(i={},n()(i,k.g.VIDEO_ENCODE,{success:g.Sb,failed:g.Pb,callbackDataValue:k.c.encode}),n()(i,k.g.VIDEO_DECODE,{success:g.Sb,failed:g.Pb,callbackDataValue:k.c.decode}),n()(i,k.g.AUDIO_ENCODE,{success:g.Qb,failed:g.Nb,callbackDataValue:k.c.encode}),n()(i,k.g.AUDIO_DECODE,{success:g.Qb,failed:g.Nb,callbackDataValue:k.c.decode}),n()(i,k.g.SHARING_DECODE,{success:g.Rb,failed:g.Ob,callbackDataValue:k.c.decode}),n()(i,k.g.SHARING_ENCODE,{success:g.Rb,failed:g.Ob,callbackDataValue:k.c.encode}),i)},function(e,t,r){"use strict";var i,a,n=r(17),o=r.n(n),s=r(7),u=r.n(s),d=r(11),c=r.n(d),h=r(12),l=r.n(h),p=r(3),f=r.n(p),m=function(){};m.prototype={threads:(a=u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=u()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(WebAssembly.validate(t)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),!0));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})));return function(t){return e.apply(this,arguments)}}()(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])));case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)}),simd:(i=u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})};var g=new m,v=r(25),S=r(8),_=r(0);r.d(t,"e",(function(){return k})),r.d(t,"d",(function(){return P})),r.d(t,"b",(function(){return N})),r.d(t,"a",(function(){return $})),r.d(t,"c",(function(){return ee})),r.d(t,"f",(function(){return te}));var C={},y=function(){var e,t={},r=navigator.userAgent.toLowerCase();return(e=r.match(/rv:([\d.]+)\) like gecko/))||(e=r.match(/msie ([\d\.]+)/))?t.ie=e[1]:(e=r.match(/edge\/([\d\.]+)/))?t.edge=e[1]:(e=r.match(/firefox\/([\d\.]+)/))?t.firefox=e[1]:(e=r.match(/(?:opera|opr).([\d\.]+)/))?t.opera=e[1]:(e=r.match(/chrome\/([\d\.]+)/))?t.chrome=e[1]:(e=r.match(/version\/([\d\.]+).*safari/))&&(t.safari=e[1]),t},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90,t=y();if(t.chrome){var r=parseInt(t.chrome);if(r>=e)return!0}return!1},A=function(e){var t=y();if(t.firefox&&parseInt(t.firefox)>=e)return!0;return!1};var k=new(function(){function e(){c()(this,e),this._isSupportMultiThread=!1,this._isSupportSIMD=!1,this.inProgressPromise={checkSupportMultiThread:null,checkSupportSIMD:null},this._isSupportWebtransport=!1,this._isSupportVirtualBackground=!1}var t,r;return l()(e,[{key:"checkIsSupportMultiThread",value:(r=u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getIsSupportMultiThread()){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this.inProgressPromise.checkSupportMultiThread){e.next=8;break}return e.next=6,this.inProgressPromise.checkSupportMultiThread;case 6:e.next=14;break;case 8:return this.inProgressPromise.checkSupportMultiThread=g.threads(),e.t0=this,e.next=12,this.inProgressPromise.checkSupportMultiThread;case 12:e.t1=e.sent,e.t0._setIsSupportMultiThread.call(e.t0,e.t1);case 14:e.next=19;break;case 16:e.prev=16,e.t2=e.catch(2),this._setIsSupportMultiThread(!1);case 19:case"end":return e.stop()}}),e,this,[[2,16]])}))),function(){return r.apply(this,arguments)})},{key:"_setIsSupportMultiThread",value:function(e){this._isSupportMultiThread=e}},{key:"getIsSupportMultiThread",value:function(){return this._isSupportMultiThread}},{key:"checkIsSupportSIMD",value:(t=u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getIsSupportSIMD()){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this.inProgressPromise.checkSupportSIMD){e.next=8;break}return e.next=6,this.inProgressPromise.checkSupportSIMD;case 6:e.next=14;break;case 8:return this.inProgressPromise.checkSupportSIMD=g.simd(),e.t0=this,e.next=12,this.inProgressPromise.checkSupportSIMD;case 12:e.t1=e.sent,e.t0._setIsSupportSIMD.call(e.t0,e.t1);case 14:e.next=19;break;case 16:e.prev=16,e.t2=e.catch(2),this._setIsSupportSIMD(!1);case 19:case"end":return e.stop()}}),e,this,[[2,16]])}))),function(){return t.apply(this,arguments)})},{key:"_setIsSupportSIMD",value:function(e){this._isSupportSIMD=e}},{key:"getIsSupportSIMD",value:function(){return this._isSupportSIMD}},{key:"getIsSupportWebtransport",value:function(){return b(97)&&"function"==typeof WebTransport&&this._isSupportWebtransport}},{key:"setIsSupportWebtransport",value:function(e){this._isSupportWebtransport=!!e}},{key:"getIsSupportVirtualBackground",value:function(){var e=b(91)||A(89);return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&e&&"function"==typeof OffscreenCanvas&&this._isSupportVirtualBackground}},{key:"setIsSupportVirtualBackground",value:function(e){this._isSupportVirtualBackground=!!e}},{key:"getIsRenderSelfVideoInEncodeWorker",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&!this.getIsSupportMultiThread()&&this.getIsSupportVirtualBackground()}}]),e}()),E={capacity:void 0,get capacityfor720(){return void 0!==this.capacity&&this.capacity},set capacityfor720(e){this.capacity=e}},I={capacitydeco:void 0,get capacitydecofor1080(){return void 0!==this.capacitydeco&&this.capacitydeco},set capacitydecofor1080(e){this.capacitydeco=e}};function w(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function M(){var e=window.navigator,t={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return t.browser="Not a browser.",t;if(e.mozGetUserMedia)t.browser="firefox",t.version=w(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia)t.browser="chrome",t.version=w(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=w(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=w(e.userAgent,/AppleWebKit\/(\d+)\./,1)}return t}var D=M();function R(){var e=navigator.userAgent.match(/CrKey\/([\d.]+)/);if(e){var t=e[1].match(/[0-9]{0,2}[.][0-9]{0,2}/);return t?t[0]:-1}return-1}var T="function"==typeof OffscreenCanvas&&!!new OffscreenCanvas(1,1).getContext("webgl");function P(){return T}function x(){return-1!==navigator.userAgent.indexOf("CrKey")}function O(){return function(){try{var e=navigator.userAgent||navigator.vendor||window.opera;return!!/android/i.test(e)}catch(e){return!1}}()&&!x()}function V(){return"function"==typeof VideoTrackReader&&"function"==typeof VideoFrame}function N(e){return e?e>>10<<10:-1}var L,W,U,B,F,G,H,j,K,q,Q,z,J,X,Y,Z;t.g={isGoogleNestChrome:function(){return x()},isHighVersionGoolgeNestChrome:function(){return-1!==navigator.userAgent.indexOf("CrKey")&&R()>=1.54},isSupport2DCanvasDrawFrame:function(){return("function"==typeof MediaStreamTrackProcessor||V())&&!x()&&"chrome"==D.browser&&D.version>=90&&-1==navigator.appVersion.indexOf("Mac")},checkLocalP2PConnection:function(){return new Promise(function(){var e=u()(f.a.mark((function e(t,r){var i,a,n,o,s,u,d,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){e&&e.close()},i=function(e){return new Promise((function(t,r){e.onconnectionstatechange=function(r){"connected"===e.connectionState&&t(!0)}}))},n=null,o=null,s=document.createElement("canvas"),e.prev=5,s.width=200,s.height=200,s.getContext("2d"),c=s.captureStream(),"function"!=typeof RTCPeerConnection&&t(!1),n=new RTCPeerConnection,o=new RTCPeerConnection,n.onicecandidate=function(e){e.candidate&&o.addIceCandidate(new RTCIceCandidate(e.candidate))},o.onicecandidate=function(e){e.candidate&&n.addIceCandidate(new RTCIceCandidate(e.candidate))},Promise.all([i(n),i(o)]).then((function(){t(!0),a(n),a(o)})),"function"!=typeof n.addStream&&t(!1),e.next=19,n.addStream(c);case 19:return e.next=21,n.createOffer();case 21:return u=e.sent,e.next=24,n.setLocalDescription(u);case 24:return e.next=26,o.setRemoteDescription(u);case 26:return e.next=28,o.createAnswer();case 28:return d=e.sent,e.next=31,o.setLocalDescription(d);case 31:return e.next=33,n.setRemoteDescription(d);case 33:setTimeout((function(){t(!1),a(n),a(o)}),200),e.next=40;break;case 36:e.prev=36,e.t0=e.catch(5),S.a.error("Error when trying to check for local RTC peer connection",e.t0),t(!1);case 40:case"end":return e.stop()}}),e,null,[[5,36]])})));return function(t,r){return e.apply(this,arguments)}}())},getDocumentHandle:function(e){return document.getElementById(e)},browserType:D,browser:{isFirefox:"firefox"===D.browser,isChrome:"chrome"===D.browser,isSafari:"safari"===D.browser},isIphoneOrIpadSafari:function(){var e=navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i)||!!e.match(/Macintosh/),r=!!e.match(/WebKit/i),i=!!e.match(/Mobile/i),a=isIPad();return t&&r&&(i||a)},isOpera65:function(){return function(){try{var e=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(e&&Number(e[1])<66)}catch(e){return!1}}()},isAndroidBrowser:function(){return O()},isQuestBrowser:function(){return function(){try{return/oculusbrowser/i.test(navigator.userAgent)}catch(e){return!1}}()},isSelfPreviewRenderWithVideo:function(){return!k.getIsSupportMultiThread()&&!k.getIsSupportVirtualBackground()&&this.isSupportVideoFrameOrBitmapCapture()||this.isAndroidBrowser()&&!_.a.rwgAgent},isIphoneOrIpadBrowser:function(){try{return!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}catch(e){return!1}},isIpadOS:function(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},isChromeOS:function(){return function(){try{return!!/\bCrOS\b/.test(navigator.userAgent)}catch(e){return!1}}()},isWindowsChrome:function(){var e=navigator.userAgent;return/windows/i.test(e)},isTeslaMode:function(){return/TESLA/.test(navigator.userAgent)},isMac:function(){return navigator.platform.indexOf("Mac")>-1},isWindows:function(){return navigator.platform.indexOf("Win")>-1},isLinux:function(){return navigator.platform.indexOf("Linux")>-1&&!this.isChromeOS()},isSupportChromeWideAEC:function(){return(this.isMac()||this.isWindows()||this.isLinux())&&b(111)},isSupportOpenMicWhenShareAudio:function(){return this.isSupportChromeWideAEC()&&_.a.chromeWideAEC&&!_.a.shareSystemAudio},getAudioFeatureFlags:function(){return _.a.enableAudioBridge?4:12},isSupportShareMultiStream:function(){return!1},isSupportVideoLTR:function(){return!1},isSupportAudioBridgeAvsync:function(){return!0},getAudioContextConfigure:function(){var e={};return function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90,r={},i=navigator.userAgent.toLowerCase();if((e=i.match(/rv:([\d.]+)\) like gecko/))||(e=i.match(/msie ([\d\.]+)/))?r.ie=e[1]:(e=i.match(/edge?\/([\d\.]+)/))?r.edg=e[1]:(e=i.match(/firefox\/([\d\.]+)/))?r.firefox=e[1]:(e=i.match(/(?:opera|opr).([\d\.]+)/))?r.opera=e[1]:(e=i.match(/chrome\/([\d\.]+)/))?r.chrome=e[1]:(e=i.match(/version\/([\d\.]+).*safari/))&&(r.safari=e[1]),r.chrome||r.edg||r.opera){var a=parseInt(r.chrome||r.edg||r.opera);if(a>=t)return!0}return!1}(74)&&(e={sampleRate:16e3,latencyHint:.02}),e},download:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(C[e])return C[e];var r=new Promise((function(r,i){var a={};t&&(a.integrity=t),fetch(e,a).then((function(e){r(e.text())})).catch((function(e){i(e)}))}));return C[e]=r,r},downloadBinary:function(e){if(C[e])return C[e];var t=new Promise((function(t,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.addEventListener("load",(function(){t(this.response)}),i),i.onerror=function(e){r(e)},i.open("get",e,!0),i.send()}));return C[e]=t,t},readBlob:function(e){return new Promise((function(t,r){var i=new FileReader;i.onload=function(){t(i.result)},i.readAsText(e)}))},readBlobAsBuffer:function(e){return new Promise((function(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsArrayBuffer(e)}))},lengthInUtf8Bytes:function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},isLittleEndian:function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);return t[0]=170,t[1]=187,48042===r[0]},sleep:function(e){return new Promise((function(t,r){setTimeout((function(){t(!0)}),e)}))},isSDKSupportMultiThread:(Z=u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.checkIsSupportMultiThread();case 2:return e.abrupt("return",k.getIsSupportMultiThread()&&navigator.userAgent&&(-1==navigator.userAgent.indexOf("CrKey")||R()>=1.54));case 3:case"end":return e.stop()}}),e)}))),function(){return Z.apply(this,arguments)}),isAMDGraphic:function(){try{return this.graphicName().includes("amd")}catch(e){return S.a.error("Error determining whether graphics card is AMD"),!1}},graphicName:(Y=null,function(){try{if(Y)return Y;var e=new OffscreenCanvas(1,1).getContext("webgl");if(!e)return"";var t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t.UNMASKED_RENDERER_WEBGL);return Y=r.toLowerCase()}catch(e){return S.a.error("Error determining whether graphics card is AMD",e),""}}),isGraphicShouldUseHardwareAccelerationDecode:function(){return!(!this.isAMDGraphic()||!this.isChromeOS())||!(this.isAMDGraphic()&&!this.isChromeOS())},VP9MachineDetect:function(){var e=navigator.mediaCapabilities.decodingInfo({type:"webrtc",video:{contentType:"video/vp9",bitrate:1e7,framerate:25,height:1920,width:1080}});return new Promise((function(t,r){e.then((function(e){e.supported||(S.a.error("Error: video/vp9 codec isn't supported in software or hardware"),t(!1)),t(e.powerEfficient)})).catch((function(e){S.a.error("Error when trying to determine support for VP9 codec",e),t(!1)}))}))},IsSupportVideoDecodeHardwareAcceleration:function(){return u()(f.a.mark((function e(){var t,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof VideoDecoder){e.next=19;break}return t=new Uint8Array([1,100,0,31,255,225,0,14,103,100,0,51,172,27,26,17,129,64,22,201,160,16,7,0,5,104,200,66,60,48,0,5,104,82,16,207,12,0,25,104,114,16,143,24,67,17,132,56,140,84,81,8,18,22,41,3,194,98,3,5,32,122,9,140,0,5,104,36,132,51,203,0,5,104,46,132,51,195,0,25,104,54,132,35,198,16,196,97,14,35,21,20,66,4,133,138,64,240,152,128,193,72,30,130,99,0,5,104,62,132,51,203]),r={codec:"avc1.640028",description:t,codedWidth:1280,codedHeight:720,hardwareAcceleration:"prefer-hardware"},e.prev=3,e.next=6,VideoDecoder.isConfigSupported(r);case 6:if(!e.sent.supported){e.next=11;break}return e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(3),e.abrupt("return",!1);case 17:e.next=20;break;case 19:return e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[3,14]])})))()},IsSupportVideoEncodeHardwareAcceleration:function(){return u()(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof VideoEncoder){e.next=13;break}return t={codec:"avc1.640028",bitrate:15e5,width:1280,height:720,avc:{format:"annexb"},framerate:25,hardwareAcceleration:"no-preference",latencyMode:"realtime",bitrateMode:"constant",scalabilityMode:"L1T2"},e.next=5,VideoEncoder.isConfigSupported(t);case 5:if(!e.sent.supported){e.next=10;break}return e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:e.next=14;break;case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e)})))()},AdapterWhiteListCheckForEncoder:function(){if(!P())return-1;var e=new OffscreenCanvas(1,1).getContext("webgl"),t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t.UNMASKED_VENDOR_WEBGL),i=e.getParameter(t.UNMASKED_RENDERER_WEBGL).toLowerCase(),a=r.includes("ARM"),n=(i.includes("amd"),i.includes("intel"));i.includes("hd graphics"),i.includes("nvidia"),i.includes("geforce");return n?0:a?-1:0},isChromeVersionHigherThan:b,isFirefoxVersionHigherThan:A,isSDKSupportSIMD:function(){return u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===("undefined"==typeof WebAssembly?"undefined":o()(WebAssembly))){e.next=2;break}return e.abrupt("return",!1);case 2:if("chrome"!=D.browser){e.next=11;break}if(!(D.version>=84)){e.next=8;break}return e.next=6,k.checkIsSupportSIMD();case 6:e.next=9;break;case 8:return e.abrupt("return",!1);case 9:e.next=13;break;case 11:return e.next=13,k.checkIsSupportSIMD();case 13:return e.abrupt("return",k.getIsSupportSIMD());case 14:case"end":return e.stop()}}),e)})))()},buffer2stringSplitByComma:function(e){return new Uint8Array(e).join(",")},stringSplitByComma2Buffer:function(e){try{for(var t=e.split(",").map((function(e){return parseInt(e)})),r=new ArrayBuffer(t.length),i=new Uint8Array(r),a=0;a<t.length;a++)i[a]=t[a];return r}catch(e){return null}},removeDuplicates:function(e,t){var r=[];return e.forEach((function(e){for(var i=!1,a=0;a<r.length;a++)if(!t.call(null,r[a],e)){i=!0;break}i||r.push(e)})),r},getBrowserVersion:function(){return function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("firefox")>0)return e.match(/firefox\/[\d.]+/gi);if(e.indexOf("safari")>0&&e.indexOf("chrome")<0){var t,r="safari/unknow";return r=e.match(/safari\/[\d.]+/gi),t=e.match(/safari\/[\d.]+/gi),r&&(r=[r.toString().replace("version","safari")]),t&&(r=[t.toString().replace("version","safari")]),r}return e.indexOf("chrome")>0?e.match(/chrome\/[\d.]+/gi):"other"}()[0].match(/(\d+)/)[0]},getIOSMajorVersion:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return parseInt(e[1],10)}return null},getMacSafariMajorVersion:function(){if(this.browser.isSafari){var e=navigator.userAgent.match(/Version\/([\d\.]+)/);return e[1]?parseFloat(e[1]):null}return null},isSupportImageCapture:function(){return"function"==typeof ImageCapture&&P()},isSupportOffscreenCanvas:function(){return P()},isSupport2dOffscreenCanvas:function(){return"function"==typeof OffscreenCanvas},isSupportVideoTrackReader:function(){return V()&&P()},isSupportMediaStreamTrackProcessor:function(){return"function"==typeof MediaStreamTrackProcessor&&P()},isSupportVideoFrameOrBitmapCapture:function(){return this.isSupportImageCapture()||this.isSupportVideoTrackReader()||this.isSupportMediaStreamTrackProcessor()},isSupportSharedArrayBuffer:function(){return"undefined"!=typeof SharedArrayBuffer},queryPTZPermisson:function(){return u()(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.permissions.query({name:"camera",panTiltZoom:!0});case 3:if("granted"!=e.sent.state){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 9:return e.prev=9,e.t0=e.catch(0),S.a.error("Error when querying pan-tilt-zoom permission",e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},isSupportCameraPan:function(){return!!navigator.mediaDevices.getSupportedConstraints().pan},isSupportCameraTilt:function(){return!!navigator.mediaDevices.getSupportedConstraints().tilt},isSupportCameraZoom:function(){return!!navigator.mediaDevices.getSupportedConstraints().zoom},isSupportPTZ:function(){var e=navigator.mediaDevices.getSupportedConstraints();return e.pan&&e.tilt&&e.zoom},get720pcapacity:function(){return E.capacityfor720},set720pcapacity:function(e){E.capacityfor720=e},getsub1080pcapacity:function(){return I.capacitydecofor1080},setsub1080pcapacity:function(e){I.capacitydecofor1080=e},checkAudioAutoPlay:function(){return new Promise((function(e,t){var r=new Blob([new Uint8Array([255,227,24,196,0,0,0,3,72,1,64,0,0,4,132,16,31,227,192,225,76,255,67,12,255,221,27,255,228,97,73,63,255,195,131,69,192,232,223,255,255,207,102,239,255,255,255,101,158,206,70,20,59,255,254,95,70,149,66,4,16,128,0,2,2,32,240,138,255,36,106,183,255,227,24,196,59,11,34,62,80,49,135,40,0,253,29,191,209,200,141,71,7,255,252,152,74,15,130,33,185,6,63,255,252,195,70,203,86,53,15,255,255,247,103,76,121,64,32,47,255,34,227,194,209,138,76,65,77,69,51,46,57,55,170,170,170,170,170,170,170,170,170,170,255,227,24,196,73,13,153,210,100,81,135,56,0,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170])],{type:"audio/mpeg"}),i=new Audio(URL.createObjectURL(r));i.addEventListener("canplaythrough",(function(){i.play().then((function(){e(!0)})).catch((function(e){S.a.error("Unable to auto play audio",e),t(e)}))})),i.load&&i.load()}))},isSupportVideoShare:function(){return!0},isSupportVideoShareSend:function(){var e,t=M();return"chrome"==t.browser&&(e=this.getBrowserVersion()),!!this.isSupportSharedArrayBuffer()&&!("chrome"!==t.browser||e&&e<=100||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()||this.isIphoneOrIpadBrowser()||this.isGoogleNestChrome())},isSupportVideoShareReceive:function(){return!0},watermark:(z=new v.a,J=document.createElement("canvas"),X={enableWaterMark:!1,waterMarkText:"",watermarkOpacity:0,watermarkRepeated:!1,watermarkPosition:void 0},{getWaterMarkData:function(e){var t=e.width,r=e.height;if(!X.enableWaterMark)return null;var i=t<512||r<288?16:X.watermarkPosition,a=X.watermarkRepeated&&t>306&&r>202,n=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}}(t,r);return t=n.width,r=n.height,a?z.Get_Repeated_WaterMarkRGBA({canvas:J,name:X.waterMarkText,width:n.width,height:n.height,opacity:X.watermarkOpacity,position:i,convertToDataUrl:!0}):z.Get_WaterMarkRGBA({canvas:J,name:X.waterMarkText,width:n.width,height:n.height,opacity:X.watermarkOpacity,position:i,convertToDataUrl:!0})},updateWaterMarkInfo:function(e){Object.assign(X,e)}}),isSupportAudioDenoise:function(){var e,t=M();return"chrome"==t.browser&&(e=this.getBrowserVersion()),!!this.isSupportSharedArrayBuffer()&&!("chrome"!==t.browser||e&&e<=100||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()||this.isIphoneOrIpadBrowser()||this.isGoogleNestChrome())},videoToMediaStreamManager:(U=document.createElement("canvas"),B=U.getContext("2d"),F=640,G=360,H=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4?10:24,j=1e3/("chrome"===D.browser?H:10),K=null,q=0,Q=null,{_draw:function(){if(L){this.drawCanvas(U,B,F,G);var e=performance.now();if(q){var t=e-q;t>j?this._setFasterTimer():t<.8*j&&this._clearFastTimer()}q=e}},_setFasterTimer:function(){var e=this;K||(K=setInterval((function(){L&&L.currentTime>0&&!L.paused&&!L.ended&&performance.now()-q>=j/2&&e.drawCanvas(U,B,F,G)}),j))},_clearFastTimer:function(){q=0,clearInterval(K),K=null},drawCanvas:function(e,t,r,i){e.width=r,e.height=i;var a=0,n=0;L.videoWidth/L.videoHeight>r/i?a=r/i*(n=L.videoHeight):n=i/r*(a=L.videoWidth),t.drawImage(L,(L.videoWidth-a)/2,(L.videoHeight-n)/2,a,n,0,0,r,i)},startCapture:function(e,t,r){return L=e,t&&r&&t/r==16/9&&(F=t,G=r),Q&&L.removeEventListener("timeupdate",Q),Q=this._draw.bind(this),e.addEventListener("timeupdate",Q),W=U.captureStream(H)},stopCapture:function(){Q&&L.removeEventListener("timeupdate",Q),this._clearFastTimer(),W&&(W.getVideoTracks().forEach((function(e){return e.stop()})),W=null),L=null},isSupported:function(){return"function"==typeof HTMLCanvasElement.prototype.captureStream}}),audioToMediaStreamMananger:function(){var e=null,t=new(window.AudioContext||window.webkitAudioContext),r=null,i=null,a=null;return{startCapture:function(n){if(a&&n===a)e=a;else{this.destroy(),a=e=n,i=t.createMediaElementSource(e);var o=t.createMediaStreamDestination();i.connect(o),r=o.stream}return"suspended"===t.state&&t.resume(),r},stopCapture:function(){t&&t.suspend(),e=null},destroy:function(){i&&i.disconnect(),r&&(r.getAudioTracks().forEach((function(e){return e.stop()})),r=null),a=null,i=null},isAudioFileStream:function(e){return e===r},isSupported:function(){return"undefined"!=typeof AudioContext&&"function"==typeof AudioContext.prototype.createMediaStreamDestination&&"function"==typeof AudioContext.prototype.createMediaElementSource}}}()};function $(){var e=this;this.promise=new Promise((function(t,r){e.reject=r,e.resolve=t}))}var ee=function(){function e(t,r){c()(this,e),this.scriptURL=t,this.lateLoadedAssetsHash=r}return l()(e,[{key:"getIntegrity",value:function(){var e=this.scriptURL.split("/").pop().split("?")[0].split("#")[0],t=this.lateLoadedAssetsHash[e];return t||null}}]),e}();function te(e,t){if(e===t)return!0;if(i(e)&&i(t)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!te(e[r],t[r]))return!1;return!0}function i(e){return"object"===o()(e)&&null!=e}}},function(e,t){function r(e,t,r,i,a,n,o){try{var s=e[n](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(i,a)}e.exports=function(e){return function(){var t=this,i=arguments;return new Promise((function(a,n){var o=e.apply(t,i);function s(e){r(o,a,n,s,u,"next",e)}function u(e){r(o,a,n,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.d(t,"b",(function(){return u}));var i=r(11),a=r.n(i),n=r(12),o=r.n(n),s=function(){function e(){a()(this,e),this._highFrequencyLogs={}}return o()(e,[{key:"setInstance",value:function(e){this._instance=e}},{key:"getMessageFromErrorEvent",value:function(e,t){var r=e;return t instanceof ErrorEvent?(t.filename&&(r+=" File: ".concat(t.filename)),(t.lineno||t.colno)&&(r+=" Line: ".concat(t.lineno,":").concat(t.colno)),t.message&&(r+=" Message: ".concat(t.message)),t.stack&&(r+="\nStack: ".concat(t.stack))):t instanceof Error&&(t.fileName&&(r+=" File: ".concat(t.fileName)),(t.lineNumber||t.columnNumber)&&(r+=" Line: ".concat(t.lineNumber,":").concat(t.columnNumber)),t.message&&(r+=" Message: ".concat(t.message)),t.stack&&(r+=" Stack: ".concat(t.stack)),t.name&&(r+=" Name: ".concat(t.name))),r}},{key:"error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.getMessageFromErrorEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1;var r=u(this._highFrequencyLogs[e]);this._instance&&r&&this._instance.error(e)}}]),e}(),u=function(e){return 0==(e&e-1)},d=new s;t.a=d},function(e,t,r){"use strict";r.d(t,"l",(function(){return i})),r.d(t,"e",(function(){return a})),r.d(t,"y",(function(){return n})),r.d(t,"a",(function(){return o})),r.d(t,"g",(function(){return s})),r.d(t,"k",(function(){return u})),r.d(t,"A",(function(){return d})),r.d(t,"d",(function(){return c})),r.d(t,"v",(function(){return h})),r.d(t,"o",(function(){return l})),r.d(t,"n",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"b",(function(){return m})),r.d(t,"f",(function(){return g})),r.d(t,"t",(function(){return v})),r.d(t,"w",(function(){return S})),r.d(t,"s",(function(){return _})),r.d(t,"u",(function(){return C})),r.d(t,"p",(function(){return y})),r.d(t,"z",(function(){return b})),r.d(t,"i",(function(){return A})),r.d(t,"j",(function(){return k})),r.d(t,"q",(function(){return E})),r.d(t,"h",(function(){return I})),r.d(t,"r",(function(){return w})),r.d(t,"x",(function(){return M})),r.d(t,"m",(function(){return D}));var i="QosMonitoring",a=30,n=35,o=48,s=61,u=-26,d=-27,c=50,h=51,l=52,p=53,f=66.5,m=66.6,g=78,v=-1,S=0,_=1,C=2,y=3,b=!0,A=30,k=1,E=24,I=10,w=8294400,M={DESKTOP:0,MOBILE:1,ANDROID:2,IPHONE:3},D=0},function(e,t,r){"use strict";var i=r(21),a=r.n(i),n=function(){};n.prototype={publish:function(){return a.a.publish.apply(this,arguments)},publishSync:function(){return a.a.publishSync.apply(this,arguments)},trigger:function(){return this.publish.apply(this,arguments)},triggerSync:function(){return this.publishSync.apply(this,arguments)},emit:function(){return this.publish.apply(this,arguments)},subscribe:function(){return a.a.subscribe.apply(this,arguments)},on:function(){return this.subscribe.apply(this,arguments)},unsubscribe:function(){return a.a.unsubscribe.apply(this,arguments)},clearAllSubscriptions:function(){a.a.clearAllSubscriptions()}},t.a=new n},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(31);function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}e.exports=function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";var i=r(19),a=r.n(i),n=r(17),o="object"===("undefined"==typeof localStorage?"undefined":r.n(n)()(localStorage))&&localStorage.__islogdebug,s=function(e,t){function r(){var e=[];return e.push.apply(e,arguments),e}!0===t&&(o=!0);var i=function(){var t;o&&(t=console).log.apply(t,[e].concat(a()(r(arguments))))};return["log","info","warn","error"].forEach((function(t){i[t]=function(){var i;o&&(i=console)[t].apply(i,[e].concat(a()(r(arguments))))}})),i.isEnable=function(){return o},i};s.isEnable=function(){return o},t.a=s},function(e,t,r){"use strict";function i(){this.a=[],this.b=0,this.residue=null}i.prototype.getLength=function(){return this.a.length-this.b},i.prototype.isEmpty=function(){return 0==this.a.length},i.prototype.enqueue=function(e){this.a.push(e)},i.prototype.dequeue=function(){if(0!=this.a.length){var e=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),e}return null},i.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0},i.prototype.clear=function(){this.a=[],this.b=0},t.a=i},function(e,t,r){var i=r(47),a=r(48),n=r(30),o=r(49);e.exports=function(e,t){return i(e)||a(e,t)||n(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(31);e.exports=function(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.d(t,"e",(function(){return s})),r.d(t,"c",(function(){return l})),r.d(t,"a",(function(){return u})),r.d(t,"d",(function(){return d})),r.d(t,"b",(function(){return p}));var i=r(14);function a(){this.ssrcQueueMap=new Map,a.prototype.AddQueue=function(e){var t=new i.a;return this.ssrcQueueMap.set(e,t),t},a.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},a.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},a.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},a.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},a.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return null!==t?t.getLength():0}}var n=function(){this.frames=0,this.ntp=new i.a};n.prototype={UpdateVideoInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetVideoFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,i=0,a=0,n=0;n<e;n++){var o=this.ntp.dequeue();0==o&&0==i?r++:0!=o?(a=0,0==i&&(i=o),t=o):0!=i&&t!=i&&0==o&&a++}return 0==t||t==i?0:e-r-a-1!=0?(t-i)/(e-r-a-1):0}}};var o=function(){this.ssrcInfoMap=new Map};function s(){this.ssrcQueueMap=new Map,this.ssrcInfo=new o,s.prototype.AddQueue=function(e){var t=new i.a;return this.ssrcQueueMap.set(e,t),t},s.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},s.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},s.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},s.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},s.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},s.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},s.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},s.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}o.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new n,this.ssrcInfoMap.set(e,r)),r.UpdateVideoInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetVideoFpsInfo():0}};var u=function(){function e(){this.map=new Map,this.AudioQueueMGR=new a,this.timemap=new Map}return e.prototype.Add=function(e,t){this.map.set(e,t),this.AudioQueueMGR.AddQueue(e)},e.prototype.Clear=function(){this.map.clear()},e.prototype.Keys=function(){return this.map.keys()},e.prototype.UpdateSSRCTimeMap=function(e){this.timemap=e},e.prototype.GetSSRCTimeMap=function(e){return this.timemap?this.timemap.get(e):null},e}();function d(){this.map=new Map,this.VideoQueueMGR=new s}d.prototype.Add=function(e,t){this.map.set(e,t)},d.prototype.Clear=function(){this.map.clear()},d.prototype.Keys=function(){return this.map.keys()};var c=function(){this.frames=0,this.ntp=new i.a};c.prototype={UpdateSharingInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetSharingFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,i=0,a=0,n=0;n<e;n++){var o=this.ntp.dequeue();0==o&&0==i?r++:0!=o?(a=0,0==i&&(i=o),t=o):0!=i&&t!=i&&0==o&&a++}return 0==t||t==i?0:e-r-a-1!=0?(t-i)/(e-r-a-1):0}}};var h=function(){this.ssrcInfoMap=new Map};function l(){this.ssrcQueueMap=new Map,this.ssrcInfo=new h,l.prototype.AddQueue=function(e){var t=new i.a;return this.ssrcQueueMap.set(e,t),t},l.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},l.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},l.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},l.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},l.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},l.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},l.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},l.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}function p(){this.map=new Map,this.sQueue=new i.a,this.SharingQueueMGR=new l}h.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new c,this.ssrcInfoMap.set(e,r)),r.UpdateSharingInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetSharingFpsInfo():0}},p.prototype.Clear=function(){this.map.clear()},p.prototype.Keys=function(){return this.map.keys()},p.prototype.Add=function(e,t){this.map.set(e,t)},p.prototype.Get=function(e){return this.map.get(e)},p.prototype.PutData=function(e){e&&this.sQueue&&this.sQueue.enqueue(e)},p.prototype.GetData=function(){if(this.sQueue)return this.sQueue.dequeue()},p.prototype.ClearBuffer=function(){this.sQueue&&(this.sQueue=new i.a)}},function(e,t,r){var i=r(41),a=r(42),n=r(30),o=r(43);e.exports=function(e){return i(e)||a(e)||n(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(22),a=r(27);e.exports=function(e){return"number"==typeof e||a(e)&&"[object Number]"==i(e)}},function(e,t,r){(function(e){!function(r,i){"use strict";var a={};r.PubSub=a;var n=r.define;!function(e){var t={},r=-1;function i(e){var t;for(t in e)if(e.hasOwnProperty(t))return!0;return!1}function a(e,t,r){try{e(t,r)}catch(e){setTimeout(function(e){return function(){throw e}}(e),0)}}function n(e,t,r){e(t,r)}function o(e,r,i,o){var s,u=t[r],d=o?n:a;if(t.hasOwnProperty(r))for(s in u)u.hasOwnProperty(s)&&d(u[s],e,i)}function s(e,r,a,n){var s=function(e,t,r){return function(){var i=String(e),a=i.lastIndexOf(".");for(o(e,e,t,r);-1!==a;)a=(i=i.substr(0,a)).lastIndexOf("."),o(e,i,t,r)}}(e,r,n);return!!function(e){for(var r=String(e),a=Boolean(t.hasOwnProperty(r)&&i(t[r])),n=r.lastIndexOf(".");!a&&-1!==n;)n=(r=r.substr(0,n)).lastIndexOf("."),a=Boolean(t.hasOwnProperty(r)&&i(t[r]));return a}(e)&&(!0===a?s():setTimeout(s,0),!0)}e.publish=function(t,r){return s(t,r,!1,e.immediateExceptions)},e.publishSync=function(t,r){return s(t,r,!0,e.immediateExceptions)},e.subscribe=function(e,i){if("function"!=typeof i)return!1;t.hasOwnProperty(e)||(t[e]={});var a="uid_"+String(++r);return t[e][a]=i,a},e.subscribeOnce=function(t,r){var i=e.subscribe(t,(function(){e.unsubscribe(i),r.apply(this,arguments)}));return e},e.clearAllSubscriptions=function(){t={}},e.clearSubscriptions=function(e){var r;for(r in t)t.hasOwnProperty(r)&&0===r.indexOf(e)&&delete t[r]},e.unsubscribe=function(r){var i,a,n,o="string"==typeof r&&(t.hasOwnProperty(r)||function(e){var r;for(r in t)if(t.hasOwnProperty(r)&&0===r.indexOf(e))return!0;return!1}(r)),s=!o&&"string"==typeof r,u="function"==typeof r,d=!1;if(!o){for(i in t)if(t.hasOwnProperty(i)){if(a=t[i],s&&a[r]){delete a[r],d=r;break}if(u)for(n in a)a.hasOwnProperty(n)&&a[n]===r&&(delete a[n],d=!0)}return d}e.clearSubscriptions(r)}}(a),"function"==typeof n&&n.amd?n((function(){return a})):(void 0!==e&&e.exports&&(t=e.exports=a),t.PubSub=a,e.exports=t=a)}("object"==typeof window&&window||this)}).call(this,r(52)(e))},function(e,t,r){var i=r(32),a=r(54),n=r(55),o=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?a(e):n(e)}},function(e,t,r){var i=r(56),a=r(24);e.exports=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return a(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),i(e,t,{leading:n,maxWait:t,trailing:o})}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){"use strict";var i=r(11),a=r.n(i),n=r(12),o=r.n(n),s=function(){function e(){a()(this,e)}return o()(e,[{key:"_drawWatermarkWithShadow",value:function(e){var t=e.ctx,r=e.textPos,i=e.opacity,a=e.name;t.fillStyle="rgba(0, 0, 0, ".concat(i,")"),t.fillText(a,r.x,r.y),t.fillStyle="rgba(255, 255, 255, ".concat(i,")"),t.fillText(a,r.x+1,r.y+1)}},{key:"_getTransformInfo",value:function(e){var t,r=e.canvas,i=e.position;if(1===i)t={x:r.width/2,y:0,rateRadio:0,maxWidth:r.width};else if(2===i)t={x:r.width/2,y:r.height,rateRadio:0,maxWidth:r.width};else if(4===i)t={x:0,y:r.height/2,rateRadio:Math.PI/2,maxWidth:r.height};else if(8===i)t={x:r.width,y:r.height/2,rateRadio:-Math.PI/2,maxWidth:r.height};else{var a=-21*Math.PI/180;t={x:r.width/2,y:r.height/2,rateRadio:a,maxWidth:Math.min(r.width/Math.cos(a),-r.height/Math.sin(a))}}return t.maxWidth>100&&(t.maxWidth-=50),t}},{key:"_calcTextPos",value:function(e){var t=e.position,r=e.ctx,i=e.name,a=e.textWidth,n=this._getPaddingWidth({ctx:r,position:t,name:i});return 1===t?{x:-a.width/2,y:n}:2===t||4===t||8===t?{x:-a.width/2,y:-n}:{x:-a.width/2,y:r.measureText(i[0]).width/2}}},{key:"_getPaddingWidth",value:function(e){var t=e.ctx,r=e.position,i=e.name;return[1,2,4,8].includes(r)?32:t.measureText(i[0]).width}},{key:"_setBaseLine",value:function(e){var t=e.ctx,r=e.position;t.textBaseline=1===r?"top":2===r||4===r||8===r?"bottom":"middle"}},{key:"Get_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,i=e.width,a=e.height,n=e.opacity,o=void 0===n?.15:n,s=e.position,u=e.convertToDataUrl;if(r&&i&&a){o=o||.15;i*=1,a*=1,t.width=i,t.height=a;var d,c=this._getTransformInfo({canvas:t,position:s}),h=t.getContext("2d");if(h.clearRect(0,0,t.width,t.height),h.translate(c.x,c.y),h.rotate(c.rateRadio),this._setBaseLine({ctx:h,position:s}),h.lineWidth=1,h.imageSmoothingEnabled=!0,1==r.length){var l=c.maxWidth/r.length;h.font=l+"px  'Segoe UI'",d=h.measureText(r)}else{var p=16;for(h.font=p+"px  'Segoe UI'",d=h.measureText(r);d.width<c.maxWidth-2*this._getPaddingWidth({ctx:h,position:s,name:r});)p+=1,h.font=p+"px  'Segoe UI'",d=h.measureText(r);if(d.width>c.maxWidth-2*this._getPaddingWidth({ctx:h,position:s,name:r}))if(p>16)p-=1,h.font=p+"px  'Segoe UI'",d=h.measureText(r);else{for(var f=r;r.length>5&&d.width>c.maxWidth-2*this._getPaddingWidth({ctx:h,position:s,name:r+"..."});)r=r.slice(0,r.length-1),d=h.measureText(r+"...");f!==r&&(r+="...")}}var m,g=this._calcTextPos({position:s,ctx:h,name:r,textWidth:d});if(this._drawWatermarkWithShadow({ctx:h,name:r,opacity:o,textPos:g}),u)m=t.toDataURL();else{var v=h.getImageData(0,0,h.canvas.width,h.canvas.height);m=new Uint8Array(v.data.buffer)}return h.rotate(-c.rateRadio),h.translate(-c.x,-c.y),m}}},{key:"Get_Repeated_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,i=e.width,a=e.height,n=e.opacity,o=void 0===n?.15:n,s=(e.position,e.convertToDataUrl);if(r&&i&&a){o=o||.15;i*=1,a*=1,t.width=i,t.height=a;var u=t.getContext("2d");u.clearRect(0,0,t.width,t.height),u.translate(i/2,a/2),u.rotate(-21*Math.PI/180),u.imageSmoothingEnabled=!0;u.font="".concat(32,"px 'Segoe UI'"),u.textBaseline="top";var d,c=u.measureText(r),h=.37*c.width,l=0,p=-a;do{var f=l%2==0?h-i:-i;do{u.fillStyle="rgba(0, 0, 0, ".concat(o,")"),u.fillText(r,f,p),u.fillStyle="rgba(255, 255, 255, ".concat(o,")"),u.fillText(r,f+1,p+1),f+=c.width+h}while(f<i);p+=32+h,l++}while(p<a);if(s)d=t.toDataURL();else{var m=u.getImageData(0,0,u.canvas.width,u.canvas.height);d=new Uint8Array(m.data.buffer)}return u.rotate(21*Math.PI/180),u.translate(-i/2,-a/2),d}}}]),e}();t.a=s},function(e,t,r){var i=r(50);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(29);e.exports=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(17).default,a=r(44);e.exports=function(e){var t=a(e,"string");return"symbol"===i(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(33).Symbol;e.exports=i},function(e,t,r){var i=r(53),a="object"==typeof self&&self&&self.Object===Object&&self,n=i||a||Function("return this")();e.exports=n},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var i=r(46);e.exports=function(e,t){if(null==e)return{};var r,a,n=i(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(17).default,a=r(51);e.exports=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return a(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(22),a=r(24);e.exports=function(e){if(!a(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,r){"use strict";(function(e){var i=r(7),a=r.n(i),n=r(3),o=r.n(n),s=r(23),u=r.n(s),d=r(13),c=r(10),h=r(1),l=r(20),p=r.n(l),f=r(39),m=r.n(f),g=r(6),v=r(2),S=Object(d.a)("sdk.remoteControl"),_=0,C=0,y=83,b=82,A=84,k=85,E=87,I=88;function w(e){var t=this;this.dom=e.dom,this.socketURL=e.socketURL,this.meetingID=e.meetingID,this.condID=e.condID,this.blobSocket=null;var r=this._keyMouseEventHandler.bind(this);this.keyMouseEventHandler=function(e){t.keyMouseFilters(e).then((function(e){r(e)}))},this.keyMouseEventHandlerThrottle=u()((function(e){t.keyMouseEventHandler(e)}),1e3/24),this.pasteOnDocument=this._pasteOnDocument.bind(this),this.copyOnDocument=this._copyOnDocument.bind(this),this.cutOnDocument=this._cutOnDocument.bind(this),this.focus=this._focus.bind(this),this.PUBSUB_SHARING_PARAM_INFO_TOKEN=null,this.preventDefault=this._preventDefault.bind(this),this.browserBlurEventHandler=this._browserBlurEventHandler.bind(this),this.positionMap={canvas:{offsetX:0,offsetY:0},src:{x:0,y:0,w:0,h:0,scaleWidth:0,scaleHeight:0},dst:{x:0,y:0,w:0,h:0}},this.blockedKeyboardEventOfPaste=[],this.keydownupMergeRemoveMap={},this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map={},this.PASTE_MAX_BYTE_LENGTH=64e3,this.currentMousePositionProps={clientX:0,clientY:0,x2video:0,y2video:0},this.isControllerNow=!0,this.remoteOS=v.f.UNKNOWN,this.localOS=this.getLocalOS(),this._blockedCopyKeyboardList=[],this.maxSleep=500}w.prototype={start:function(){var e=this;return new Promise(function(){var t=a()(o.a.mark((function t(r,i){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,S("remote control start"),e.modifyDom(),e.bindEvent(),e.subscribeSharingWidthOrHeightChange(),t.next=7,e.connectSocket();case 7:e.sendPostionPDU(),e.socketBlobMessageHandler(),r(!0),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),i(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,r){return t.apply(this,arguments)}}())},destroy:function(){var e=this;return new Promise((function(t,r){try{S("destroy remote control"),e.unbindEvent(),e.uncheckAndClearKeydownupMergeRemoveMap(),e.destroySocket(),c.a.unsubscribe(e.PUBSUB_SHARING_PARAM_INFO_TOKEN),t(!0)}catch(e){S(e),t(!1)}}))},modifyDom:function(){try{this.dom.setAttribute("tabindex","0"),this.dom.focus()}catch(e){}},_focus:function(){this.dom.focus()},getLocalOS:function(){var t=e.navigator.platform;return/win/i.test(t)?v.f.WIN:/mac/i.test(t)?v.f.MAC:v.f.UNKNOWN},setIsControlerNow:function(e){this.isControllerNow=e},blobSocketCheckAndSend:function(e){this.isControllerNow&&this.blobSocket.send(e)},isKeyboardEvent:function(e){return!!e&&(e.type&&-1!==["keydown","keyup"].indexOf(e.type.toLowerCase()))},isThisKeyIgnoreCase:function(e,t){return e.key&&e.key.toLowerCase()==t.toLowerCase()},_copyOnDocument:function(e){var t=this;return a()(o.a.mark((function r(){var i;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){r.next=2;break}return r.abrupt("return");case 2:if(i=t._blockedCopyKeyboardList,"done"!=i[i.length-1]){r.next=8;break}return r.abrupt("return");case 8:t._blockedCopyKeyboardList=[],t._blockedCopyKeyboardList.push("done");case 10:S("copyOnDocument",e),t.processMonitorCtrlMetaWithKey("c");case 12:case"end":return r.stop()}}),r)})))()},_cutOnDocument:function(e){var t=this;return a()(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){r.next=2;break}return r.abrupt("return");case 2:S("_cutOnDocument",e),t.processMonitorCtrlMetaWithKey("x");case 4:case"end":return r.stop()}}),r)})))()},processMonitorCtrlMetaWithKey:function(e){var t=this,r=0,i=1,a=2,n=this.remoteOS===v.f.MAC,o={t:"keydown",event_type:1,repeat:!1,alt:!1,shift:!1,capslock:!1,numlock:!0,pduType:k,ctrl:!n,super:n},s=Object.assign({},o,{charCode:0,keyCode:n?91:17,key:n?"Meta":"Control"}),u=Object.assign({},o,{charCode:e.charCodeAt(0),keyCode:e.toUpperCase().charCodeAt(0),key:e}),d=Object.assign({},s,{input_event_type:r}),c=(Object.assign({},s,{input_event_type:a}),Object.assign({},u,{input_event_type:r})),h=(Object.assign({},u,{input_event_type:a}),Object.assign({},s,{t:"keyup",ctrl:!1,super:!1,input_event_type:i})),l=Object.assign({},u,{t:"keyup",ctrl:!1,super:n,input_event_type:i});(n?[d,c,l,h]:[d,c,h,l]).forEach((function(e){t.processEvent(e)}))},isFocusNow:function(){return this.dom===document.activeElement},_pasteOnDocument:function(e){var t=this;return a()(o.a.mark((function r(){var i,a,n,s,u,d,c,h,l,p,f;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){for(i=(e.clipboardData||window.clipboardData).getData("text"),S("_pasteOnDocument",i),a=[],n=0;n<i.length;n++)for(s=i[n],u=m.a.encode(s),d=0;d<u.length;d++)a.push(u.charCodeAt(d));for(c=new ArrayBuffer(8+a.length),h=new Uint8Array(c),l=new DataView(c,4,4),p=new Uint8Array(c,8),h[0]=E,l.setUint32(0,a.length,!0),f=0;f<a.length;f++)p[f]=a[f];a.length>t.PASTE_MAX_BYTE_LENGTH?(t.triggerPasteTextLengthOverflow(),t.dropAllEventFromBlockedKeyboardEventOfPaste()):(t.blobSocketCheckAndSend(c),t.processMonitorCtrlMetaWithKey("v"))}case 1:case"end":return r.stop()}}),r)})))()},onReturnCopiedText:function(e){!this._onReturnCopiedText_list&&(this._onReturnCopiedText_list=[]),this._onReturnCopiedText_list.push(e)},triggerReturnCopiedText:function(e){this._onReturnCopiedText_list&&this._onReturnCopiedText_list.forEach((function(t){return t(e)}))},onPasteTextLengthOverflow:function(e){!this._onPasteTextLengthOverflow_list&&(this._onPasteTextLengthOverflow_list=[]),this._onPasteTextLengthOverflow_list.push(e)},triggerPasteTextLengthOverflow:function(){this._onPasteTextLengthOverflow_list&&this._onPasteTextLengthOverflow_list.forEach((function(e){return e()}))},dropAllEventFromBlockedKeyboardEventOfPaste:function(){this.blockedKeyboardEventOfPaste=[]},createParamsFromKeyboardEvent:function(e){return{key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,repeat:e.repeat,charCode:e.charCode,keyCode:e.keyCode,which:e.which,ctrlKey:e.ctrlKey,metaKey:e.metaKey}},sendAllEventFromBlockedKeyboardEventOfPaste:function(){for(S("blockedKeyboardEventOfPaste.length",this.blockedKeyboardEventOfPaste.length);this.blockedKeyboardEventOfPaste.length>0;){var e=this.blockedKeyboardEventOfPaste.shift();this._keyMouseEventHandler(e)}},_preventDefault:function(e){if(-1!==["keydown","keyup"].indexOf(e.type))for(var t=["v","c","x"],r=0;r<t.length;r++)if(e.ctrlKey^e.metaKey&&this.isThisKeyIgnoreCase(e,t[r]))return;e.preventDefault()},subscribeSharingWidthOrHeightChange:function(){var e=this;this.PUBSUB_SHARING_PARAM_INFO_TOKEN=c.a.on(h.Xc,(function(t,r){S("subscribeSharingWidthOrHeightChange",r.body),e.positionMap.dst.w=r.body.logicWidth,e.positionMap.dst.h=r.body.logicHeight,e.positionMap.src.w=r.body.logicWidth,e.positionMap.src.h=r.body.logicHeight,e.sendPostionPDU()}))},setDstWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of destination sharing video width/height are not correct");this.positionMap.dst.w=e,this.positionMap.dst.h=t},setSrcWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w=e,this.positionMap.src.h=t},setSrcWidthAndHeightAndSendPDU:function(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w!==e&&this.positionMap.src.h!==t&&(this.setSrcWidthAndHeight(e,t),this.sendPostionPDU())},setSrcOffsetXYAndSendPDU:function(e,t){e=Math.floor(e),t=Math.floor(t),this.positionMap.canvas.offsetX===e&&this.positionMap.canvas.offsetY===t||(this.setSrcOffsetXY(e,t),this.sendPostionPDU())},setSrcScaleWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of source sharing video scaleWidth/scaleHeight are not correct");this.positionMap.src.scaleWidth=e,this.positionMap.src.scaleHeight=t},setSrcOffsetXY:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Math.floor(e),i=Math.floor(t);if(!p()(r)&&!p()(i))throw new Error("the value of source offset x or y is not correct");this.positionMap.canvas.offsetX=r,this.positionMap.canvas.offsetY=i},sendPostionPDU:function(){var e=new ArrayBuffer(36),t=new Uint8Array(e),r=new DataView(e,4),i=new DataView(e,20);t[0]=b,r.setInt32(0,this.positionMap.src.x,!0),r.setInt32(4,this.positionMap.src.y,!0),r.setInt32(8,this.positionMap.src.w,!0),r.setInt32(12,this.positionMap.src.h,!0),i.setInt32(0,this.positionMap.dst.x,!0),i.setInt32(4,this.positionMap.dst.y,!0),i.setInt32(8,this.positionMap.dst.w,!0),i.setInt32(12,this.positionMap.dst.h,!0),S("send position pdu");try{this.blobSocket.send(e)}catch(e){}},unbindEvent:function(){var e=this.dom;e.removeEventListener("click",this.focus),e.removeEventListener("keydown",this.keyMouseEventHandler),e.removeEventListener("keyup",this.keyMouseEventHandler),document.removeEventListener("paste",this.pasteOnDocument),document.removeEventListener("copy",this.copyOnDocument),document.removeEventListener("cut",this.cutOnDocument),e.removeEventListener("contextmenu",this.preventDefault),e.removeEventListener("wheel",this.preventDefault),e.removeEventListener("dblclick",this.preventDefault),e.removeEventListener("keydown",this.preventDefault),e.removeEventListener("keyup",this.preventDefault),e.removeEventListener("dblclick",this.keyMouseEventHandler),e.removeEventListener("mousedown",this.keyMouseEventHandler),e.removeEventListener("mouseup",this.keyMouseEventHandler),e.removeEventListener("mousemove",this.keyMouseEventHandlerThrottle),e.removeEventListener("wheel",this.keyMouseEventHandler),window.removeEventListener("blur",this.browserBlurEventHandler)},bindEvent:function(){var e=this.dom;S("dom",e),e.addEventListener("click",this.focus),e.addEventListener("keydown",this.keyMouseEventHandler),e.addEventListener("keyup",this.keyMouseEventHandler),document.addEventListener("paste",this.pasteOnDocument),document.addEventListener("copy",this.copyOnDocument),document.addEventListener("cut",this.cutOnDocument),e.addEventListener("contextmenu",this.preventDefault),e.addEventListener("wheel",this.preventDefault),e.addEventListener("dblclick",this.preventDefault),e.addEventListener("keydown",this.preventDefault),e.addEventListener("keyup",this.preventDefault),e.addEventListener("dblclick",this.keyMouseEventHandler),e.addEventListener("mousedown",this.keyMouseEventHandler),e.addEventListener("mouseup",this.keyMouseEventHandler),e.addEventListener("mousemove",this.keyMouseEventHandlerThrottle),e.addEventListener("wheel",this.keyMouseEventHandler),window.addEventListener("blur",this.browserBlurEventHandler)},recordCurrentMousePosition:function(e){try{var t=this.positionMap,r=e.clientX,i=e.clientY;Object.assign(this.currentMousePositionProps,{clientX:r,clientY:i,x2video:r-t.canvas.offsetX,y2video:i-t.canvas.offsetY})}catch(e){}},resolvePosition:function(e){var t=e.clientX,r=e.clientY,i=this.positionMap;return t-=i.canvas.offsetX,r-=i.canvas.offsetY,t*=i.dst.w/i.src.scaleWidth,r*=i.dst.h/i.src.scaleHeight,{x:t=Math.floor(t),y:r=Math.floor(r)}},generateBuffer:function(e){if(void 0!==e.key&&!/^[\x00-\x7F]*$/.test(e.key))throw new Error("params.key must only contain ascii character");var t=8;(e=Object.assign({v:0,x:0,y:0,dx:0,dy:0,repeat:0},e)).pduType===A&&(t+=4);var r=new ArrayBuffer(t),i=new Uint8Array(r),a=new DataView(r,4),n=new DataView(r,4);if(i[0]=e.pduType,i[1]=63&e.input_event_type,e.pduType===y)a.setUint16(0,e.x,!0),a.setUint16(2,e.y,!0);else if(e.pduType===A)n.setInt16(0,e.x,!0),n.setInt16(2,e.y,!0),n.setInt16(4,e.dx,!0),n.setInt16(6,e.dy,!0);else if(e.pduType===k){var o=new DataView(r,4),s=new DataView(r,6),u=new Uint8Array(r,2);o.setUint16(0,e.keyCode,!0),s.setUint16(0,e.charCode,!0);var d={shift:1,capslock:2,ctrl:4,alt:8,numlock:16,super:32},c=0;Object.keys(d).forEach((function(t){!0===e[t]&&(c+=d[t])})),u[0]=c,e.repeat&&(i[1]=32|i[1])}return r},processEvent:function(e){this.blobSocket&&this.blobSocketCheckAndSend(this.generateBuffer(e))},debug:function(e){var t={};(e.pduType===k?["t","keyCode","charCode","key"]:["t","x","y","dx","dy","input_event_type"]).forEach((function(r){t[r]=e[r]})),S("debug",JSON.stringify(t))},blockedPasteKeyboard:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&t.isPasteEvent(e)?t.blockedKeyboardEventOfPaste.push(e):r(e)}))},isPasteEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"v");return!!(e.ctrlKey^e.metaKey&&t)},isCopyEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"c");return!!(e.ctrlKey^e.metaKey&&t)},isCutEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"x");return!!(e.ctrlKey^e.metaKey&&t)},returnNewEventByTransformCtrlKeyOrCommandKey:function(e){var t=this.createParamsFromKeyboardEvent(e);switch(this.remoteOS){case v.f.WIN:Object.assign(t,{ctrlKey:!0,metaKey:!1});break;case v.f.MAC:Object.assign(t,{ctrlKey:!1,metaKey:!0});break;case v.f.UNKNOWN:}return new e.constructor(e.type,t)},transformCtrlCAndCommandC:function(e){var t=this,r=this;return new Promise((function(i,a){if(t.isKeyboardEvent(e)&&(e.ctrlKey||e.metaKey)&&r.isThisKeyIgnoreCase(e,"c")){r.createParamsFromKeyboardEvent(e);i(r.returnNewEventByTransformCtrlKeyOrCommandKey(e))}else i(e)}))},keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap:function(e){var t=this;return new Promise((function(r,i){try{t.isKeyboardEvent(e)&&e.key&&("keydown"!==e.type||e.repeat||(t.keydownupMergeRemoveMap[e.key]={t:+new Date,e:e}),"keydown"===e.type&&e.repeat&&delete t.keydownupMergeRemoveMap[e.key],"keyup"===e.type&&delete t.keydownupMergeRemoveMap[e.key])}catch(e){S.error(e)}r(e)}))},_browserBlurEventHandler:function(){this._checkAndClearKeydownupMergeRemoveMap(this.maxSleep,!0)},checkAndClearKeydownupMergeRemoveMap:function(){var e=this,t=this;this.checkAndClearKeydownupMergeRemoveMapInterval=setInterval((function(){t._checkAndClearKeydownupMergeRemoveMap(e.maxSleep)}),100)},_checkAndClearKeydownupMergeRemoveMap:function(e,t){var r=this,i=this.keydownupMergeRemoveMap;Object.keys(i).forEach((function(a){var n=i[a];if(+new Date-n.t>=e||t){var o=new n.e.constructor("keyup",n.e);try{r._keyMouseEventHandler(o)}catch(e){}delete r.keydownupMergeRemoveMap[a]}}))},uncheckAndClearKeydownupMergeRemoveMap:function(){this._checkAndClearKeydownupMergeRemoveMap(0),clearInterval(this.checkAndClearKeydownupMergeRemoveMapInterval)},keyMouseFilters:function(e){var t=this;return new Promise((function(t,r){t(e)})).then((function(e){return t.blockedPasteKeyboard(e)})).then((function(e){return t.blockedCopyKeyboard(e)})).then((function(e){return t.blockedCutKeyboard(e)})).then((function(e){return t.keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap(e)})).then((function(e){return t.blockedSomeKeyboardEventNotHaveKeydownBefore(e)})).then((function(e){return t.keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE(e)}))},blockedSingleMetaKey:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&e.key&&(/command/i.test(e.key)||/meta/i.test(e.key)||/control/i.test(e.key))&&!e.shiftKey&&!e.altKey&&e.ctrlKey^e.metaKey||r(e)}))},blockedCutKeyboard:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&t.isCutEvent(e)||r(e)}))},blockedCopyKeyboard:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&t.isCopyEvent(e)?t._blockedCopyKeyboardList.push(e):r(e)}))},blockedSomeKeyboardEventNotHaveKeydownBefore:function(e){var t=this;return new Promise((function(r,i){if(t.isKeyboardEvent(e)&&e.key){var a=!1;if(["x","c","v"].forEach((function(r){t.isThisKeyIgnoreCase(e,r)&&(a=!0)})),"keyup"===e.type&&a)if(!!!t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key])return}r(e)}))},keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE:function(e){var t=this;return new Promise((function(r,i){try{if(t.isKeyboardEvent(e)&&e.key&&("keydown"===e.type&&(t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key]=e),"keyup"===e.type)){var a=!!t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];delete t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];var n=!1;if(["meta"].forEach((function(r){t.isThisKeyIgnoreCase(e,r)&&(n=!0)})),!a&&!n){S.warn("keyup trigger, but no keydown before");var o=new e.constructor("keydown",e);t._keyMouseEventHandler(o)}}}catch(e){S.error(e)}r(e)}))},_keyMouseEventHandler:function(e){this.isKeyboardEvent(e)&&S("_keyMouseEventHandler keyboard",e);var t={},r={keydown:0,keyup:1,keychar:2},i={mousemove:0,mousedown:{left:1,right:4,middle:7},mouseup:{left:2,right:5,middle:8},mouseleftdbldown:3,mouserightdbldown:6,wheel:10},a=e.getModifierState?function(t){return e.getModifierState(t)}:function(e,t){return t},n=_,o=e.key&&1===e.key.length;if(-1!==["keydown","keyup"].indexOf(e.type))t.event_type=1,n=k,void 0!==r[e.type]&&(t.input_event_type=r[e.type]);else{if(-1===["mousedown","mouseup","mousemove","wheel","click","dblclick","contextmenu"].indexOf(e.type))return void S.warn("the event type cannot be handled");t.event_type=0,this.recordCurrentMousePosition(e);var s=this.resolvePosition(e);if(Object.assign(t,{x:s.x,y:s.y}),n="wheel"===e.type?A:y,void 0!==i[e.type]&&(t.input_event_type=i[e.type]),-1!==["mousedown","mouseup"].indexOf(e.type)){var u;switch(e.button){case 0:u="left";break;case 1:u="middle";break;case 2:u="right";break;default:u="left"}t.input_event_type=i[e.type][u]}-1!==["dblclick"].indexOf(e.type)&&(t.input_event_type=i.mouseleftdbldown)}if("wheel"===e.type){var d={deltaX:"dx",deltaY:"dy"};Object.keys(d).forEach((function(r){e[r]&&(t[d[r]]=e[r]>0?-100:100)}))}var c=this.ctrlMetaConvert({keyCode:e.keyCode,key:e.key,ctrlKey:e.ctrlKey,metaKey:e.metaKey});Object.assign(t,{t:e.type,pduType:n,keyCode:c.keyCode,charCode:o?e.key.charCodeAt(0):0,key:c.key,repeat:e.repeat,ctrl:c.ctrlKey,alt:e.altKey,super:c.metaKey,shift:e.shiftKey,capslock:a("CapsLock",!1),numlock:a("NumLock",!1)}),this.isKeyboardEvent(e)&&S("processEvent",JSON.stringify(t)),this.processEvent(t)},ctrlMetaConvert:function(e){var t=e.metaKey,r=e.ctrlKey;return(this.remoteOS===v.f.MAC&&this.localOS===v.f.WIN||this.remoteOS===v.f.WIN&&this.localOS===v.f.MAC)&&e.key&&(/Meta/i.test(e.key)?(e.ctrlKey=!0,e.keyCode=17,e.metaKey=r,e.key="Control"):/Control/i.test(e.key)&&(e.metaKey=!0,e.keyCode=91,e.ctrlKey=t,e.key="Meta")),e},isCapslock:function(e){var t=e.keyCode,r=e.key,i=e.shiftKey;return!!/[a-zA-Z]/.test(r)&&(r.charCodeAt(0)!==t?!i:i)},stop:function(){var e=this;return a()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.blobSocket&&e.blobSocket.close(),e.blobSocket=null;case 2:case"end":return t.stop()}}),t)})))()},connectSocket:function(){var e=this;return a()(o.a.mark((function t(){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createBlobSocket("".concat(e.socketURL,"/wc/media/").concat(e.meetingID,"?type=r&mode=2&cid=").concat(e.condID));case 2:return(r=t.sent).binaryType="blob",e.blobSocket=r,t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})))()},socketBlobMessageHandler:function(){if(this.blobSocket){var e=this;this.blobSocket.addEventListener("message",function(){var t=a()(o.a.mark((function t(r){var i,a,n,s,u,d,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.data,t.next=3,g.g.readBlobAsBuffer(i,i.size);case 3:if(a=t.sent,n=new Int8Array(a),(s=n[0])!==I||!e.isControllerNow){t.next=14;break}return u=i.slice(8),t.next=10,g.g.readBlob(u);case 10:d=t.sent,c=n[4],S("COPY_TEXT_FROM_RWG",d,c),e.triggerReturnCopiedText({data:d,x:e.currentMousePositionProps.x2video,y:e.currentMousePositionProps.y2video});case 14:s===C&&e.blobSocket.send(a);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},destroySocket:function(){try{this.blobSocket.close(),this.blobSocket=null}catch(e){S("destroySocket",e)}},createBlobSocket:function(e){return new Promise((function(t,r){var i=new WebSocket(e);i.addEventListener("open",(function(){})),i.addEventListener("message",(function(e){try{var r=JSON.parse(e.data);0===r.evt&&r.body&&t(i)}catch(e){}})),i.addEventListener("error",(function(e){r(e)})),i.addEventListener("close",(function(){r(new Error("socket close"))}))}))},setRemoteOS:function(e){void 0!==e&&(this.remoteOS=e)}},t.a=w}).call(this,r(34))},function(e,t,r){!function(e){var t,r,i,a=String.fromCharCode;function n(e){for(var t,r,i=[],a=0,n=e.length;a<n;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<n?56320==(64512&(r=e.charCodeAt(a++)))?i.push(((1023&t)<<10)+(1023&r)+65536):(i.push(t),a--):i.push(t);return i}function o(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function s(e,t){return a(e>>t&63|128)}function u(e){if(0==(4294967168&e))return a(e);var t="";return 0==(4294965248&e)?t=a(e>>6&31|192):0==(4294901760&e)?(o(e),t=a(e>>12&15|224),t+=s(e,6)):0==(4292870144&e)&&(t=a(e>>18&7|240),t+=s(e,12),t+=s(e,6)),t+=a(63&e|128)}function d(){if(i>=r)throw Error("Invalid byte index");var e=255&t[i];if(i++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function c(){var e,a;if(i>r)throw Error("Invalid byte index");if(i==r)return!1;if(e=255&t[i],i++,0==(128&e))return e;if(192==(224&e)){if((a=(31&e)<<6|d())>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&e)){if((a=(15&e)<<12|d()<<6|d())>=2048)return o(a),a;throw Error("Invalid continuation byte")}if(240==(248&e)&&(a=(7&e)<<18|d()<<12|d()<<6|d())>=65536&&a<=1114111)return a;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=n(e),r=t.length,i=-1,a="";++i<r;)a+=u(t[i]);return a},e.decode=function(e){t=n(e),r=t.length,i=0;for(var o,s=[];!1!==(o=c());)s.push(o);return function(e){for(var t,r=e.length,i=-1,n="";++i<r;)(t=e[i])>65535&&(n+=a((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=a(t);return n}(s)}}(t)},function(e,t,r){var i=r(22),a=r(27);e.exports=function(e){return!0===e||!1===e||a(e)&&"[object Boolean]"==i(e)}},function(e,t,r){var i=r(29);e.exports=function(e){if(Array.isArray(e))return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(17).default;e.exports=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==i(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(17).default;function a(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",d=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function l(e,t,r,i){var a=t&&t.prototype instanceof m?t:m,n=Object.create(a.prototype),s=new M(i||[]);return o(n,"_invoke",{value:k(e,r,s)}),n}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f={};function m(){}function g(){}function v(){}var S={};h(S,u,(function(){return this}));var _=Object.getPrototypeOf,C=_&&_(_(D([])));C&&C!==r&&n.call(C,u)&&(S=C);var y=v.prototype=m.prototype=Object.create(S);function b(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){var r;o(this,"_invoke",{value:function(a,o){function s(){return new t((function(r,s){!function r(a,o,s,u){var d=p(e[a],e,o);if("throw"!==d.type){var c=d.arg,h=c.value;return h&&"object"==i(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,u)}))}u(d.arg)}(a,o,r,s)}))}return r=r?r.then(s,s):s()}})}function k(e,t,r){var i="suspendedStart";return function(a,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw n;return R()}for(r.method=a,r.arg=n;;){var o=r.delegate;if(o){var s=E(o,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var u=p(e,t,r);if("normal"===u.type){if(i=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i="completed",r.method="throw",r.arg=u.arg)}}}function E(e,t){var r=t.method,i=e.iterator[r];if(void 0===i)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var a=p(i,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,f;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function D(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:R}}function R(){return{value:void 0,done:!0}}return g.prototype=v,o(y,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:g,configurable:!0}),g.displayName=h(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,h(e,c,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},b(A.prototype),h(A.prototype,d,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,i,a,n){void 0===n&&(n=Promise);var o=new A(l(e,r,i,a),n);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(y),h(y,c,"Generator"),h(y,u,(function(){return this})),h(y,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=D,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var a=i.arg;w(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(null==e)return{};var r,i,a={},n=Object.keys(e);for(i=0;i<n.length;i++)r=n[i],t.indexOf(r)>=0||(a[r]=e[r]);return a},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,a,n,o,s=[],u=!0,d=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(i=n.call(r)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(e){d=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw a}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(t,i){return e.exports=r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t,i)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(34))},function(e,t,r){var i=r(32),a=Object.prototype,n=a.hasOwnProperty,o=a.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=n.call(e,s),r=e[s];try{e[s]=void 0;var i=!0}catch(e){}var a=o.call(e);return i&&(t?e[s]=r:delete e[s]),a}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var i=r(24),a=r(57),n=r(58),o=Math.max,s=Math.min;e.exports=function(e,t,r){var u,d,c,h,l,p,f=0,m=!1,g=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function S(t){var r=u,i=d;return u=d=void 0,f=t,h=e.apply(i,r)}function _(e){return f=e,l=setTimeout(y,t),m?S(e):h}function C(e){var r=e-p;return void 0===p||r>=t||r<0||g&&e-f>=c}function y(){var e=a();if(C(e))return b(e);l=setTimeout(y,function(e){var r=t-(e-p);return g?s(r,c-(e-f)):r}(e))}function b(e){return l=void 0,v&&u?S(e):(u=d=void 0,h)}function A(){var e=a(),r=C(e);if(u=arguments,d=this,p=e,r){if(void 0===l)return _(p);if(g)return l=setTimeout(y,t),S(p)}return void 0===l&&(l=setTimeout(y,t)),h}return t=n(t)||0,i(r)&&(m=!!r.leading,c=(g="maxWait"in r)?o(n(r.maxWait)||0,t):c,v="trailing"in r?!!r.trailing:v),A.cancel=function(){void 0!==l&&clearTimeout(l),f=0,u=p=d=l=void 0},A.flush=function(){return void 0===l?h:b(a())},A}},function(e,t,r){var i=r(33);e.exports=function(){return i.Date.now()}},function(e,t,r){var i=r(24),a=r(59),n=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var r=s.test(e);return r||u.test(e)?d(e.slice(2),r?2:8):o.test(e)?NaN:+e}},function(e,t,r){var i=r(22),a=r(27);e.exports=function(e){return"symbol"==typeof e||a(e)&&"[object Symbol]"==i(e)}},,function(e,t,r){var i=r(64).default;e.exports=i},,,function(e,t,r){"use strict";r.r(t);var i=r(19),a=r.n(i),n=r(17),o=r.n(n),s=r(7),u=r.n(s),d=r(16),c=r.n(d),h=r(11),l=r.n(h),p=r(12),f=r.n(p),m=r(3),g=r.n(m),v=r(5),S=r(0),_=r(4),C=r(1);let y=null;if("function"==typeof AudioWorklet){class e extends AudioWorkletNode{constructor(e,t,r){super(e,t,r),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(e){var t=e.data;switch(t.status){case"delay":if(S.a.localAudioDecMGR)(r=S.a.localAudioDecMGR.map.get(0))&&r.postMessage({command:"delay"});break;case C.pb:t.at&&(S.a.CurrentSSRCTime=t.at),t.st&&S.a.mediaSDKHandle.SharingRenderObj&&S.a.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);break;case"AUDIO_MONITOR_LOG":v.addAudioMonitorLog.push({log:t.data,isSend:!0});break;case"MONITOR_LOG":_.a.add_monitor(t.data);break;case"UPDATE_MULTIVIEW_TIME":var r;if(S.a.localVideoDecMGR)(r=S.a.localVideoDecMGR.map.get(0))&&r.postMessage({command:"audioDecodeTime",data:t.data,status:1});break;case"WASM_INIT_SUCCESS":for(S.a.workletWasmInitSuccess=!0;!S.a.interpretationMessage.isEmpty();){let e=S.a.interpretationMessage.dequeue();this.postCMD(e.command,e)}}}postData(e,t){this.port.postMessage({status:e,data:t},[t.data.buffer])}postCMD(e,t){this.port.postMessage({status:e,data:t})}}y=e}var b=y,A=r(6),k=r(8);function E(e){this.name="CameraOccupiedError",this.message=e,this.stack=(new Error).stack}E.prototype=new Error;var I=r(13),w=r(10),M=r(37),D=r.n(M),R=r(38),T=r(2),P=r(40),x=r.n(P),O=r(20),V=r.n(O),N=r(23),L=r.n(N),W={};W.screen={chromeMediaSource:"desktop",screenCallback:null,getSourceId:function(e){W.screenCallback=e,window.postMessage("WCL.getSourceID","*")},onMessageCallback:function(e){if("WCL.PermissionDeniedError"==e.type&&W.screenCallback)return W.screenCallback("WCL.PermissionDeniedError");"WCL.userCancel"==e.type&&W.screenCallback("WCL.userCancel"),e.sourceId&&(W.screen.sourceId=e.sourceId,W.screenCallback&&W.screenCallback("WCL.PermisssionOK",W.screen.sourceId))},getChromeExtensionStatus:function(e){var t=document.createElement("img");t.src="chrome-extension://kgjfgplpablkjnlkjmjdecgdpfankdle/images/trash.png",t.onload=function(){e("installed-enabled")},t.onerror=function(){e("not-installed")}}},window.addEventListener("message",(function(e){e.data&&("string"==typeof e.data||e.data.sourceId||e.data.captureSourceId||e.data.getChromeExtensionStatus||e.data.type)&&(e.data.captureSourceId&&W.screen.getChromeExtensionStatus((function(e){"installed-enabled"==e?W.screen.getSourceId((function(e,t){window.postMessage({typ:e,chromeMediaSourceId:t},"*")})):window.postMessage({typ:"WCL.extensionUninstalled"},"*")})),W.screen.onMessageCallback(e.data))})),window.getScreenId=function(e,t){A.g.browser.isFirefox?e(null,"firefox",{video:{mediaSource:"screen"}}):(window.addEventListener("message",(function t(r){var i,a,n;r.data&&(r.data.typ&&("WCL.PermissionDeniedError"===r.data.typ||"WCL.extensionUninstalled"==r.data.typ||"WCL.userCancel"==r.data.typ?e(r.data.typ):"WCL.PermisssionOK"==r.data.typ&&e(null,r.data.chromeMediaSourceId,(i=null,a=r.data.chromeMediaSourceId,n={audio:!1,video:{mandatory:{chromeMediaSource:i?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}},a&&(n.video.mandatory.chromeMediaSourceId=a,n.audio&&n.audio.mandatory&&(n.audio.mandatory.chromeMediaSourceId=a)),n)),window.removeEventListener("message",t)))})),window.postMessage({captureSourceId:!0},"*"))};var U=Object(I.a)("sdk.rtcUtil"),B=function(){function e(){var t=this;l()(this,e),this.rtcPeerConnection=null,this.dataChannel=null,this.dataChannelLabel=null,this.messageListener=null,this.rtcPeerConnectionCreatedListener=null,this.reconnectCount=0,this.reconnectMax=10,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,this.connectionID=null,this.pubSubTokenList=[],this.isForceClosed=!1,this.reconnectRTCPeerConnectionThrottle=L()((function(){t.reconnectRTCPeerConnection()}),2e3),this.timeoutThenCloseInterval=null,this.userid=null,this.connectionType=null,this.totalEncodedVideoRtpNumb=0,this.dataChannelStatus="",this.delaycloseTimeout=0,this.delaycloseid_=0}var t;return f()(e,[{key:"setUserid",value:function(e){this.userid=e}},{key:"setConnectionType",value:function(e){this.connectionType=e}},{key:"isSupportDataChannel",value:function(){return!!window.RTCDataChannel}},{key:"initConnection",value:(t=u()(g.a.mark((function e(t){var r,i=this,a=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:"ZoomWebclientVideoDataChannel",_.a.add_monitor("DCCONN"),this.isSupportDataChannel()){e.next=4;break}return e.abrupt("return");case 4:return this.dataChannelLabel=r,this.connectionID=t,this.rtcPeerConnection=new RTCPeerConnection({iceCandidatePoolSize:1}),this.rtcPeerConnection.addEventListener("close",(function(e){U("rtcPeerConnection.onclose",e),i.clear(),i.close(),i.reconnectRTCPeerConnectionThrottle()})),this.rtcPeerConnection.addEventListener("icecandidate",(function(e){U("onicecandidate",e)})),this.rtcPeerConnection.addEventListener("iceconnectionstatechange",(function(e){var t=i.rtcPeerConnection;if("failed"!==t.iceConnectionState&&"closed"!==t.iceConnectionState||(U("".concat(i.dataChannelLabel," iceconnectionstatechange"),t.iceConnectionState),_.a.add_monitor("ICECONNSTATECHANGE:"+i.dataChannelLabel),t.close(),i.delaycloseid_&&(clearTimeout(i.delaycloseid_),i.delaycloseid_=0)),"disconnected"===t.iceConnectionState&&!i.delaycloseid_){var r=i;i.delaycloseid_=setTimeout((function(){r.delaycloseid_=0,r.rtcPeerConnection&&r.rtcPeerConnection.close()}),r.delaycloseTimeout)}"connected"===t.iceConnectionState&&i.delaycloseid_&&(clearTimeout(i.delaycloseid_),i.delaycloseid_=0)})),this.createDataChannel(),e.next=13,this.rtcPeerConnection.createOffer().then(function(){var e=u()(g.a.mark((function e(r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U("original offer",JSON.stringify(r)),r.sdp=r.sdp.replace(/a=ice-ufrag:.+/g,"a=ice-ufrag:".concat(t)),U("modified offer",r),e.abrupt("return",i.rtcPeerConnection.setLocalDescription(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(){i.rtcPeerConnectionCreatedListener.call(null,i.rtcPeerConnection)}));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"close",value:function(){_.a.add_monitor("RTCPeerConnUtil.CLOSE");try{try{this.dataChannel&&this.dataChannel.close()}catch(e){k.a.error("Error when closing RTCDataChannel",e)}this.rtcPeerConnection&&this.rtcPeerConnection.close()}catch(e){k.a.error("Error when closing RTCPeerConnection",e)}finally{this.dataChannel=null,this.rtcPeerConnection=null}}},{key:"forceClose",value:function(){_.a.add_monitor("DCFORCECLOSE:"+this.dataChannelLabel),U("forceClose : "+this.dataChannelLabel),this.isForceClosed=!0,this.clear(),this.close()}},{key:"clear",value:function(){clearInterval(this.timeoutThenCloseInterval),this.messageListener=null,this.pubSubTokenList.forEach((function(e){w.a.unsubscribe(e)})),this.pubSubTokenList=[]}},{key:"onConnectionCreated",value:function(e){this.rtcPeerConnectionCreatedListener=e}},{key:"reconnectRTCPeerConnection",value:function(){var e=this;this.isForceClosed||this.reconnectCount<this.reconnectMax&&this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen<this.reconnectMax&&(U("".concat(this.dataChannelLabel," reconnect reconnectTotalCount  : ").concat(this.reconnectCount,"; reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen : ").concat(this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen,", reconnectMax : ").concat(this.reconnectMax)),this.reconnectCount+=1,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen+=1,setTimeout((function(){e.initConnection(e.connectionID,e.dataChannelLabel)}),1e3*Math.pow(2,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen)))}},{key:"oneSingleLineLog",value:function(e){setTimeout((function(){_.a.send_instant_monitor(),_.a.add_monitor(e),_.a.send_instant_monitor()}),0)}},{key:"checkEmptyUserIdAndResendMonitor",value:function(e){this.userid||(this.setUserid(e),this.sendDataChannelStatusMonitorLog())}},{key:"sendDataChannelStatusMonitorLog",value:function(){this.userid&&("OPEN"===this.dataChannelStatus?(_.a.add_monitor("DCOPEN:"+this.dataChannelLabel),this.oneSingleLineLog("".concat("{[WLCCONT]}",",").concat(this.userid,",").concat(this.connectionType,",DCOPEN,").concat("{[WLCCONT]}"))):"CLOSED"===this.dataChannelStatus&&(_.a.add_monitor("DCCLOSE:"+this.dataChannelLabel),this.oneSingleLineLog("".concat("{[WLCCONT]}",",").concat(this.userid,",").concat(this.connectionType,",DCCLOSE,").concat("{[WLCCONT]}"))))}},{key:"createDataChannel",value:function(){var e=this;if(this.dataChannel)try{this.dataChannel.close()}catch(e){k.a.error("Error when trying to close existing RTCDataChannel before creating a new one",e)}var t=this.rtcPeerConnection.createDataChannel(this.dataChannelLabel,{ordered:!1,maxRetransmits:0,reliable:!1});t.binaryType="arraybuffer",t.addEventListener("open",(function(t){e.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,clearInterval(e.timeoutThenCloseInterval),e.dataChannelStatus="OPEN",e.sendDataChannelStatusMonitorLog(),U("dataChannel.onopen",t)})),t.addEventListener("close",(function(t){var r=T.h.ZOOM_CONNECTION_AUDIO;"ZoomWebclientVideoDataChannel"==e.dataChannelLabel&&(r=T.h.ZOOM_CONNECTION_VIDEO),S.a.sendMessageToRwg(C.Ec,{evt:C.ef,body:{flag:1,type:r}},!1),clearInterval(e.timeoutThenCloseInterval),U("dataChannel.onclose",t),e.dataChannelStatus="CLOSED",e.sendDataChannelStatusMonitorLog(),e.clear(),e.close(),e.reconnectRTCPeerConnectionThrottle()})),t.addEventListener("error",(function(t){clearInterval(e.timeoutThenCloseInterval),_.a.add_monitor("DCERROR","".concat(e.dataChannelLabel,": ").concat(t.message,", error detail: ").concat(t.errorDetail)),U("dataChannel.onerror",t)})),t.addEventListener("message",(function(t){e.messageListener&&e.messageListener.call(null,t.data)})),this.dataChannel=t}},{key:"onMessage",value:function(e){this.messageListener=e}},{key:"waitForAnswerFromRWG",value:function(e){var t=this;return new Promise((function(r,i){var a=w.a.on(e,(function(e,t){r(t)}));t.pubSubTokenList.push(a)}))}},{key:"setRemoteDescription",value:function(e){U("setRemoteDescription",e),this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.sdp}))}},{key:"closeIfTimeout",value:function(){var e=this;clearInterval(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=setTimeout((function(){U("closeIfTimeout"),e.close()}),1e4)}},{key:"addIceCandidate",value:function(e){this.rtcPeerConnection.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMLineIndex:0,sdpMid:"0"}))}},{key:"sendVideoData",value:function(e){try{this.totalEncodedVideoRtpNumb=this.totalEncodedVideoRtpNumb+1,this.totalEncodedVideoRtpNumb%5e3==0&&_.a.add_monitor("TEVRN:"+this.totalEncodedVideoRtpNumb),this.dataChannel.send(e)}catch(e){k.a.error("Error when sending video data via WebRTC",e),U.error("sendVideoData",e)}}},{key:"sendAudioData",value:function(e){try{this.dataChannel.send(e)}catch(e){k.a.error("Error when sending audio data via WebRTC",e)}}},{key:"listenOnDataAndSend",value:function(e){var t=this,r=w.a.on(e,(function(e,r){t.sendVideoData(r)}));this.pubSubTokenList.push(r)}},{key:"consumeRingbuffer",value:function(e){for(;e.available_read()>0;){var t=e.dequeue();this.sendVideoData(t)}requestAnimationFrame(this.consumeRingbuffer.bind(this))}},{key:"listenOnDataAndSendAudio",value:function(e){var t=this,r=w.a.on(e,(function(e,r){t.sendAudioData(r)}));this.pubSubTokenList.push(r)}}]),e}(),F=r(15),G=r.n(F),H=r(9),j=r(25);function K(e,t,r,i,a,n){if(this.canvasElement=e,this.contextOptions=i,this.glInitSucceed=0,this.textureindex=t||0,this.texturestride=this.textureindex?3:n?4:6,this.initmask=n||!1,K.prototype.ROTATION_CLOCK0=0,K.prototype.ROTATION_CLOCK90=1,K.prototype.ROTATION_CLOCK180=2,K.prototype.ROTATION_CLOCK270=3,a?this.contextGL=a.contextgl:this.initContextGL(),this.contextGL){this.webGLContextLostProtect(),a?(this.shaderProgram=a.program,this.waterMarkTextureRef=a.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=a.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=a.vBuffer,this.texturePosBuffer=a.tBuffer):(this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers());var o=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(o),this.dummpyWaterMark=new Uint8Array(o);var s=this.contextGL.getError();this.glInitSucceed=s!=this.contextGL.NO_ERROR&&s!=this.contextGL.CONTEXT_LOST_WEBGL?0:1,this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=H.t,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0}}function q(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=e.contextGL,o=n.canvas.width,s=n.canvas.height;a&&(o=a.width,s=a.height);var u,d,c,h,l=i==e.ROTATION_CLOCK90||i==e.ROTATION_CLOCK270?r:t,p=i==e.ROTATION_CLOCK90||i==e.ROTATION_CLOCK270?t:r,f=l/p*s,m=p/l*o;f>o?(u=0,c=1,h=1-(d=(s-m)/2/s)):(d=0,h=1,c=1-(u=(o-f)/2/o)),u=2*u-1,c=2*c-1,d=1-2*d,h=1-2*h;var g=new Float32Array([c,d,u,d,c,h,u,h,c,d,u,d,c,h,u,h]);n.bindBuffer(n.ARRAY_BUFFER,e.vertexPosBuffer),n.bufferData(n.ARRAY_BUFFER,g,n.DYNAMIC_DRAW)}function Q(e,t,r,i,n){var o=e.contextGL,s=i.top/r,u=i.left/t,d=s+(i.height-1)/r,c=u+i.width/t,h=[u,s,c,s,c,d,u,d];n==e.ROTATION_CLOCK90&&(h.unshift(h[6],h[7]),h=h.slice(0,8)),n==e.ROTATION_CLOCK180&&(h.unshift(h[4],h[5],h[6],h[7]),h=h.slice(0,8)),n==e.ROTATION_CLOCK270&&(h.push(h[0],h[1]),h=h.slice(2));var l=h[0],p=h[1];h[0]=h[2],h[1]=h[3],h[2]=l,h[3]=p;var f=new Float32Array([].concat(a()(h),[1,0,0,0,1,1,0,1]));o.bindBuffer(o.ARRAY_BUFFER,e.texturePosBuffer),o.bufferData(o.ARRAY_BUFFER,f,o.DYNAMIC_DRAW)}K.prototype.webGLContextLostSimulate=function(){var e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push(this.contextGL.getExtension("WEBGL_lose_context")),console.log("\n    webGLEXTSimulate[0].loseContext()\n    webGLEXTSimulate[0].restoreContext()\n    ")},K.prototype.webGLContextLostProtect=function(){var e=this;if(this.contextOptions){var t=this.canvasElement;t.addEventListener("webglcontextlost",(function(t){console.log("webglcontextlost",t),t.preventDefault(),e.contextOptions&&e.contextOptions.webglcontextlostCallback&&e.contextOptions.webglcontextlostCallback(t,e.contextOptions.params)}),{capture:!1,once:!0}),t.addEventListener("webglcontextrestored",(function(t){console.log("webglcontextrestored",t),e.contextOptions&&e.contextOptions.webglcontextrestoredCallback&&e.contextOptions.webglcontextrestoredCallback(t,e.contextOptions.params)}),{capture:!1,once:!0})}},K.prototype.isWebGL=function(){return this.contextGL},K.prototype.initContextGL=function(){for(var e=this.canvasElement,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!t&&i<r.length;){var a=r[i];try{t=this.contextOptions?e.getContext(a,this.contextOptions):e.getContext(a)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++i}this.contextGL=t},K.prototype.initProgram=function(){var e=this.contextGL,t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 masktexturePos;","varying vec2 textureCoord;","varying vec2 masktextureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","masktextureCoord = masktexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 masktextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform sampler2D cursorSampler;","uniform sampler2D waterMarkSampler;","uniform sampler2D  previewVideoSampler;","uniform sampler2D maskSampler;","uniform vec4 cursorInfo;","uniform int onlyRGBA;","uniform int bgraMode;","uniform int colorRange;","uniform int waterMarkFlag;","uniform int cursorFlag;","uniform int maskFlag;","uniform int yuvmode;","const mat4 YUV2RGB_L = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","const mat4 YUV2RGB_F = mat4","(","1.0, 0, 1.402, -.701,","1.0, -.34413, -.71414, .529135,","1.0, 1.772, 0, -.886,","0, 0, 0, 1",");","void main(void) {","vec4 c;","if(waterMarkFlag!=1) {","if(onlyRGBA==0){","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u;","highp float v;","if(yuvmode==1){","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(vSampler,  textureCoord).r;","}","else{","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(uSampler,  textureCoord).a;","}","if (colorRange == 0)","{","  c = vec4(y, u, v, 1) * YUV2RGB_L;","} else {","  c = vec4(y, u, v, 1) * YUV2RGB_F;","}","if(cursorFlag==1)","{","if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y && ","    textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w ){"," vec2 cursorCoord = textureCoord - cursorInfo.xy;"," cursorCoord /= cursorInfo.zw;"," vec4 cursor = texture2D(cursorSampler, cursorCoord);"," c = c*(1.0-cursor.a) + cursor*cursor.a;","}","}","}","else{"," c = texture2D(previewVideoSampler, textureCoord);","if(bgraMode==1)","{"," c = vec4(c.b, c.g, c.r, c.a);","}","}","}","if(waterMarkFlag==1)","{"," c = texture2D(waterMarkSampler, textureCoord);","if(c.r == 0.0 && c.g == 0.0 && c.b == 0.0){"," c.a = 0.0;","}","}","if(maskFlag==1 && waterMarkFlag!=1)","{","vec4 mask = texture2D(maskSampler, masktextureCoord);","if(mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0){","c = mask* mask.a+ c*(1.0-mask.a);","}","}","if (waterMarkFlag!=1){","c.a = 1.0;","}","gl_FragColor = c;","}"].join("\n"),i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||e.isContextLost()||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(i));var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||e.isContextLost()||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(a));var n=e.createProgram();e.attachShader(n,i),e.attachShader(n,a),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||e.isContextLost()||console.log("Program failed to compile: "+e.getProgramInfoLog(n)),e.useProgram(n),this.shaderProgram=n},K.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=r;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=o}this.texturePosBuffer=a},K.prototype.initTextures=function(e){var t=this.contextGL,r=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var i=this.initTexture();this.yTextureRef=i;var a=this.initTexture();this.uTextureRef=a;var n=this.initTexture();if(this.vTextureRef=n,e){this.BindTextures(H.s);var o=this.initTexture(),s=t.getUniformLocation(r,"cursorSampler");t.uniform1i(s,this.textureindex*this.texturestride+3),this.cursorTextureRef=o;var u=this.initTexture(),d=t.getUniformLocation(r,"waterMarkSampler");t.uniform1i(d,4),this.waterMarkTextureRef=u;var c=this.initTexture();this.repeatedWaterMarkTextureRef=c;var h=this.initTexture(),l=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(l,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=h;var p=t.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=p}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var f=this.initTexture(),m=t.getUniformLocation(r,"maskSampler");t.uniform1i(m,this.textureindex*this.texturestride+6),this.maskTextureRef=f}var g=t.getUniformLocation(r,"colorRange");this.colorRangeRef=g,this.onlyRGBARef=t.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(r,"yuvmode")},K.prototype.BindTextures=function(e){var t=this.contextGL,r=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),e==H.s){var i=t.getUniformLocation(r,"ySampler");t.uniform1i(i,0);var a=t.getUniformLocation(r,"uSampler");t.uniform1i(a,1);var n=t.getUniformLocation(r,"vSampler");t.uniform1i(n,2)}else if(this.isRGBAMode(e)){var o=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(o,0);var s=t.getUniformLocation(r,"ySampler");t.uniform1i(s,0);var u=t.getUniformLocation(r,"uSampler");t.uniform1i(u,0);var d=t.getUniformLocation(r,"vSampler");t.uniform1i(d,0)}else if(e==H.u){var c=t.getUniformLocation(r,"ySampler");t.uniform1i(c,0);var h=t.getUniformLocation(r,"uSampler");t.uniform1i(h,1);var l=t.getUniformLocation(r,"vSampler");t.uniform1i(l,0)}var p=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(p,0);var f=t.getUniformLocation(r,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(f,6)):t.uniform1i(f,0);var m=t.getUniformLocation(r,"cursorSampler");t.uniform1i(m,0);var g=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(g,0)},K.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},K.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},K.prototype.cleanup=function(){var e=this.contextGL;e&&this.glInitSucceed&&(e.deleteProgram(this.program),e.activeTexture(e.TEXTURE0+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),this.textureindex||this.initmask||(e.activeTexture(e.TEXTURE3+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE4+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(this.GetRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE5+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null)),e.bindBuffer(e.ARRAY_BUFFER,null),e.deleteTexture(this.yTextureRef),e.deleteTexture(this.uTextureRef),e.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(e.deleteTexture(this.cursorTextureRef),e.deleteTexture(this.waterMarkTextureRef),e.deleteTexture(this.repeatedWaterMarkTextureRef),e.deleteTexture(this.previewVideoTextureRef),e.deleteBuffer(this.vertexPosBuffer),e.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&e.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&e.deleteBuffer(this.masktexturePosBuffer),this.contextGL=null,this.glInitSucceed=0)},K.prototype.drawNextOutputPicture=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=this.contextGL;n?this.drawNextOuptutPictureGL(e,t,r,i,a):this.drawNextOuptutPictureRGBA(e,t,r,i)},K.prototype.updateVertexInfoForMultiView=function(e,t,r,i,a){var n,o,s,u,d=this.contextGL;if(this.isUseFillMode({width:r,height:i,rotation:a}))n=0,o=0,s=1,u=1;else{var c=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?i:r,h=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?r:i,l=c/h*t;l>e?(n=0,s=1,u=1-(o=(t-h/c*e)/2/t)):(o=0,u=1,s=1-(n=(e-l)/2/e))}n=2*n-1,s=2*s-1,o=1-2*o,u=1-2*u;var p=new Float32Array([s,o,n,o,s,u,n,u,1,1,-1,1,1,-1,-1,-1]);d.bindBuffer(d.ARRAY_BUFFER,this.vertexPosBuffer),d.bufferData(d.ARRAY_BUFFER,p,d.DYNAMIC_DRAW)},K.prototype.updateTextureInfoForMultiView=function(e,t,r,i,n,o,s){var u,d,c,h,l=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:i})){var p=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?s/o:o/s,f=r.left||0,m=r.top||0;if(r.width/r.height>p){var g=r.height*p;u=m/t,d=(Math.round((r.width-g)/2)+f)/e,c=u+(r.height-1)/t,h=d+g/e}else{var v=r.width/p;c=(u=(Math.round((r.height-v)/2)+m)/t)+(v-1)/t,h=(d=f/e)+r.width/e}}else u=r.top/t,d=r.left/e,c=u+(r.height-1)/t,h=d+r.width/e;var S=[d,u,h,u,h,c,d,c];i==this.ROTATION_CLOCK90&&(S.unshift(S[6],S[7]),S=S.slice(0,8)),i==this.ROTATION_CLOCK180&&(S.unshift(S[4],S[5],S[6],S[7]),S=S.slice(0,8)),i==this.ROTATION_CLOCK270&&(S.push(S[0],S[1]),S=S.slice(2));var _=S[0],C=S[1];S[0]=S[2],S[1]=S[3],S[2]=_,S[3]=C,n&&(S[0]=1-S[0],S[2]=1-S[2],S[4]=1-S[4],S[6]=1-S[6]);var y=new Float32Array([].concat(a()(S),[1,0,0,0,1,1,0,1]));l.bindBuffer(l.ARRAY_BUFFER,this.texturePosBuffer),l.bufferData(l.ARRAY_BUFFER,y,l.DYNAMIC_DRAW)},K.prototype.drawNextOuptutPictureGL=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=this.contextGL;if(s&&this.glInitSucceed){this.texturePosBuffer;var u=this.yTextureRef,d=this.uTextureRef,c=this.vTextureRef;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),a=a||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,l=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,p=s.canvas.width!=this.canvasWidth||s.canvas.height!=this.canvasHeight,f=e!=this.textureWidth||t!=this.textureHeight,m=a!=this.picRotation;(h||p||m)&&q(this,r.width,r.height,a,o),(h||l||f||m)&&Q(this,e,t,r,a);var g=n?0:1;g!=this.colorRange&&(s.uniform1i(this.colorRangeRef,g),this.colorRange=g),o?s.viewport(o.x,o.y,o.width,o.height):s.viewport(0,0,s.canvas.width,s.canvas.height),s.uniform1i(this.onlyRGBARef,0),s.uniform1i(this.yuvmodeRef,H.s),Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.picRotation=a,this.canvasWidth=s.canvas.width,this.canvasHeight=s.canvas.height,s.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),s.clear(s.COLOR_BUFFER_BIT);var v=i,S=e*t,_=v.subarray(0,S);s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,t,0,s.LUMINANCE,s.UNSIGNED_BYTE,_);var C=e/2*t/2,y=v.subarray(S,S+C);s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,d),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,y);var b=C,A=v.subarray(S+C,S+C+b);s.activeTexture(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,A),s.activeTexture(s.TEXTURE3),s.bindTexture(s.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?s.uniform1i(this.cursorFlagRef,1):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,this.dummpyCursor),s.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),s.activeTexture(s.TEXTURE5),s.bindTexture(s.TEXTURE_2D,this.previewVideoTextureRef),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,this.dummpyWaterMark);var k=s.getUniformLocation(this.shaderProgram,"maskSampler");s.uniform1i(k,5),this.render(),this.hasWholeFrame=1}},K.prototype.updateTextureBlock=function(e,t,r,i,a){var n=this.contextGL;if(n&&this.glInitSucceed){var o=a;if(!(!this.hasWholeFrame||e<=0||t<=0||r<0||i<0||r+e>this.textureWidth||i+t>this.textureHeight)&&a&&a.length==e*t*3/2){var s=this.yTextureRef,u=this.uTextureRef,d=this.vTextureRef,c=e*t,h=o.subarray(0,c);n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.texSubImage2D(n.TEXTURE_2D,0,r,i,e,t,n.LUMINANCE,n.UNSIGNED_BYTE,h);var l=e/2*t/2,p=o.subarray(c,c+l);n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,u),n.texSubImage2D(n.TEXTURE_2D,0,r/2,i/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,p);var f=l,m=o.subarray(c+l,c+l+f);n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,d),n.texSubImage2D(n.TEXTURE_2D,0,r/2,i/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,m)}}},K.prototype.updateCursor=function(e,t,r){var i=this.contextGL;i&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length!=e*t*4||(i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,this.cursorTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1))},K.prototype.updateWatherMark=function(e,t,r){this.contextGL&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length!=e*t*4||(this.watermarkData=r,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1))},K.prototype.drawWatermark=function(){var e=this.contextGL;if(this.IsSetWaterMark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.IsWatermarkRepeated()?(e.activeTexture(this.GetRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);var t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.IsWatermarkRepeated()?this.GetRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}},K.prototype.render=function(){var e=this.contextGL;e&&this.glInitSucceed&&(e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark())},K.prototype.draw=function(e,t,r,i,a){var n=this.contextGL;if(n&&this.glInitSucceed&&!(!this.hasWholeFrame||e&&(i<0||a<0))){n.viewport(0,0,n.canvas.width,n.canvas.height);var o=this.yTextureRef,s=this.uTextureRef,u=this.vTextureRef,d=this.cursorTextureRef;if(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,s),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,u),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,d),e&&this.hasCursor){var c=t/this.croppingParams.width,h=r/this.croppingParams.height,l=i/this.croppingParams.width,p=a/this.croppingParams.height;this.cx=c,this.cy=h,this.cw=l,this.ch=p,n.uniform4f(this.cursorInfoRef,c,h,l,p)}else n.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}},K.prototype.clear=function(){var e=this.contextGL;e&&this.glInitSucceed&&(e.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),e.clear(e.COLOR_BUFFER_BIT),this.hasWholeFrame=0,this.hasCursor=0)},K.prototype.clearCanvas=function(e){var t=this.contextGL;t&&this.glInitSucceed&&(e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT))},K.prototype.drawNextOuptutPictureRGBA=function(e,t,r,i){var a=i,n=this.canvasElement.getContext("2d"),o=n.getImageData(0,0,e,t);o.data.set(a),n.putImageData(o,0,0)},K.prototype.isRGBAMode=function(e){return-1!==[H.w,H.p].indexOf(e)},K.prototype.UpdateRemoteVideoTextures=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this.contextGL;if(o&&this.glInitSucceed){var s=this.yTextureRef,u=this.uTextureRef,d=this.vTextureRef;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);var c=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!i||!i.length||i.length!=e*t*3/2&&!c||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return!1;var h=n?0:1;if(this.colorRange=h,this.rotation=a,Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=o.canvas.width,this.canvasHeight=o.canvas.height,o.bindTexture(o.TEXTURE_2D,s),!c){var l=i,p=e*t,f=l.subarray(0,p);o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e,t,0,o.LUMINANCE,o.UNSIGNED_BYTE,f);var m=0,g=0;this.videoMode==H.s?g=m=e/2*t/2:this.videoMode==H.u&&(m=e*t/2,g=0);var v=l.subarray(p,p+m);if(o.bindTexture(o.TEXTURE_2D,u),g){o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,v);var S=l.subarray(p+m,p+m+g);o.bindTexture(o.TEXTURE_2D,d),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,S)}else o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE_ALPHA,e/2,t/2,0,o.LUMINANCE_ALPHA,o.UNSIGNED_BYTE,v);return!0}o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,i)}},K.prototype.UpdateRemoteVideoTexturesImageBitmap=function(e,t,r,i,a){var n=this.contextGL;if(n&&this.glInitSucceed){if(e<=0||t<=0||!r)return;this.textureWidth=e,this.textureHeight=t,Number.isNaN(a)||(this.rotation=a),Object.assign(this.croppingParams,i),n.bindTexture(n.TEXTURE_2D,this.yTextureRef);var o=n.RGBA,s=n.RGBA,u=n.UNSIGNED_BYTE;n.texImage2D(n.TEXTURE_2D,0,o,s,u,r)}},K.prototype.updateSelfMaskImage=function(e,t,r){var i=this.contextGL;i&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length!=e*t*4||(i.bindTexture(i.TEXTURE_2D,this.maskTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r)))},K.prototype.VideoFlip=function(){var e=this.contextGL;e&&this.glInitSucceed&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)},K.prototype.DrawRemoteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.contextGL;if(r&&this.glInitSucceed){var i=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(i,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()}},K.prototype.readPixelsSyncRequest=function(e,t,r,i){var a,n=this.contextGL;return this.destination&&this.destination.length==r*i*4||(this.destination=new Uint8Array(r*i*4)),a=this.destination,n.flush(),n.readPixels(e,t,r,i,n.RGBA,n.UNSIGNED_BYTE,a),a},K.prototype.UpdateSelfVideoTextures=function(e,t,r,i){var a=this.contextGL;a&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length%4!=0||(this.textureWidth=e,this.textureHeight=t,this.rotation=this.ROTATION_CLOCK0,Object.assign(this.croppingParams,i),a.bindTexture(a.TEXTURE_2D,this.yTextureRef),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,t,0,a.RGBA,a.UNSIGNED_BYTE,r)))},K.prototype.DrawSelfVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.contextGL;i&&this.glInitSucceed&&(this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,e.width,e.height),i.viewport(e.x,e.y,e.width,e.height),t?(i.enable(i.BLEND),i.blendFunc(i.ZERO,i.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(H.w),this.render())},K.prototype.IsSetWaterMark=function(){return this.hasWaterMark},K.prototype.SetWaterMarkFlag=function(e){this.hasWaterMark=e,e||(this.SetWatermarkRepeated(!1),this.SetWatermarkOpacity(),this.SetWatermarkPosition(16))},K.prototype.setUniformFlag=function(e,t,r){var i=this.contextGL;i&&(i.uniform1i(this.onlyRGBARef,e),i.uniform1i(this.bgraModeRef,e&&r===H.p?1:0),i.uniform1i(this.cursorFlagRef,t),e||i.uniform1i(this.yuvmodeRef,r))},K.prototype.SetVideoMode=function(e){this.videoMode=e},K.prototype.GetVideoMode=function(e){return this.videoMode},K.prototype.SetWatermarkRepeated=function(e){this.watermarkRepeated=e},K.prototype.IsWatermarkRepeated=function(){return!!this.watermarkRepeated},K.prototype.SetWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},K.prototype.GetWatermarkOpacity=function(){return this.watermarkOpacity},K.prototype.SetWatermarkPosition=function(e){this.watermarkPosition=e||16},K.prototype.GetWatermarkPosition=function(){return this.watermarkPosition},K.prototype.SetMultiView=function(e){return this.isMultiView=e},K.prototype.GetRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},K.prototype.GetRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},K.prototype.setFillMode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},K.prototype.isUseFillMode=function(e){var t=e.width,r=e.height,i=e.rotation;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!r)return!1;var a=i===this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r/t:t/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((function(e){return Math.abs(a-e)<.01}))};var z=K,J=r(18);function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;postMessage({status:H.g,errorMessage:e,errorEvent:t})}function Y(e){postMessage({status:H.y,data:e})}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];postMessage({status:H.k,canvasId:e,replaceCanvas:t})}function $(e){return e.split("/").pop().split("?")[0].split("#")[0]}var ee=0;function te(e,t,r,i,a,n,o){var s,u,d,c;if(Y("instantiateCachedURL"),a)d=n,c=o;else if(s=self.wasmSuccessEvent,u=self.wasmFailEvent,d=self.databaseName,c=self.databaseDataType,$(t).includes("audio")){var h={};h.databaseName=d,h.databaseDataType=c,h.dbVersion=e,h.url=t,postMessage({status:"AUDIO_WASM_INFO",data:h})}function l(e,t){return Y("fetch_wasm"),function(e){var t=self;return new Promise((function(r,i){t.addEventListener("message",(function(e){var t=e.data;"DOWNLOAD_WASM_FROM_MAIN_THREAD_OK"===t.command&&(Y("DE"),r(t.data)),"DOWNLOAD_WASM_FROM_MAIN_THREAD_FAILED"===t.command&&i()})),Y("DS"),postMessage({status:H.e,url:e})}))}(e)}function p(t){return Y("fetchAndInstantiate"+t),new Promise((function(n,o){try{if(indexedDB){var s,u=void 0===IDBTransaction.READ_WRITE?"readwrite":IDBTransaction.READ_WRITE,h=indexedDB.open(d,e);h.onerror=function(e){Y("request error");var i=indexedDB.deleteDatabase(d);i.onerror=function(e){Y("rt error"),console.log("Error deleting database")},i.onsuccess=function(e){Y("rt success"),console.log("Database deleted successfully")},n(!a&&l(t).then((function(e){Y("CS");var t=WebAssembly.instantiate(e,r);return Y("CE"),t})))},h.onsuccess=function(e){if(Y("request success"),!(s=e.target.result).objectStoreNames.contains("file"))return a?void n(!1):void n(l(t).then((function(e){Y("CS");var t=WebAssembly.instantiate(e,r);Y("CE");try{s.objectStoreNames.contains("file")||indexedDB.deleteDatabase(d)}catch(e){}return t})));var o=s.transaction(["file"],u).objectStore("file").get(c);o.onsuccess=function(e){if(Y("getRet success"),o.result&&!i){Y("result ok");var d=e.target.result;if(a)return n(d);Y("CS");var h=WebAssembly.instantiate(d,r);return Y("CE"),n(h)}Y("result null"),n(!a&&l(t).then((function(e){s.transaction(["file"],u).objectStore("file").put(e,c),Y("CS");var t=WebAssembly.instantiate(e,r);return Y("CE"),t})))},o.onerror=function(e){Y("getRet error"),n(!a&&l(t).then((function(e){Y("CS");var t=WebAssembly.instantiate(e,r);return Y("CE"),t})))}},h.onupgradeneeded=function(e){var t;Y("request upgradeneeded"),(t=e.target.result).objectStoreNames.contains("file")&&t.deleteObjectStore("file"),t.createObjectStore("file")}}else{if(Y("indexedDB null"),a)return void n(!1);n(l(t).then((function(e){Y("CS");var t=WebAssembly.instantiate(e,r);return Y("CE"),t})))}}catch(e){if(p="error",postMessage({status:H.a,data:p}),a)return void n(!1);n(l(t).then((function(e){Y("CS");var t=WebAssembly.instantiate(e,r);return Y("CE"),t})))}var p}))}function f(e){!function(e,t){var r=e.exports;Module.asm=r,registerTLSInit(Module.asm._emscripten_tls_init),wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),wasmModule=t,ENVIRONMENT_IS_PTHREAD||removeRunDependency("wasm-instantiate")}(e.instance,e.module)}function m(e){var t;t=e.instance,e.module,Module.asm=t.exports,wasmMemory=Module.asm.memory,updateGlobalBufferAndViews(wasmMemory.buffer),wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),removeRunDependency("wasm-instantiate")}return a?p(t):p(t).then((function(e){var r=$(t)||"";ee=0,r.includes("video.mt")?f(e):r.includes("video")?m(e):function(e,t){var r=e.exports;Module.asm=r,wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),removeRunDependency("wasm-instantiate")}(e.instance),self.Fetch_WASM_OK=!0,postMessage({status:s})})).catch((function(i){X("Failed to instantiate WASM ".concat(t),i),i&&i instanceof WebAssembly.CompileError&&ee<3?(ee++,te(e,t,r,!0)):postMessage({status:u})}))}var re=function(){function e(t){l()(this,e),this.sharedBufferList=t}return f()(e,[{key:"storeFlexible",value:function(e,t){var r=e.byteLength-this.sharedBufferList.bytesPerElement;if(r>0){var i=Math.floor(.1*this.sharedBufferList.bytesPerElement),a=r>i?r:i;if(a+this.sharedBufferList.bytesPerElement>t)return Promise.reject("too big, more than maxBytesPerElement");this.sharedBufferList.increaseBufferSize(a)}return this.store(e)}},{key:"store",value:function(e){var t=this;return this.sharedBufferList.get().then((function(r){try{return t.obj=r,r.uint8s.set(e,0),t.yuvdata=new Uint8Array(r.uint8s.buffer,0,e.byteLength),!0}catch(e){throw e}finally{t.autoRecycle()}}))}},{key:"storeSync",value:function(e){var t=this.sharedBufferList.getSync();return null!==t&&(this.obj=t,t.uint8s.set(e,0),this.yuvdata=new Uint8Array(t.uint8s.buffer,0,e.byteLength),!0)}},{key:"autoRecycle",value:function(){var e=this;this.autoRecycleInterval=setTimeout((function(){console.log("autoRecycle",e.obj.index),e.recycle()}),5e3)}},{key:"recycle",value:function(){try{this.autoRecycleInterval&&clearInterval(this.autoRecycleInterval),this.sharedBufferList.recycle(this.obj.index)}catch(e){X("Error in YuvWrap.recycle: ".concat(e))}}}]),e}(),ie=function(){function e(){l()(this,e),this.ssrcInfoMap=new Map,this.timer=null}return f()(e,[{key:"updateSSRCInfo",value:function(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{timeList:[],lastTime:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS(),this._checkIfNewFrameComing()}},{key:"_calculateFPS",value:function(e,t){var r=this.ssrcInfoMap.get(e);if(r.timeList.push(t),r.lastTime=t,r.timeList.length>2){var i=r.timeList[0],a=r.timeList[r.timeList.length-1];if(a-i>=1e3){var n=Math.floor(1e3/((a-i)/(r.timeList.length-1)));r.fps!==n&&(this._notifyFPS(e,n),r.fps=n),r.timeList=[]}}r.timeList.length>30&&(r.timeList=r.timeList.slice(r.timeList.length-30))}},{key:"_removeZeroFPS",value:function(){var e=this;this.ssrcInfoMap.forEach((function(t,r){var i=e.ssrcInfoMap.get(r);i&&Date.now()-i.lastTime>2e3&&(e.ssrcInfoMap.delete(r),e._notifyFPS(r,0))}))}},{key:"_notifyFPS",value:function(e,t){postMessage({status:H.b,data:{ssrc:e,fps:t}})}},{key:"_checkIfNewFrameComing",value:function(){var e=this;this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){e._removeZeroFPS(),e.timer=null}),2500)}}]),e}();new Map,new ie;function ae(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ne(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16/9;if(!e||!t)return null;var n=r||0,o=i||0;if(e/t>a){var s=t*a;return{width:s,height:t,left:Math.round((e-s)/2)+n,top:0+o}}var u=e/a;return{width:e,height:u,left:0+n,top:Math.round((t-u)/2)+o}};function de(e){this.Notify_APPUI=e.Notify_APPUI,this.isSupportOffscreenCanvas=e.isSupportOffscreenCanvas,this.jsMediaEngine=e.jsMediaEngine,this.threadNumbs=e.videodecodethreadnumb,this.globalTracingLogger=e.globalTracingLogger,this.waterMarkCanvas=null,this.videoRenderLevel=10,this.videoRenderLevelCount=1,this.renderPeriodTotal=100,this.renderPeriodCount=0,this.renderPeriodTotalFps=0,this.renderPeriodFpsCount=0,this.lastRenderAudioTimeStamp=0,this.videoBufEmptyCount=0,this.videoBufCount=0,this.videoRenderMaxLevel=15,this.timestamp=0,this.audioPlayTime=0,this.videoTimestamp=0,this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.currentactive=0,this.currentVideoHeight=0,this.currentVideoWidth=0,this.videoRenderArray=[],this.WaterMarkRGBA=new j.a,this.vMonitorCount=0,this.videoQueue=new J.e,this.timestart=0,this.rendingFlag=!0,this.rAFID=0,this.rAFIDBack=null,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.renderMGR=null,this.ssrcDispalyMap=new Map,this.ssrcHaddataMap=new Map,this.selfvideossrc=0,this.localVideoPtr=0,this.sabBuffer=0,this.localvideossrc=0,this.encodedVideoSharedArrayBufferUint8Array=null,this.encodedVideoSharedArrayBufferUint16Array=null,this.encodedVideoSharedArrayWasmMemory=null,this.startCaptureVideo=!1,this.clearColor=new Uint8Array(4),this.videorendercanvas=null,this.keyrender=null,this.renderIndex=0,this.renderMode=0,this.intervalHandle,this.croppingParams={top:0,left:0,height:1,width:1},this.coordinate={x:0,y:0,width:640,height:360},this.isSupportVideoTrackReader=!1,this.bWebglContextLostProtectingMap=new Map,this.ismirror=!1,this.lfTimeStamp=0,this.activeFps=0,this.lastActiveSSRC=0,this.disableOriginalRatio=!1,this.enableReplaceCanvasWhenContextLost=e.enableReplaceCanvasWhenContextLost}de.prototype.clearUseridRender=function(e,t){var r=e[0],i=r.display;if(i)if(i.SetWaterMarkFlag(0),this.renderMode)i.clearCanvas(t);else{var a=r.ssrc;if(!i||!t)return;this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=1,this.croppingParams.width=1,this.clearColor[0]=255*t.R,this.clearColor[1]=255*t.G,this.clearColor[2]=255*t.B,this.clearColor[3]=255*t.A,i.UpdateSelfVideoTextures(1,1,this.clearColor,this.croppingParams);var n=this;this.ssrcDispalyMap.forEach((function(e,t){var r,i;n.Get_Logical_SSrc(t)==n.Get_Logical_SSrc(n.selfvideossrc)&&(r=!0),n.Get_Logical_SSrc(t)==n.Get_Logical_SSrc(a)&&(i=!0),e.forEach((function(e){if(e.haddata||i){var t=e.display;n.coordinate.x=e.x,n.coordinate.y=e.y,n.coordinate.width=e.width,n.coordinate.height=e.height,t&&(i?t.DrawSelfVideo(n.coordinate,!0):t.GetVideoMode()!=H.t&&(-1==[H.w,H.p].indexOf(t.GetVideoMode())&&r?t.DrawSelfVideo(n.coordinate,!1,n.ismirror):r?t.DrawRemoteVideo(n.coordinate,n.ismirror):t.DrawRemoteVideo(n.coordinate)))}}))}))}},de.prototype.Set_Render_Array_rAF=function(e){if(this.videoRenderArray=e,this.ssrcDispalyMap.clear(),this.ssrcHaddataMap.clear(),this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++){var r=this.ssrcDispalyMap.get(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc));r?r.push(this.videoRenderArray[t]):((r=[]).push(this.videoRenderArray[t]),this.ssrcDispalyMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),r),this.ssrcHaddataMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),!1))}},de.prototype.Set_Render_Array=function(e,t){this.renderMode?this.Set_Render_Array_IntervalMode(e,t):this.Set_Render_Array_rAF(e)},de.prototype.ClearQueue=function(){this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},de.prototype.Put_Video_Into_Buffer=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e.ssrc);if(t||(t=this.videoQueue.AddQueue(e.ssrc)),t.enqueue(e),this.videoQueue&&this.videoQueue.ssrcInfo){var r=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(r,e.ntptime)}for(var i=this.videoQueue.GetQueueLength(e.ssrc)-10;i>=0;)i--}},de.prototype.Update_RemoteVideo_Texture=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.Check_Request_Animation(),r){if(e&&i){var a=this.Get_Logical_SSrc(i),n=this.ssrcDispalyMap.get(a);if(!n)return;var o=this;this.ssrcHaddataMap.set(a,!0);this.croppingParams.top=e.visibleRect?0:e.cropTop,this.croppingParams.left=e.visibleRect?0:e.cropLeft,this.croppingParams.height=e.visibleRect?e.visibleRect.height:e.cropHeight,this.croppingParams.width=e.visibleRect?e.visibleRect.width:e.cropWidth,n&&n.forEach((function(t){t.haddata=!0;var r=t.display;o.coordinate.x=t.x,o.coordinate.y=t.y,o.coordinate.width=t.width,o.coordinate.height=t.height,r&&(r.SetVideoMode(H.w),o.Should_Update_Watermark(r,t.width,t.height,t.width,t.height)&&o.Update_Display_Watermark(r,t.width,t.height,t.width,t.height),e&&r.UpdateRemoteVideoTexturesImageBitmap(o.croppingParams.width,o.croppingParams.height,e,o.croppingParams,e.rotation))}))}}else{if(e&&e.ssrc){var s,u=this.Get_Logical_SSrc(e.ssrc),d=this.ssrcDispalyMap.get(u);if(!d)return void(e.yuvdataptr&&Module._free(e.yuvdataptr));var c=!1,h=this;this.ssrcHaddataMap.set(u,!0);var l=e;this.croppingParams.top=l.r_y,this.croppingParams.left=l.r_x,this.croppingParams.height=l.r_h,this.croppingParams.width=l.r_w,(s=l).enableMultiDecodeVideoWithoutSAB?s.yuvdata=s.data:s.yuvdata=Module.HEAPU8.subarray(s.yuvdataptr,s.yuvdataptr+s.yuvlength),!s.yuvdata.length||s.yuvdata.length!=s.width*s.height*3/2||this.croppingParams.top<0||this.croppingParams.left<0||this.croppingParams.left+this.croppingParams.width>s.width||this.croppingParams.top+this.croppingParams.height>s.height||d&&d.forEach((function(e){e.haddata=!0;var r=e.display;h.coordinate.x=e.x,h.coordinate.y=e.y,h.coordinate.width=e.width,h.coordinate.height=e.height,r&&(r.SetVideoMode(H.s),t.Should_Update_Watermark(r,e.width,e.height,e.width,e.height)&&t.Update_Display_Watermark(r,e.width,e.height,e.width,e.height),s&&r.UpdateRemoteVideoTextures(s.width,s.height,h.croppingParams,s.yuvdata,s.rotation,s.yuv_limited,h.coordinate,c))}))}e.yuvdataptr&&Module._free(e.yuvdataptr)}},de.prototype.Set_Cropping_Mode=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.disableOriginalRatio=!!e},de.prototype.Update_Cropping_Params=function(){if(this.disableOriginalRatio){var e=ue(this.croppingParams.width,this.croppingParams.height,this.croppingParams.left,this.croppingParams.top);e&&(this.croppingParams=se(se({},this.croppingParams),e))}},de.prototype.Update_SelfVideo_Texture=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H.w,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(n?(this.croppingParams.top=n.top,this.croppingParams.left=n.left,this.croppingParams.width=n.width,this.croppingParams.height=n.height):(this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=t,this.croppingParams.width=e),this.renderMode){for(var o=0;o<this.videoRenderArray.length;o++)if(this.Get_Logical_SSrc(this.videoRenderArray[o].ssrc)==this.Get_Logical_SSrc(i)){this.coordinate.x=this.videoRenderArray[o].x,this.coordinate.y=this.videoRenderArray[o].y,this.coordinate.width=this.videoRenderArray[o].width,this.coordinate.height=this.videoRenderArray[o].height,this.Update_Cropping_Params(),this.videoRenderArray[o].display.SetVideoMode(a);var s=this.videoRenderArray[o],u=s.display,d=s.width,c=s.height;this.Should_Update_Watermark(u,d,c,d,c)&&this.Update_Display_Watermark(u,d,c,d,c),-1!==[H.w,H.p].indexOf(a)?(this.videoRenderArray[o].display.UpdateSelfVideoTextures(e,t,r,this.croppingParams),this.videoRenderArray[o].enableMultiDecodeVideoWithoutSAB?this.videoRenderArray[o].firstFrame=!0:this.videoRenderArray[o].display.DrawSelfVideo(this.coordinate,!1,this.ismirror)):(this.videoRenderArray[o].display.UpdateRemoteVideoTextures(e,t,this.croppingParams,r,0,0,this.coordinate,!1),this.videoRenderArray[o].enableMultiDecodeVideoWithoutSAB?this.videoRenderArray[o].firstFrame=!0:this.videoRenderArray[o].display.DrawRemoteVideo(this.coordinate,this.ismirror))}}else if(r&&i){var h=this.ssrcDispalyMap.get(i);this.ssrcHaddataMap.set(i,!0);var l=this;h&&h.forEach((function(i){i.haddata=!0,l.coordinate.x=i.x,l.coordinate.y=i.y,l.coordinate.width=i.width,l.coordinate.height=i.height,l.Update_Cropping_Params();var n=i.display;n&&(n.SetVideoMode(a),l.Should_Update_Watermark(n,i.width,i.height,i.width,i.height)&&l.Update_Display_Watermark(n,i.width,i.height,i.width,i.height),-1!==[H.w,H.p].indexOf(a)?n.UpdateSelfVideoTextures(e,t,r,l.croppingParams):n.UpdateRemoteVideoTextures(e,t,l.croppingParams,r,0,!0,l.coordinate,!1))}))}},de.prototype.Draw_Send_Video_Img=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H.w,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.Update_SelfVideo_Texture(t,r,e,i,a,n)},de.prototype.setMirrorMyVideoOption=function(e){this.ismirror=e},de.prototype.Start_Draw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.rendingFlag=!0,this.renderMode=e,e?t?(this.intervalHandle=setInterval(this.JsMediaSDK_VideoRender_interval.bind(this),t),this.intervalHandle):null:(fe(this),this.Start_Request_Animation_Frame())},de.prototype.Stop_Draw=function(){this.rendingFlag=!1,this.renderMode?clearInterval(this.intervalHandle):this.Stop_Request_Animation_Frame()},de.prototype.webGLContextLostProtect=function(e,t){var r=this;this.bWebglContextLostProtectingMap.get(e)||(this.bWebglContextLostProtectingMap.set(e,t),this.renderMode||(e.addEventListener("webglcontextlost",(function(i){console.log("webglcontextlost",t),r.rAFID&&r.Stop_Request_Animation_Frame(),r.enableReplaceCanvasWhenContextLost?(e.contextLostTimer&&(clearTimeout(e.contextLostTimer),e.contextLostTimer=null),e.contextLostTimer=setTimeout((function(){e.contextLostTimer=null,Z(t,!0)}),3e3)):Z(t),i.preventDefault()}),{capture:!1}),e.addEventListener("webglcontextrestored",(function(i){console.log("webglcontextrestored",t),r.enableReplaceCanvasWhenContextLost?e.contextLostTimer&&(clearTimeout(e.contextLostTimer),e.contextLostTimer=null,Z(t,!0)):r.Restored_From_Context_Lost(e,e,t)}),{capture:!1})))},de.prototype._Replace_Video_Render_Array_From_Context_LOST=function(e){for(var t=e.canvas,r=e.oldCanvas,i=e.newDisplayMap,a=0;a<this.videoRenderArray.length;a++)if(this.videoRenderArray[a].canvas===r||this.videoRenderArray[a].canvas===t){r!==t&&(this.videoRenderArray[a].canvas=t);var n=this.videoRenderArray[a].display.fillMode;this.videoRenderArray[a].display=i?i.get(this.videoRenderArray[a].display.textureindex):this._Create_H264_Canvas({videoRenderArrayIndex:a,canvas:t,canvasId:this.videoRenderArray[a].rendercanvasID}),n&&this.videoRenderArray[a].display&&this.videoRenderArray[a].display.setFillMode(n,this.videoRenderArray[a].display.fillModeForResolution)}},de.prototype.Restored_From_Context_Lost=function(e,t,r){if(this.renderMode)this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t});else{var i=new Map,a=new z(e,0,void 0,void 0);a.contextGL||function(e){postMessage({status:H.A,canvasId:e})}(r),a.SetMultiView(!0),i.set(0,a);for(var n=2;n<=this.threadNumbs;n++){var o=new z(e,n,void 0,void 0,{program:a.shaderProgram,contextgl:a.contextGL,vBuffer:a.vertexPosBuffer,tBuffer:a.texturePosBuffer,waterMarkTextureRef:a.waterMarkTextureRef,repeatedWaterMarkTextureRef:a.repeatedWaterMarkTextureRef});o.SetMultiView(!0),i.set(n,o)}var s=this.renderMGR.get(t);s[0]=s[0].map((function(e){return i.get(e.textureindex)})),s[1]=s[1].map((function(e){return i.get(e.textureindex)})),t!==e&&(this.renderMGR.delete(t),this.renderMGR.set(e,s)),this.ssrcDispalyMap.forEach((function(r,a){r.forEach((function(r){if(r.haddata=!1,r.canvas===t){t!==e&&(r.canvas=e);var a=r.display;r.display=i.get(a.textureindex)}}))})),this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t,newDisplayMap:i}),this.rendingFlag&&this.Start_Request_Animation_Frame()}},de.prototype.Replace_Canvas=function(e,t){var r=this,i=null;this.bWebglContextLostProtectingMap.forEach((function(e,a){e===t&&(i=a,r.bWebglContextLostProtectingMap.delete(a))})),i&&(this.webGLContextLostProtect(e,t),this.Restored_From_Context_Lost(e,i,t)),this.isSupportOffscreenCanvas&&(this.waterMarkCanvas||this.videorendercanvas)&&(this.waterMarkCanvas=this.videorendercanvas=new OffscreenCanvas(640,360))},de.prototype.Get_Display=function(e,t){var r;this.renderMGR||(this.renderMGR=new Map),this.webGLContextLostProtect(e,t);var i=this.renderMGR.get(e);if(!i){var a=[];i=[a,[]],this.renderMGR.set(e,i);var n=new z(e,0,void 0,void 0);n.SetMultiView(!0),a.push(n);for(var o=2;o<=this.threadNumbs;o++){var s=new z(e,o,void 0,void 0,{program:n.shaderProgram,contextgl:n.contextGL,vBuffer:n.vertexPosBuffer,tBuffer:n.texturePosBuffer,waterMarkTextureRef:n.waterMarkTextureRef,repeatedWaterMarkTextureRef:n.repeatedWaterMarkTextureRef});s.SetMultiView(!0),a.push(s)}}var u=this.renderMGR.get(e),d=u[0],c=u[1];return u&&(d[0]&&(r=d.shift()),c.push(r)),r||this.Log_Error("No Display obtained from VideoRender.Get_Display"),r},de.prototype.GiveBack_Display=function(e){if(this.renderMGR){var t=e[0];if(t&&t.display){t.display.SetWaterMarkFlag(0),t.display.SetVideoMode(H.t);var r=this.renderMGR.get(t.canvas);if(r){var i=r[0],a=r[1];a&&a.some((function(e,r){if(e===t.display)return a.splice(r,1),!0})),i.push(t.display)}}}},de.prototype.Get_Logical_SSrc=function(e){return e?e>>10<<10:-1},de.prototype.Set_LocalVideo_Ptr=function(e){e&&(this.localVideoPtr=e)},de.prototype.Set_LocalVideo_Buffer=function(e){e&&(this.encodedVideoSharedArrayWasmMemory=e,this.sabBuffer=e.buffer,this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.sabBuffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.sabBuffer))},de.prototype.Set_LocalVideo_SSRC=function(e){e&&(this.localvideossrc=e,this.selfvideossrc=e)},de.prototype.Draw_LocalVideo=function(){if(this.localVideoPtr&&this.sabBuffer&&this.localvideossrc){this.encodedVideoSharedArrayWasmMemory&&this.encodedVideoSharedArrayWasmMemory.buffer!=this.sabBuffer&&(this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.sabBuffer=this.encodedVideoSharedArrayWasmMemory.buffer);var e=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr),t=!0;if(e==Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr+1)&&(t=!1),t){var r=0,i=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e)/2],a=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e+2)/2],n=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e+4)/2],o=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e+6)/2],s=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e+8)/2],u=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e+10)/2],d=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(H.r+4+8+2)*e+12)/2];r=d&&d!==H.p?i*a*3/2:i*a*4,this.croppingParams.top=n,this.croppingParams.left=o,this.croppingParams.height=u,this.croppingParams.width=s;var c=this.encodedVideoSharedArrayBufferUint8Array.subarray(this.localVideoPtr+4+(H.r+4+8+2)*e+4+8,this.localVideoPtr+4+(H.r+4+8+2)*e+4+8+r);this.Update_SelfVideo_Texture(i,a,c,this.Get_Logical_SSrc(this.localvideossrc),d,this.croppingParams),Atomics.store(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr,(e+1)%10)}}},de.prototype.Update_LocalVideo=function(e){var t=this.localvideossrc;this.Update_RemoteVideo_Texture(e,!0,t)},de.prototype.Set_Capture_Video_Flag=function(e){this.startCaptureVideo=e},de.prototype.Get_Capture_Video_Flag=function(){return this.startCaptureVideo},de.prototype.JsMediaSDK_VideoRender_interval=function(){if(this.startCaptureVideo&&this.Draw_LocalVideo(),0!=this.videoRenderArray.length)for(var e=0;e<this.videoRenderArray.length;e++){var t=this.videoRenderArray[e],r=t.display,i=t.canvas,a=t.enableMultiDecodeVideoWithoutSAB,n=t.ssrc,o=t.isMyself,s=null;if(this.Get_Logical_SSrc(n)===this.Get_Logical_SSrc(this.currentactive)){var u=Date.now();if(this.jsMediaEngine){var d=this.jsMediaEngine.Get_Video_SSRC_Latest_Time();this.timestamp=d.currentSSRCTime,this.audioPlayTime=d.audioPlayTime}this.calPacingTime(u),u-this.timestart<this.pacingTime||(s=this.Get_Decoded_Video_Frame(this.Get_Logical_SSrc(n)),this.timestart=u)}else s=this.Get_Decoded_Video_Frame(this.Get_Logical_SSrc(n));if(s){this.Get_Logical_SSrc(n)===this.Get_Logical_SSrc(this.currentactive)&&(this.videoTimestamp=s.ntptime);var c=void 0;c=s.yuvdata instanceof re?s.yuvdata.yuvdata:s.yuvdata,this.croppingParams.top=s.r_y,this.croppingParams.left=s.r_x,this.croppingParams.height=s.r_h,this.croppingParams.width=s.r_w;var h=s.width>s.height&&(1===s.rotation||3===s.rotation)||s.width<s.height&&1!==s.rotation&&3!==s.rotation,l=h?s.height:s.width,p=h?s.width:s.height,f=i.width,m=i.height;this.Should_Update_Watermark(r,l,p,f,m)&&this.Update_Display_Watermark(r,l,p,f,m),this.currentVideoHeight==this.croppingParams.height&&this.currentVideoWidth==this.croppingParams.width||(this.Notify_APPUI?this.Notify_APPUI(C.qb,{width:this.croppingParams.width,height:this.croppingParams.height}):postMessage({status:H.d,width:this.croppingParams.width,height:this.croppingParams.height}),this.currentVideoHeight=this.croppingParams.height,this.currentVideoWidth=this.croppingParams.width),c.length==s.width*s.height*3/2&&s.r_x>=0&&s.r_y>=0&&s.r_x+s.r_w<=s.width&&s.r_y+s.r_h<=s.height?(8400==this.vMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("VDGLM"):postMessage({status:H.v,data:"VDGLW"}),this.vMonitorCount=0),this.vMonitorCount++,a?r&&(r.SetVideoMode(H.s),r.UpdateRemoteVideoTextures(s.width,s.height,this.croppingParams,c,s.rotation,s.yuv_limited),t.firstFrame=!0):(t.display.SetVideoMode(H.s),t.display.drawNextOuptutPictureGL(s.width,s.height,this.croppingParams,c,s.rotation,s.yuv_limited,t))):this.Log_Error("Invalid YUV data: ".concat(s.r_x," ").concat(s.r_y," ").concat(s.r_w," ").concat(s.r_h," ").concat(s.width," ").concat(s.height)),s.yuvdata instanceof re&&s.yuvdata.recycle()}if(a&&t.firstFrame){var g={x:t.x,y:t.y,width:t.width,height:t.height};o?r.DrawSelfVideo(g):r.DrawRemoteVideo(g)}}},de.prototype.Get_Decoded_Video_Frame=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e);return t?t.dequeue():null}},de.prototype.Set_SSRC_Latest_Time_Stamp=function(e){this.timestamp!==e&&"number"==typeof e&&(this.timestamp=e,this.audioPlayTime=Date.now())},de.prototype.Get_Decoded_Video_Buffer_Length=function(e){return this.videoQueue?this.videoQueue.GetQueueLength(e):0},de.prototype.Get_SSRC_VIDEO_FPS=function(e){if(e>>=10,this.videoQueue&&this.videoQueue.ssrcInfo){var t=this.videoQueue.ssrcInfo.GetSSRCFpsInfo(e);if(t)return Math.round(t)}return 0},de.prototype.Change_Current_SSRC=function(e){this.currentactive=e,this.ClearQueue()},de.prototype.Set_Render_Array_IntervalMode=function(e,t){if(this.videoRenderArray=e,this.renderMode&&this.videoRenderArray.length>0)for(var r=0;r<this.videoRenderArray.length;r++){var i=this.videoRenderArray[r];t?i.display||(i.enableMultiDecodeVideoWithoutSAB=t,i.display=this.Get_Display(i.canvas,i.canvas.id),i.display&&i.display.setFillMode(i.fillMode,i.fillModeForResolution)):(i.display=this._Create_H264_Canvas({videoRenderArrayIndex:r,canvas:i.canvas,canvasId:i.rendercanvasID}),this.webGLContextLostProtect(i.canvas,i.rendercanvasID))}},de.prototype._Create_H264_Canvas=function(e){var t=e.videoRenderArrayIndex,r=e.canvas,i=e.canvasId;return new z(r,0,void 0,{webglcontextlostCallback:this.webglcontextlostCallback.bind(this),webglcontextrestoredCallback:this.webglcontextrestoredCallback.bind(this),params:{videoRenderArrayIndex:t,canvas:r,canvasId:i}})},de.prototype.webglcontextlostCallback=function(e,t){var r=t.canvas,i=t.canvasId;this.renderMode&&this.enableReplaceCanvasWhenContextLost&&r&&i&&(r.contextLostTimer&&(clearTimeout(r.contextLostTimer),r.contextLostTimer=null),r.contextLostTimer=setTimeout((function(){r.contextLostTimer=null,Z(i,!0)}),3e3))},de.prototype.webglcontextrestoredCallback=function(e,t){var r=t.videoRenderArrayIndex,i=t.canvas,a=t.canvasId;this.renderMode&&(this.enableReplaceCanvasWhenContextLost&&i&&a?i.contextLostTimer&&(clearTimeout(i.contextLostTimer),i.contextLostTimer=null,Z(a,!0)):this.videoRenderArray[r].display=this._Create_H264_Canvas({videoRenderArrayIndex:r,canvas:i,canvasId:a}))},de.prototype.ClearQueue=function(){try{var e,t=ae(this.videoQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=G()(e.value,2),i=(r[0],r[1]);!i.isEmpty();){var a=i.dequeue();a.yuvdata&&a.yuvdata instanceof re&&a.yuvdata.recycle()}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception during VideoRender.ClearQueue",e)}this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},de.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateVideoWaterMark,i=e.videoWaterMarkName,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;this.waterMarkCanvas=t||this.videorendercanvas,this.isCreateVideoWaterMark=r,this.videoWaterMarkName=i,void 0!==n&&(this.isWaterMarkRepeatedEnable=!!n),void 0!==a&&(this.waterMarkOpacity=a),void 0!==o&&(this.watermarkPosition=o)},de.prototype.Set_WaterMark_Flag=function(e){if(this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++){this.videoRenderArray[t].display.SetWaterMarkFlag(e?1:0)}},de.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var ce=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};de.prototype.Update_Display_Watermark=function(e,t,r,i,a){var n=this.Should_Watermark_Repeated(i,a);this.waterMarkCanvas||this.videorendercanvas||(this.videorendercanvas=this.isSupportOffscreenCanvas?new OffscreenCanvas(640,360):null);var o=i<512||a<288?16:this.watermarkPosition,s=this.waterMarkCanvas||this.videorendercanvas;if(!("function"==typeof OffscreenCanvas&&s instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var u=ce(t,r);t=u.width,r=u.height;var d=n?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o});e.updateWatherMark(t,r,d)}},de.prototype.Should_Update_Watermark=function(e,t,r,i,a){if(!this.isCreateVideoWaterMark)return!1;var n=!1,o=ce(t,r);o.width===e.watermarkWidth&&o.height===e.watermarkHeight||(n=!0);var s=this.Should_Watermark_Repeated(i,a);e.IsSetWaterMark()||(n=!0),s!==e.IsWatermarkRepeated()&&(n=!0,e.SetWatermarkRepeated(s)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.GetWatermarkOpacity()&&(n=!0,e.SetWatermarkOpacity(this.waterMarkOpacity));var u=t<512||r<288?16:this.watermarkPosition;return u!==e.GetWatermarkPosition()&&(n=!0,e.SetWatermarkPosition(u)),n},de.prototype.Put_Video_Data_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(this.videoQueue){var r=this.videoQueue.GetQueue(e.ssrc);if(r||(r=this.videoQueue.AddQueue(e.ssrc)),r.enqueue(e),this.Get_Logical_SSrc(this.currentactive)==this.Get_Logical_SSrc(e.ssrc)&&(this.Get_Logical_SSrc(this.lastActiveSSRC)!=this.Get_Logical_SSrc(e.ssrc)&&(this.lfTimeStamp=0,this.activeFps=0),this.lastActiveSSRC=this.currentactive,this.lfTimeStamp&&(this.activeFps?this.activeFps=500/(e.ntptime-this.lfTimeStamp)+this.activeFps/2:this.activeFps=1e3/(e.ntptime-this.lfTimeStamp)),this.lfTimeStamp=e.ntptime),this.videoQueue&&this.videoQueue.ssrcInfo){var i=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(i,e.ntptime)}for(var a=this.videoQueue.GetQueueLength(e.ssrc),n=a-t;n>=0;){var o=this.Get_Decoded_Video_Frame(e.ssrc);o.yuvdata instanceof re&&o.yuvdata.recycle(),n--}}else e.yuvdata&&e.yuvdata instanceof re&&e.yuvdata.recycle()},de.prototype.Set_VideoTrackReader=function(e){this.isSupportVideoTrackReader=e},de.prototype.Clear_OffScreenCavas=function(e){if(this.renderMGR&&this.renderMGR.get(e)){var t=this.renderMGR.get(e);if(t){var r=t[0],i=t[1];i.forEach((function(e){e.cleanup()})),r.forEach((function(e){e.cleanup()})),r=[],i=[],this.renderMGR.delete(e)}}e.width=1,e.height=1},de.prototype.Zoom_Render=function(e){},de.prototype.Decode_Ssrc=function(e){return this.ssrcDispalyMap.has(this.Get_Logical_SSrc(e))||this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)};var he,le="undefined"==typeof window;function pe(e){var t=Date.now(),r=he;if(r.rendingFlag){try{r.startCaptureVideo&&r.localVideoPtr&&r.Draw_LocalVideo(),r.ssrcDispalyMap.forEach((function(e,i){var a;if(r.Get_Logical_SSrc(i)==r.Get_Logical_SSrc(r.selfvideossrc)&&(a=!0),r.Get_Logical_SSrc(i)===r.Get_Logical_SSrc(r.currentactive))if(r.calPacingTime(t),t-r.timestart<r.pacingTime);else{r.timestart=t;var n=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(i));n&&(r.Update_RemoteVideo_Texture(n),r.videoTimestamp=n.ntptime)}else{var o=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(i));o&&r.Update_RemoteVideo_Texture(o)}e.forEach((function(e){if(e.haddata){var t=e.display;r.coordinate.x=e.x,r.coordinate.y=e.y,r.coordinate.width=e.width,r.coordinate.height=e.height,t&&t.GetVideoMode()!=H.t&&(a&&-1!==[H.w,H.p].indexOf(t.GetVideoMode())?t.DrawSelfVideo(r.coordinate,!1,r.ismirror):a?t.DrawRemoteVideo(r.coordinate,r.ismirror):t.DrawRemoteVideo(r.coordinate))}}))}))}catch(e){r.Log_Error("Exception while rendering video",e)}r.Start_Request_Animation_Frame(e)}else r.rAFID&&r.Stop_Request_Animation_Frame()}function fe(e){return!!e&&(he=e,!0)}de.prototype.Check_Request_Animation=function(){if(le&&this.rendingFlag&&this.rAFID&&this.prevRequestAnimationTimestap){var e=performance.now()-this.prevRequestAnimationTimestap;e>1e3&&!this.rAFIDBack&&(postMessage({status:MONITOR_MESSAGE,data:"WCL_M,RCIF"}),console.log("Request_Animation_stop"),this.rAFIDBack=setInterval(pe.bind(null,!0),30)),this.rAFIDBack&&e>=1e3*this.retryRequestAnimationStep&&(this.retryRequestAnimationStep<=32?this.retryRequestAnimationStep*=2:this.retryRequestAnimationStep+=30,this.Start_Request_Animation_Frame(!1,!0))}},de.prototype.Start_Request_Animation_Frame=function(e,t){if(!e&&this.rAFIDBack&&(console.log("Request_Animation_start"),this.Stop_Request_Animation_Frame_Backup()),!this.rAFIDBack)return t||(this.retryRequestAnimationStep=2),this.prevRequestAnimationTimestap=performance.now(),this.rAFID=requestAnimationFrame(pe),this.rAFID},de.prototype.Stop_Request_Animation_Frame_Backup=function(){this.rAFIDBack&&(clearInterval(this.rAFIDBack),this.rAFIDBack=null)},de.prototype.Stop_Request_Animation_Frame=function(){cancelAnimationFrame(this.rAFID),this.rAFID=0,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.Stop_Request_Animation_Frame_Backup()},de.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):X(e,t)},de.prototype.calPacingTime=function(e){if(this.pacingTime=30,this.activeFps&&this.activeFps>0&&this.activeFps<100&&(this.pacingTime=1e3/this.activeFps),this.timestamp&&this.videoTimestamp){var t=this.timestamp+e-this.audioPlayTime,r=this.videoTimestamp+this.pacingTime-t,i=this.videoQueue.GetQueueLength(this.Get_Logical_SSrc(this.currentactive));r>65&&r<1e4&&i>=1&&(this.pacingTime=1.5*this.pacingTime),r<-65&&(this.pacingTime=1*this.pacingTime/2)}else this.timestamp||(this.pacingTime>150?this.pacingTime=1*this.pacingTime/2:this.pacingTime=this.pacingTime-10)};var me=de;function ge(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ve(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ve(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Se(e){this.Notify_APPUI=e.Notify_APPUI,this.PubSub=e.PubSub,this.jsMediaEngine=e.jsMediaEngine,this.globalTracingLogger=e.globalTracingLogger,this.currentshareactive=0,this.isFromMainSession=0,this.sharingWidthAndHeightInfo={logicHeight:0,logicWidth:0},this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.SharingCanvasSizeInfo=null,this.Cursorx=null,this.Cursory=null,this.CursorWidth=null,this.CursorHeight=null,this.xratio=1,this.yratio=1,this.sharingDisplay=null,this.mouseQueue=new J.c,this.sharingQueue=new J.c,this.WaterMarkRGBA=new j.a,this.sMonitorCount=0,this.mMonitorCount=0,this.firstFrameForIOS=!1,this.timestart=0,this.asTime=0,this.rAFID=0,this.requestAnimation=!1,this.requestF=this.No_Bindthis_RAF.bind(this),this.cATimeStamp=0,this.lRTimeStamp=0,this.pacingtime=1,this.sharingFps=0,this.lfTimeStamp=0,this.maxQueueLength=0,this.vaTimeDelta=0,this.renderMode=H.m,this.SharingRenderInterval=0}Se.prototype.Start_Draw=function(){return this.requestAnimation=!0,this.Start_Request_Animation_Frame()},Se.prototype.Stop_Draw=function(){return this.requestAnimation=!1,this.lRTimeStamp=0,this.cATimeStamp=0,this.Stop_Request_Animation_Frame()},Se.prototype.Start_Request_Animation_Frame=function(){return this.rAFID=requestAnimationFrame(this.requestF),this.rAFID},Se.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0)},Se.prototype.No_Bindthis_RAF=function(){var e=performance.now();this.requestAnimation?(this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender()),this.Start_Request_Animation_Frame()):this.Stop_Request_Animation_Frame()},Se.prototype.No_Bindthis_Interval=function(){var e=performance.now();this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender())},Se.prototype.calPacingTime=function(e){this.pacingtime=30,this.sharingFps&&this.sharingFps>0&&this.sharingFps<100&&(this.pacingtime=1e3/this.sharingFps);var t=this.Get_Current_QueueLength();if(this.cATimeStamp&&this.lRTimeStamp){var r=this.cATimeStamp+e-this.asTime;this.vaTimeDelta=this.lRTimeStamp+this.pacingtime-r,this.vaTimeDelta>65&&this.vaTimeDelta<1e4&&t>1&&(this.pacingtime=1.5*this.pacingtime),this.vaTimeDelta<-65&&(this.pacingtime=1*this.pacingtime/2)}else this.cATimeStamp||(this.pacingtime>150||t>20?this.pacingtime=1*this.pacingtime/2:this.pacingtime=this.pacingtime-10)},Se.prototype.JsMediaSDK_SharingRender=function(){if(this.sharingDisplay){var e=this.Get_Decoded_Sharing_Frame(this.currentshareactive),t=this.Get_Decoded_Mouse_Frame(this.currentshareactive);if(e){var r,i;this.lRTimeStamp=e.ntptime,e.yuvdata instanceof re?(r=e.yuvdata.yuvdata,i=e.yuvdata):(r=e.yuvdata,i=null),this.sharingWidthAndHeightInfo.logicWidth==e.logic_w&&this.sharingWidthAndHeightInfo.logicHeight==e.logic_h||(this.PubSub?PubSub.publish(C.Xc,{body:{width:e.logic_w,height:e.logic_h,logicWidth:e.logic_w,logicHeight:e.logic_h}}):(postMessage({status:H.o,logicWidth:e.logic_w,logicHeight:e.logic_h}),this.updateOffscreenCanvasSize(e.logic_w,e.logic_h)),this.sharingWidthAndHeightInfo.logicWidth=e.logic_w,this.sharingWidthAndHeightInfo.logicHeight=e.logic_h);var a=e.logic_h,n=e.logic_w,o=e.r_h,s=e.r_w;this.xratio=s/n,this.yratio=o/a;var u={top:e.r_x,left:e.r_y,height:e.r_h,width:e.r_w};this.currentSharingHeight==e.r_h&&this.currentSharingWidth==e.r_w&&this.currentSharingLogicHeight==e.logic_h&&this.currentSharingLogicWidth==e.logic_w||(this.Notify_APPUI?this.Notify_APPUI(C.Wc,{body:{height:e.logic_h,width:e.logic_w,logicHeight:e.logic_h,logicWidth:e.logic_w}}):(postMessage({status:H.o,logicWidth:e.logic_w,logicHeight:e.logic_h}),this.updateOffscreenCanvasSize(e.logic_w,e.logic_h)),this.currentSharingHeight=e.r_h,this.currentSharingWidth=e.r_w,this.currentSharingLogicHeight=e.logic_h,this.currentSharingLogicWidth=e.logic_w);var d=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:e.r_w,c=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:e.r_h;this.Should_Update_Watermark(this.sharingDisplay,d,c)&&this.Update_Display_Watermark(this.sharingDisplay,d,c),3e3==this.sMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDIMM"):postMessage({status:H.n,data:"SDIMW"}),this.sMonitorCount=0),this.sMonitorCount++,this.sharingDisplay.drawNextOuptutPictureGL(e.width,e.height,u,r,null,e.yuv_limited),i&&i.recycle(),e.dataptr&&Module._free(e.dataptr)}t&&(this.Cursorx=t.r_x*this.xratio,this.Cursory=t.r_y*this.yratio,this.CursorWidth=t.width*this.xratio,this.CursorHeight=t.height*this.yratio,this.sharingDisplay.updateCursor(t.width,t.height,t.buffer),3e3==this.mMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDSBM"):postMessage({status:H.n,data:"SDSBW"}),this.mMonitorCount=0),this.mMonitorCount++,this.sharingDisplay.draw(1,this.Cursorx,this.Cursory,this.CursorWidth,this.CursorHeight))}},Se.prototype.setOnlyAcceptUISize=function(e){this.bOnlyAcceptUISize=e},Se.prototype.updateOffscreenCanvasSize=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.bOnlyAcceptUISize&&!r)return console.log("drop logic w/h");try{var i=this.sharingDisplay.canvasElement;i&&i instanceof OffscreenCanvas&&(i.width=e,i.height=t)}catch(e){this.Log_Error("Error updating OffscreenCanvas size",e)}},Se.prototype.Set_Render_WebGL=function(e){this.sharingDisplay=e},Se.prototype.Change_Current_SSRC=function(e,t){this.currentshareactive=e,this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isFromMainSession=t,this.firstFrameForIOS=!1,this.ClearQueue()},Se.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateSharingWaterMark,i=e.sharingWaterMarkName,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;r||(this.SharingCanvasSizeInfo=null),this.Replace_WaterMark_Canvas(t),this.isCreateSharingWaterMark=r,this.sharingWaterMarkName=i,void 0!==n&&(this.isWaterMarkRepeatedEnable=!!n),void 0!==a&&(this.waterMarkOpacity=a),void 0!==o&&(this.watermarkPosition=o)},Se.prototype.Replace_WaterMark_Canvas=function(e){this.waterMarkCanvas=e},Se.prototype.Set_WaterMark_Flag=function(e){this.sharingDisplay.SetWaterMarkFlag(e?1:0)},Se.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var _e=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};Se.prototype.Update_Display_Watermark=function(e,t,r){if(!("function"==typeof OffscreenCanvas&&this.waterMarkCanvas instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var i=t<512||r<288?16:this.watermarkPosition,a=this.Should_Watermark_Repeated(t,r),n=_e(t,r);t=n.width,r=n.height;var o=a?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:i}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:i});e.updateWatherMark(t,r,o)}},Se.prototype.Should_Update_Watermark=function(e,t,r){if(!this.isCreateSharingWaterMark)return!1;var i=!1,a=_e(t,r);a.width===e.watermarkWidth&&a.height===e.watermarkHeight||(i=!0);var n=this.Should_Watermark_Repeated(t,r);e.IsSetWaterMark()||(i=!0),n!==e.IsWatermarkRepeated()&&(i=!0,e.SetWatermarkRepeated(n)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.GetWatermarkOpacity()&&(i=!0,e.SetWatermarkOpacity(this.waterMarkOpacity));var o=t<512||r<288?16:this.watermarkPosition;return o!==e.GetWatermarkPosition()&&(i=!0,e.SetWatermarkPosition(o)),i},Se.prototype.Update_Sharing_Canvas_Size=function(e){var t=e.width,r=e.height;this.SharingCanvasSizeInfo={width:Math.round(t),height:Math.round(r)}},Se.prototype.ClearQueue=function(){try{var e,t=ge(this.sharingQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=G()(e.value,2),i=(r[0],r[1]);!i.isEmpty();){var a=i.dequeue();a.yuvdata&&a.yuvdata instanceof re&&a.yuvdata.recycle(),a.dataptr&&Module._free(a.dataptr)}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception from SharingRender.ClearQueue",e)}this.sharingQueue&&this.sharingQueue.ClearQueue(),this.mouseQueue&&this.mouseQueue.ClearQueue(),this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0},Se.prototype.Get_Decoded_Sharing_Frame=function(e){if(this.sharingQueue){var t=this.GetLogicalSSRCPart(e,this.isFromMainSession),r=this.sharingQueue.GetQueue(t);return r?r.dequeue():null}},Se.prototype.Get_Decoded_Mouse_Frame=function(e){if(this.mouseQueue){var t=this.GetLogicalSSRCPart(e,this.isFromMainSession),r=this.mouseQueue.GetQueue(t);return r?r.dequeue():null}},Se.prototype.Put_Sharing_Data_From_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(this.sharingQueue){var r=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession);this.firstFrameForIOS||r!=this.currentshareactive>>10||(this.firstFrameForIOS=!0,this.Notify_APPUI?this.Notify_APPUI(C.Hb,this.currentshareactive):postMessage({status:H.f,ssrc:this.currentshareactive}));var i=this.sharingQueue.GetQueue(r);i||(i=this.sharingQueue.AddQueue(r)),i.enqueue(e),this.lfTimeStamp&&(this.sharingFps?this.sharingFps=500/(e.ntptime-this.lfTimeStamp)+this.sharingFps/2:this.sharingFps=1e3/(e.ntptime-this.lfTimeStamp)),this.sharingFps!=1/0&&this.sharingFps||(this.sharingFps=20),this.lfTimeStamp=e.ntptime;var a=this.sharingQueue.GetQueueLength(r),n=a-t;for(this.maxQueueLength=t;n>=0;){var o=this.Get_Decoded_Sharing_Frame(e.ssrc);o.yuvdata instanceof re&&o.yuvdata.recycle(),o.dataptr&&Module._free(o.dataptr),n--}}},Se.prototype.Get_Current_QueueLength=function(){if(this.sharingQueue){var e=this.currentshareactive,t=this.GetLogicalSSRCPart(e,this.isFromMainSession);return this.sharingQueue.GetQueueLength(t)}},Se.prototype.Put_Mouse_Data_Into_Queue=function(e){if(this.mouseQueue){var t=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession),r=this.mouseQueue.GetQueue(t);r||(r=this.mouseQueue.AddQueue(t)),r.enqueue(e);for(var i=this.mouseQueue.GetQueueLength(t)-10;i>=0;)this.Get_Decoded_Mouse_Frame(e.ssrc),i--}},Se.prototype.GetLogicalSSRCPart=function(e,t){var r=e>>10;return t&&(r|=1<<23),r},Se.prototype.SetcATimeStamp=function(e){this.cATimeStamp=e,this.asTime=performance.now()},Se.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):X(e,t)},Se.prototype.setMode=function(e){this.Stop_Draw2(),this.mode=e},Se.prototype.Start_Draw2=function(e){var t=this;this.mode?(this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0),this.SharingRenderInterval=setInterval((function(){t.No_Bindthis_Interval()}),20)):this.Start_Draw()},Se.prototype.Stop_Draw2=function(e){this.mode?this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0):this.Stop_Draw()};var Ce=Se,ye=r(14),be=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.byteLength,s=arguments.length>6?arguments[6]:void 0;l()(this,e),this.offset=n,this._BYTES_PER_ELEMENT=r,this.capacity=(o-8)/r,this.usableCapacity=this.capacity-1,this.buf=t,this.write_ptr=new Uint32Array(this.buf,n,1),this.read_ptr=new Uint32Array(this.buf,n+4,1),this.storageUint8sByteOffset=n+8,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,o-8),this.byteLength=o,this.label=i,this.usingOneElementBuffer=a,s&&(this.wasmMemory=s),a&&(this.oneElementBuffer=new ArrayBuffer(r)),this.repushhander=0,this.repushlogcount=0,this.monitorpace=0}return f()(e,[{key:"checkBuffer",value:function(){this.wasmMemory&&this.wasmMemory.buffer!=this.buf&&(console.log("buffer change"),this.buf=this.wasmMemory.buffer,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,this.byteLength-8))}},{key:"enqueue",value:function(e){return this.push(e)}},{key:"enqueueSafe",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(this.dataBuffer||(this.dataBuffer=new ye.a);this.dataBuffer.getLength()>0&&this.available_write()>0;){var a=this.dataBuffer.dequeue();a&&this.enqueue(a)}var n=this.dataBuffer.getLength();if(e){if(this.available_write()>0&&0==n)return this.enqueue(e),!0;if(!r)return!1;this.dataBuffer.enqueue(e),++n}if(n>0&&!this.repushhander&&(this.repushhander=setTimeout((function(){t.repushlogcount%10==0&&console.warn("<<< retry consume cache data"),t.repushlogcount++,t.repushhander=0,t.enqueueSafe(null)}),10)),n>=1e3&&(k.a.error("Cached data in SAB reached critical value, will be cleared"),this.dataBuffer.clear()),n>0&&i){var o=performance.now();(!this.monitorpace||o-this.monitorpace>2e4)&&(this.monitorpace=o,i("vqsl"+n))}return!0}},{key:"push",value:function(e){return e instanceof Array?this._pushArray(e):this._push(e)}},{key:"_pushArray",value:function(e){var t=this,r=Atomics.load(this.read_ptr,0),i=Atomics.load(this.write_ptr,0);if((i+1)%this.capacity==r)return 0;this.checkBuffer();var a=0;e.forEach((function(e){t.storageUint8s.set(e,i*t._BYTES_PER_ELEMENT+8+4+a),a+=e.byteLength})),new Uint32Array(this.buf,this.offset+i*this._BYTES_PER_ELEMENT+8,1)[0]=a;var n=(i+1)%this.capacity;return Atomics.store(this.write_ptr,0,n),{rd:r,wr:n}}},{key:"_push",value:function(e){var t=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);if((r+1)%this.capacity==t)return 0;this.checkBuffer(),this.storageUint8s.set(e,r*this._BYTES_PER_ELEMENT+8+4,e.byteLength),new Uint32Array(this.buf,this.offset+r*this._BYTES_PER_ELEMENT+8,1)[0]=e.byteLength;var i=(r+1)%this.capacity;return Atomics.store(this.write_ptr,0,i),{rd:t,wr:i}}},{key:"addReadPtr",value:function(){var e=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(e+1)%this.capacity)}},{key:"dequeue",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);if(this._available_read(t,r)<=0)return null;this.checkBuffer();var i,a,n,o=new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1);if(e){i=this.oneElementBuffer?new Uint8Array(this.oneElementBuffer,0,o[0]):new Uint8Array(o[0]);var s=new Uint8Array(this.storageUint8s.buffer,t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,i.byteLength);i.set(s,0)}else i=this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+8+4,t*this._BYTES_PER_ELEMENT+8+4+o[0]),a=t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,n=t*this._BYTES_PER_ELEMENT+8+4+o[0]+this.storageUint8sByteOffset;return e&&Atomics.store(this.read_ptr,0,(t+1)%this.capacity),e?i:{bCopyData:e,uint8s:i,begin:a,end:n}}},{key:"available_read",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}},{key:"available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}},{key:"is_available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._is_available_write(e,t)}},{key:"_available_read",value:function(e,t){return(t+this.capacity-e)%this.capacity}},{key:"_available_write",value:function(e,t){return this.usableCapacity-this._available_read(e,t)}},{key:"_is_available_write",value:function(e,t){return this._available_write(e,t)>0}},{key:"_storage_capacity",value:function(){return this.capacity}}],[{key:"getStorageForCapacity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,r=8+(e+1)*t;return new SharedArrayBuffer(r)}}]),e}(),Ae=function(){function e(t,r,i,a){if(l()(this,e),!(t instanceof be))throw new Error("RingBuffer required");this.rb=t,this.dataCallback=r,this.interval=null,this.requestID=null,this.timeout_call=i,this.tick_lasted_time=0,this.timeoutMS=a>20?a:50}return f()(e,[{key:"consume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interval||(this.bCopyData=r,this.interval=setInterval((function(){e._dequeue()}),t),console.log("consume interval ".concat(this.interval)))}},{key:"consumeAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.bCopyData=e,this._dequeue()}},{key:"_dequeue",value:function(){if(this.timeout_call){var e=performance.now();if(0!=this.tick_lasted_time){var t=e-this.tick_lasted_time;t>=this.timeoutMS&&this.timeout_call(t,e)}this.tick_lasted_time=e}for(;this.rb.available_read()>0;){var r=this.rb.dequeue(this.bCopyData);this.dataCallback(r),this.bCopyData||this.rb.addReadPtr()}}},{key:"_consumeForAnimationFrame",value:function(){this._dequeue(),this.requestID=requestAnimationFrame(this._consumeForAnimationFrame.bind(this))}},{key:"consumeUsingRequestAnimationFrame",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.requestID||(this.bCopyData=e,this._consumeForAnimationFrame())}},{key:"cancelConsume",value:function(){console.log("cancelConsume interval ".concat(this.interval," requestID ").concat(this.requestID)),this.tick_lasted_time=0,clearInterval(this.interval),this.requestID&&cancelAnimationFrame(this.requestID),this.interval=null,this.requestID=null}}]),e}(),ke=function(){function e(){l()(this,e),this.timeStampKey="video_timestamp",this.keysList=["video_ssrc","video_width","video_height","rendering_x","rendering_y","rendering_w","rendering_h","rotation","yuv_limited"],this.bCopyData=null,this.begin=null,this.end=null}return f()(e,[{key:"setOBJ",value:function(e){this.obj=e,this.yuvUint8s=e.data}},{key:"setBuffer",value:function(e){!1===e.bCopyData?(this.objUint8s=e.uint8s,this.bCopyData=e.bCopyData,this.begin=e.begin,this.end=e.end):(this.objUint8s=e,this.bCopyData=!0,this.begin=0,this.end=e.byteLength)}},{key:"buffer2Obj",value:function(){var e=new Uint32Array(this.objUint8s.buffer,this.begin,9),t=new DataView(this.objUint8s.buffer,this.begin+40,16),r={};this.keysList.forEach((function(t,i){r[t]=e[i]})),r[this.timeStampKey]=Number(t.getBigUint64(0,!0));var i,a=Number(t.getBigUint64(8,!0)),n=new Uint8Array(this.objUint8s.buffer,this.begin+40+8+8,a);return i=(this.bCopyData,n),r.data=i,r}},{key:"obj2buffer",value:function(){var e=this,t=new Uint8Array(56),r=this.keysList,i=new Uint32Array(t.buffer,0,9),a=new DataView(t.buffer,40,16);return r.forEach((function(t,r){i[r]=e.obj[t]})),a.setBigUint64(0,BigInt(this.obj[this.timeStampKey]),!0),a.setBigUint64(8,BigInt(this.yuvUint8s.byteLength),!0),[t,this.yuvUint8s]}}]),e}();function Ee(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ie(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ie(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var we,Me,De=function(e,t){return _.a.add_monitor("AB"+e)},Re=A.g.isSupportOffscreenCanvas(),Te=(we=[],Me=Date.now(),function(e){if(we.push(e),Date.now()-Me>14e3){var t=we.reduce((function(e,t,r){var i=t.rtt,a=t.ssrcMap,n="";return Object.keys(a).forEach((function(e){var t=a[e],r=t.aveAudioLevel,i=t.audioLevel,o=t.aveJitterBufferDelay,s=t.jitter,u=t.packetsLost,d=t.packetsReceived,c=t.bytesReceived;n+="{".concat(e,"},").concat(i,",").concat(r,",").concat(s,",").concat(o,",").concat(u,",").concat(d,",").concat(c)})),e+"".concat(i||"").concat(n?",".concat(n):"")+(r<we.length-1?"||":"")}),"WCL_AB, {[NETWORK]},");Me=Date.now(),S.a.sendMessageToRwg(C.gc,{evt:4167,seq:1,body:{data:t}}),we=[]}}),Pe=function(){var e=[],t=Date.now();return function(r){if(e.push(r),Date.now()-t>14e3){var i=e.reduce((function(t,r,i){var a=r.rtt,n=r.bytesSent;return t+"".concat(a||"",",").concat(void 0===n?"":n)+(i<e.length-1?"||":"")}),"WCL_AB, {[SEND]},");t=Date.now(),S.a.sendMessageToRwg(C.gc,{evt:4167,seq:1,body:{data:i}}),e=[]}}}(),xe={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",iceServers:[],iceTransportPolicy:"all"},Oe=function(){function e(t,r,i,a,n,o){l()(this,e),this.publisherCandidate=[],this.subscriberCandidate=[],this.retry=0,this.retryPublish=0,this.nginxHost=t,this.rwgHost=r,this.conId=i,this.wsUrl=o?"wss://".concat(r,"/ab/signal?rwg=").concat(r,"&cid=").concat(i):"wss://".concat(t,"/ab/signal?rwg=").concat(r,"&cid=").concat(i),this.audioPlayerMap=new Map,this.onError=null,this.isRetrying=!1,this.recvOnly=!!a,this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.destination=this.audioCtx.createMediaStreamDestination(),this.monitorTimer=null,this.monitorTimerDuration=5e3,this.monitorInfo={subscriber:{},publisher:{}},this.muted=!1,this.audioMuteStatus=new Map,this.ssrcUserIdMap=new Map,this.published=!1,this.joinAudioAfterConnect=!1,this.isJoinAudio=!1,this.isMultiView=!!n,this.normalAudioMap=new Map,this.shareAudioMap=new Map,this.syncTimer=null}var t,r,i,a;return f()(e,[{key:"reconnect",value:(a=u()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRetrying&&!this.isDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(!(this.retry>=3)){e.next=7;break}return this.isRetrying=!1,console.error("audio bridge:::: reconnect by error: ",t),S.a.Notify_APPUI&&S.a.Notify_APPUI(C.Oe),e.abrupt("return");case 7:return this.isRetrying=!0,e.next=10,A.g.sleep(3e3);case 10:if(!this.isDestroyed){e.next=12;break}return e.abrupt("return");case 12:return De("JOIN"+this.retry),this.retry++,S.a.Notify_APPUI&&S.a.Notify_APPUI(C.Ne),this.publisher&&(this.sender&&(this.publisher.removeTrack(this.sender),this.sender=null),this.publisher.close(),this.publisher=null),this.subscriber&&(this.subscriber.close(),this.subscriber=null),e.next=19,this.join(!0);case 19:this.isRetrying=!1;case 20:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"join",value:(i=u()(g.a.mark((function e(t,r){var i,a,n=this,o=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>2&&void 0!==o[2]&&o[2],this.stopDestoryOldSignalTimer(),this.isJoinAudio=i,!this.signal){e.next=11;break}return this.isDestroyed=!1,this.signal.isDestroyed=!1,this.signal.isJoinAudio=i,i&&(this.startAVSyncTimer(),this.signal.socket&&1===this.signal.socket.readyState&&this.signal.notify("audiostatus",{status:1})),this.startAudioQualityMonitorTimer(),this.unmuteAllRemoteAudio(),e.abrupt("return");case 11:if(t){e.next=17;break}if(this.joinAudioAfterConnect=i,!this.isRetrying){e.next=17;break}return this.destroySocketAndWebRtcConnect(t),this.isDestroyed=!1,e.abrupt("return");case 17:if(this.destroySocketAndWebRtcConnect(t),this.isDestroyed=!1,De("INIT"+",".concat(this.nginxHost)+",".concat(this.rwgHost)+",".concat(this.conId)+",".concat(r)),this.signal=new Ne(this.joinAudioAfterConnect),this.joinAudioAfterConnect&&this.startAVSyncTimer(),this.joinAudioAfterConnect=!1,e.prev=23,!r){e.next=28;break}a=r,e.next=33;break;case 28:return S.a.sendMessageToRwg(C.zc,{evt:C.Ze},!1),e.next=31,this.waitForTokenFromRWG(C.wc.AUDIO_BRIDGE_WS_TOKEN);case 31:a=e.sent,De("TK");case 33:this.signal.init("".concat(this.wsUrl,"&token=").concat(a)),e.next=39;break;case 36:e.prev=36,e.t0=e.catch(23),this.reconnect(e.t0);case 39:this.signal.onopen(function(){var e=u()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startAudioQualityMonitorTimer(),n.isOpen=!0,n.retryPublish=0,!n.audioStream&&!n.recvOnly){e.next=10;break}return n.clearAudioPlayerMap(),n.setAudioStream(n.audioStream),e.next=8,n.publish();case 8:n.retry=0,S.a.Notify_APPUI&&n.signal.isJoinAudio&&S.a.Notify_APPUI(C.Me);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.signal.onclose((function(e){n.signal=null,n.published=!1,n.stopAudioQualityMonitorTimer(),n.stopAVSyncTimer(),e&&n.reconnect(e)})),this.signal.onerror((function(e){n.signal=null,n.published=!1,n.stopAudioQualityMonitorTimer(),n.stopAVSyncTimer(),e&&n.reconnect(e)})),this.signal.on_notify("command",(function(e){var t=(e||{}).data;if(t)try{(JSON.parse(t)||{}).evt===C.bf&&n.destroy(!1)}catch(e){}})),this.signal.UpdateNTP=function(e,t,r,i){512&r?n.shareAudioMap.set(r>>10,{ntptime:e,rtptime:t,abssrc:i}):n.normalAudioMap.set(r>>10,{ntptime:e,rtptime:t,abssrc:i})},this.publisher&&this.sender&&(this.publisher.removeTrack(this.sender),this.sender=null),this.publisher=new RTCPeerConnection(xe),this.subscriber=new RTCPeerConnection(xe),this.signal.onOffer=function(){var e=u()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return De("RERSDP"),n.updateSsrcUserIdMap(t),e.next=4,n.subscriber.setRemoteDescription(t);case 4:return n.subscriberCandidate.forEach((function(e){return n.subscriber.addIceCandidate(e)})),n.subscriberCandidate=[],e.next=8,n.subscriber.createAnswer();case 8:return r=e.sent,e.next=11,n.subscriber.setLocalDescription(r);case 11:return De("RELSDP"),e.next=14,n.rpc("answer",{desc:r});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.signal.onTrickle=function(){var e=u()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0==r?null!=n.subscriber.remoteDescription?(De("RERICE"),n.subscriber.addIceCandidate(t)):(De("RERICEF"),n.subscriberCandidate.push(t)):1==r?null!=n.publisher.remoteDescription?(De("SERICE"),n.publisher.addIceCandidate(t)):(De("SERICEF"),n.publisherCandidate.push(t)):console.error("audio bridge:::: onTrickle ERROR!!!! role:",r,", candidate:",t);case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.publisher.onicecandidate=function(e){var t=e.candidate;De("SELICE"),n.signal.notify("trickle",{candidate:t,role:1})},this.publisher.onconnectionstatechange=function(){De("PCSC:"+n.publisher.connectionState),n.publisher&&("disconnected"===n.publisher.connectionState?setTimeout((function(){n.publisher&&"disconnected"===n.publisher.connectionState&&n.publish(!0)}),5e3):"connected"===n.publisher.connectionState&&(n.signal.isRtcConnected=!0,n.publisher.firstConnected||(n.publisher.firstConnected=!0,S.a.Notify_APPUI(C.g))))},this.subscriber.onicecandidate=function(e){var t=e.candidate;De("RELICE"),n.signal.notify("trickle",{candidate:t,role:0})},this.subscriber.ontrack=function(e){De("REVT");var t=e.streams[0],r=decodeURIComponent(t.id),i="ab-audio-"+r;e.track.onunmute=function(){var e=n.audioPlayerMap.get(r);e?e.srcObject=t:((e=document.createElement("audio")).addEventListener("playing",(function(){De("ASP:"+i)})),e.addEventListener("pause",(function(){De("APP:"+i)})),e.addEventListener("canplay",(function(){De("ACP:"+i)})),e.id=i,e.srcObject=t,e.autoplay=!0,e.controls=!1,n.audioPlayerMap.set(r,e),document.documentElement.appendChild(e)),n.isDestroyed&&(e.muted=!0),De("REVTP")},e.track.onmute=function(){De("REVTM");var e=n.audioPlayerMap.get(r);e&&e.remove(),n.audioPlayerMap.delete(r)}},this.subscriber.onconnectionstatechange=function(){De("SCSC:"+n.subscriber.connectionState),n.subscriber&&"connected"===n.subscriber.connectionState&&!n.subscriber.firstConnected&&(n.subscriber.firstConnected=!0,S.a.Notify_APPUI(C.h))};case 54:case"end":return e.stop()}}),e,this,[[23,36]])}))),function(e,t){return i.apply(this,arguments)})},{key:"leaveAudioWithoutDisconnect",value:function(){this.isJoinAudio=!1,this.signal&&this.signal.isJoinAudio&&(this.signal.isJoinAudio=!1,this.signal.leaveTime=Date.now(),this.signal.notify("audiostatus",{status:0})),this.setAudioStream(null,!0),this.muteAllRemoteAudio(),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer()}},{key:"rpc",value:(r=u()(g.a.mark((function e(t){var r,i=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:[],e.prev=1,this.signal){e.next=5;break}return console.error("audio bridge:::: RPC ERROR, signal NULL",t,r),e.abrupt("return","");case 5:return e.abrupt("return",this.signal.call(t,r));case 8:return e.prev=8,e.t0=e.catch(1),console.error("audio bridge:::: RPC err",t,r,e.t0),e.abrupt("return","");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return r.apply(this,arguments)})},{key:"publish",value:(t=u()(g.a.mark((function e(t){var r,i,a,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publisher&&this.isOpen){e.next=2;break}return e.abrupt("return");case 2:if(!t){e.next=6;break}if(!(this.retryPublish>=3)){e.next=5;break}return e.abrupt("return");case 5:this.retryPublish++;case 6:if(t){e.next=10;break}if(!this.published){e.next=9;break}return e.abrupt("return");case 9:this.published=!0;case 10:return e.next=12,this.publisher.createOffer({iceRestart:!!t});case 12:return r=e.sent,e.next=15,this.publisher.setLocalDescription(r);case 15:return this.uid||t||(this.uid=Ve()),De("SELSDP"),e.next=19,t?this.rpc("offer",{desc:this.publisher.localDescription}):this.rpc("join",{uid:this.uid,offer:this.publisher.localDescription});case 19:if(!(i=e.sent)||2!==i.length){e.next=31;break}if(i[0],"answer"!==(a=i[1]).type){e.next=31;break}return De("SERSDP"),e.next=27,this.publisher.setRemoteDescription(a);case 27:this.publisherCandidate.forEach((function(e){return n.publisher.addIceCandidate(e)})),this.publisherCandidate=[],this.setAudioStream(this.audioStream),this.ping();case 31:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"waitForTokenFromRWG",value:function(e){return new Promise((function(t,r){w.a.on(e,(function(e,r){t(r)}))}))}},{key:"ping",value:function(){var e=this;null!=this.signal&&this.signal.notify("ping",{}),this.pingTimeout&&clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout((function(){e.ping()}),15e3)}},{key:"setRecvOnly",value:function(e,t){this.recvOnly=!!e,this.recvOnly?this.setAudioStream(null,!0):t&&this.setAudioStream(t)}},{key:"setAudioStream",value:function(e,t){var r=this;this.recvOnly||t?this.audioStream=this.destination.stream:this.audioStream=e;var i=null;i=this.audioStream&&this.audioStream.id!==this.destination.stream.id?"T":"F",this.publisher&&this.audioStream.getTracks().forEach((function(e){r.sender?(De("PRAT"+i),r.sender.replaceTrack(e).catch((function(e){De("RATE")}))):(De("PAAT"+i),r.sender=r.publisher.addTrack(e,r.audioStream))}))}},{key:"mute",value:function(){this.audioStream&&(De("SEVTP"),this.muted=!0,this.audioStream.getAudioTracks().forEach((function(e){e.enabled=!1})))}},{key:"unmute",value:function(){this.audioStream&&(De("SEVTM"),this.muted=!1,this.audioStream.getAudioTracks().forEach((function(e){e.enabled=!0})))}},{key:"stopIncomingAudio",value:function(e){e?this.muteAllRemoteAudio():this.unmuteAllRemoteAudio()}},{key:"muteAllRemoteAudio",value:function(){var e,t=Ee(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=G()(e.value,2);r[0];r[1].muted=!0}}catch(e){t.e(e)}finally{t.f()}}},{key:"unmuteAllRemoteAudio",value:function(){var e,t=Ee(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=G()(e.value,2);r[0];r[1].muted=!1}}catch(e){t.e(e)}finally{t.f()}}},{key:"setSpeechVolumeLevel",value:function(e,t){var r,i=Ee(this.audioPlayerMap);try{for(i.s();!(r=i.n()).done;){var a=G()(r.value,2),n=a[0],o=a[1],s=Number(n.split("+")[0]||"0"),u=Number.isNaN(s)||!s?null:s>>10<<10;if(u&&u===e>>10<<10){var d=Math.min(Math.max(0,t),100)/100;o.volume=d;break}}}catch(e){i.e(e)}finally{i.f()}}},{key:"changeSpeaker",value:function(e){var t,r=Ee(this.audioPlayerMap);try{for(r.s();!(t=r.n()).done;){var i=G()(t.value,2);i[0];i[1].setSinkId(e).catch((function(e){k.a.error("Error when setting sink of audio player",e)}))}}catch(e){r.e(e)}finally{r.f()}}},{key:"updateSsrcUserIdMap",value:function(e){var t=this;if(e){var r=e.sdp,i=(void 0===r?"":r).match(/a=ssrc:(.+) cname:(.+)/g);i&&i.forEach((function(e){var r=e.match(/a=ssrc:(.+) cname:(.+)/);if(r&&r[1]&&r[2]){var i=Number(r[2].split("+")[0]||"0"),a=Number.isNaN(i)||!i?null:i>>10<<10,n=Number(r[1]);t.ssrcUserIdMap.set(n,a)}}))}}},{key:"updateUserMuteUnmuteStatus",value:function(e){var t=this,r=e.update,i=e.remove;r&&r.length>0&&r.forEach((function(e){var r=e.userId,i=e.muted;r&&t.audioMuteStatus.set(r>>10<<10,!!i)})),i&&i.length>0&&i.forEach((function(e){var r=e.userId;r&&t.audioMuteStatus.set(r>>10<<10,!0)}))}},{key:"isUserMuted",value:function(e){var t=this.ssrcUserIdMap.get(e);if(!t)return!1;var r=this.audioMuteStatus.get(t);return void 0!==r&&!!r}},{key:"clearAudioPlayerMap",value:function(){this.muteAllRemoteAudio();var e,t=Ee(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=G()(e.value,2);r[0];r[1].remove()}}catch(e){t.e(e)}finally{t.f()}this.audioPlayerMap.clear(),this.audioMuteStatus.clear()}},{key:"destroySocketAndWebRtcConnect",value:function(e){this.published=!1,this.pingTimeout&&(clearTimeout(this.pingTimeout),this.pingTimeout=null);try{this.sender&&(this.publisher.removeTrack(this.sender),this.sender=null)}catch(e){}this.publisher&&(this.publisher.close(),this.publisher=null),this.subscriber&&(this.subscriber.close(),this.subscriber=null),this.isOpen=!1,e||(this.retry=0),this.retryPublish=0,this.signal&&(this.signal.isDestroyed=!0,this.signal.destroy(),this.signal=null),this.ssrcUserIdMap.clear()}},{key:"stopDestoryOldSignalTimer",value:function(){this.destroyOldSignalTimer&&(clearTimeout(this.destroyOldSignalTimer),this.destroyOldSignalTimer=null)}},{key:"startDestoryOldSignalTimer",value:function(){var e=this;this.stopDestoryOldSignalTimer(),this.destroyOldSignalTimer=setTimeout((function(){e.stopDestoryOldSignalTimer(),e.destroySocketAndWebRtcConnect()}),15e3)}},{key:"destroy",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];De("DS"),this.isDestroyed=!0,this.signal&&(this.signal.isDestroyed=!0),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer(),this.stopDestoryOldSignalTimer(),e?(this.muteAllRemoteAudio(),this.setAudioStream(null,!0),this.startDestoryOldSignalTimer()):(this.clearAudioPlayerMap(),this.destroySocketAndWebRtcConnect(),this.audioCtx&&(this.audioCtx.close(),this.audioCtx=null,this.destination=null,this.recvOnly=!1))}},{key:"startAudioQualityMonitorTimer",value:function(){var e=this;this.stopAudioQualityMonitorTimer(),this.monitorTimer=setInterval((function(){e.publisher&&e.publisher.getStats().then((function(t){if(t){var r={},i=!1,a=e.monitorInfo.publisher;t.forEach((function(t){var n=t.totalRoundTripTime,o=t.responsesReceived,s=t.bytesSent,u=t.timestamp,d=t.localCandidateId,c=t.remoteCandidateId,h=t.type,l=t.state,p=t.nominated;if("candidate-pair"===h&&"succeeded"===l&&p){if(a.prevStatInfo&&a.localCandidateId===d&&a.remoteCandidateId===c){var f=a.prevStatInfo;i=!0,Object.assign(r,{rtt:Math.floor(1e3*(o===f.responsesReceived?0:(n-f.totalRoundTripTime)/(o-f.responsesReceived))),bytesSent:e.muted?0:Math.floor((s-f.bytesSent)/(u-f.timestamp)*1e3)})}else a.localCandidateId=d,a.remoteCandidateId=c,a.prevStatInfo={};Object.assign(a.prevStatInfo,{totalRoundTripTime:n,responsesReceived:o,bytesSent:s,timestamp:u})}})),t.forEach((function(e){var t=e.id,r=e.type;if("local-candidate"===r&&t===a.localCandidateId){var i=e.ip,n=e.port,o=e.networkType;a.localCA&&a.localCA.ip===i&&a.localCA.port===n&&a.localCA.networkType===o||(a.localCA={ip:i,port:n,networkType:o},De("SELCA"+",".concat(i)+",".concat(n)+",".concat(o)))}else if("remote-candidate"===r&&t===a.remoteCandidateId){var s=e.ip,u=e.port;a.remoteCA&&a.remoteCA.ip===s&&a.remoteCA.port===u||(a.remoteCA={ip:s,port:u},De("SERCA"+",".concat(s)+",".concat(u)))}})),i&&Pe(r)}})),e.subscriber&&e.subscriber.getStats().then((function(t){if(t){var r=e.monitorInfo.subscriber,i={ssrcMap:{}},a=!1;t.forEach((function(e){var t=e.totalRoundTripTime,n=e.responsesReceived,o=e.localCandidateId,s=e.remoteCandidateId,u=e.type,d=e.state,c=e.nominated;if("candidate-pair"===u&&"succeeded"===d&&c){if(r.prevStatInfo&&r.localCandidateId===o&&r.remoteCandidateId===s){var h=r.prevStatInfo;a=!0,Object.assign(i,{rtt:Math.floor(1e3*(n===h.responsesReceived?0:(t-h.totalRoundTripTime)/(n-h.responsesReceived)))})}else r.localCandidateId=o,r.remoteCandidateId=s,r.prevStatInfo={},r.ssrcMap={};Object.assign(r.prevStatInfo,{totalRoundTripTime:t,responsesReceived:n})}})),t.forEach((function(t){var n=t.id,o=t.type;if("local-candidate"===o&&n===r.localCandidateId){var s=t.ip,u=t.port,d=t.networkType;r.localCA&&r.localCA.ip===s&&r.localCA.port===u&&r.localCA.networkType===d||(r.localCA={ip:s,port:u,networkType:d},De("RELCA"+",".concat(s)+",".concat(u)+",".concat(d)))}else if("remote-candidate"===t.type&&n===r.remoteCandidateId){var c=t.ip,h=t.port;r.remoteCA&&r.remoteCA.ip===c&&r.remoteCA.port===h||(r.remoteCA={ip:c,port:h},De("RERCA"+",".concat(c)+",".concat(h)))}else if("inbound-rtp"===o){var l=t.totalAudioEnergy,p=t.timestamp,f=t.jitterBufferDelay,m=t.jitterBufferEmittedCount,g=t.ssrc,v=t.jitter,S=t.audioLevel,_=t.packetsLost,C=t.packetsReceived,y=t.bytesReceived;r.ssrcMap||(r.ssrcMap={});var b=r.ssrcMap[g];if(b){var A=e.ssrcUserIdMap.get(g);if(A){a=!0;var k=Math.sqrt((l-b.totalAudioEnergy)/(p-b.timestamp)).toFixed(4),E=-1;"number"==typeof S&&(E=S.toFixed(4));var I=Math.floor(1e3*(m===b.jitterBufferEmittedCount?0:(f-b.jitterBufferDelay)/(m-b.jitterBufferEmittedCount)));i.ssrcMap["".concat(g,"-").concat(A)]=Object.assign(i.ssrcMap["".concat(g,"-").concat(A)]||{},{aveAudioLevel:k<1e-4?0:k,audioLevel:E<1e-4?0:E,aveJitterBufferDelay:I,jitter:v,packetsLost:_-b.packetsLost,packetsReceived:Math.floor((C-b.packetsReceived)/(p-b.timestamp)*1e3),bytesReceived:Math.floor((y-b.bytesReceived)/(p-b.timestamp)*1e3)})}}else b=r.ssrcMap[g]={};e.isUserMuted(g)||!e.ssrcUserIdMap.has(g)?r.ssrcMap[g]=null:Object.assign(b,{totalAudioEnergy:l,timestamp:p,jitterBufferDelay:f,jitterBufferEmittedCount:m,packetsLost:_,packetsReceived:C,bytesReceived:y})}})),a&&Te(i)}}))}),this.monitorTimerDuration)}},{key:"stopAudioQualityMonitorTimer",value:function(){this.monitorTimer&&(clearInterval(this.monitorTimer),this.monitorTimer=null,this.monitorInfo={subscriber:{},publisher:{}})}},{key:"publishStream",value:function(e){var t=this;return this.setAudioStream(e),new Promise((function(e,r){t.published?e(!0):t.publish().then((function(){e(!1)}))}))}},{key:"stopAVSyncTimer",value:function(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}},{key:"syncSingleView",value:function(e,t){var r=0;if(t){var i=parseInt(t).toString(2),a=i.substring(0,32),n=i.substring(32,64);r=1e3*(a=parseInt(a,2))+232.8*(n=parseInt(n,2))/1e9}Re?Object(v.Notify_Video_Decode_Thread)({command:"audioDecodeTime",status:0,data:r}):e?S.a.mediaSDKHandle.SharingRenderObj&&S.a.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(r):S.a.CurrentSSRCTime!=r&&(S.a.CurrentSSRCTime=r,S.a.audioPlayTime=Date.now())}},{key:"startAVSyncTimer",value:function(){var e=this;this.stopAVSyncTimer(),this.syncTimer=setInterval((function(){if(e.subscriber){var t=0;e.subscriber.getReceivers().forEach((function(r){r.getSynchronizationSources().forEach((function(r){t++;var i=e.ssrcUserIdMap.get(r.source),a=null,n=!1;if((a=e.shareAudioMap.get(i>>10))&&a.abssrc===r.source?n=!0:a=e.normalAudioMap.get(i>>10),a){var o=a.ntptime,s=a.rtptime,u=o+(r.rtpTimestamp-s)*Math.pow(2,32)/48e3;e.isMultiView||i>>10!=S.a.CurrentSSRC>>10&&!n||r.source===a.abssrc&&e.syncSingleView(n,u)}}))})),0===t&&(e.syncSingleView(!1,0),e.syncSingleView(!0,0))}}),500)}}]),e}();function Ve(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function Ne(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.onOffer,this.isRtcConnected=!1,this.isDestroyed=!1,this.isJoinAudio=t,this.leaveTime=0,this.onopen=function(e){this._onopen=e},this.onclose=function(e){this._onclose=e},this.onerror=function(e){this._onerror=e},this.init=function(e){var t=this;this.socket=window.audioBridgeSignal=new WebSocket(e),this._notifyhandlers={},this.socket.addEventListener("open",(function(){De("WSO"),t.isJoinAudio&&t.notify("audiostatus",{status:1}),t._onopen&&t._onopen()})),this.socket.addEventListener("error",(function(e){k.a.error("Audio Bridge WebSocket received error",e),De("WSE"),t._onerror&&t._onerror(!t.isDestroyed&&!t.isJoinAudio&&Date.now()-t.leaveTime>=15e3?e||!0:null),t.isDestroyed||(t.isJoinAudio||Date.now()-t.leaveTime<15e3)&&S.a.Notify_APPUI&&S.a.Notify_APPUI(C.qc)})),this.socket.addEventListener("close",(function(e){k.a.error("Audio Bridge WebSocket close",e),De("WSC"),t._onclose&&t._onclose(!t.isDestroyed&&!t.isJoinAudio&&Date.now()-t.leaveTime>=15e3?e||!0:null),t.isDestroyed||(t.isJoinAudio||Date.now()-t.leaveTime<15e3)&&S.a.Notify_APPUI&&S.a.Notify_APPUI(C.qc)})),this.socket.addEventListener("message",function(){var e=u()(g.a.mark((function e(r){var i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("close"!==r.data){e.next=3;break}return S.a.Notify_APPUI&&S.a.Notify_APPUI(C.qc),e.abrupt("return");case 3:"offer"===(i=JSON.parse(r.data)).method?t.onOffer&&t.onOffer(i.params):"trickle"===i.method?t.onTrickle&&t.onTrickle(i.params.candidate,i.params.role):"rtcpsr"===i.method?t.UpdateNTP(i.params.ntptime,i.params.rtptime,i.params.ssrc,i.params.abssrc):(a=t._notifyhandlers[i.method])&&a(i.params);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},this.on_notify=function(e,t){this._notifyhandlers[e]=t},this.notify=function(e,t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify({method:e,params:t})):console.error("websocket is not open",this.socket.readyState)},this.call=function(){var e=u()(g.a.mark((function e(t,r){var i,a=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Ve(),!this.socket||this.socket.readyState!==WebSocket.OPEN){e.next=5;break}this.socket.send(JSON.stringify({method:t,params:r,id:i})),e.next=7;break;case 5:return console.error("audio bridge:::: websocket is not open",this.socket.readyState),e.abrupt("return");case 7:return e.abrupt("return",new Promise((function(e,t){a.socket.addEventListener("message",(function t(r){var n=JSON.parse(r.data);n.id===i&&(n.error?e(n):e(n.result),a.socket.removeEventListener("message",t))}))})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),this.destroy=function(){e.socket&&e.socket.close&&e.socket.close()}}function Le(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return We(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return We(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var Ue=11,Be=function(){function e(){l()(this,e)}var t,r;return f()(e,null,[{key:"init",value:(r=u()(g.a.mark((function e(t,r){var i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.hid&&window.navigator.hid.requestDevice){e.next=2;break}return e.abrupt("return",!1);case 2:return i=this.webHid=new Fe((function(e){switch(e.eventName){case"ondevicehookswitch":S.a.Notify_APPUI_SAFE(C.Mb,"on"===e.hookStatus);break;case"ondevicemuteswitch":S.a.Notify_APPUI_SAFE(C.Lb,e.isMute)}})),e.next=5,i.open({label:t,muted:r,hookStatus:"off"});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"sendReport",value:function(e,t){switch(e){case"hookswitch":this.webHid.sendDeviceReport({command:t?"offHook":"onHook"});break;case"mute":this.webHid.sendDeviceReport({command:t?"muteOn":"muteOff"})}}},{key:"destroy",value:(t=u()(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webHid.close();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Fe=function(){function e(t){l()(this,e),this.deviceUsage={mute:{usageId:524297,usageName:"Mute"},offHook:{usageId:524311,usageName:"Off Hook"},ring:{usageId:524312,usageName:"Ring"},hookSwitch:{usageId:720928,usageName:"Hook Switch"},phoneMute:{usageId:720943,usageName:"Phone Mute"}},this.deviceCommand={outputReport:{mute:{reportId:0,usageOffset:-1},offHook:{reportId:0,usageOffset:-1},ring:{reportId:0,itemIndex:-1}},inputReport:{hookSwitch:{reportId:0,usageOffset:-1,isAbsolute:!1},phoneMute:{reportId:0,usageOffset:-1,isAbsolute:!1}}},this.device=null,this.inputReportRetFunc=t}var t,r,i,a;return f()(e,[{key:"getHexByte",value:function(e){for(var t=Number(e).toString(16);t.length<2;)t="0"+t;return t}},{key:"getHexByteStr",value:function(e){for(var t="",r=0;r<e.byteLength;++r)t+=this.getHexByte(e.getUint8(r))+" ";return t}},{key:"parseDeviceDescriptors",value:function(){try{if(this.outputEventGenerators=new Map,!this.device||!this.device.collections)return;var e=this.device.collections.find((function(e){return e.usagePage===Ue}));if(!e||0===Object.keys(e).length)return;if(e.inputReports&&!this.parseInputReports(e.inputReports))return!1;if(e.outputReports)return!!this.parseOutputReports(e.outputReports)}catch(e){console.error("parseDeviceDescriptors error:"+JSON.stringify(e,null,"    "))}}},{key:"parseInputReports",value:function(e){var t=this;return e.forEach((function(e){if(e.items.length&&void 0!==e.reportId){var r=0;e.items.forEach((function(i){void 0!==i.usages&&void 0!==i.reportSize&&void 0!==i.reportCount&&void 0!==i.isAbsolute&&(i.usages.forEach((function(a,n){switch(a){case t.deviceUsage.hookSwitch.usageId:t.deviceCommand.inputReport.hookSwitch={reportId:e.reportId,usageOffset:r+n*i.reportSize,isAbsolute:i.isAbsolute};break;case t.deviceUsage.phoneMute.usageId:t.deviceCommand.inputReport.phoneMute={reportId:e.reportId,usageOffset:r+n*i.reportSize,isAbsolute:i.isAbsolute}}})),r+=i.reportCount*i.reportSize)}))}})),0!==this.deviceCommand.inputReport.phoneMute.reportData&&0!==this.deviceCommand.inputReport.hookSwitch}},{key:"parseOutputReports",value:function(e){var t,r,i,a=this;for(var n in e.forEach((function(e){if(e.items.length&&void 0!==e.reportId){var t=0,r=new Map;e.items.forEach((function(i){void 0!==i.usages&&void 0!==i.reportSize&&void 0!==i.reportCount&&(i.usages.forEach((function(n,o){switch(n){case a.deviceUsage.mute.usageId:a.deviceCommand.outputReport.mute={reportId:e.reportId,usageOffset:t+o*i.reportSize},r.set(n,t+o*i.reportSize);break;case a.deviceUsage.offHook.usageId:a.deviceCommand.outputReport.offHook={reportId:e.reportId,usageOffset:t+o*i.reportSize},r.set(n,t+o*i.reportSize);break;case a.deviceUsage.ring.usageId:a.deviceCommand.outputReport.ring={reportId:e.reportId,usageOffset:t+o*i.reportSize},r.set(n,t+o*i.reportSize)}})),t+=i.reportCount*i.reportSize)}));var i,n=t,o=Le(r);try{var s=function(){var e=G()(i.value,2),t=e[0],r=e[1];a.outputEventGenerators[t]=function(e){var t=new Uint8Array(n/8);if(r>=0&&e){var i=Math.trunc(r/8),a=r%8;t[i]=1<<a}return t}};for(o.s();!(i=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}}})),this.outputEventGenerators){var o=this.getHexByte(n);o="0x0"+o,this.deviceUsage.mute.usageId===Number(o)?t=this.outputEventGenerators[this.deviceUsage.mute.usageId]:this.deviceUsage.offHook.usageId===Number(o)?i=this.outputEventGenerators[this.deviceUsage.offHook.usageId]:this.deviceUsage.ring.usageId===Number(o)&&(r=this.outputEventGenerators[this.deviceUsage.ring.usageId])}return!!(t||r||i)}},{key:"open",value:(a=u()(g.a.mark((function e(t){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.hid.getDevices();case 2:if((r=e.sent).length&&(this.device=r.find((function(e){return t.label.includes(e.productName)}))),this.device){e.next=9;break}return e.next=7,navigator.hid.requestDevice({filters:[{usagePage:Ue}]});case 7:(i=e.sent).length&&(this.device=i[0]);case 9:if(this.device){e.next=11;break}return e.abrupt("return",!1);case 11:if(e.prev=11,!this.device.opened){e.next=15;break}return e.next=15,this.device.close();case 15:return e.next=17,this.device.open();case 17:if(this.parseDeviceDescriptors()){e.next=19;break}return e.abrupt("return",!1);case 19:return e.next=21,this.handleInputReport.bind(this);case 21:return this.device.oninputreport=e.sent,this.resetState({muted:t.muted,hookStatus:t.hookStatus}),e.abrupt("return",!0);case 26:e.prev=26,e.t0=e.catch(11),console.error("error content:"+e.t0);case 29:case"end":return e.stop()}}),e,this,[[11,26]])}))),function(e){return a.apply(this,arguments)})},{key:"close",value:(i=u()(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.resetState({muted:!1,hookStatus:"on"}),this.device){e.next=4;break}return e.abrupt("return");case 4:if(!this.device||!this.device.opened){e.next=7;break}return e.next=7,this.device.close();case 7:this.device.oninputreport=null,this.device=null,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(){return i.apply(this,arguments)})},{key:"resetState",value:function(e){var t=e.muted,r=e.hookStatus;this.device&&this.device.opened&&(this.device.hookStatus=r,this.device.muted=t,this.device.ring=!1,this.sendDeviceReport({command:"off"===r?"offHook":"onHook"}),this.sendDeviceReport({command:t?"muteOn":"muteOff"}))}},{key:"sendDeviceReport",value:(r=u()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,h,l,p,f,m,v,S,_,C,y,b,A,k,E,I,w,M;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.command&&this.device&&this.device.opened){e.next=2;break}return e.abrupt("return");case 2:if("muteOn"!==t.command&&"muteOff"!==t.command){e.next=7;break}if(this.outputEventGenerators[this.deviceUsage.mute.usageId]){e.next=5;break}return e.abrupt("return");case 5:e.next=15;break;case 7:if("onHook"!==t.command&&"offHook"!==t.command){e.next=12;break}if(this.outputEventGenerators[this.deviceUsage.offHook.usageId]){e.next=10;break}return e.abrupt("return");case 10:e.next=15;break;case 12:if("onRing"!==t.command&&"offRing"!==t.command){e.next=15;break}if(this.outputEventGenerators[this.deviceUsage.ring.usageId]){e.next=15;break}return e.abrupt("return");case 15:r=0,l=null,e.t0=t.command,e.next="muteOn"===e.t0||"muteOff"===e.t0?20:"onHook"===e.t0||"offHook"===e.t0?22:"onRing"===e.t0||"offRing"===e.t0?24:26;break;case 20:return r=this.deviceCommand.outputReport.mute.reportId,e.abrupt("break",27);case 22:return r=this.deviceCommand.outputReport.offHook.reportId,e.abrupt("break",27);case 24:return r=this.deviceCommand.outputReport.ring.reportId,e.abrupt("break",27);case 26:return e.abrupt("return");case 27:if(0!=r){e.next=29;break}return e.abrupt("return");case 29:if(a=this.device.muted,"off"!==this.device.hookStatus){e.next=34;break}i=!0,e.next=39;break;case 34:if("on"!==this.device.hookStatus){e.next=38;break}i=!1,e.next=39;break;case 38:return e.abrupt("return");case 39:n=this.device.ring,e.t1=t.command,e.next="muteOn"===e.t1?43:"muteOff"===e.t1?45:"onHook"===e.t1?47:"offHook"===e.t1?49:"onRing"===e.t1?51:"offRing"===e.t1?53:55;break;case 43:return s=!0,e.abrupt("break",56);case 45:return s=!1,e.abrupt("break",56);case 47:return o=!1,e.abrupt("break",56);case 49:return o=!0,e.abrupt("break",56);case 51:return u=!0,e.abrupt("break",56);case 53:return u=!1,e.abrupt("break",56);case 55:return e.abrupt("return");case 56:if(this.outputEventGenerators[this.deviceUsage.mute.usageId]&&(c=void 0===s?this.outputEventGenerators[this.deviceUsage.mute.usageId](a):this.outputEventGenerators[this.deviceUsage.mute.usageId](s)),this.outputEventGenerators[this.deviceUsage.offHook.usageId]&&(d=void 0===o?this.outputEventGenerators[this.deviceUsage.offHook.usageId](i):this.outputEventGenerators[this.deviceUsage.offHook.usageId](o)),this.outputEventGenerators[this.deviceUsage.ring.usageId]&&(h=void 0===u?this.outputEventGenerators[this.deviceUsage.ring.usageId](n):this.outputEventGenerators[this.deviceUsage.ring.usageId](u)),r===this.deviceCommand.outputReport.mute.reportId)if(null===l)l=new Uint8Array(c);else{p=Le(c.entries());try{for(p.s();!(f=p.n()).done;)m=G()(f.value,2),v=m[0],S=m[1],l[v]|=S}catch(e){p.e(e)}finally{p.f()}}if(r===this.deviceCommand.outputReport.offHook.reportId)if(null===l)l=new Uint8Array(d);else{_=Le(d.entries());try{for(_.s();!(C=_.n()).done;)y=G()(C.value,2),b=y[0],A=y[1],l[b]|=A}catch(e){_.e(e)}finally{_.f()}}if(r===this.deviceCommand.outputReport.ring.reportId)if(null===l)l=new Uint8Array(h);else{k=Le(h.entries());try{for(k.s();!(E=k.n()).done;)I=G()(E.value,2),w=I[0],M=I[1],l[w]|=M}catch(e){k.e(e)}finally{k.f()}}return e.next=64,this.device.sendReport(r,l);case 64:e.t2=t.command,e.next="muteOn"===e.t2?67:"muteOff"===e.t2?69:"onHook"===e.t2?71:"offHook"===e.t2?73:"onRing"===e.t2?75:"offRing"===e.t2?77:79;break;case 67:return this.device.muted=!0,e.abrupt("break",80);case 69:return this.device.muted=!1,e.abrupt("break",80);case 71:return this.device.hookStatus="on",e.abrupt("break",80);case 73:return this.device.hookStatus="off",e.abrupt("break",80);case 75:return this.device.ring=!0,e.abrupt("break",80);case 77:return this.device.ring=!1,e.abrupt("break",80);case 79:return e.abrupt("break",80);case 80:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"sendReplyReport",value:(t=u()(g.a.mark((function e(t,r,i){var a,n,o,s,u,d,c,h,l,p;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=0,this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId||t===this.deviceCommand.inputReport.hookSwitch.reportId?a=this.deviceCommand.outputReport.offHook.reportId:t===this.deviceCommand.inputReport.phoneMute.reportId&&(a=this.deviceCommand.outputReport.mute.reportId),this.device&&this.device.opened){e.next=4;break}return e.abrupt("return");case 4:if(0!==a&&void 0!==r&&void 0!==i){e.next=6;break}return e.abrupt("return");case 6:if(this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId){o=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),s=this.outputEventGenerators[this.deviceUsage.offHook.usageId](r),n=new Uint8Array(s),d=Le(o.entries());try{for(d.s();!(c=d.n()).done;)h=G()(c.value,2),l=h[0],p=h[1],n[l]|=p}catch(e){d.e(e)}finally{d.f()}}else a===this.deviceCommand.outputReport.offHook.reportId?(s=this.outputEventGenerators[this.deviceUsage.offHook.usageId](r),n=new Uint8Array(s)):a===this.deviceCommand.outputReport.mute.reportId?(o=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),n=new Uint8Array(o)):a===this.deviceCommand.outputReport.ring.reportId&&(u=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),n=new Uint8Array(u));return e.next=9,this.device.sendReport(a,n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,r,i){return t.apply(this,arguments)})},{key:"handleInputReport",value:function(e){try{var t=e.data,r=e.device,i=e.reportId;if(0===i)return;var a=this.deviceCommand.inputReport;if(i!==a.hookSwitch.reportId&&i!==a.phoneMute.reportId)return;var n=!1,o=!1,s=new Uint8Array(t.buffer);if(i===a.hookSwitch.reportId){var u=a.hookSwitch,d=Math.trunc(u.usageOffset/8),c=u.usageOffset%8,h=0!=(t.getUint8(d)&1<<c);a.hookSwitch.isAbsolute?"on"===this.device.hookStatus&&h?(this.device.hookStatus="off",n=!0):"off"!==this.device.hookStatus||h||(this.device.hookStatus="on",n=!0):h&&(this.device.hookStatus="off"===this.device.hookStatus?"on":"off",n=!0)}this.device.muted;if(i===a.phoneMute.reportId){var l=a.phoneMute,p=Math.trunc(l.usageOffset/8),f=l.usageOffset%8,m=0!=(t.getUint8(p)&1<<f);a.phoneMute.isAbsolute?this.device.muted!=m&&(this.device.muted=m,o=!0):m&&(this.device.muted=!this.device.muted,o=!0)}var g={productName:r.productName,reportId:this.getHexByte(i),reportData:s};if(n&&(g.eventName="ondevicehookswitch",g.hookStatus=this.device.hookStatus),o&&(g.eventName="ondevicemuteswitch",g.isMute=this.device.muted),this.inputReportRetFunc&&this.inputReportRetFunc(g),n||o){var v;if("off"===this.device.hookStatus)v=!0;else{if("on"!==this.device.hookStatus)return;v=!1}this.sendReplyReport(i,v,this.device.muted)}}catch(e){console.error(e)}}}]),e}();function Ge(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return He(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}var Ke=function(){function e(t){l()(this,e),this.options=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({analyserFrequent:50},t||{}),this.asnTime=performance.now(),this.audioStream=null,this.analyserNodeBufferDataArray=null,this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.destinationNode=new MediaStreamAudioDestinationNode(this.audioCtx),this.initAnalyserNode()}return f()(e,[{key:"initAnalyserNode",value:function(){this.analyserNode=this.audioCtx.createAnalyser(),this.analyserNode.connect(this.destinationNode),this.analyserNode.fftSize=1024}},{key:"setAudioStream",value:function(e){this.audioStream=e}},{key:"start",value:function(){var e=this;return this.getAnalyzingStatus()&&this.stop(),this.getDestroyedStatus()?Promise.reject(new Error("instance is destroyed already")):new Promise((function(t){e.setAnalyzingStatus(!0),e.sourceNode=e.audioCtx.createMediaStreamSource(e.audioStream),e.sourceNode.connect(e.analyserNode),e.resumeAudioCtx(),e.setAnalyzeInterval(),t(!0)}))}},{key:"stop",value:function(){this.setAnalyzingStatus(!1),this.clearAnalyzeInterval()}},{key:"destroy",value:function(){var e=this;this.stop(),this.analyserNode.disconnect(this.destinationNode),this.setDestroyedStatus(!0),this.audioCtx.suspend().finally((function(){return e.audioCtx.close()})),this.audioStream=null,this.analyserNodeBufferDataArray=null}},{key:"analyserNodeIntervalCallback",value:function(){if(this.analyserNodeBufferDataArray){this.analyserNode.getByteFrequencyData(this.analyserNodeBufferDataArray);var e,t=0,r=Ge(this.analyserNodeBufferDataArray);try{for(r.s();!(e=r.n()).done;){t+=e.value}}catch(e){r.e(e)}finally{r.f()}var i=t/this.analyserNodeBufferDataArray.length;if(i>0){var a=performance.now();a-this.asnTime>1e3&&(this.asnTime=a,this.options.analyserCallback(i))}}}},{key:"setAnalyzeInterval",value:function(){this.clearAnalyzeInterval();var e=this.analyserNode.frequencyBinCount;this.analyserNodeBufferDataArray=new Uint8Array(e),this.analyserNodeTimer=window.setInterval(this.analyserNodeIntervalCallback.bind(this),this.options.analyserFrequent)}},{key:"clearAnalyzeInterval",value:function(){this.analyserNodeTimer&&(window.clearInterval(this.analyserNodeTimer),this.analyserNodeTimer=null,this.analyserNodeBufferDataArray=null)}},{key:"getAnalyzingStatus",value:function(){return!!this.isAnalyzing}},{key:"setAnalyzingStatus",value:function(e){this.isAnalyzing=!!e}},{key:"getDestroyedStatus",value:function(){return!!this.isDestroyed}},{key:"setDestroyedStatus",value:function(e){this.isDestroyed=!!e}},{key:"resumeAudioCtx",value:function(){"running"!==this.audioCtx.state&&this.audioCtx.resume()}}]),e}(),qe=["headset","pods","buds","opencomm","arctis","mpow","hyperx cloud","zone wired","aeropex by aftershokz","plt focus","xiberia","pxc 550","tk-hs001","lifechat lx","cisco 56"],Qe=[["wh-","wf-","wi-"],["1000x","ch","xb","sp","h9","c2","c5","c6","c1","h8","c4","c3"]],ze={jabra:["evolve","pro 900","pro 920","pro 93","pro 94","talk","biz","engage","elite","uc voice","link 180","link 2","link 860","link 850","link 400","blueparrott"],plantronics:["savi","blackwire","c5","c3","c4","c6","c7","bt","audio","da","encorepro","hw111n","gamecom","apu","voyager"],logitech:["h570","h820","h650","pro x"],sennheiser:["sc","mb","pc","sd","dect","g4me1","audio"],sony:["wh","wf","mdr"],bose:["qc","quiet","soundlink","soundsport","on-ear","nc"],beats:["fit","flex","power","solo","studio","mivi"],razer:["kraken","blackshark","barracuda","nari","hammerhead","opus"],yealink:["uh","wh","yh","cp"],soundcore:["life","liberty","spirit","strike"],addasound:["sr","epic"],jbl:["tune","quantum","live","wave","t450bt","c200","everest","c310"],epos:["impact","pc 8 usb","h3","adapt"],jlab:["go","bt","epic","studio"]};var Je=function(e){if("string"!=typeof e)return console.error("should be string"),!1;for(var t=e.toLowerCase(),r=0;r<qe.length;r++){var i=qe[r];if(t.includes(i))return!0}for(var a=Object.keys(ze),n=0;n<a.length;n++){var o=a[n];if(t.includes(o))for(var s=ze[o],u=0;u<s.length;u++)if(t.includes(s[u]))return!0}for(var d=Qe[0],c=Qe[1],h=!1,l=0;l<d.length;l++)if(t.includes(d[l])){h=!0;break}if(h)for(var p=0;p<c.length;p++)if(t.includes(c[p]))return!0;return!1};function Xe(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ye(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ye(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Ze(e,t){var r;if(e.size!==t.size)return!1;var i,a=Xe(e);try{for(a.s();!(i=a.n()).done;){var n=G()(i.value,2),o=n[0],s=n[1];if((r=t.get(o))!==s||void 0===r&&!t.has(o))return!1}}catch(e){a.e(e)}finally{a.f()}return!0}function $e(){this.audioInputDeviceList=new Map,this.audioOutputDeviceList=new Map,this.videoInputDeviceList=new Map,this.micId=null,this.speakerId=null,this.cameraId=null,this.startTime=Date.now(),this.userId=0,this.videoWidth=0,this.videoHeight=0,this.isAudioBridge=!1,this.isUpdatingDevice=!1,this.denoiseSwitch=!1}$e.prototype.notifyDenoiseSetting=function(){if(A.g.isSupportAudioDenoise()&&this.micId&&!this.isAudioBridge){var e={command:"audio_denoise_switch",switch:this.denoiseSwitch,isHeadSet:et.isHeadSet()};v.Notify_Audio_Encode_Thread(e)}},$e.prototype.updateDeviceList=function(e){var t=this;this.isUpdatingDevice=!0;var r=new Map,i=new Map,a=new Map;navigator.mediaDevices.enumerateDevices().then((function(n){n.forEach((function(e){"audioinput"==e.kind?r.set(e.deviceId,e.label.replace(/\([\w,\d]+:[\w,\d]+\)/i,"").trim()):"audiooutput"==e.kind?i.set(e.deviceId,e.label.replace(/\([\w,\d]+:[\w,\d]+\)/i,"").trim()):"videoinput"==e.kind&&a.set(e.deviceId,e.label.replace(/\([\w,\d]+:[\w,\d]+\)/i,"").trim())})),t.isUpdatingDevice=!1,e||Ze(t.audioInputDeviceList,r)||!r.has(t.micId)||(t.audioInputDeviceList=r,t.notifyDenoiseSetting(),t.sendMicDevice(0,!0)),e||Ze(t.audioOutputDeviceList,i)||!i.has(t.speakerId)||(t.audioOutputDeviceList=i,t.sendSpeakerDevice(0,!0)),e||Ze(t.videoInputDeviceList,a)||!a.has(t.cameraId)||(t.videoInputDeviceList=a,t.sendCameraInfo(0,!0,-1,-1,15,-1)),t.audioInputDeviceList=r,t.audioOutputDeviceList=i,t.videoInputDeviceList=a,t.sendAllDevice()}))},$e.prototype.changeDenoiseSwitch=function(e){this.denoiseSwitch=e,this.notifyDenoiseSetting()},$e.prototype.setIsAudioBridge=function(e){this.isAudioBridge=e},$e.prototype.setUserId=function(e){"number"!=typeof e||Number.isNaN(e)||(this.userId=e)},$e.prototype.setMicId=function(e){if(e){if(e!=this.micId)return this.micId=e,this.isUpdatingDevice||this.notifyDenoiseSetting(),!0}else this.micId="default";return!1},$e.prototype.setSpeakerId=function(e){this.speakerId=e&&""!=e?e:"default"},$e.prototype.setVideoResolution=function(e,t){this.videoWidth=e,this.videoHeight=t},$e.prototype.setCameraId=function(e){this.cameraId=e||"default"},$e.prototype.getMicLabel=function(){return this.audioInputDeviceList.get(this.micId)||"default"},$e.prototype.getSpeakerLabel=function(){return this.audioOutputDeviceList.get(this.speakerId)||"default"},$e.prototype.getCameraLabel=function(){return this.videoInputDeviceList.get(this.cameraId)||"default"},$e.prototype.isHeadSet=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=null;return t=e?this.getMicLabel():this.getSpeakerLabel(),Je(t)},$e.prototype.getIndex=function(e){return"default"==e?-1:"communications"==e?A.g.isMac()?0:-2:0},$e.prototype.sendAllDevice=function(){var e=this;this.isUpdatingDevice||(this.audioInputDeviceList.forEach((function(t,r){e.sendDeviceInfo(-1,1,e.getIndex(t),t,r,!0)})),this.audioOutputDeviceList.forEach((function(t,r){e.sendDeviceInfo(-1,0,e.getIndex(t),t,r,!0)})))},$e.prototype.sendMicDevice=function(e,t){this.isUpdatingDevice||this.sendDeviceInfo(e,1,this.getIndex(this.micId),this.micId,this.getMicLabel(),t,this.isHeadSet())},$e.prototype.sendSpeakerDevice=function(e,t){this.isUpdatingDevice||this.sendDeviceInfo(e,0,this.getIndex(this.speakerId),this.speakerId,this.getSpeakerLabel(),t,this.isHeadSet(!1))},$e.prototype.sendDeviceInfo=function(e,t,r,i,a,n,o){if(this.userId){var s=null,u=Date.now()-this.startTime;s=-1==e?"WCL_AUDIOD-ALL,"+this.userId+","+t+","+r+","+a+","+i+","+n+","+e+",7,"+u+",1":"WCL_AUDIOD,"+this.userId+","+t+","+r+","+a+","+i+","+n+","+e+",7,"+u+",1,"+(n?1:0)+","+o,S.a.sendMessageToRwg(C.gc,{evt:4167,seq:1,body:{data:s}})}},$e.prototype.sendCameraInfo=function(e,t,r,i,a,n){if(this.userId&&!this.isUpdatingDevice){var o;o="WCL_CAMERA,"+this.userId+",0,"+this.getCameraLabel()+","+t+","+e+","+r+","+this.videoWidth+","+this.videoHeight+","+i+","+a+","+n,S.a.sendMessageToRwg(C.gc,{evt:4167,seq:1,body:{data:o}})}};var et=new $e,tt=et;function rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var at=new(function(){function e(){l()(this,e),this._isReuseStreamEnabled=!1,this._isStreamInReuseMap=new Map,this.presetedConstraints={audioConstraints:null,videoConstraints:null,audioTimer:null,videoTimer:null},this._deprecatedStream={audio:[],video:[]},this.audioConstraints=null,this.audioStream=null,this.isCaptureAudioInProgress=!1,this.videoConstraints=null,this.videoStream=null,this.videoStreamTrack=null,this.captureVideoTimer=null,this.checkVideoStreamActiveTimer=null,this.isCaptureVideoInProgress=!1,this.currentVideoResolution={width:0,height:0},this.streamProcessAbility={isSupportMediaStreamTrackProcessor:A.g.isSupportMediaStreamTrackProcessor(),isSupportVideoTrackReader:A.g.isSupportVideoTrackReader(),isSupportImageCapture:A.g.isSupportImageCapture()},this.mediaStreamTrackProcessor=null,this.reableStream=null,this.videoTrackReader=null,this.videoImageCapture=null,this.videoImageCaptureLocked=!1,this.isAppleGraphic=!1}var t,r,i;return f()(e,[{key:"enableReuseStream",value:function(e){this._isReuseStreamEnabled=!!e}},{key:"_updateStreamInReuse",value:function(e,t){t?this._isStreamInReuseMap.set(e,!0):this._isStreamInReuseMap.delete(e)}},{key:"_isStreamInReuse",value:function(e){return!!this._isStreamInReuseMap.get(e)}},{key:"presetConstraints",value:function(e){var t=e.audioConstraints,r=e.videoConstraints;t&&(this.presetedConstraints.audioConstraints=this._getAudioConstraints(t)),r&&(this.presetedConstraints.videoConstraints=this._getVideoConstraints(r))}},{key:"_clearPresetConstraints",value:function(){this.presetedConstraints.audioConstraints=null,this.presetedConstraints.videoConstraints=null}},{key:"_getPresetAudioConstraints",value:function(){var e=this.presetedConstraints.audioConstraints;return this._clearPresetConstraints(),!(!e||this.audioStream||this.isCaptureAudioInProgress)&&e}},{key:"_getPresetVideoConstraints",value:function(){var e=this.presetedConstraints.videoConstraints;return this._clearPresetConstraints(),!(!e||this.videoStream||this.isCaptureVideoInProgress)&&e}},{key:"_pushDeprecatedStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audioStream,r=e.videoStream;t&&this._deprecatedStream.audio.push(t),r&&this._deprecatedStream.video.push(r)}},{key:"_destoryDeprecatedStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.audio,i=t.video;r&&(this._deprecatedStream.audio.forEach((function(t){try{e._destoryStream(t)}catch(e){}})),this._deprecatedStream.audio=[]),i&&(this._deprecatedStream.video.forEach((function(t){try{e._destoryStream(t)}catch(e){}})),this._deprecatedStream.video=[])}},{key:"setStreamProcessAbility",value:function(e){var t=e.isSupportMediaStreamTrackProcessor,r=e.isSupportVideoTrackReader,i=e.isSupportImageCapture;this.streamProcessAbility=it(it(it(it({},this.streamProcessAbility),void 0!==t?{isSupportMediaStreamTrackProcessor:t}:{}),void 0!==r?{isSupportVideoTrackReader:r}:{}),void 0!==i?{isSupportImageCapture:i}:{})}},{key:"_isFileInputAudioSource",value:function(e){return e&&(e.audio instanceof HTMLVideoElement||e.audio instanceof HTMLAudioElement)}},{key:"_getAudioConstraints",value:function(e){var t=e.audioSource,r=e.isSupportBrowserAec,i=e.disableAudioAGC,a=e.disableNoiseSuppression;if(t instanceof HTMLVideoElement||t instanceof HTMLAudioElement)return{audio:t};return r&&!A.g.isGoogleNestChrome()?{deviceId:t?{exact:t}:void 0,autoGainControl:!i,noiseSuppression:!a,latency:0,echoCancellation:!0}:{deviceId:t?{exact:t}:void 0,autoGainControl:!i,noiseSuppression:!a,latency:0,echoCancellation:r}}},{key:"_isSameAudioConstraintsAsPrev",value:function(e){return!this._isFileInputAudioSource(e)&&(!(!this.audioConstraints||!Object(A.f)(this.audioConstraints,e))&&(!!this.audioStream&&!!this._isStreamHasAudio(this.audioStream)))}},{key:"_destoryStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.audioOnly,i=t.videoOnly;if(e&&!A.g.audioToMediaStreamMananger.isAudioFileStream(e)){(r?e.getAudioTracks():i?e.getVideoTracks():e.getTracks()).forEach((function(e){e.stop()}))}}},{key:"_isStreamHasAudio",value:function(e){var t=e.getAudioTracks();return t&&t.length>0}},{key:"_isStreamHasVideo",value:function(e){var t=e.getVideoTracks();return t&&t.length>0}},{key:"destoryAudioMediaStream",value:function(){this.audioStream?(this._isFileInputAudioSource(this.audioConstraints)&&A.g.audioToMediaStreamMananger.stopCapture(),this._isReuseStreamEnabled?this._updateStreamInReuse(this.audioStream,!0):(this._updateStreamInReuse(this.audioStream,!1),this._destoryStream(this.audioStream),this.audioStream=null,this.audioConstraints=null,this._destoryDeprecatedStream({audio:!0}))):this._destoryDeprecatedStream({audio:!0}),this.enableReuseStream(!1)}},{key:"shouldCaptureAudio",value:function(){return!this.audioStream||this._isStreamInReuse(this.audioStream)}},{key:"muteUnmuteAudioMediaStream",value:function(e){this.audioStream&&(this.audioStream.getAudioTracks()||[]).forEach((function(t){t.enabled=!e}))}},{key:"_storeAudioStream",value:function(e,t,r){e&&(nt("audio stream is ok"),this.destoryAudioMediaStream(),this.audioStream=e,this.audioConstraints=t,r&&this._setPresetAudioStreamAutoStopTimer())}},{key:"_setPresetAudioStreamAutoStopTimer",value:function(){var e=this;this._clearPresetAudioStreamAutoStopTimer(),this.presetedConstraints.audioTimer=setTimeout((function(){e.destoryAudioMediaStream()}),1e4)}},{key:"_clearPresetAudioStreamAutoStopTimer",value:function(){this.presetedConstraints.audioTimer&&(clearTimeout(this.presetedConstraints.audioTimer),this.presetedConstraints.audioTimer=null)}},{key:"_handleAudioCaptureSuccess",value:function(e,t,r,i){this._clearPresetAudioStreamAutoStopTimer(),i||this._storeAudioStream(e,t),this._updateStreamInReuse(e,!1);var a=e.getAudioTracks()[0];a?(_.a.add_monitor("TRS:"+a.readyState),_.a.add_monitor("TMS:"+a.muted),a.onended=function(){_.a.add_monitor("TRS:"+a.readyState)},a.onmute=function(){_.a.add_monitor("TMS:"+a.muted)},a.onunmute=function(){_.a.add_monitor("TMS:"+a.muted)}):_.a.add_monitor("TN"),r(e)}},{key:"_genAudioStream",value:function(e){try{var t=e.getAudioTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return console.warn(t),this._destoryStream(e,{videoOnly:!0}),e}}},{key:"_genVideoStream",value:function(e){try{var t=e.getVideoTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return console.warn(t),this._destoryStream(e,{audioOnly:!0}),e}}},{key:"_splitAudioStream",value:function(e,t,r,i){var a=t.audio,n=t.video;if(n&&this._isStreamHasVideo(e)){var o=this._genAudioStream(e),s=this._genVideoStream(e);return o?this._handleAudioCaptureSuccess(o,a,r):i(new Error("audio stream do not contains audio track ")),void(s&&(this.videoStream?this._pushDeprecatedStream({videoStream:s}):(this._updateStreamInReuse(s,!0),this._storeVideoStream(s,n,!0))))}this._handleAudioCaptureSuccess(e,a,r)}},{key:"_captureFileInputAudioStream",value:(i=u()(g.a.mark((function e(t){var r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.audio,e.prev=1,e.next=4,new Promise((function(e,t){r.currentTime>0&&!r.paused&&!r.ended&&e(!0),r.addEventListener("timeupdate",(function t(){e(!0),r.removeEventListener("timeupdate",t)})),setTimeout((function(){return t(!1)}),1e4)}));case 4:if(e.sent){e.next=7;break}throw new Error("audio file playing failed");case 7:return i=A.g.audioToMediaStreamMananger.startCapture(r),e.abrupt("return",i);case 11:throw e.prev=11,e.t0=e.catch(1),console.error(e.t0),(a=new Error("capture stream from file input souce failed")).name="FileInputSouceError",a;case 17:case"end":return e.stop()}}),e,null,[[1,11]])}))),function(e){return i.apply(this,arguments)})},{key:"startCaptureAudio",value:function(e){var t=this,r=e.audioConstraints,i=e.successHandler,a=e.errorHandler;this.enableReuseStream(!1);var n=!!r&&this._getAudioConstraints(r),o=this._isFileInputAudioSource(n),s=this._isSameAudioConstraintsAsPrev(n),u=this._getPresetVideoConstraints();if(this._clearPresetAudioStreamAutoStopTimer(),s){var d=this.audioStream.getAudioTracks()[0].getSettings();return tt.setMicId(d.deviceId),tt.sendMicDevice(0,!0),void this._handleAudioCaptureSuccess(this.audioStream,n,i,!0)}this.destoryAudioMediaStream();var c={audio:n,video:o?null:u};this.isCaptureAudioInProgress=!0;var h=Date.now();(o?this._captureFileInputAudioStream(n):navigator.mediaDevices.getUserMedia(c)).then((function(e){if(!o){var r=e.getAudioTracks()[0].getSettings();tt.setMicId(r.deviceId),tt.sendMicDevice(Date.now()-h,!0)}t._splitAudioStream(e,c,i,a)})).catch((function(e){o||tt.sendMicDevice(Date.now()-h,!1),a(e)})).finally((function(){t.isCaptureAudioInProgress=!1}))}},{key:"_isFileInputVideoSource",value:function(e){return e&&e.video instanceof HTMLVideoElement}},{key:"isUsingFileInputVideoSource",value:function(){return this._isFileInputVideoSource(this.videoConstraints)}},{key:"_getFileInputSourceSize",value:function(e,t){var r=[90,180,360,720];return t||(t=360),t>720&&(t=720),t<90&&(t=90),-1===r.indexOf(t)&&r.some((function(e,i){return e>t&&(t=(e+r[i-1])/2<t?e:r[i-1],!0)})),{width:16/9*t,height:t}}},{key:"_getVideoConstraints",value:function(e){var t=e.videoSource,r=e.usingFacingMode,i=e.width,a=e.height,n=e.pan,o=e.tilt,s=e.zoom,u=e.fps;if(t instanceof HTMLVideoElement)return it({video:t},i&&a?this._getFileInputSourceSize(i,a):{});var d=!1,c=u||H.q;c>H.i&&(c=H.i),c<H.j&&(c=H.q),navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4&&c>H.h&&(c=H.h);var h=c;if(this.videoCaptureValue&&(t=this.videoCaptureValue.VideoSelectValue),r)d=!t||{facingMode:{exact:t}};else if(A.g.browser.isSafari)d=!t||{deviceId:{exact:t}};else{var l=this.currentVideoResolution,p=l.width,f=l.height,m=0!=p&&0!=f;d={width:m?p:i||640,height:m?f:a||360,deviceId:t?{exact:t}:void 0,frameRate:h,pan:n,tilt:o,zoom:s},S.a.monitorVideoReadyCaptureWidth=d.width,S.a.monitorVideoReadyCaptureHeight=d.height}return d}},{key:"_updateVideoConstraints",value:function(e){return this.videoStreamTrack?this.videoStreamTrack.applyConstraints(e).catch((function(e){k.a.error("Applying video constraints failed",e)})):Promise.reject(new Error("video stream not exist! update video constraints failed"))}},{key:"changeVideoResolution",value:function(e,t,r){var i=this;return this.videoStreamTrack?(_.a.add_monitor("CCWidth"+e),this._updateVideoConstraints({width:e,height:t,frameRate:r}).then((function(){i.currentVideoResolution={width:e,height:t}}))):Promise.reject(new Error("video stream not exist! change video resolution failed"))}},{key:"_isSameVideoConstraintsAsPrev",value:function(e){return!this._isFileInputVideoSource(e)&&(!(!this.videoConstraints||!Object(A.f)(this.videoConstraints,e))&&(!!this.videoStream&&!!this._isStreamHasVideo(this.videoStream)))}},{key:"_clearCaptureVideoTimer",value:function(){this.captureVideoTimer&&(clearTimeout(this.captureVideoTimer),this.captureVideoTimer=null)}},{key:"destoryVideoMediaStream",value:function(){this.videoStream?(this._isFileInputVideoSource(this.videoConstraints)&&A.g.videoToMediaStreamManager.stopCapture(),this._isReuseStreamEnabled?this._updateStreamInReuse(this.videoStream,!0):(this._updateStreamInReuse(this.videoStream,!1),this._destoryStream(this.videoStream),this.videoStream=null,this.videoStreamTrack=null,this.videoConstraints=null,this._destoryDeprecatedStream({video:!0}))):this._destoryDeprecatedStream({video:!0}),this._isReuseStreamEnabled||this._clearCaptureVideoTimer(),this.enableReuseStream(!1),this.destoryVideoProcessor(),this._clearCheckVideoStreamActiveTimer()}},{key:"shouldCaptureVideo",value:function(){return!this.videoStream||this._isStreamInReuse(this.videoStream)}},{key:"_clearCheckVideoStreamActiveTimer",value:function(){this.checkVideoStreamActiveTimer&&(clearTimeout(this.checkVideoStreamActiveTimer),this.checkVideoStreamActiveTimer=null)}},{key:"checkVideoStreamActive",value:function(){var e=this;return new Promise((function(t,r){e._clearCheckVideoStreamActiveTimer(),e.checkVideoStreamActiveTimer=setTimeout((function(){e.videoStream?!1===e.videoStream.active?r(new E("VideoMediaStram.active equals false")):t(!0):r(!1)}),1e3)}))}},{key:"destoryVideoProcessor",value:function(){if(this.videoTrackReader){try{this.videoTrackReader.stop()}catch(e){}this.videoTrackReader=null}if(this.mediaStreamTrackProcessor){if(this.mediaStreamTrackProcessor=null,v.Notify_Video_Encode_Thread({command:"releaseStream"}),this.reableStream&&this.reableStream.close)try{this.reableStream.close()}catch(e){}this.reableStream=null}this.videoImageCapture=null,this.unLockImageCapture()}},{key:"lockImageCapture",value:function(){this.videoImageCaptureLocked=!0}},{key:"unLockImageCapture",value:function(){this.videoImageCaptureLocked=!1}},{key:"isImageCaptureLocked",value:function(){return this.videoImageCaptureLocked}},{key:"_createVideoProcessor",value:function(){this.videoStreamTrack?this.streamProcessAbility.isSupportMediaStreamTrackProcessor?(this.mediaStreamTrackProcessor=new MediaStreamTrackProcessor(this.videoStreamTrack),this.reableStream=this.mediaStreamTrackProcessor.readable,v.Notify_Video_Encode_Thread({command:"releaseStream"}),v.Notify_Video_Encode_Thread_Transferable_Data("frameStream",this.reableStream),_.a.add_monitor("VCTP")):this.streamProcessAbility.isSupportVideoTrackReader?(this.videoTrackReader=new VideoTrackReader(this.videoStreamTrack),_.a.add_monitor("VCTR")):this.streamProcessAbility.isSupportImageCapture&&(this.videoImageCapture=new ImageCapture(this.videoStreamTrack),_.a.add_monitor("VCIC")):k.a.error("Video stream track does not exist - cannot create video processor")}},{key:"_storeVideoStream",value:function(e,t,r){e&&(nt("video stream is ok"),this.destoryVideoMediaStream(),this.videoStream=e,this.videoStreamTrack=this.videoStream.getVideoTracks()[0],this.videoConstraints=t,r&&this._setPresetVideoStreamAutoStopTimer())}},{key:"_setPresetVideoStreamAutoStopTimer",value:function(){var e=this;this._clearPresetVideoStreamAutoStopTimer(),this.presetedConstraints.videoTimer=setTimeout((function(){e.destoryVideoMediaStream()}),1e4)}},{key:"_clearPresetVideoStreamAutoStopTimer",value:function(){this.presetedConstraints.videoTimer&&(clearTimeout(this.presetedConstraints.videoTimer),this.presetedConstraints.videoTimer=null)}},{key:"_handleVideoCaptureSuccess",value:function(e,t,r,i){this._clearPresetVideoStreamAutoStopTimer(),i||this._storeVideoStream(e,t),this._createVideoProcessor(),this._updateStreamInReuse(e,!1),r(e)}},{key:"getVideoCapabilities",value:function(){if(this.videoStream&&(this.videoStreamTrack||(this.videoStreamTrack=this.videoStream.getVideoTracks()[0]),this.videoStreamTrack)){if(this.videoStreamTrack.getCapabilities)return this.videoStreamTrack.getCapabilities()||{};if(this.videoStreamTrack.getSettings)return this.videoStreamTrack.getSettings()||{}}return{}}},{key:"_splitVideoStream",value:function(e,t,r,i){var a=t.audio,n=t.video;if(a&&this._isStreamHasAudio(e)){var o=this._genVideoStream(e),s=this._genAudioStream(e);return o?this._handleVideoCaptureSuccess(o,n,r):i(new Error("video stream do not contains video track ")),void(s&&(this.audioStream?this._pushDeprecatedStream({audioStream:s}):(this._updateStreamInReuse(s,!0),this._storeAudioStream(s,a,!0))))}this._handleVideoCaptureSuccess(e,n,r)}},{key:"_captureFileInputVideoStream",value:(r=u()(g.a.mark((function e(t){var r,i,a,n,o,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.video,e.prev=1,e.next=4,new Promise((function(e,t){r.currentTime>0&&!r.paused&&!r.ended&&e(!0),r.addEventListener("timeupdate",(function t(){e(!0),r.removeEventListener("timeupdate",t)})),setTimeout((function(){return t(!1)}),1e4)}));case 4:if(e.sent){e.next=7;break}throw new Error("video file playing failed");case 7:return t.width&&t.height||(i=_getFileInputSourceSize(r.videoWidth,r.videoHeight),a=i.width,n=i.height,t.width=a,t.height=n),o=A.g.videoToMediaStreamManager.startCapture(r,t.width,t.height),e.abrupt("return",o);case 12:throw e.prev=12,e.t0=e.catch(1),console.error(e.t0),(s=new Error("capture stream from file input souce failed")).name="FileInputSouceError",s;case 18:case"end":return e.stop()}}),e,null,[[1,12]])}))),function(e){return r.apply(this,arguments)})},{key:"startCaptureVideo",value:(t=u()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,h,l,p,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.videoConstraints,i=t.timeout,a=t.successHandler,n=t.errorHandler,this.enableReuseStream(!1),o=!!r&&this._getVideoConstraints(r),s=this._isFileInputVideoSource(o),u=this._isSameVideoConstraintsAsPrev(o),d=this._getPresetAudioConstraints(),this._clearPresetVideoStreamAutoStopTimer(),!u){e.next=10;break}return this._handleVideoCaptureSuccess(this.videoStream,o,a,!0),e.abrupt("return");case 10:if(this.destoryVideoMediaStream(),nt("try to getusermedia",c={audio:s?null:d,video:o}),e.prev=13,this.isCaptureVideoInProgress=!0,h=!1,this._clearCaptureVideoTimer(),i&&(this.captureVideoTimer=setTimeout((function(){if(!l){h=!0;var e=new Error("GetUserMedia timeout");n(e)}}),i)),p=Date.now(),!s){e.next=25;break}return e.next=22,this._captureFileInputVideoStream(o);case 22:l=e.sent,e.next=37;break;case 25:return c.video&&c.video.deviceId&&c.video.deviceId.exact?tt.setCameraId(c.video.deviceId.exact):tt.setCameraId("default"),e.prev=26,e.next=29,navigator.mediaDevices.getUserMedia(c);case 29:l=e.sent,e.next=37;break;case 32:return e.prev=32,e.t0=e.catch(26),e.next=36,navigator.mediaDevices.getUserMedia(Object.assign({},c,{video:!0}));case 36:l=e.sent;case 37:if(this._clearCaptureVideoTimer(),!l){e.next=46;break}if(!h){e.next=43;break}return this._destoryStream(l),s||tt.sendCameraInfo(Date.now()-p,!1,-1,-1,-1,-1),e.abrupt("return");case 43:s||(f=l.getVideoTracks()[0],(m=f.getSettings())&&tt.setVideoResolution(m.width,m.height),tt.sendCameraInfo(Date.now()-p,!0,-1,-1,-1,-1)),e.next=48;break;case 46:return s||tt.sendCameraInfo(Date.now()-p,!1,-1,-1,-1,-1),e.abrupt("return");case 48:this._splitVideoStream(l,c,a,n),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(13),n(e.t1);case 54:return e.prev=54,this.isCaptureVideoInProgress=!1,e.finish(54);case 57:case"end":return e.stop()}}),e,this,[[13,51,54,57],[26,32]])}))),function(e){return t.apply(this,arguments)})},{key:"playVideoStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.playsinline;if(e){r&&e.setAttribute("playsinline","");try{e.srcObject=this.videoStream}catch(t){e.src=URL.createObjectURL(this.videoStream)}var i=e.play();return i?i.then((function(){})).catch((function(e){throw k.a.error("Automatic playback failed",e),e})):Promise.resolve(void 0)}return Promise.reject(new Error("video dom node not provided!"))}},{key:"destoryReuseStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,r=e.video;this.enableReuseStream(!1),t&&this.destoryAudioMediaStream(),r&&this.destoryVideoMediaStream()}}]),e}()),nt=Object(I.a)("sdk"),ot=!1;tt.updateDeviceList(!0);var st,ut,dt,ct,ht,lt,pt,ft=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};nt("sdkProps",t);try{_.a.add_monitor("JSBN:".concat(e.buildNumber,",").concat(e.fixVersion)),nt("JSBN:".concat(e.buildNumber))}catch(e){nt(e)}if(this.lateLoadedAssetsHash=t.lateLoadedAssetsHash||{},t.globalTracingLogger&&k.a.setInstance(t.globalTracingLogger),this.isSupportThread="object"===("undefined"==typeof WebAssembly?"undefined":o()(WebAssembly))&&"function"==typeof Worker,!this.isSupportThread)throw new Error("Webassemly or worker is not supported on this browser");var r=S.a.sharedBuffer;S.a.reinit(),r&&(S.a.sharedBuffer=r),ot||(ot=!0,navigator.mediaDevices.addEventListener("devicechange",tt.updateDeviceList.bind(tt,!1))),this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.sharingAudioCtx=new(window.AudioContext||window.webkitAudioContext),this.webrtcAudioNode=null,this.sharingWebrtcAudioNode=null,this.videoRenderArray=[],this.videoCaptureValue=null,this.audioRenderArray=[],this.audioCapture=null,this.deviceInfo=new Map,this.display=[],this.sampleRate=this.audioCtx.sampleRate,this.videoRenderIntervalHandle=null,this.audioDomNode=null,this.audioSpeakerValue=null,this.audionoderecordbuffersize=2048,this.lastresidual=null,this.currentactive=0,this.audioPlay=!1,this.sharingInterval=null,this.sharingIntervalTime=100,this.sharingDisplay=null,this.currentshareactive=0,this.videorenderinterval=10,this.waterMarkCanvas=null,this.videoCaptureHiddenCanvas=null,this.videoCaptureHiddenCanvasCtx=null,this.isSetCursor=!1,this.logon=!1,this.canvas=null,this.firstSetDelay=!0,this.isSupportOffscreenCanvas=A.g.isSupportOffscreenCanvas(),this.isSupportImageCapture=A.g.isSupportImageCapture(),this.isSharingSupportImageCapture=this.isSupportImageCapture,this.isSupportVideoTrackReader=A.g.isSupportVideoTrackReader(),this.isSupportSharingTrackReader=this.isSupportVideoTrackReader,this.isSupportVideoShare=A.g.isSupportVideoShareReceive()&&A.g.isSupportVideoShareSend(),this.isSupportMediaStreamTrackProcessor=A.g.isSupportMediaStreamTrackProcessor(),this.isSupportVideoFrameOrBitmapCapture=A.g.isSupportVideoFrameOrBitmapCapture(),this.isMultipleCanvasForMultipleView=0,this.canISendNextSharingFrame=!0,this.isCaputureNodeConnect=!1,this.isSharingCaptureNodeConnect=!1,this.audioWorkletJsPath=null,this.isSupportChromeWideAEC=A.g.isSupportChromeWideAEC(),this.isSupport2DCanvasDrawFrame=A.g.isSupport2DCanvasDrawFrame(),this.MaskImage=null,this.BgImage=null,this.bgCanvas=null,this.bgCanvasctx=null,this.isCurrentInMaskStatus=!1,this.maskCoordinate={dx:0,dy:0,dWidth:0,dHeight:0},this.VideoMaskSettingCanvas=null,this.VideoMaskSettingCanvasctx=null,this.PrevVideoMaskSettingCanvas=null,this.VideoMaskCanvasFillMode=0,this.isMaskSettingOn=!1,this.isMaskSettingStarted=!1,this.MaskData=null,this.MaskSettingVideo=null,this.ReadyCapureWidth=640,this.ReadyCapureHeight=360,this.bgImageCroppingParams={sx:0,sy:0,sw:0,sh:0},this.VideoVBSettingCanvas=null,this.isVBSettingOn=!1,this.sMonitorCaptureFrameCount=0,this.vMonitorCaptureFrameCount=0,this.videoCaptureInterval=0,this.isStartVideoCapture=!1,this.videoCaptureWidth=0,this.videoCaptureHeight=0,this.videoCaptureContext=null,this.isCreateVideoWaterMark=!1,this.videoWaterMarkName="",this.sharingWaterMarkName="",this.isCreateSharingWaterMark=!1,this.isStartDesktopSharing=!1,this.desktopSharingValue=null,this.desktopCaptureContext=null,this.desktopSharingMediaStram=null,this.desktopSharingCaptureWidth=0,this.desktopSharingCaptureHeight=0,this.desktopSharingSend=!1,this.isdesktopCaptureLoadedmetadata=!1,this.captureVideoOutputCanvasDomList=[],this.captureVideoOutPutVideoDom=null,this.shareTrack=null,this.isVideoCaptureLoadedmetadata=!1,this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO={},this.vMonitorCount=0,this.sMonitorCount=0,this.mMonitorCount=0,this.sharingTrackReader,this.sharingMediaStreamTrackProcessor,this.sharingFrameStream,this.isSendVideoOfflineCanvas=!1,S.a.mediaSDKHandle=this,this._preloadMeetingParam=null,this.is32bitbrowser=-1!=navigator.userAgent.indexOf("WOW64"),this.flipSend=!0,this.mtu_size=0,this.sharingImageCapture=null,this.sharingRenderCanvas=null,this.VideoRenderObj=null,this.SharingRenderObj=null,this.rtcConnectionA=null,this.rtcConnectionB=null,this.isLocalP2PSupportedPromise=A.g.checkLocalP2PConnection(),this.isSupportBrowserAec=!0,this.sharingWidthAndHeightInfo={ctiveNodeID:0,height:0,logicHeight:0,logicWidth:0,width:0},this.remoteControl=null,this.isMirrorMyVideo=!1,this.isCanvasScaled=!1,this.isInitVideoDataChannel=!1,this.isInitAudioDataChannel=!1,this.rtcPeerConnectionList=[],this.isDestroy=!1,this.rwgAgentMessageListenerWrapper=this.rwgAgentMessageListener.bind(this),this.bVideoDecodeWorker2MainSABPostSuccessDeferred=new A.a,this.bVideoDecodeFrameBackSABRingBufferConsumeCopyData=!1,this.bVideoDecodeUsingSAB=A.g.isSupportSharedArrayBuffer(),this.bVideoDecodeWorker2MainUsingSAB=!1,this.bVideoEncodeUsingSAB=A.g.isSupportSharedArrayBuffer(),this.bAudioEncodeUsingSAB=A.g.isSupportSharedArrayBuffer(),this.bAudioDecodeUsingSAB=A.g.isSupportSharedArrayBuffer(),this.audioEncodeRingBufferConsumer=null,this.audioDecodeRingBuffer=null,this.videoEncodeRingbufferConsumer=null,this.videoDecodeFrameBackSABRingBufferConsumer=null,this.bVideoEncodeMainThreadConsumerIntervalEnable=A.g.isGoogleNestChrome(),this.bAudioEncodeMainThreadConsumerIntervalEnable=A.g.isGoogleNestChrome(),this.isSupportOffscreenCanvasForVideoDecode=!this.bVideoDecodeWorker2MainUsingSAB&&A.g.isSupportOffscreenCanvas(),this.bAudioDatachannelOpen=null,this.isMultiView=!1,this.webrtcaudiodom=null,t.ivObj&&(S.a.ivObj=t.ivObj),this.WebSipClient=null,this.lastRealRect={left:0,top:0,width:0,height:0},this.videodecodehardwareflag=null,this.videoencodehardwareflag=null,this.isEnableVideoDecodeHardWareThread=!1,this.hardwareflag=null,this.isEnableHardWareThread=!1,this.isTeslaMode=!1,this.useAudioBridge=!1,this.audioBridge=null,this.replaceCanvasMap={},this.hidAvalible=!1,this.enableHID=!1,this.audioInputLevel=null,this.captureAudioMuted=!1,this.setvideokk=!1,this.isStartWhiteboardSharing=!1,this.sharingDecodeRingBuffer=null,this.ZoomMonitor=_.a.add_monitor.bind(_.a),this.isLandScape=!1,this.captureSize=null,this.platformType=H.x.DESKTOP};ft.buildNumber=3622,ft.version="15.0.3622",ft.util=A.g,ft.fixVersion="Web-Media-5.15.5.4",ft.prototype={JsMediaSDK_Log:function(e){k.a.error("Error in JsMediaSDK",e)},JsMediaSDK_PreLoad:function(e,t,r){var i=r||{},a=i.isTeslaMode,n=i.enableMultiDecodeVideoWithoutSAB,o=i.enableReplaceCanvasWhenContextLost,s=i.enableVirtualBackgroundWithoutSAB,u=i.enableDecoderInWorklet,d=i.enableAudioBridge;S.a.decoderinworkletOP=!0,S.a.chromeWideAEC=u,S.a.enableMultiDecodeVideoWithoutSAB=n,S.a.enableReplaceCanvasWhenContextLost=o,S.a.enableVirtualBackgroundWithoutSAB=s,S.a.enableAudioBridge=d,this.isTeslaMode=!!a;var c={audioWorkletPath:e.audioWorkletPath,audioWorkletSIMDPath:e.audioWorkletSIMDPath,audioWorkletProcessPath:e.audioWorkletProcessPath,sharingAudioWorkletPath:e.sharingAudioWorkletPath};this.setPropsBeforeInit({callback:t,audioWorkletPath:c}),this._preloadMeetingParam=e,v.Start_Monitor(),_.a.add_monitor("JSPLD"),r&&r.file&&r.resourceManager&&v.prepareVBfile(r.file,r.resourceManager)},recordSharingParamInfo:function(){var e=this;w.a.on(C.Xc,(function(t,r){Object.assign(e.sharingWidthAndHeightInfo,r.body)}))},setCallback:function(e){if(!D()(e))throw new Error("callback must be function");S.a._Notify_APPUI=e},setPropsBeforeInit:function(e){e.callback&&this.setCallback(e.callback),e.audioWorkletPath&&(this.audioWorkletJsPath=e.audioWorkletPath),e.e2eEncrypt?S.a.e2eencrypt=!0:S.a.e2eencrypt=!1,this._setWebtransportEnable({enable:e.enableWebtransport,webtransportPort:e.webtransportPort}),e.bandwidth?e.bandwidth.uplimit>=800?S.a.uplimit=1e3*(e.bandwidth.uplimit-120):S.a.uplimit=0:S.a.uplimit||(S.a.uplimit=0)},setRWGAgent:function(e){S.a.rwgAgent=e,this.addEventListenerForRWGAgent(e)},updateQosSubscription:function(e,t,r){var i=!0;this.isSupportVideoShare&&(t==T.g.SHARING_DECODE&&(t=T.g.VIDEO_DECODE,i=!1),t==T.g.SHARING_ENCODE&&(t=T.g.VIDEO_ENCODE,i=!1));var a={enable:e,workerType:t,pollingInterval:r,isVideo:i};v.pushMessageToWorker(t,a,H.l,!1)},addEventListenerForRWGAgent:function(e){e.on("message",this.rwgAgentMessageListenerWrapper)},rwgAgentMessageListener:function(e){if("string"==typeof e.data){var t=JSON.parse(e.data);if(!this.isDestroy)switch(t.evt){case C.Fb:this.setRTCPeerConnectionDatachannelAnswer(t)}}},setRTCPeerConnectionDatachannelAnswer:function(e){if(e.evt===C.gf||e.evt===C.df){if(nt("rwg answer",e),!e.answer)return;switch(e.answer.type){case T.h.ZOOM_CONNECTION_VIDEO:w.a.trigger(C.wc.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,e);break;case T.h.ZOOM_CONNECTION_AUDIO:w.a.trigger(C.wc.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,e)}}},checkISDatachannelOrWebsocket:function(){var e=L()((function(){console.log("Datachannel Return Message")}),1e3),t=L()((function(){console.log("Datachannel Send Message")}),1e3);w.a.on(C.wc.DC_COMING_MESSAGE,(function(){e()})),w.a.on(C.je,(function(e,r){-1!==[2,7].indexOf(r[0])&&t()}))},initVideoDataChannel:function(e,t){var r=this;return u()(g.a.mark((function i(){var a,n;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r.isInitVideoDataChannel){i.next=3;break}return t&&(a=r.rtcPeerConnectionList.find((function(e){return e.connectionType===T.b.VIDEO})))&&a.checkEmptyUserIdAndResendMonitor(t),i.abrupt("return");case 3:r.isInitVideoDataChannel=!0,_.a.add_monitor("INITVDC"),nt("initVideoDataChannel",e),n=new B,A.g.browser.isFirefox&&(n.delaycloseTimeout=15e3),n.setUserid(t),n.setConnectionType(T.b.VIDEO),nt("rtc",n),n.onConnectionCreated(function(){var e=u()(g.a.mark((function e(t){var i,a,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.localDescription,nt("localDesc",i),S.a.sendMessageToRwg(C.Ec,{evt:C.ff,offer:{sdp:i.sdp,type:T.h.ZOOM_CONNECTION_VIDEO}},!1),e.next=5,n.waitForAnswerFromRWG(C.wc.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT);case 5:a=e.sent,nt("jsEvent.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",a),n.setRemoteDescription(a.answer),n.closeIfTimeout(),o=a.answer.sdp.match(/a=candidate:.+/)[0],nt("received candidate",o),o=o.replace(/^a=/,""),n.addIceCandidate(o),n.listenOnDataAndSend(C.je),n.onMessage((function(e){var t=new Uint8Array(e);w.a.trigger(C.wc.DC_COMING_MESSAGE),t[0]!=C.Dc&&132!=t[0]||(1&t[1])!=C.rb?r.isSupportVideoShare||133!=t[0]&&132!=t[0]?r.videoDecodeRingBuffer?r.videoDecodeRingBuffer.enqueueSafe(t,!0,r.ZoomMonitor):v.pushMessageToWorker(T.g.VIDEO_DECODE,e,void 0,!0):r.sharingDecodeRingBuffer?r.sharingDecodeRingBuffer.enqueueSafe(t,!0,null):v.pushMessageToWorker(T.g.SHARING_DECODE,e,void 0,!0):v.pushMessageToWorker(T.g.VIDEO_ENCODE,e,void 0,!0)})),n.dataChannel.addEventListener("open",(function(){v.pushMessageToWorker(T.g.VIDEO_DECODE,{isDataChannelOpen:!0},"UPDATE_DATACHANNEL_STATUS",!1,!0),v.pushMessageToWorker(T.g.VIDEO_ENCODE,{isDataChannelOpen:!0},"UPDATE_DATACHANNEL_STATUS",!1,!0),r.isSupportVideoShare||v.pushMessageToWorker(T.g.SHARING_DECODE,{isDataChannelOpen:!0},"UPDATE_DATACHANNEL_STATUS",!1,!0)})),n.dataChannel.addEventListener("close",(function(){v.pushMessageToWorker(T.g.VIDEO_DECODE,{isDataChannelOpen:!1},"UPDATE_DATACHANNEL_STATUS"),v.pushMessageToWorker(T.g.VIDEO_ENCODE,{isDataChannelOpen:!1},"UPDATE_DATACHANNEL_STATUS"),r.isSupportVideoShare||v.pushMessageToWorker(T.g.SHARING_DECODE,{isDataChannelOpen:!1},"UPDATE_DATACHANNEL_STATUS",!1,!0)}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.initConnection(e).catch((function(e){nt.warn("initConnection",e),_.a.add_monitor("INITVDCERR",e.message)})),r.rtcPeerConnectionList.push(n),r.videoDataChannel=n;case 15:case"end":return i.stop()}}),i)})))()},initAudioDataChannel:function(e,t){var r=this;return u()(g.a.mark((function i(){var a,n;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r.isInitAudioDataChannel){i.next=3;break}return t&&(a=r.rtcPeerConnectionList.find((function(e){return e.connectionType===T.b.AUDIO})))&&a.checkEmptyUserIdAndResendMonitor(t),i.abrupt("return");case 3:r.isInitAudioDataChannel=!0,_.a.add_monitor("INITADC"),nt("initAudioDataChannel",e),n=new B,A.g.browser.isFirefox&&(n.delaycloseTimeout=15e3),n.setUserid(t),n.setConnectionType(T.b.AUDIO),nt("rtc",n),n.onConnectionCreated(function(){var e=u()(g.a.mark((function e(t){var i,a,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.localDescription,nt("localDesc",i),S.a.sendMessageToRwg(C.Ec,{evt:C.ff,offer:{sdp:i.sdp,type:T.h.ZOOM_CONNECTION_AUDIO}},!1),e.next=5,n.waitForAnswerFromRWG(C.wc.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT);case 5:a=e.sent,nt("answer",a),n.setRemoteDescription(a.answer),n.closeIfTimeout(),o=a.answer.sdp.match(/a=candidate:.+/)[0],nt("received candidate",o),o=o.replace(/^a=/,""),n.addIceCandidate(o),n.listenOnDataAndSendAudio(C.k),n.onMessage((function(e){var t=new Uint8Array(e);if(t[0]==C.Cc&&t[1]==C.rb)v.pushMessageToWorker(T.g.AUDIO_ENCODE,e,void 0,!0);else{var i=!(r.audioDecodeRingBuffer&&S.a.sharedBuffer);i||r.audioDecodeRingBuffer.enqueue(t),v.pushMessageToWorker(T.g.AUDIO_DECODE,!i||e,void 0,i)}})),n.dataChannel.addEventListener("open",(function(){r.bAudioDatachannelOpen=!0,v.pushMessageToWorker(T.g.AUDIO_DECODE,{isDataChannelOpen:!0},"UPDATE_DATACHANNEL_STATUS",!1,!0),v.pushMessageToWorker(T.g.AUDIO_ENCODE,{isDataChannelOpen:!0},"UPDATE_DATACHANNEL_STATUS",!1,!0)})),n.dataChannel.addEventListener("close",(function(){r.bAudioDatachannelOpen=!1,v.pushMessageToWorker(T.g.AUDIO_DECODE,{isDataChannelOpen:!1},"UPDATE_DATACHANNEL_STATUS"),v.pushMessageToWorker(T.g.AUDIO_ENCODE,{isDataChannelOpen:!1},"UPDATE_DATACHANNEL_STATUS")}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.initConnection(e,"ZoomWebclientAudioDataChannel").catch((function(e){nt.warn("initConnection",e),_.a.add_monitor("INITADCERR",e.message)})),r.rtcPeerConnectionList.push(n),r.audioDataChannel=n;case 15:case"end":return i.stop()}}),i)})))()},init_Notify_APPUI:function(e,t){var r=v.MEDIA_INIT_SUCCESS_CALLBACK_METADATA[t],i=e?r.success:r.fail;S.a.Notify_APPUI(i,r.callbackDataValue)},_setWebtransportEnable:function(e){var t=e.enable,r=e.webtransportPort;t?(A.e.setIsSupportWebtransport(!0),S.a.webtransportPort=r||8802):A.e.setIsSupportWebtransport(!1)},_previewInitWebtransport:function(e){var t=e.conId,r=e.meetingNumber,i=e.rwgHost,a=e.webtransportPort,n=e.workType;if(this._setWebtransportEnable({enable:!0,webtransportPort:a}),A.e.getIsSupportWebtransport()){var o=n===T.g.AUDIO_ENCODE,s=n===T.g.AUDIO_DECODE,u=n===T.g.VIDEO_ENCODE,d=n===T.g.VIDEO_DECODE,c=o||s,h=c?"a":"v",l=o||u?2:1,p="https://".concat(i,":").concat(S.a.webtransportPort,"/wc/media/").concat(r,"?type=").concat(h,"&cid=").concat(t),f="".concat(p,"&mode=").concat(l);c?v.Set_Audio_Web_Transport_Ip_Address(p):v.Set_Video_Web_Transport_Ip_Address(p);var m=S.a.SPECIAL_ID,g="",_=null;o?(g="localAudioEncMGR",_=v.preserveMessageController.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):s?(g="localAudioDecMGR",_=v.preserveMessageController.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):u?(g="localVideoEncMGR",_=v.preserveMessageController.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):d&&(g="localVideoDecMGR",_=v.preserveMessageController.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);var C=S.a[g]&&S.a[g].map.get(m);C?C.postMessage({command:"OPEN_MEDIA_WEBTRANSPORT",webtransportURL:f}):v.preserveMessageController.enqueueMessage({name:_,handler:function(){(C=S.a[g].map.get(m)).postMessage({command:"OPEN_MEDIA_WEBTRANSPORT",webtransportURL:f})},direction:v.preserveMessageController.direction.SDK_TO_SDK})}},_previewInitMediaWebsocket:function(e){var t=e.websocketUrl,r=e.workType,i=S.a.SPECIAL_ID,a=r===T.g.AUDIO_ENCODE,n=r===T.g.AUDIO_DECODE,o=r===T.g.VIDEO_ENCODE,s=r===T.g.VIDEO_DECODE;a||n?v.Set_Audio_WebSocket_Ip_Address(t):v.Set_Video_WebSocket_Ip_Address(t);var u="",d=null,c=0;a?(c=2,u="localAudioEncMGR",d=v.preserveMessageController.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):n?(c=5,u="localAudioDecMGR",d=v.preserveMessageController.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):o?(c=2,u="localVideoEncMGR",d=v.preserveMessageController.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):s&&(c=5,u="localVideoDecMGR",d=v.preserveMessageController.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);var h=S.a[u]&&S.a[u].map.get(i);h?h.postMessage({command:"OPEN_MEDIA_WEBSOCKET",websocket_ip_address:"".concat(t,"&mode=").concat(c)}):v.preserveMessageController.enqueueMessage({name:d,handler:function(){(h=S.a[u].map.get(i)).postMessage({command:"OPEN_MEDIA_WEBSOCKET",websocket_ip_address:"".concat(t,"&mode=").concat(c)})},direction:v.preserveMessageController.direction.SDK_TO_SDK})},previewInit:function(e){var t=this;return u()(g.a.mark((function r(){var i,a,n,o,s,u,d,c,h,l,p,f,m,_,C,y,b,k,E,I,w,M,D,R,P,x,O,V,N,L,W,U,B,F,G,H,j,K,q,Q,z,J,X,Y,Z,$,ee,te,re,ie,ae;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.videoDecode,a=e.videoDataChannel,n=e.videoEncodeMediaWss,o=e.videoDecodeMediaWss,s=e.videoEncodeWebtransport,u=e.videoDecodeWebtransport,d=e.audioDecode,c=e.audioDataChannel,h=e.audioBridge,l=e.audioEncodeMediaWss,p=e.audioDecodeMediaWss,f=e.audioEncodeWebtransport,m=e.audioDecodeWebtransport,!i){r.next=18;break}return _=(i||{}).urlParameters,r.next=5,A.g.isSDKSupportMultiThread();case 5:if(r.t0=r.sent,!r.t0){r.next=8;break}r.t0=!A.g.isSelfPreviewRenderWithVideo()||A.g.isAndroidBrowser();case 8:return C=r.t0,r.next=11,A.g.isSDKSupportSIMD();case 11:y=r.sent,b=y&&C,k={},t.isSupportVideoShare?(k.workerJsFileUrl=_.vsmiworkerpath,k.workerWasmFileUrl=_.videoMSIMDWasm):b?(k.workerJsFileUrl=_.videoMSIMDWorkerPath,k.workerWasmFileUrl=_.videoMSIMDWasm):C?(k.workerJsFileUrl=_.videoMtWorkerPath,k.workerWasmFileUrl=_.videoMtWasm):y?(k.workerJsFileUrl=_.videoSIMDWorkerPath,k.workerWasmFileUrl=_.videoSIMDWasm):(k.workerJsFileUrl=_.videoWorkerPath,k.workerWasmFileUrl=_.videoWasm),k.integrityHelper=new A.c(k.workerJsFileUrl,t.lateLoadedAssetsHash),v.previewController.resetVideoDecode(!0),v.initVideoDecode(k,t);case 18:if(a&&(E=a.conId,I=a.userid,t.initVideoDataChannel(E,I),S.a.monitorCid=E),n&&(w=n.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:w,workType:T.g.VIDEO_ENCODE})),o&&(M=o.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:M,workType:T.g.VIDEO_DECODE})),s&&(D=s.conId,R=s.meetingNumber,P=s.rwgHost,x=s.webtransportPort,t._previewInitWebtransport({conId:D,meetingNumber:R,rwgHost:P,webtransportPort:x,workType:T.g.VIDEO_ENCODE})),u&&(O=u.conId,V=u.meetingNumber,N=u.rwgHost,L=u.webtransportPort,t._previewInitWebtransport({conId:O,meetingNumber:V,rwgHost:N,webtransportPort:L,workType:T.g.VIDEO_DECODE})),!d){r.next=33;break}return W=(d||{}).urlParameters,U={},r.next=28,A.g.isSDKSupportSIMD();case 28:r.sent?(U.workerJsFileUrl=W.audioSIMDWorkletPath,U.workerWasmFileUrl=W.audioSIMDWasm):(U.workerJsFileUrl=W.audioWorkerPath,U.workerWasmFileUrl=W.audioWasm),U.integrityHelper=new A.c(U.workerJsFileUrl,t.lateLoadedAssetsHash),v.previewController.resetAudioDecode(!0),v.initAudioDecode(U,t);case 33:if(c&&(B=c.conId,F=c.userid,t.initAudioDataChannel(B,F),S.a.monitorCid=B),!h){r.next=41;break}return t.useAudioBridge=!0,G=h.nginxHost,H=h.rwgHost,j=h.cid,K=h.abToken,q=h.isCapturingAudio,Q=h.isJoinAudio,z=h.supportLocalAB,t.audioBridge?t.audioBridge.leaveAudioWithoutDisconnect():t.audioBridge=new Oe(G,H,j,!q,t.isMultiView,z),q&&t.audioBridge.setRecvOnly(!1,at.audioStream),r.next=41,t.audioBridge.join(!1,K,Q);case 41:l&&(J=l.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:J,workType:T.g.AUDIO_ENCODE})),p&&(X=p.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:X,workType:T.g.AUDIO_DECODE})),f&&(Y=f.conId,Z=f.meetingNumber,$=f.rwgHost,ee=f.webtransportPort,t._previewInitWebtransport({conId:Y,meetingNumber:Z,rwgHost:$,webtransportPort:ee,workType:T.g.AUDIO_ENCODE})),m&&(te=m.conId,re=m.meetingNumber,ie=m.rwgHost,ae=m.webtransportPort,t._previewInitWebtransport({conId:te,meetingNumber:re,rwgHost:ie,webtransportPort:ae,workType:T.g.AUDIO_DECODE}));case 45:case"end":return r.stop()}}),r)})))()},previewUnInitRtcConnection:function(){try{this.isInitAudioDataChannel=!1,this.isInitVideoDataChannel=!1,this.rtcPeerConnectionList.forEach((function(e){e&&(e.forceClose(),e=null)})),this.rtcPeerConnectionList=[]}catch(e){nt.error("clear rtcPeerConnectionList err",e)}this.audioBridge&&(this.audioBridge.destroy(!1),this.audioBridge=null);var e=S.a.SPECIAL_ID;[S.a.localVideoEncMGR&&S.a.localVideoEncMGR.map.get(e),S.a.localVideoDecMGR&&S.a.localVideoDecMGR.map.get(e),S.a.localAudioEncMGR&&S.a.localAudioEncMGR.map.get(e),S.a.localAudioDecMGR&&S.a.localAudioDecMGR.map.get(e)].forEach((function(e){e&&(e.postMessage({command:"CLOSE_MEDIA_WEBSOCKET"}),e.postMessage({command:"CLOSE_MEDIA_WEBTRANSPORT"}))}))},initVideoEncode:function(e,t,r){var i=arguments,a=this;return u()(g.a.mark((function n(){var o,s,u,d,c,h,l,p,f,m,C,y,b,k,E,I,M,D,R,P,x,O,V,N,L,W,U;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,d=i.length>6?i[6]:void 0,c=i.length>7?i[7]:void 0,h=!(i.length>8&&void 0!==i[8])||i[8],l=i.length>9?i[9]:void 0,p=i.length>10?i[10]:void 0,f=i.length>11&&void 0!==i[11]&&i[11],m=i.length>12?i[12]:void 0,a.isSupportImageCapture=!c&&a.isSupportImageCapture,at.setStreamProcessAbility({isSupportImageCapture:a.isSupportImageCapture}),a.isSupportVideoFrameOrBitmapCapture=a.isSupportImageCapture||a.isSupportVideoTrackReader||a.isSupportMediaStreamTrackProcessor,nt("initVideoEncode"),_.a.add_monitor("INITVE"),tt.setUserId(r),v.previewController.resetVideoEncode(m),n.next=19,A.g.isSDKSupportMultiThread();case 19:if(n.t0=n.sent,!n.t0){n.next=22;break}n.t0=!A.g.isSelfPreviewRenderWithVideo()||A.g.isAndroidBrowser();case 22:return C=n.t0,A.e.setIsSupportVirtualBackground(!a.isTeslaMode&&!A.g.isGoogleNestChrome()&&!A.g.isAndroidBrowser()&&!c&&(C||S.a.enableVirtualBackgroundWithoutSAB)),y=A.e.getIsSupportVirtualBackground(),n.next=27,A.g.isSDKSupportSIMD();case 27:if(b=n.sent,k=b&&C,E={},I=!1,M=A.g.graphicName(),D=!!M&&M.includes("amd"),a.isAppleGraphic=!!M&&((M.includes("apple m1")||M.includes("apple m2"))&&!A.g.isChromeVersionHigherThan(116)),n.t2=A.g.isIphoneOrIpadBrowser()||A.g.isIpadOS()||navigator.hardwareConcurrency&&navigator.hardwareConcurrency>7,n.t2){n.next=48;break}return n.next=38,A.g.VP9MachineDetect();case 38:if(n.t5=n.sent,!n.t5){n.next=41;break}n.t5=D;case 41:if(n.t4=n.t5,!n.t4){n.next=44;break}n.t4=navigator.hardwareConcurrency;case 44:if(n.t3=n.t4,!n.t3){n.next=47;break}n.t3=navigator.hardwareConcurrency>=4;case 47:n.t2=n.t3;case 48:if(n.t1=n.t2,!n.t1){n.next=51;break}n.t1=l;case 51:if(!n.t1){n.next=53;break}I=!0;case 53:if(_.a.add_monitor("isMT: "+C),_.a.add_monitor("isenbaleHD: "+l),_.a.add_monitor("ENABLE720:"+I),_.a.add_monitor("ISVSV:"+a.isSupportVideoShare),_.a.add_monitor("graphicname: "+M),R=H.z&&p,!(C&&(l||f)&&a.isSupportMediaStreamTrackProcessor&&A.g.isChromeVersionHigherThan(95))||A.g.isGoogleNestChrome()||0!==A.g.AdapterWhiteListCheckForEncoder()){n.next=69;break}if(n.t6=H.z,!n.t6){n.next=65;break}return n.next=64,A.g.IsSupportVideoEncodeHardwareAcceleration();case 64:n.t6=n.sent;case 65:a.videoencodehardwareflag=n.t6,p=a.videoencodehardwareflag,n.next=71;break;case 69:a.videoencodehardwareflag=!1,p=!1;case 71:return a.isSupportVideoShare?(E.workerJsFileUrl=e.vsmiworkerpath,E.workerWasmFileUrl=e.videoMSIMDWasm):k?(E.workerJsFileUrl=e.videoMSIMDWorkerPath,E.workerWasmFileUrl=e.videoMSIMDWasm):C?(E.workerJsFileUrl=e.videoMtWorkerPath,E.workerWasmFileUrl=e.videoMtWasm):b?(E.workerJsFileUrl=e.videoSIMDWorkerPath,E.workerWasmFileUrl=e.videoSIMDWasm):(E.workerJsFileUrl=e.videoWorkerPath,E.workerWasmFileUrl=e.videoWasm),E.integrityHelper=new A.c(E.workerJsFileUrl,a.lateLoadedAssetsHash),m||(P=new URL(t).searchParams.get("cid"),x=new URL(t).host,A.e.getIsSupportWebtransport()&&v.Set_Video_Web_Transport_Ip_Address("https://".concat(x,":").concat(S.a.webtransportPort,"/wc/media/").concat(u,"?type=v&cid=").concat(P)),a.previewInit({videoDataChannel:{conId:P,userid:r}})),O=1,V=!1,N=!1,(L=y&&C)&&p?(O=3,V=!0,N=!!R):L||p?(O=2,p&&(V=!0,N=!!R)):(a.isSupportVideoShare||C)&&(O=2),W=V&&N&&I,A.g.set720pcapacity(W),_.a.add_monitor("CAPTURE720:"+W),_.a.add_monitor("VETNum:"+O),A.g.isAndroidBrowser()?a.platformType=H.x.ANDROID:A.g.isIphoneOrIpadBrowser()&&(a.platformType=H.x.IPHONE),N=N&&!a.isAppleGraphic,U={log:o,confId:r,meetingid:s,meetingnumb:u,videodecodethreadnumb:d,isSupportMultiThread:C,videoencodethreadnumb:O,qoson:h,isSupportVirtualBackground:y,isSupportWebCodecEnocde:V,initWebCodecFlag:N,is360penablehw:f,enable720p:I,platformType:a.platformType},n.t7=console,n.next=89,A.g.VP9MachineDetect();case 89:return n.t8=n.sent,n.t9=A.g.isAMDGraphic(),n.t10=A.g.isGraphicShouldUseHardwareAccelerationDecode(),n.t11="isenbaleHD:"+l+" enable720p?:",n.t12=I,n.t13=W,n.t7.log.call(n.t7,"VP9?:",n.t8,"AMD?:",n.t9,"AMDdecodecheck:",n.t10,n.t11,n.t12,"capacityfor720:",n.t13),v.setVideoEngineInitProperties(t,U),n.next=99,v.initVideoEncode(E,a);case 99:if(!m){n.next=101;break}return n.abrupt("return");case 101:return n.next=103,S.a.videoInitInstance.initSuccessPromise.then((function(e){if(e&&a.bVideoEncodeUsingSAB)if(C)w.a.on("VIDEO_ENCODE_PTR",(function(e,t){var r=new be(t.data.buffer,void 0,void 0,!0,t.offset,t.length,t.data);a.videoEncodeRingbufferConsumer=new Ae(r,a.consumeVideoEncodeRingbuffer.bind(a))})),v.pushMessageToWorker(T.g.VIDEO_ENCODE,{bVideoEncodeMainThreadConsumerIntervalEnable:a.bVideoEncodeMainThreadConsumerIntervalEnable},"VIDEO_ENCODE_SAB",!1,!0);else{var t=be.getStorageForCapacity(),r=new be(t,void 0,void 0,!0);a.videoEncodeRingbufferConsumer=new Ae(r,a.consumeVideoEncodeRingbuffer.bind(a)),v.pushMessageToWorker(T.g.VIDEO_ENCODE,{buffer:t,bVideoEncodeMainThreadConsumerIntervalEnable:a.bVideoEncodeMainThreadConsumerIntervalEnable},"VIDEO_ENCODE_SAB",!1,!0)}return e})).then((function(e){return a.init_Notify_APPUI(e,T.g.VIDEO_ENCODE),v.preserveMessageController.subscribeMessage(v.preserveMessageController.nameMap.INIT_VIDEO_ENCODE_SUCCESS),e}));case 103:return n.abrupt("return",n.sent);case 104:case"end":return n.stop()}}),n)})))()},initVideoDecode:function(e,t,r){var i=arguments,a=this;return u()(g.a.mark((function n(){var o,s,d,c,h,l,p,f,m,C,y,b,k,E,I,M,D,R;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,d=i.length>5?i[5]:void 0,c=i.length>6?i[6]:void 0,h=i.length>7&&void 0!==i[7]&&i[7],l=!(i.length>8&&void 0!==i[8])||i[8],v.previewController.resetVideoDecode(!1),nt("initVideoDecode"),_.a.add_monitor("INITVD"),c>1&&Object(A.d)()&&(a.isMultiView=!0),n.next=12,A.g.isSDKSupportMultiThread();case 12:if(n.t0=n.sent,!n.t0){n.next=15;break}n.t0=!A.g.isSelfPreviewRenderWithVideo()||A.g.isAndroidBrowser();case 15:return p=n.t0,n.next=18,A.g.isSDKSupportSIMD();case 18:if(f=n.sent,m=f&&p,C={},a.isEnableVideoDecodeHardWareThread=A.g.isChromeVersionHigherThan(95),!h||!a.isEnableVideoDecodeHardWareThread){n.next=27;break}return n.next=25,A.g.IsSupportVideoDecodeHardwareAcceleration();case 25:a.videodecodehardwareflag=n.sent,h=a.videodecodehardwareflag;case 27:return _.a.add_monitor("SupportWebCodecDecode:".concat(h)),a.isSupportVideoShare?(C.workerJsFileUrl=e.vsmiworkerpath,C.workerWasmFileUrl=e.videoMSIMDWasm):m?(C.workerJsFileUrl=e.videoMSIMDWorkerPath,C.workerWasmFileUrl=e.videoMSIMDWasm):p?(C.workerJsFileUrl=e.videoMtWorkerPath,C.workerWasmFileUrl=e.videoMtWasm):f?(C.workerJsFileUrl=e.videoSIMDWorkerPath,C.workerWasmFileUrl=e.videoSIMDWasm):(C.workerJsFileUrl=e.videoWorkerPath,C.workerWasmFileUrl=e.videoWasm),C.integrityHelper=new A.c(C.workerJsFileUrl,a.lateLoadedAssetsHash),y=new URL(t).searchParams.get("cid"),b=new URL(t).host,A.e.getIsSupportWebtransport()&&v.Set_Video_Web_Transport_Ip_Address("https://".concat(b,":").concat(S.a.webtransportPort,"/wc/media/").concat(d,"?type=v&cid=").concat(y)),a.previewInit({videoDataChannel:{conId:y,userid:r}}),k=h&&a.isEnableVideoDecodeHardWareThread&&c>1&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>=4,A.g.setsub1080pcapacity(k),E={log:o,confId:r,meetingid:s,meetingnumb:d,videodecodethreadnumb:c,isFirefox:A.g.browser.isFirefox,isSupportMultiThread:p,isSupportVideoTrackReader:a.isSupportVideoTrackReader,isSupportOffscreenCanvas:a.isSupportOffscreenCanvas,isenablehw:h,isEnableVideoDecodeHardWareThread:a.isEnableVideoDecodeHardWareThread,qoson:l,isEnableHardWareThread:a.isEnableHardWareThread,isTeslaMode:a.isTeslaMode},v.setVideoEngineInitProperties(t,E),D=15e5,a.bVideoDecodeUsingSAB&&(p?w.a.on("VIDEO_DECODE_PTR",(function(e,t){a.videoDecodeRingBuffer=new be(t.data.buffer,void 0,void 0,void 0,t.offset,t.length,t.data)})):(I=be.getStorageForCapacity(),a.videoDecodeRingBuffer=new be(I))),a.bVideoDecodeWorker2MainUsingSAB&&(M=be.getStorageForCapacity(10,D),R=new be(M,D,"vdfb"),a.videoDecodeFrameBackSABRingBufferConsumer=new Ae(R,a.videoDecodeFrameBackSABRingBufferConsumeCallback.bind(a))),n.next=43,v.initVideoDecode(C,a);case 43:return n.next=45,S.a.videoDecInitInstance.initSuccessPromise.then(function(){var e=u()(g.a.mark((function e(t){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!a.bVideoDecodeUsingSAB){e.next=6;break}return e.next=3,v.pushMessageToWorker(T.g.VIDEO_DECODE,p?null:I,"VIDEO_DECODE_SAB_FROM_DATACHANNEL",!1,!0);case 3:(r=e.sent)||(a.videoDecodeRingBuffer=null),nt("videoDatachannelSAB",r);case 6:if(!t||!M){e.next=13;break}return e.next=9,v.pushMessageToWorker(T.g.VIDEO_DECODE,{buffer:M,bytesPerEle:D},"VIDEO_DECODE_FRAME_BACK_SAB",!1,!0);case 9:(i=e.sent)||(a.bVideoDecodeWorker2MainUsingSAB=null),a.bVideoDecodeWorker2MainSABPostSuccessDeferred.resolve(i),nt("videoDecodeFrameBackSAB",i);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return a.init_Notify_APPUI(e,T.g.VIDEO_DECODE),v.preserveMessageController.subscribeMessage(v.preserveMessageController.nameMap.INIT_VIDEO_DECODE_SUCCESS),e}));case 45:return n.abrupt("return",n.sent);case 46:case"end":return n.stop()}}),n)})))()},initAudioEncode:function(e,t,r){var i=arguments,a=this;return u()(g.a.mark((function n(){var o,s,u,d,c,h,l,p,f,m,C,y;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,d=i.length>6?i[6]:void 0,c=!(i.length>7&&void 0!==i[7])||i[7],h=i.length>8?i[8]:void 0,nt("initAudioEncode"),_.a.add_monitor("INITAE"),tt.setUserId(r),v.previewController.resetAudioEncode(h),l={},n.next=13,A.g.isSDKSupportSIMD();case 13:return n.sent?(l.workerJsFileUrl=e.audioSIMDWorkletPath,l.workerWasmFileUrl=e.audioSIMDWasm):(l.workerJsFileUrl=e.audioWorkerPath,l.workerWasmFileUrl=e.audioWasm),l.integrityHelper=new A.c(l.workerJsFileUrl,a.lateLoadedAssetsHash),h||(p=new URL(t).searchParams.get("cid"),f=new URL(t).host,A.e.getIsSupportWebtransport()&&v.Set_Audio_Web_Transport_Ip_Address("https://".concat(f,":").concat(S.a.webtransportPort,"/wc/media/").concat(u,"?type=a&cid=").concat(p)),a.previewInit({audioDataChannel:{conId:p,userid:r}})),a.audioCtx||(a.audioCtx=new(window.AudioContext||window.webkitAudioContext)),m={sampleRate:a.audioCtx.sampleRate,userid:r,log:o,meetingid:s,meetingnumb:u,videodecodethreadnumb:d,qoson:c},v.setAudioEngineInitProperties(t,m),y=1500,a.bAudioEncodeUsingSAB&&!h&&(C=be.getStorageForCapacity(100,y),a.audioEncodeRingBufferConsumer=new Ae(new be(C,y,void 0,!0),a.audioEncodeRingBufferConsumerCallback.bind(a))),n.next=24,v.initAudioEncode(l,a);case 24:if(!h){n.next=26;break}return n.abrupt("return");case 26:return n.next=28,S.a.audioEncodeInitInstance.initSuccessPromise.then((function(e){return e&&null!==a.bAudioDatachannelOpen&&v.pushMessageToWorker(T.g.AUDIO_ENCODE,{isDataChannelOpen:a.bAudioDatachannelOpen},"UPDATE_DATACHANNEL_STATUS"),e&&C&&v.pushMessageToWorker(T.g.AUDIO_ENCODE,{buffer:C,bytesPerEle:y,bAudioEncodeMainThreadConsumerIntervalEnable:a.bAudioEncodeMainThreadConsumerIntervalEnable},"audioEncodeSAB",!1,!0),e})).then((function(e){return a.init_Notify_APPUI(e,T.g.AUDIO_ENCODE),e}));case 28:return n.abrupt("return",n.sent);case 29:case"end":return n.stop()}}),n)})))()},initAudioDecode:function(e,t,r){var i=arguments,a=this;return u()(g.a.mark((function n(){var o,s,d,c,h,l,p,f,m,C,y,b;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,d=i.length>5?i[5]:void 0,c=i.length>6?i[6]:void 0,h=!(i.length>7&&void 0!==i[7])||i[7],v.previewController.resetAudioDecode(!1),nt("initAudioDecode"),tt.setUserId(r),_.a.add_monitor("INITAD"),l=new URL(t).searchParams.get("cid"),p=new URL(t).host,(f={}).workerJsFileUrl=e.audioWorkerPath,f.workerWasmFileUrl=e.audioWasm,A.e.getIsSupportWebtransport()&&v.Set_Audio_Web_Transport_Ip_Address("https://".concat(p,":").concat(S.a.webtransportPort,"/wc/media/").concat(d,"?type=a&cid=").concat(l)),a.previewInit({audioDataChannel:{conId:l,userid:r}}),C=1500,a.bAudioDecodeUsingSAB&&(m=be.getStorageForCapacity(100,C),a.audioDecodeRingBuffer=new be(m,C)),n.next=20,A.g.isSDKSupportMultiThread();case 20:return y=n.sent,n.next=23,A.g.isSDKSupportSIMD();case 23:return n.sent?(f.workerJsFileUrl=e.audioSIMDWorkletPath,f.workerWasmFileUrl=e.audioSIMDWasm):(f.workerJsFileUrl=e.audioWorkerPath,f.workerWasmFileUrl=e.audioWasm),f.integrityHelper=new A.c(f.workerJsFileUrl,a.lateLoadedAssetsHash),a.audioCtx||(a.audioCtx=new(window.AudioContext||window.webkitAudioContext)),b={sampleRate:a.audioCtx.sampleRate,userid:r,log:o,meetingid:s,meetingnumb:d,videodecodethreadnumb:c,isSupportMultiThread:y,qoson:h},v.setAudioEngineInitProperties(t,b),n.next=31,v.initAudioDecode(f,a);case 31:return n.next=33,S.a.audioDecInitInstance.initSuccessPromise.then(function(){var e=u()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.a.add_monitor("ADIP"+!!t),!t||!m){e.next=6;break}return e.next=4,v.pushMessageToWorker(T.g.AUDIO_DECODE,{buffer:m,bytesPerEle:C},"audioDecodeSAB",!1,!0);case 4:e.sent||(a.audioDecodeRingBuffer=null);case 6:return t&&null!==a.bAudioDatachannelOpen&&v.pushMessageToWorker(T.g.AUDIO_DECODE,{isDataChannelOpen:a.bAudioDatachannelOpen},"UPDATE_DATACHANNEL_STATUS"),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return a.init_Notify_APPUI(e,T.g.AUDIO_DECODE),e}));case 33:return n.abrupt("return",n.sent);case 34:case"end":return n.stop()}}),n)})))()},initSharingDecode:function(e,t,r){var i=arguments,a=this;return u()(g.a.mark((function n(){var o,s,u,d,c,h,l;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,i.length>6?i[6]:void 0,_.a.add_monitor("INITSD"),a.recordSharingParamInfo(),nt("initSharingDecode"),!a.isSupportVideoShare){n.next=11;break}return n.next=10,S.a.sharingDecInitInstance.socketSuccessPromise.then((function(e){return a.init_Notify_APPUI(e,T.g.SHARING_DECODE),e}));case 10:return n.abrupt("return",n.sent);case 11:return S.a.monitorCid=new URL(t).searchParams.get("cid"),n.next=14,A.g.isSDKSupportMultiThread();case 14:return d=n.sent,n.next=17,A.g.isSDKSupportSIMD();case 17:return c=n.sent,h={},c&&d?(h.workerJsFileUrl=e.sharingMSIMDWorkerPath,h.workerWasmFileUrl=e.videoMSIMDWasm):d?(h.workerJsFileUrl=e.sharingMtWorkerPath,h.workerWasmFileUrl=e.videoMtWasm):c?(h.workerJsFileUrl=e.sharingSIMDWorkerPath,h.workerWasmFileUrl=e.videoSIMDWasm):(h.workerJsFileUrl=e.sharingWorkerPath,h.workerWasmFileUrl=e.videoWasm),h.integrityHelper=new A.c(h.workerJsFileUrl,a.lateLoadedAssetsHash),l={log:o,userid:r,meetingid:s,meetingnumb:u,isSupportMultiThread:d},v.setSharingEngineInitProperties(t,l),a.isSupportVideoShare||w.a.on("SHARING_DECODE_PTR",(function(e,t){a.sharingDecodeRingBuffer=new be(t.data.buffer,void 0,void 0,void 0,t.offset,t.length,t.data)})),n.next=27,v.initSharingDecode(h,a);case 27:return n.next=29,S.a.sharingDecInitInstance.initSuccessPromise.then((function(e){return a.init_Notify_APPUI(e,T.g.SHARING_DECODE),e}));case 29:return n.abrupt("return",n.sent);case 30:case"end":return n.stop()}}),n)})))()},initSharingEncode:function(e,t,r){var i=arguments,a=this;return u()(g.a.mark((function n(){var o,s,u,d,c,h,l;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,i.length>6?i[6]:void 0,nt("initSharingEncode"),!a.isSupportVideoShare){n.next=9;break}return n.next=8,S.a.sharingEncInitInstance.socketSuccessPromise.then((function(e){return a.init_Notify_APPUI(e,T.g.SHARING_ENCODE),e}));case 8:return n.abrupt("return",n.sent);case 9:return _.a.add_monitor("INITSE"),n.next=12,A.g.isSDKSupportMultiThread();case 12:return d=n.sent,n.next=15,A.g.isSDKSupportSIMD();case 15:return c=n.sent,h={},c&&d?(h.workerJsFileUrl=e.sharingMSIMDWorkerPath,h.workerWasmFileUrl=e.videoMSIMDWasm):d?(h.workerJsFileUrl=e.sharingMtWorkerPath,h.workerWasmFileUrl=e.videoMtWasm):c?(h.workerJsFileUrl=e.sharingSIMDWorkerPath,h.workerWasmFileUrl=e.videoSIMDWasm):(h.workerJsFileUrl=e.sharingWorkerPath,h.workerWasmFileUrl=e.videoWasm),h.integrityHelper=new A.c(h.workerJsFileUrl,a.lateLoadedAssetsHash),S.a.monitorCid=new URL(t).searchParams.get("cid"),l={log:o,userid:r,meetingid:s,meetingnumb:u,isSupportMultiThread:d},v.setSharingEngineInitProperties(t,l),n.next=25,v.initSharingEncode(h,a);case 25:return n.next=27,S.a.sharingEncInitInstance.initSuccessPromise.then((function(e){return a.init_Notify_APPUI(e,T.g.SHARING_ENCODE),e}));case 27:return n.abrupt("return",n.sent);case 28:case"end":return n.stop()}}),n)})))()},JsMediaSDK_UnInit:function(){v.Stop_Monitor(),v.JsAudioEngine_UnInit(),v.JsVideoEngine_UnInit(),v.JsSharingEngine_UnInit(),this.videoRenderArray.length&&this.videoRenderArray.forEach((function(e){e.display&&(e.display.cleanup(),e.display=null)})),S.a._Notify_APPUI=null},StartAudioMediaCapture:function(){at.startCaptureAudio({audioConstraints:this.audioCapture?{audioSource:this.audioCapture?this.audioCapture.AudioSelectValue:null,isSupportBrowserAec:this.isSupportBrowserAec,disableAudioAGC:this.disableAudioAGC,disableNoiseSuppression:this.disableNoiseSuppression}:null,successHandler:this.handleAudioCapture.bind(this),errorHandler:this.handleAudioError.bind(this)})},StartDesktopMediaCapture:(pt=u()(g.a.mark((function e(){var t,r,i,a,n,s,u,d,c,h,l,p,f;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,!this.desktopSharingValue.sourceId){e.next=14;break}return r=this.desktopSharingValue.sourceId,e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r}}});case 6:i=e.sent,this.handleDesktopCapture(i),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),this.handleCaptureError(e.t0);case 13:return e.abrupt("return");case 14:if(a=this.handleDesktopCapture.bind(this),n=this.handleCaptureError.bind(this),!this.desktopSharingValue.share2ndCamera){e.next=22;break}return s=this.desktopSharingValue.share2ndCameraParams||{},u=s.VideoSelectValue?{exact:s.VideoSelectValue}:void 0,d={deviceId:u,width:s.width||640,height:s.height||360},navigator.mediaDevices.getUserMedia({video:d,audio:!1}).then(a,n),e.abrupt("return");case 22:c=this.desktopSharingValue.videoParams,h=navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints(),l=h&&!!h.displaySurface&&c&&c.displaySurface,navigator.mediaDevices.getDisplayMedia?(p=!(!A.g.isSupportSharedArrayBuffer()||!this.desktopSharingValue.showShareAudioOption)&&{autoGainControl:!1,noiseSuppression:!1},f=this.desktopSharingValue.videoParams||!0,l&&("object"===o()(f)?f.displaySurface=c.displaySurface:"boolean"==typeof f&&(f={displaySurface:c.displaySurface})),navigator.mediaDevices.getDisplayMedia({video:f,audio:p}).then(a,n)):window.getScreenId((function(e,r,i){if(e){var a;switch(e){case"WCL.userCancel":a=C.Ud;break;case"WCL.extensionUninstalled":a=C.ub;break;case"WCL.PermissionDeniedError":a=C.wb}t.StopSharingCapture(),a&&(_.a.add_monitor("SCSF"),S.a.Notify_APPUI(a,null))}else navigator.mediaDevices.getUserMedia(i).then((function(e){t.desktopSharingMediaStram=e,S.a.Notify_APPUI(C.tb,null),t.desktopSharingMediaStram.getVideoTracks()[0].onended=function(){_.a.add_monitor("SSBB"),S.a.Notify_APPUI(C.be,null),t.StopSharingCapture()},t.Start_Desktop_Sharing()})).catch((function(e){k.a.error("An error occurred when trying to capture sharing",e),_.a.add_monitor("SCCF"),t.StopSharingCapture(),S.a.Notify_APPUI(C.vb,null)}))}));case 26:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return pt.apply(this,arguments)}),StartVideoMediaCapture:(lt=u()(g.a.mark((function e(){var t,r=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.videoCaptureValue,at.startCaptureVideo({videoConstraints:this.videoCaptureValue?{videoSource:this.videoCaptureValue.VideoSelectValue,usingFacingMode:this.videoCaptureValue.usingFacingMode,width:this.videoCaptureValue.width,height:this.videoCaptureValue.height,pan:this.videoCaptureValue.pan,tilt:this.videoCaptureValue.tilt,zoom:this.videoCaptureValue.zoom,fps:this.videoCaptureValue.fps}:null,timeout:this.videoCaptureValue?this.videoCaptureValue.timeout:null,successHandler:function(){var e=u()(g.a.mark((function e(i){var a,n,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.videoCaptureValue=t,at.videoConstraints&&(a=at.videoConstraints,n=a.width,o=a.height,n&&o&&(r.videoCaptureWidth=n,r.videoCaptureHeight=o)),e.prev=2,e.next=5,r.handleVideoCapture(i);case 5:e.sent&&(_.a.add_monitor("VCMS"),S.a.monitorVideoCapture=!0),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),r.handleVideoError(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),errorHandler:function(e){console.log(e),r.handleVideoError(e)}});case 2:case"end":return e.stop()}}),e,this)}))),function(){return lt.apply(this,arguments)}),Start_Audio_Play:function(){this.audioPlay=!0,S.a.AudioNode&&S.a.AudioNode.postCMD("startPlayAudio",null),v.UpdateAudioPlayStatus(!0)},Stop_Audio_Play:function(){v.UpdateAudioPlayStatus(!1),S.a.AudioNode&&S.a.AudioNode.postCMD("stopPlayAudio",null)},Remove_Audio_Play:function(){v.UpdateAudioPlayStatus(!1),this.audioPlay=!1,S.a.AudioNode&&S.a.AudioNode.postCMD("stopPlayAudio",null)},Meeting_Fail_Over:function(e,t){v.Meeting_Fail_Over(e,t)},Start_Desktop_Audio_Capture:function(){var e=this.desktopSharingMediaStram.getAudioTracks();if(this.desktopSharingMediaStram&&e){var t=this.sharingAudioCtx.createMediaStreamSource(this.desktopSharingMediaStram);return this.sharingWebrtcAudioNode=t,void(this.isSharingCaptureNodeConnect||(this.sharingWebrtcAudioNode.connect(S.a.SharingAudioNode),S.a.SharingAudioNode.postCMD("StartCaptureAudio",null),this.isSharingCaptureNodeConnect=!0))}},Start_Audio_Capture:function(){if(!at.shouldCaptureAudio()){if(this.audioInputLevel)return this.audioInputLevel.setAudioStream(at.audioStream),this.captureAudioMuted||this.audioInputLevel.start(),void(S.a.ComputerAudioStatus===T.a.ComputerAudio_Connecting&&(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null)));if(this.audioBridge)return void this.audioBridge.publishStream(at.audioStream).then((function(e){S.a.ComputerAudioStatus===T.a.ComputerAudio_Connecting&&(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null))}));var e=this.audioCtx.createMediaStreamSource(at.audioStream);return this.webrtcAudioNode=e,!this.isCaputureNodeConnect&&S.a.AudioNode&&(this.webrtcAudioNode.connect(S.a.AudioNode),S.a.AudioNode.postCMD("StartCaptureAudio",null),this.isCaputureNodeConnect=!0),void(S.a.ComputerAudioStatus===T.a.ComputerAudio_Connecting&&(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null)))}this.StartAudioMediaCapture()},Stop_Audio_Capture:function(){v.Notify_Audio_Thread_Status(S.a.SPECIAL_ID,C.x)},Start_Video_Capture:function(){if(!at.shouldCaptureVideo()){var e=this;return new Promise((function(t,r){var i=function t(){var r,i;e.isSupportVideoFrameOrBitmapCapture?(r=e.videoCaptureWidth,i=e.videoCaptureHeight):(e.isVideoCaptureLoadedmetadata=!0,r=e.videoCaptureValue.videoCtrl.videoWidth,i=e.videoCaptureValue.videoCtrl.videoHeight,e.videoCaptureWidth=r,e.videoCaptureHeight=i,e.captureVideoOutputCanvasDomList.forEach((function(e){e.width=r,e.height=i})),e.videoCaptureValue.videoCtrl.removeEventListener("loadedmetadata",t)),v.Notify_Video_Encode_Thread({command:"startVideoEncode",width:e.videoCaptureWidth,height:e.videoCaptureHeight,fps:e.videoCaptureValue.fps,ssid:e.videoCaptureValue.ssid,mtu_size:e.mtu_size,isSupportImageCapture:e.isSupportImageCapture,isSupportVideoTrackReader:e.isSupportVideoTrackReader,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:e.isSupport2DCanvasDrawFrame,disableOriginalRatio:!!e.videoCaptureValue.disableOriginalRatio}),v.Notify_Video_Decode_Thread({command:"startVideoEncode",ssid:e.videoCaptureValue.ssid,disableOriginalRatio:!!e.videoCaptureValue.disableOriginalRatio}),e.isSupportVideoShare||v.Notify_Sharing_Encode_Thread({command:"startVideoEncode"}),v.Notify_Video_Encode_Thread({command:"updateVideoPara",width:e.videoCaptureWidth,height:e.videoCaptureHeight,fps:e.GetVideoCaptureFps()}),e.lastRealRect.left=0,e.lastRealRect.top=0,e.lastRealRect.width=e.videoCaptureWidth,e.lastRealRect.height=e.videoCaptureHeight,S.a.monitorVideoUserID=e.videoCaptureValue.ssid,S.a.Notify_APPUI(C.hb,{width:r,height:i})};if(e.isSupportVideoFrameOrBitmapCapture){i();try{e.videoCaptureValue.videoCtrl.srcObject=at.videoStream}catch(e){}if(A.g.isGoogleNestChrome()&&!A.g.isHighVersionGoolgeNestChrome()||A.g.isSelfPreviewRenderWithVideo()&&A.g.isSupportVideoFrameOrBitmapCapture()){var a=e.videoCaptureValue.videoCtrl.play();void 0!==a&&a.then((function(){})).catch((function(e){k.a.error("Automatic playback failed",e)}))}t(!0);var n=at.getVideoCapabilities(),o=n.deviceId,s=n.pan,u=void 0===s?null:s,d=n.tilt,c=void 0===d?null:d,h=n.zoom,l=void 0===h?null:h;S.a.Notify_APPUI(C.id,{currentDeviceID:o,PTZRange:{pan:u,tilt:c,zoom:l}})}else{e.videoCaptureValue.videoCtrl.addEventListener("loadedmetadata",i),at.checkVideoStreamActive().then(t).catch(r),at.playVideoStream(e.videoCaptureValue.videoCtrl,{playsinline:!0});var p=at.getVideoCapabilities(),f=p.deviceId,m=p.pan,g=void 0===m?null:m,_=p.tilt,y=void 0===_?null:_,b=p.zoom,E=void 0===b?null:b;S.a.Notify_APPUI(C.id,{currentDeviceID:f,PTZRange:{pan:g,tilt:y,zoom:E}})}}))}this.StartVideoMediaCapture()},Stop_Video_Capture:function(){v.Notify_Video_Encode_Thread({command:"stopVideoEncode"}),v.Notify_Video_Decode_Thread({command:"stopVideoEncode"}),v.Notify_Sharing_Encode_Thread({command:"stopVideoEncode"}),this.isStartVideoCapture=!1,this.isVideoCaptureLoadedmetadata=!1,this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&!this.isMaskSettingOn&&!this.isVBSettingOn&&(this.videoCaptureValue.videoCtrl.pause(),this.videoCaptureValue.videoCtrl.srcObject&&(this.videoCaptureValue.videoCtrl.srcObject=null),this.videoCaptureValue.videoCtrl.src&&(this.videoCaptureValue.videoCtrl.src=null)),at._clearCheckVideoStreamActiveTimer(),this.isMaskSettingOn||this.isVBSettingOn||this.isStartVideoCapture||(at.destoryVideoMediaStream(),this.videoCaptureValue=null),clearInterval(this.videoCaptureInterval),this.videoCaptureInterval=0},Remove_Video_Capture:function(){clearInterval(this.videoCaptureInterval),this.videoCaptureInterval=0,at.destoryVideoMediaStream(),this.videoCaptureValue=null,this.videoCaptureValue.videoCtrl&&this.videoCaptureValue.videoCtrl.pause()},Change_Video_Capture_Resolution:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!A.g.isIpadOS()){var a=!1;(!(A.g.isIphoneOrIpadBrowser()||A.g.isIpadOS()||A.g.isAndroidBrowser())||(a=!0,i||(this.captureSize={width:e,height:t}),this.isLandScape||i))&&(this.videoCaptureHiddenCanvas&&A.g.isMac()&&A.g.browser.isFirefox||(at.changeVideoResolution(e,t,this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:24).then((function(){a||(r.ReadyCapureWidth=e,r.ReadyCapureHeight=t,r.videoCaptureWidth=e,r.videoCaptureHeight=t,S.a.Notify_APPUI(C.hb,{width:e,height:t}),v.Notify_Video_Encode_Thread({command:"updateVideoPara",width:e,height:t,fps:r.videoCaptureValue&&r.videoCaptureValue.fps?r.videoCaptureValue.fps:24}))})),!at.videoStreamTrack||this.isSupportVideoTrackReader||this.isSupportMediaStreamTrackProcessor||this.Process_Video()))}},Start_Whiteboard_Sharing:(ht=u()(g.a.mark((function e(){var t,r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.desktopSharingValue.canvas,this.whiteboardCanvas=i,this.isdesktopCaptureLoadedmetadata=!0,t=i.width,r=i.height,this.desktopSharingCaptureWidth=t,this.desktopSharingCaptureHeight=r,this.desktopCaptureContext=i.getContext("2d"),S.a.monitorSharingUserID=this.desktopSharingValue.ssid,a={command:"startSharingEncode",width:t,height:r,fps:8,ssid:this.desktopSharingValue.ssid,isSupportVideoTrackReader:!1,isSupportMediaStreamTrackProcessor:!1,isWhiteboardSharing:!0},v.Notify_Video_Encode_Thread(a),this.isSupportVideoShare||v.Notify_Sharing_Encode_Thread(a);case 13:case"end":return e.stop()}}),e,this)}))),function(){return ht.apply(this,arguments)}),Change_Sharing_Capture_Resolution:function(e){var t;this.shareTrack&&(console.log("change sharing capture resolution to",e),t=1==e?{video:!0,frameRate:5}:{width:1280,height:720,frameRate:24},this.shareTrack.applyConstraints(t))},Start_Desktop_Sharing:function(){if(this.desktopSharingMediaStram){var e=this;return new Promise((function(t,r){var i=function(){var t=u()(g.a.mark((function t(r){var a,n,o,s,u,d,c;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSupportSharingTrackReader&&!e.isSupportMediaStreamTrackProcessor){t.next=10;break}o=e.desktopSharingMediaStram.getVideoTracks()[0],e.isSupportMediaStreamTrackProcessor?(e.sharingMediaStreamTrackProcessor=new MediaStreamTrackProcessor(o),e.sharingFrameStream=e.sharingMediaStreamTrackProcessor.readable,e.isSupportVideoShare?v.Notify_Sharing_Video_Encode_Thread_Transferable_Data("sharingframeStream",e.sharingFrameStream):v.Notify_Sharing_Encode_Thread_Transferable_Data("frameStream",e.sharingFrameStream),_.a.add_monitor("SCTP")):e.isSupportSharingTrackReader&&(e.sharingTrackReader=new VideoTrackReader(o),_.a.add_monitor("SCTPR")),a=e.desktopSharingValue.video.videoWidth,n=e.desktopSharingValue.video.videoHeight,e.desktopSharingCaptureWidth=a,e.desktopSharingCaptureHeight=n,e.desktopSharingValue.video.removeEventListener("loadedmetadata",i),t.next=33;break;case 10:if(!e.isSharingSupportImageCapture){t.next=24;break}return o=e.desktopSharingMediaStram.getVideoTracks()[0],e.sharingImageCapture=new ImageCapture(o),_.a.add_monitor("SCIC"),t.next=16,e.sharingImageCapture.grabFrame();case 16:s=t.sent,e.desktopSharingCaptureWidth=s.width,e.desktopSharingCaptureHeight=s.height,a=s.width,n=s.height;try{e.replaceCanvasMap.sharingPreviewCanvasId=e.desktopSharingValue.rendercanvasID,e.sharingOffscreenCanvas=e.desktopSharingValue.canvas.transferControlToOffscreen(),u=S.a.SPECIAL_ID,S.a.localSharingEncMGR&&(d=S.a.localSharingEncMGR.map.get(u))&&(c={command:"newSharingPara",rendercanvasID:e.replaceCanvasMap.sharingPreviewCanvasId,data:e.sharingOffscreenCanvas,width:a,height:n,flipSend:e.flipSend,is32bitbrowser:e.is32bitbrowser},d.postMessage(c,[c.data]))}catch(t){u=S.a.SPECIAL_ID,S.a.localSharingEncMGR&&(d=S.a.localSharingEncMGR.map.get(u))&&(c={command:"newSharingPara",flipSend:e.flipSend,is32bitbrowser:e.is32bitbrowser},d.postMessage(c))}t.next=33;break;case 24:e.isdesktopCaptureLoadedmetadata=!0,a=e.desktopSharingValue.video.videoWidth,n=e.desktopSharingValue.video.videoHeight,e.desktopSharingValue.canvas.width=a,e.desktopSharingValue.canvas.height=n,e.desktopSharingCaptureWidth=a,e.desktopSharingCaptureHeight=n,e.desktopCaptureContext=e.desktopSharingValue.canvas.getContext("2d"),e.desktopSharingValue.video.removeEventListener("loadedmetadata",i);case 33:S.a.monitorSharingUserID=e.desktopSharingValue.ssid,e.isSupportVideoShare?v.Notify_Sharing_Video_Encode_Thread({command:"startSharingEncode",width:a,height:n,fps:8,ssid:e.desktopSharingValue.ssid,isSupportVideoTrackReader:e.isSupportSharingTrackReader,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}):v.Notify_Sharing_Encode_Thread({command:"startSharingEncode",width:a,height:n,fps:8,ssid:e.desktopSharingValue.ssid,isSupportVideoTrackReader:e.isSupportSharingTrackReader,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}),S.a.Notify_APPUI(C.lb,{width:a,height:n}),v.Notify_Video_Encode_Thread({command:"startsharingencode"});case 37:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();if(e.isSupportSharingTrackReader||e.isSupportMediaStreamTrackProcessor)e.desktopSharingValue.video.addEventListener("loadedmetadata",i);else{if(e.isSharingSupportImageCapture)return i(),e.desktopSharingValue.video.srcObject=e.desktopSharingMediaStram,e.desktopSharingValue.video.muted=!0,void t(!0);e.desktopSharingValue.video.addEventListener("loadedmetadata",i),e.desktopSharingValue.video.setAttribute("playsinline",""),e.desktopSharingValue.video.muted=!0}try{e.desktopSharingValue.video.srcObject=e.desktopSharingMediaStram,e.desktopSharingValue.video.muted=!0}catch(t){e.desktopSharingValue.video.src=URL.createObjectURL(e.desktopSharingMediaStram)}e.desktopSharingValue.video.play(),t(!0)}))}this.StartDesktopMediaCapture()},SharingFrameOutputCallback:function(e){var t,r,i,a=this;if(null!=e.format&&null!=e.planes)if(t=e.planes[0].stride,r=e.planes[0].rows,t==a.desktopSharingCaptureWidth&&r==a.desktopSharingCaptureHeight||(S.a.Notify_APPUI(C.lb,{width:t,height:r}),a.desktopSharingCaptureWidth=t,a.desktopSharingCaptureHeight=r),1e3==a.sMonitorCaptureFrameCount&&(_.a.add_monitor2("SCFOK"),a.sMonitorCaptureFrameCount=0),a.sMonitorCaptureFrameCount++,a.canISendNextSharingFrame){a.canISendNextSharingFrame=!1;var n=S.a.SPECIAL_ID;if(S.a.localSharingEncMGR){var o=S.a.localSharingEncMGR.map.get(n);if(o){var s={command:"encodeSharingFrame",isSupportVideoTrackReader:a.isSupportSharingTrackReader,data:e};o.postMessage(s)}A.g.browserType.version>=90&&("close"in e?e.close():e.destroy())}}else"close"in e?e.close():e.destroy();else a.canISendNextSharingFrame?(a.canISendNextSharingFrame=!1,e.createImageBitmap().then((function(n){t=(i=n).width,r=i.height,"close"in e?e.close():e.destroy(),t==a.desktopSharingCaptureWidth&&r==a.desktopSharingCaptureHeight||(S.a.Notify_APPUI(C.lb,{width:t,height:r}),a.desktopSharingCaptureWidth=t,a.desktopSharingCaptureHeight=r);var o=S.a.SPECIAL_ID;if(S.a.localSharingEncMGR){var s=S.a.localSharingEncMGR.map.get(o);s&&s.postMessage({command:"encodeSharingFrame",isImageFromSharingFrame:!0,data:i},[i])}})).catch((function(e){k.a.error("Converting sharing frame to image bitmap failed",e)}))):"close"in e?e.close():e.destroy()},Process_Sharing:(ct=u()(g.a.mark((function e(){var t,r,i,a,n,o,s,u,d;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desktopSharingValue&&this.desktopSharingSend){e.next=2;break}return e.abrupt("return");case 2:if(this.isStartWhiteboardSharing||!this.isSupportSharingTrackReader){e.next=14;break}return e.prev=4,e.next=7,this.sharingTrackReader.start(this.SharingFrameOutputCallback.bind(this));case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:return e.abrupt("return");case 14:if(this.isStartWhiteboardSharing||!this.isSharingSupportImageCapture){e.next=35;break}return e.prev=15,e.next=18,this.sharingImageCapture.grabFrame();case 18:a=e.sent,t=a.width,r=a.height,1e3==this.sMonitorCaptureFrameCount&&(_.a.add_monitor2("SCFOK"),this.sMonitorCaptureFrameCount=0),this.sMonitorCaptureFrameCount++,n=S.a.SPECIAL_ID,S.a.localSharingEncMGR&&(o=S.a.localSharingEncMGR.map.get(n))&&(s={command:"encodeSharingFrame",data:a,isImage:!0},o.postMessage(s,[s.data])),e.next=33;break;case 27:e.prev=27,e.t1=e.catch(15),k.a.error("An error occurred when trying to encode a sharing frame using the ImageCapture API",e.t1),_.a.add_monitor3("SICF"),n=S.a.SPECIAL_ID,S.a.localSharingEncMGR&&(o=S.a.localSharingEncMGR.map.get(n))&&(s={command:"encodeSharingFrame"},o.postMessage(s));case 33:e.next=36;break;case 35:this.isStartWhiteboardSharing?(i=this.whiteboardCanvas,t=i.width,r=i.height):(i=this.desktopSharingValue.video,t=i.videoWidth,r=i.videoHeight);case 36:t==this.desktopSharingCaptureWidth&&r==this.desktopSharingCaptureHeight||(S.a.Notify_APPUI(C.lb,{width:t,height:r}),this.desktopSharingCaptureWidth=t,this.desktopSharingCaptureHeight=r);try{this.isdesktopCaptureLoadedmetadata&&i&&(this.isStartDesktopSharing||(this.desktopSharingValue.canvas.width=t,this.desktopSharingValue.canvas.height=r),u=this.desktopCaptureContext,!this.is32bitbrowser||this.flipSend?(this.isStartWhiteboardSharing||u.drawImage(i,0,0,t,r,0,0,t,r),d=u.getImageData(0,0,t,r),1e3==this.sMonitorCaptureFrameCount&&(_.a.add_monitor2("SCFOK"),this.sMonitorCaptureFrameCount=0),this.sMonitorCaptureFrameCount++,v.Sharing_Encode_Frame(S.a.SPECIAL_ID,d.data,d.data.length,0,t,r),this.flipSend=!1):(this.flipSend=!0,v.Sharing_Encode_Frame(S.a.SPECIAL_ID,null,0,0,0,0)))}catch(e){k.a.error("An error occurred when trying to encode a sharing frame",e),_.a.add_monitor3("GIDF"),setTimeout((function(){v.Sharing_Encode_Frame(S.a.SPECIAL_ID,null,0,0,0,0)}),1e3)}case 38:case"end":return e.stop()}}),e,this,[[4,9],[15,27]])}))),function(){return ct.apply(this,arguments)}),VideoFrameOutputCallback:function(e){var t,r,i,a,n=this;if(null!=e.format&&null!=e.planes){i=n.videoCaptureWidth,a=n.videoCaptureHeight,t=e.cropWidth,r=e.cropHeight,t===i&&r===a||(nt("video width/height changed old => begin",i,a,t,r),S.a.Notify_APPUI(C.hb,{width:t,height:r}),v.Notify_Video_Encode_Thread({command:"updateVideoPara",width:t,height:r,fps:n.GetVideoCaptureFps()}),n.videoCaptureWidth=t,n.videoCaptureHeight=r),3e3==n.vMonitorCaptureFrameCount&&(_.a.add_monitor2("VCFOK"),n.vMonitorCaptureFrameCount=0),n.vMonitorCaptureFrameCount++;var o=S.a.SPECIAL_ID;if(S.a.localVideoEncMGR){var s=S.a.localVideoEncMGR.map.get(o);s&&e&&s.postMessage({command:"yuvVideoFrame",data:e}),A.g.browserType.version>=90&&("close"in e?e.close():e.destroy())}}else{var u;e.createImageBitmap().then((function(o){u=o,"close"in e?e.close():e.destroy(),i=n.videoCaptureWidth,a=n.videoCaptureHeight,t=u.width,r=u.height,t===i&&r===a||(nt("video width/height changed old => begin",i,a,t,r),S.a.Notify_APPUI(C.hb,{width:t,height:r}),v.Notify_Video_Encode_Thread({command:"updateVideoPara",width:t,height:r,fps:n.GetVideoCaptureFps()}),n.videoCaptureWidth=t,n.videoCaptureHeight=r);var s=S.a.SPECIAL_ID;if(S.a.localVideoEncMGR){var d=S.a.localVideoEncMGR.map.get(s);d&&d.postMessage({command:"ImageBitmapFromVideoFrame",data:u},[u])}})).catch((function(e){k.a.error("Converting video frame to image bitmap failed",e)}))}},Update_Mask_Texture:function(e,t,r){if(this.bgCanvas&&this.bgCanvasctx||(this.bgCanvas=document.createElement("canvas"),this.bgCanvasctx=this.bgCanvas.getContext("2d")),this.bgCanvas.width=t,this.bgCanvas.height=r,this.bgCanvasctx.clearRect(0,0,t,r),this.MaskImage&&this.BgImage&&"blur"!==this.BgImage){if(e.dWidth>0&&e.dHeight>0&&this.VideoMaskSettingCanvas.width>0&&this.VideoMaskSettingCanvas.height>0&&t>0&&r>0){var i=e.dx/(this.VideoMaskSettingCanvas.width/t),a=e.dy/(this.VideoMaskSettingCanvas.height/r),n=e.dWidth/(this.VideoMaskSettingCanvas.width/t),o=e.dHeight/(this.VideoMaskSettingCanvas.height/r);this.bgCanvasctx.drawImage(this.MaskImage,i,a,n,o)}var s,u,d,c;this.bgCanvasctx.globalCompositeOperation="source-out",this.Crop_Mask_Bg_16V9(),s=this.bgImageCroppingParams.sx,u=this.bgImageCroppingParams.sy,d=this.bgImageCroppingParams.sw,c=this.bgImageCroppingParams.sh,this.bgCanvasctx.drawImage(this.BgImage,s,u,d,c,0,0,t,r)}},Crop_Mask_Bg_16V9:function(){var e,t,r,i=0,a=this.BgImage.naturalWidth,n=this.BgImage.naturalHeight;16/9*n>=a?(r=a,e=0,t=(n-(i=a/(16/9)))/2):(i=n,e=(a-(r=n*(16/9)))/2,t=0),this.bgImageCroppingParams.sx=e,this.bgImageCroppingParams.sy=t,this.bgImageCroppingParams.sw=r,this.bgImageCroppingParams.sh=i},Draw_Mask_Frame:function(){if(this.VideoMaskSettingCanvas){this.VideoMaskSettingCanvasctx||(this.VideoMaskSettingCanvasctx=this.VideoMaskSettingCanvas.getContext("2d"));var e,t,r=this.VideoMaskCanvasFillMode?ue(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height,void 0,void 0,this.VideoMaskSettingCanvas.width/this.VideoMaskSettingCanvas.height):this.videoCaptureValue&&this.videoCaptureValue.disableOriginalRatio?ue(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height):null;if(this.isMirrorMyVideo)this.isCanvasScaled||(this.VideoMaskSettingCanvasctx.scale(-1,1),this.isCanvasScaled=!0),this.VideoMaskSettingCanvasctx.clearRect(0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),(e=this.VideoMaskSettingCanvasctx).drawImage.apply(e,[this.videoCaptureHiddenCanvas].concat(a()(r?[r.left,r.top,r.width,r.height]:[]),[0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height]));else this.isCanvasScaled&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.isCanvasScaled=!1),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),(t=this.VideoMaskSettingCanvasctx).drawImage.apply(t,[this.videoCaptureHiddenCanvas].concat(a()(r?[r.left,r.top,r.width,r.height]:[]),[0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height]))}},GetVideoCaptureFps:function(){return this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:H.q},Process_Video:(dt=u()(g.a.mark((function e(){var t,r,i,a,n,o,s,u,d,c,h,l,p,f,m,y;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSupportMediaStreamTrackProcessor){e.next=2;break}return e.abrupt("return");case 2:if(!this.isSupportVideoTrackReader){e.next=11;break}return e.prev=3,e.next=6,at.videoTrackReader.start(this.VideoFrameOutputCallback.bind(this));case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(3);case 10:return e.abrupt("return");case 11:if(!this.isSupportImageCapture){e.next=17;break}if(!at.isImageCaptureLocked()){e.next=16;break}return e.abrupt("return");case 16:at.lockImageCapture();case 17:if(this.videoCaptureValue&&this.isStartVideoCapture||this.isMaskSettingOn||this.isVBSettingOn){e.next=20;break}return at.unLockImageCapture(),e.abrupt("return");case 20:if(t=this,a=this.videoCaptureWidth,n=this.videoCaptureHeight,!this.isSupportImageCapture){e.next=41;break}return e.prev=24,e.next=27,at.videoImageCapture.grabFrame();case 27:s=e.sent,r=s.width,i=s.height,r&&i&&(r!==a||i!==n)&&(nt("video width/height changed old => begin",a,n,r,i),S.a.Notify_APPUI(C.hb,{width:r,height:i}),v.Notify_Video_Encode_Thread({command:"updateVideoPara",width:r,height:i,fps:this.GetVideoCaptureFps()}),3e3==this.vMonitorCaptureFrameCount&&(_.a.add_monitor2("VCFOK"),this.vMonitorCaptureFrameCount=0),this.vMonitorCaptureFrameCount++,this.videoCaptureWidth=r,this.videoCaptureHeight=i),v.transportImageBitMap(s),e.next=39;break;case 34:e.prev=34,e.t1=e.catch(24),k.a.error("An error occurred when trying to encode a video frame using the ImageCapture API",e.t1),_.a.add_monitor3("VICF"),v.transportImageBitMap(null);case 39:return at.unLockImageCapture(),e.abrupt("return");case 41:u=at.isUsingFileInputVideoSource(),this.isStartVideoCapture?o=this.videoCaptureValue.videoCtrl:(this.isMaskSettingOn||this.isVBSettingOn)&&(o=this.MaskSettingVideo),(this.isVideoCaptureLoadedmetadata||this.isMaskSettingOn||this.isVBSettingOn)&&o&&o.readyState>=2&&((o.paused||o.ended)&&o.play(),r=o.videoWidth?o.videoWidth:640,i=o.videoHeight?o.videoHeight:360,r&&i&&(r!==a||i!==n)&&(nt("video width/height changed old => begin",a,n,r,i),S.a.Notify_APPUI(C.hb,{width:r,height:i}),this.videoCaptureWidth=r,this.videoCaptureHeight=i),(!(!t.isMaskSettingOn||t.videoCaptureValue&&t.videoCaptureValue.disableOriginalRatio)||t.MaskImage&&t.BgImage)&&t.isCurrentInMaskStatus?(p=r/i*t.ReadyCapureHeight,f=i/r*t.ReadyCapureWidth,p>t.ReadyCapureWidth?(d=0,c=(t.ReadyCapureHeight-f)/2):(d=(t.ReadyCapureWidth-p)/2,c=0),h=t.ReadyCapureWidth-2*d,l=t.ReadyCapureHeight-2*c,t.videoCaptureHiddenCanvas.width=t.ReadyCapureWidth,t.videoCaptureHiddenCanvas.height=t.ReadyCapureHeight):(h=r,l=i,d=0,c=0,t.videoCaptureHiddenCanvas.width=r,t.videoCaptureHiddenCanvas.height=i),u?A.g.videoToMediaStreamManager.drawCanvas(t.videoCaptureHiddenCanvas,t.videoCaptureHiddenCanvasCtx,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height):t.videoCaptureHiddenCanvasCtx.drawImage(o,0,0,r,i,d,c,h,l),t.isCurrentInMaskStatus&&(t.bgCanvas?t.videoCaptureHiddenCanvasCtx.drawImage(t.bgCanvas,0,0,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height):t.Update_Mask_Texture(this.maskCoordinate,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height),t.VideoMaskSettingCanvas&&t.Draw_Mask_Frame()),(t.isStartVideoCapture||t.isVBSettingOn)&&(m=t.videoCaptureHiddenCanvasCtx.getImageData(0,0,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height),y=m.data,t.lastRealRect.width==t.videoCaptureHiddenCanvas.width&&t.lastRealRect.height==t.videoCaptureHiddenCanvas.height||(t.lastRealRect.left=0,t.lastRealRect.top=0,t.lastRealRect.width=t.videoCaptureHiddenCanvas.width,t.lastRealRect.height=t.videoCaptureHiddenCanvas.height,v.Notify_Video_Encode_Thread({command:"updateVideoPara",width:t.lastRealRect.width,height:t.lastRealRect.height,fps:t.GetVideoCaptureFps()})),t.videoCaptureValue&&t.VideoRenderObj&&!t.isMultiView&&(m.data instanceof Uint8ClampedArray&&(y=new Uint8Array(m.data.buffer)),t.videoCaptureValue&&void 0!==t.videoCaptureValue.disableOriginalRatio&&t.VideoRenderObj.Set_Cropping_Mode(!!t.videoCaptureValue.disableOriginalRatio),t.VideoRenderObj.Draw_Send_Video_Img(y,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height,t.videoCaptureValue.ssid,H.w,t.lastRealRect)),3e3==t.vMonitorCaptureFrameCount&&(_.a.add_monitor2("VCFOK"),t.vMonitorCaptureFrameCount=0),t.vMonitorCaptureFrameCount++,v.Video_Encode_Frame(S.a.SPECIAL_ID,y,t.videoCaptureHiddenCanvas.width,t.lastRealRect.left,t.lastRealRect.top)),t.videoCaptureHiddenCanvasCtx.clearRect(0,0,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height));case 44:case"end":return e.stop()}}),e,this,[[3,8],[24,34]])}))),function(){return dt.apply(this,arguments)}),Remove_Sharing_Audio_Capture:function(){if(v.Notify_Audio_Encode_Thread({command:"changeAudioShare",isStart:!1}),S.a.ComputerAudioStatus==T.a.ComputerAudio_Null&&v.addAudioMonitorLog.clear(),this.sharingWebrtcAudioNode&&S.a.SharingAudioNode){try{this.sharingWebrtcAudioNode.disconnect(S.a.SharingAudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.sharingWebrtcAudioNode=null}},Remove_Audio_Capture:function(e){if(v.Notify_Audio_Thread_Status(S.a.SPECIAL_ID,C.u,e),S.a.DesktopAudioStatus==T.a.DesktopAudio_Null&&v.addAudioMonitorLog.clear(),this.firstSetDelay=!0,this.webrtcAudioNode&&S.a.AudioNode){try{this.webrtcAudioNode.disconnect(S.a.AudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.webrtcAudioNode=null}},Start_Video_Play:function(){this.videoRenderIntervalHandle||(this.videoRenderIntervalHandle=this.JsMediaSDK_VideoRenderInterval(this.videorenderinterval))},Stop_Video_Play:function(){(this.UpdateVideoPlayStatus(!1),this.VideoRenderObj&&(this.VideoRenderObj.ClearQueue(),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName})),this.videoRenderIntervalHandle)&&(this.VideoRenderObj.Stop_Draw.bind(this.VideoRenderObj)(),this.videoRenderIntervalHandle=null)},Remove_Video_Play:function(){this.UpdateVideoPlayStatus(!1),this.videoRenderIntervalHandle&&(clearInterval(this.videoRenderIntervalHandle),this.videoRenderIntervalHandle=null),v.Notify_Video_Decode_Thread({command:"removeVideoPlay"})},UpdateVideoPlayStatus:function(e){v.UpdateVideoPlayStatus(e)},EndMedia:function(){try{S.a.rwgAgent&&S.a.rwgAgent.off("message",this.rwgAgentMessageListenerWrapper)}catch(e){nt.error("rwgAgent.off error",e)}try{this.rtcPeerConnectionList.forEach((function(e){e&&(e.forceClose(),e=null)})),this.rtcPeerConnectionList=[]}catch(e){nt.error("clear rtcPeerConnectionList err",e)}try{at.destoryAudioMediaStream(),this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.Remove_Sharing_Audio_Capture(),this.Remove_Video_Play(),this.audioCtx&&(this.audioCtx.close(),this.audioCtx=null),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.sharingAudioCtx=null),this.audioDomNode&&(this.audioDomNode=null),at.destoryVideoMediaStream(),this.EndSharingMediaStream(),this.CloseBoringPeerConnection()}catch(e){nt("endMedia",e)}try{v.disableSocketReconnect()}catch(e){nt("endMedia",e)}try{this.remoteControl&&this.remoteControl.destroy()}catch(e){nt("endMedia",e)}},EndDesktopAudioMediaStream:function(){if(this.desktopSharingMediaStram){var e=this.desktopSharingMediaStram.getAudioTracks();e.length&&e.forEach((function(e){e.stop()}))}},EndSharingMediaStream:function(){this.desktopSharingMediaStram&&(this.desktopSharingMediaStram.getTracks().forEach((function(e){e.stop()})),this.desktopSharingMediaStram=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop())},StopSharingCapture:function(){this.EndSharingMediaStream(),this.desktopSharingSend=!1,this.isStartDesktopSharing&&v.Notify_Video_Encode_Thread({command:"stopsharingencode"}),this.isStartDesktopSharing=!1,this.desktopSharingMediaStram=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop(),this.desktopSharingValue=null},CloseBoringPeerConnection:function(){try{this.rtcConnectionB&&(this.rtcConnectionB.close(),this.rtcConnectionB=null),this.rtcConnectionA&&(this.rtcConnectionA.close(),this.rtcConnectionA=null)}catch(e){nt(e)}},UnMuteAudio:function(){this.isSupportBrowserAec&&at.muteUnmuteAudioMediaStream(!1),v.Notify_Audio_Thread_Status(S.a.SPECIAL_ID,C.w),this.enableHID&&this.hidAvalible&&Be.sendReport("mute",!1)},MuteAudio:function(){this.isSupportBrowserAec&&at.muteUnmuteAudioMediaStream(!0),this.Stop_Audio_Capture(),this.enableHID&&this.hidAvalible&&Be.sendReport("mute",!0)},selectComputerAudioSpeaker:function(e,t){var r="default"==e?"":e,i=null;A.g.isSupportChromeWideAEC()&&!this.audioDomNode?this.audioCtx&&(i=this.audioCtx):this.audioDomNode&&(i=this.audioDomNode),i&&i.setSinkId(r).then((function(){tt.sendSpeakerDevice(Date.now()-t,!0)})).catch((function(e){k.a.error("An error occurred when trying to set the audio output device",e),_.a.add_monitor("AODF"),tt.sendSpeakerDevice(Date.now()-t,!1),S.a.Notify_APPUI(C.v,null)}))},handleDesktopCapture:function(e){this.desktopSharingMediaStram=e;var t=this;this.desktopSharingMediaStram.getVideoTracks()[0].onended=function(){_.a.add_monitor("SSBB"),S.a.Notify_APPUI(C.be,null),t.StopSharingCapture()},this.desktopSharingMediaStram.getAudioTracks().length?("Tab audio"!=this.desktopSharingMediaStram.getAudioTracks()[0].label&&(S.a.shareSystemAudio=!0),S.a.Notify_APPUI(C.Qc,null)):S.a.Notify_APPUI(C.Rc,null),this.shareTrack=this.desktopSharingMediaStram.getVideoTracks()[0],this.Start_Desktop_Sharing(),S.a.Notify_APPUI(C.tb,null)},handleCaptureError:function(e){k.a.error("An error occurred when trying to capture sharing",e),this.StopSharingCapture(),_.a.add_monitor("SCCF"),"Permission denied by system"==e.message?S.a.Notify_APPUI(C.xb,null):S.a.Notify_APPUI(C.vb,null)},handleAudioCapture:function(){return this.audioBridge&&!this.audioInputLevel?(this.audioBridge.publishStream(at.audioStream).then((function(e){S.a.ComputerAudioStatus===T.a.ComputerAudio_Connecting&&(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null))})),void S.a.Notify_APPUI(C.Xd,null)):this.audioCtx||this.audioInputLevel?(S.a.Notify_APPUI(C.Xd,null),void this.Start_Audio_Capture()):(S.a.ComputerAudioStatus=T.a.ComputerAudio_Null,S.a.Notify_APPUI(C.Ub,null),void at.destoryAudioMediaStream())},handleVideoCapture:function(e){var t=this;return new Promise(function(){var r=u()(g.a.mark((function r(i,a){var n,o;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return",a(new Error("no stream")));case 2:if(t.videoCaptureWidth?t.videoCaptureWidth=t.videoCaptureWidth:t.videoCaptureWidth=640,t.videoCaptureHeight?t.videoCaptureHeight=t.videoCaptureHeight:t.videoCaptureHeight=360,!t.isStartVideoCapture){r.next=19;break}return r.prev=5,r.next=8,t.Start_Video_Capture();case 8:n=r.sent,i(n),r.next=16;break;case 12:r.prev=12,r.t0=r.catch(5),nt("Start_Video_Capture",r.t0),a(new Error("media stream is ok, but start video capture fail"));case 16:t.isMaskSettingOn&&t.MaskSettingVideo&&at.playVideoStream(t.MaskSettingVideo),r.next=34;break;case 19:if(!t.isMaskSettingOn&&!t.isVBSettingOn){r.next=33;break}return r.prev=20,r.next=23,t.startMaskOrVBSettingVideoCapture(e);case 23:o=r.sent,i(o),r.next=31;break;case 27:r.prev=27,r.t1=r.catch(20),nt("startMaskOrVBSettingVideoCapture",r.t1),a(new Error("media stream is ok, but start setting video capture fail"));case 31:r.next=34;break;case 33:at.destoryVideoMediaStream();case 34:case"end":return r.stop()}}),r,null,[[5,12],[20,27]])})));return function(e,t){return r.apply(this,arguments)}}())},startMaskOrVBSettingVideoCapture:function(e){var t=this;return new Promise((function(e,r){try{if(t.isVBSettingOn)if(t.MaskSettingVideo){var i=at.playVideoStream(t.MaskSettingVideo,{playsinline:A.g.browser.isSafari});i&&i.then((function(){S.a.Notify_APPUI(C.kd,null)})).catch((function(e){r(new Error("media stream is ok, but video.play() fail")),_.a.add_monitor("VBVPF")}))}else S.a.Notify_APPUI(C.kd,null);else if(t.isMaskSettingOn)if(t.MaskSettingVideo){var a=at.playVideoStream(t.MaskSettingVideo,{playsinline:A.g.browser.isSafari});a&&a.then((function(){S.a.Notify_APPUI(C.jd,null)})).catch((function(e){r(new Error("media stream is ok, but video.play() fail")),k.a.error("An error occurred when trying to play video in Background Setting tab",e),_.a.add_monitor("MVPF")}))}else S.a.Notify_APPUI(C.jd,null);if(t.isSupportVideoShare){var n=new MessageChannel;v.Notify_Video_Thread_Msg_Channel(n,n)}v.Notify_Video_Encode_Thread({command:"startvideointerval",width:t.videoCaptureValue.width,height:t.videoCaptureValue.height,ssid:t.videoCaptureValue.ssid,mtu_size:t.mtu_size,fps:t.videoCaptureValue.fps,isSupportImageCapture:t.isSupportImageCapture,isSupportVideoTrackReader:t.isSupportVideoTrackReader,isSupportMediaStreamTrackProcessor:t.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:t.isSupport2DCanvasDrawFrame,isVBSettingOn:t.isVBSettingOn,isMaskSettingOn:t.isMaskSettingOn}),e(!0)}catch(e){k.a.error("Starting mask or virtual background failed",e),r(e)}}))},handleAudioError:function(e){k.a.error("Error occurred when trying to capture audio",e),_.a.add_monitor("HADF"),S.a.Notify_APPUI(C.Vd,e),S.a.ComputerAudioStatus===T.a.ComputerAudio_Connecting&&(S.a.ComputerAudioStatus=T.a.ComputerAudio_Null,S.a.Notify_APPUI(C.Ub,null))},handleVideoError:function(e){S.a.monitorVideoCapture=!1,nt("handleVideoError",e),k.a.error("Error occurred when trying to capture video",e);e instanceof E||e.name&&-1!==["NotReadableError","SourceUnavailableError"].indexOf(e.name)?(_.a.add_monitor("COCPEF"),S.a.Notify_APPUI(C.Td,e)):(_.a.add_monitor("HVDF"),S.a.Notify_APPUI(C.Wd,e)),this.Stop_Video_Capture()},chromeAecWorkAround:(ut=u()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.a.add_monitor("ASCAEC"),!this.rtcConnectionA&&!this.rtcConnectionB){e.next=3;break}return e.abrupt("return",!1);case 3:return r=null,i=null,a=new MediaStream,n={offerVideo:!0,offerAudio:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1},r=new RTCPeerConnection,i=new RTCPeerConnection,r.onicecandidate=function(e){return e.candidate&&i.addIceCandidate(new RTCIceCandidate(e.candidate))},i.onicecandidate=function(e){return e.candidate&&r.addIceCandidate(new RTCIceCandidate(e.candidate))},i.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){a.addTrack(e)}))},r.addStream(t),e.next=15,r.createOffer(n);case 15:return o=e.sent,u=!1,d=null,c=null,h=A.g.getBrowserVersion(),e.prev=20,c=o.sdp,d=h>=104?(d=o.sdp.replace("SAVPF 111","SAVPF 100 111")).replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2"):(d=o.sdp.replace("SAVPF 111","SAVPF 10 111")).replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"),o.sdp=d,e.next=26,r.setLocalDescription(o);case 26:return e.next=28,i.setRemoteDescription(o);case 28:e.next=38;break;case 30:return e.prev=30,e.t0=e.catch(20),u=!0,o.sdp=c,e.next=36,r.setLocalDescription(o);case 36:return e.next=38,i.setRemoteDescription(o);case 38:return e.next=40,i.createAnswer();case 40:return s=e.sent,u||(h>=104?(s.sdp=s.sdp.replace("SAVPF 111","SAVPF 100 111"),s.sdp=s.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2")):(s.sdp=s.sdp.replace("SAVPF 111","SAVPF 10 111"),s.sdp=s.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"))),e.next=44,i.setLocalDescription(s);case 44:return e.next=46,r.setRemoteDescription(s);case 46:return this.rtcConnectionA=r,this.rtcConnectionB=i,e.abrupt("return",a);case 49:case"end":return e.stop()}}),e,this,[[20,30]])}))),function(e){return ut.apply(this,arguments)}),switchCanvasForVideoCapture:function(e){var t=[].concat(e),r=t[0];if(this.captureVideoOutputCanvasDomList=t,this.videoCaptureValue.canvasCtrl=r,!this.isSupportVideoFrameOrBitmapCapture){var i=this.videoCaptureValue.videoCtrl.videoWidth,a=this.videoCaptureValue.videoCtrl.videoHeight;t.forEach((function(e){e.width=i,e.height=a})),this.videoCaptureValue.canvasCtrl.width=i,this.videoCaptureValue.canvasCtrl.height=a,this.videoCaptureContext=r.getContext("2d")}},videoDecodeFrameBackSABRingBufferConsumeCallback:function(e){var t=new ke;t.setBuffer(e);var r=t.buffer2Obj();v.Put_Video_Frame_Buffer(r.video_ssrc,r.data,r.video_timestamp,r.video_width,r.video_height,r.rendering_x,r.rendering_y,r.rendering_w,r.rendering_h,r.rotation,r.yuv_limited),this.VideoRenderObj.JsMediaSDK_VideoRender.bind(this.VideoRenderObj)()},consumeVideoEncodeRingbuffer:function(e){this.videoDataChannel&&this.videoDataChannel.sendVideoData(e)},audioEncodeRingBufferConsumerCallback:function(e){this.audioDataChannel&&this.audioDataChannel.sendAudioData(e)},CheckCurrentActiveSSRC:function(e){this.currentactive!=e&&(this.currentactive=e,S.a.CurrentSSRC=this.currentactive,S.a.decoderinworklet?S.a.AudioNode&&S.a.AudioNode.postCMD("currentSSRC",S.a.CurrentSSRC):v.Notify_Audio_Thread_CurrentSSRC(S.a.CurrentSSRC))},createVideoElement:function(){this.MaskSettingVideo||(this.videoCaptureValue&&this.videoCaptureValue.videoCtrl?this.MaskSettingVideo=this.videoCaptureValue.videoCtrl:(this.MaskSettingVideo=document.createElement("video"),A.g.browser.isSafari&&(this.MaskSettingVideo.setAttribute("style","position:fixed;top:-10000px;left:-10000px;"),document.body.appendChild(this.MaskSettingVideo))))},Notify_MeidaSDK:(st=u()(g.a.mark((function e(t,r){var i,a,n,o,s,u,d,c,h,l,p,f,m,y,E,I,M,D,P,O,N,L,W,U,B,F,G,j,K,q,Q,J,X,Y,Z,$,ee,re,ie,ae,ne,oe,se,ue,de,ce,he,le,pe,fe,ge,ve,Se,_e,ye,be,Ae,ke,Ee,Ie,we,Me,De,Re,Te,Pe,xe,Oe,Ve,Ne,Le,We,Ue,Fe,Ge,He,je,qe,Qe,ze,Je,Xe,Ye,Ze,$e,et,rt,ot,st,ut,dt,ct,ht,lt,pt,ft,mt,gt,vt,St,_t,Ct,yt=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:nt(t,r),i=0,_.a.add_monitor2("B"+t),e.t0=t,e.next=e.t0===C.ld?6:e.t0===C.Sd?48:e.t0===C.vd?65:e.t0===C.pe?71:e.t0===C.Nd?129:e.t0===C.Ld?132:e.t0===C.Od?157:e.t0===C.Gb?192:e.t0===C.ec?201:e.t0===C.oc?205:e.t0===C.O?207:e.t0===C.b?209:e.t0===C.Md?250:e.t0===C.hf?254:e.t0===C.qd?257:e.t0===C.wd?263:e.t0===C.ad?265:e.t0===C.nd?274:e.t0===C.a?277:e.t0===C.pd?279:e.t0===C.sc?281:e.t0===C.Id?284:e.t0===C.lc?295:e.t0===C.fd?306:e.t0===C.rd?313:e.t0===C.Rd?321:e.t0===C.W?335:e.t0===C.ab?336:e.t0===C.T?337:e.t0===C.m?347:e.t0===C.Z?349:e.t0===C.Y?358:e.t0===C.U?364:e.t0===C.V?368:e.t0===C.bc?371:e.t0===C.dc?373:e.t0===C.Eb?375:e.t0===C.S?379:e.t0===C.Te?393:e.t0===C.Xb?395:e.t0===C.Tb?432:e.t0===C.Vb?609:e.t0===C.Zb?659:e.t0===C.cd?675:e.t0===C.P?687:e.t0===C.Qd?689:e.t0===C.Ac?691:e.t0===C.bd?693:e.t0===C.od?708:e.t0===C.rc?720:e.t0===C.Bc?729:e.t0===C.hd?739:e.t0===C.gd?744:e.t0===C.sd?757:e.t0===C.bb?766:e.t0===C.db?772:e.t0===C.Zd?787:e.t0===C.A?795:e.t0===C.q?797:e.t0===C.p?799:e.t0===C.o?801:e.t0===C.me?803:e.t0===C.ne?814:"update_videohd_value"===e.t0?816:e.t0===C.Hc?819:e.t0===C.ae?821:e.t0===C.Pd?825:e.t0===C.Kc?829:e.t0===C.Yc?831:e.t0===C.N?833:e.t0===C.yd?835:e.t0===C.i?838:e.t0===C.M?840:e.t0===C.Cb?842:e.t0===C.Ab?844:e.t0===C.Se?846:e.t0===C.X?855:e.t0===C.Db?872:e.t0===C.xd?874:e.t0===C.Jc?876:e.t0===C.Yd?879:e.t0===C.jc?881:e.t0===C.pc?883:e.t0===C.Bb?885:e.t0===C.tc?887:e.t0===C.yb?889:e.t0===C.Ue?891:e.t0===C.md?894:e.t0===C.Gc?896:e.t0===C.fc?901:906;break;case 6:if(n=0,o=0,(a=this).isVBSettingOn=!0,a.isCurrentInMaskStatus=!1,n=r.width?r.width:640,o=r.height?r.height:360,a.videoCaptureWidth?a.videoCaptureWidth=a.videoCaptureWidth:a.videoCaptureWidth=n,a.videoCaptureHeight?a.videoCaptureHeight=a.videoCaptureHeight:a.videoCaptureHeight=o,v.Notify_Video_Encode_Thread({command:"StartVBSetting"}),!r.bgdom){e.next=28;break}if("blur"!=r.bgdom){e.next=21;break}v.Notify_Video_Encode_Thread({command:"vbbgimagebitmap",data:r.bgdom}),e.next=28;break;case 21:if((s=document.getElementById(r.bgdom))&&s.naturalWidth&&s.naturalHeight){e.next=26;break}return _.a.add_monitor("VBGF"),S.a.Notify_APPUI(C.ue,2),e.abrupt("return");case 26:a.BgImage=s,createImageBitmap(s).then((function(e){v.transportVBBgImageBitMap(e,"BgImage")})).catch((function(e){_.a.add_monitor("VBCF"),S.a.Notify_APPUI(C.ue,2)}));case 28:if(!r.canvas){e.next=35;break}if(a.VideoVBSettingCanvas=document.getElementById(r.canvas),!(!a.VideoVBSettingCanvas||a.VideoVBSettingCanvas.width<=0||a.VideoVBSettingCanvas.height<=0)){e.next=34;break}return _.a.add_monitor("VBCAF"),S.a.Notify_APPUI(C.ue,3),e.abrupt("return");case 34:try{u=a.VideoVBSettingCanvas.transferControlToOffscreen(),v.transportSettingCanvas(u,"VBOfflineCanvas",r.canvas)}catch(e){v.transportSettingCanvas(null,"VBOfflineCanvas",r.canvas)}case 35:if(a.isSupportVideoFrameOrBitmapCapture||(a.createVideoElement(),a.videoCaptureHiddenCanvas||(a.videoCaptureHiddenCanvas=A.g.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),a.videoCaptureHiddenCanvasCtx=a.videoCaptureHiddenCanvas.getContext("2d"))),!at.shouldCaptureVideo()){e.next=46;break}if(v.isVideoEncodeHandleReady()){e.next=41;break}return nt.warn("not isVideoEncodeHandleReady so return"),_.a.add_monitor("not isVideoEncodeHandleReady so return"),e.abrupt("return");case 41:a.videoCaptureValue?a.videoCaptureValue=Object.assign(a.videoCaptureValue,r):a.videoCaptureValue=r,a.videoCaptureValue.ssid&&(S.a.localSsrc=a.videoCaptureValue.ssid),a.StartVideoMediaCapture(),e.next=47;break;case 46:a.MaskSettingVideo&&at.playVideoStream(a.MaskSettingVideo);case 47:return e.abrupt("break",907);case 48:if(!r.bgdom){e.next=62;break}if("blur"!=r.bgdom){e.next=53;break}v.Notify_Video_Encode_Thread({command:"vbbgimagebitmap",data:r.bgdom}),e.next=60;break;case 53:if((d=document.getElementById(r.bgdom))&&d.width&&d.height){e.next=58;break}return _.a.add_monitor("VBGF"),S.a.Notify_APPUI(C.ue,2),e.abrupt("return");case 58:this.BgImage=d,createImageBitmap(d).then((function(e){v.transportVBBgImageBitMap(e,"BgImage")})).catch((function(e){_.a.add_monitor("VBCF"),S.a.Notify_APPUI(C.ue,2)}));case 60:e.next=64;break;case 62:this.BgImage=null,v.transportVBBgImageBitMap(null,"BgImage");case 64:return e.abrupt("break",907);case 65:return this.isVBSettingOn=!1,r.isSwitch&&(this.isMaskSettingOn=!0,v.Notify_Video_Encode_Thread({command:"StartMaskSetting",isSwitch:r.isSwitch})),v.Notify_Video_Encode_Thread({command:"finishVBSetting"}),this.isStartVideoCapture||this.isMaskSettingOn||this.Stop_Video_Capture(),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),e.abrupt("break",907);case 71:if(!this.isMaskSettingStarted){e.next=73;break}return e.abrupt("return");case 73:if(this.isMaskSettingStarted=!0,n=0,o=0,(c=this).isCurrentInMaskStatus=!0,c.isMaskSettingOn=!0,n=r.width?r.width:640,o=r.height?r.height:360,c.ReadyCapureWidth=n,c.ReadyCapureHeight=o,c.videoCaptureWidth?c.videoCaptureWidth=c.videoCaptureWidth:c.videoCaptureWidth=n,c.videoCaptureHeight?c.videoCaptureHeight=c.videoCaptureHeight:c.videoCaptureHeight=o,!r.maskdom){e.next=96;break}if((h=document.getElementById(r.maskdom))&&h.width&&h.height){e.next=90;break}return S.a.Notify_APPUI(C.cc,1),e.abrupt("return");case 90:c.MaskImage=h,c.maskCoordinate.dx=r.dx?r.dx:c.maskCoordinate.dx,c.maskCoordinate.dy=r.dy?r.dy:c.maskCoordinate.dy,c.maskCoordinate.dWidth=r.dWidth?r.dWidth:c.maskCoordinate.dWidth,c.maskCoordinate.dHeight=r.dHeight?r.dHeight:c.maskCoordinate.dHeight,c.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(h).then((function(e){v.transportMaskImageBitMap(e,"MaskImage",c.maskCoordinate,c.videoCaptureWidth,c.videoCaptureHeight)})).catch((function(e){S.a.Notify_APPUI(C.cc,1)}));case 96:if(!r.bgdom){e.next=104;break}if((l=document.getElementById(r.bgdom))&&l.naturalWidth&&l.naturalHeight){e.next=102;break}return _.a.add_monitor("VMGF"),S.a.Notify_APPUI(C.cc,2),e.abrupt("return");case 102:c.BgImage=l,c.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(l).then((function(e){v.transportBgImageBitMap(e,"BgImage")})).catch((function(e){_.a.add_monitor("VMCF"),S.a.Notify_APPUI(C.cc,2)}));case 104:if(!r.canvas){e.next=111;break}if(c.VideoMaskSettingCanvas=document.getElementById(r.canvas),c.PrevVideoMaskSettingCanvas=c.VideoMaskSettingCanvas,c.replaceCanvasMap.videoMaskSettingCanvasId=r.canvas,!(!c.VideoMaskSettingCanvas||c.VideoMaskSettingCanvas.width<=0||c.VideoMaskSettingCanvas.height<=0)){e.next=111;break}return S.a.Notify_APPUI(C.cc,3),e.abrupt("return");case 111:if(c.isSupportVideoFrameOrBitmapCapture||c.createVideoElement(),this.VideoMaskCanvasFillMode=r.fillMode?1:0,v.Notify_Video_Encode_Thread({command:"StartMaskSetting",fillMode:this.VideoMaskCanvasFillMode}),at.shouldCaptureVideo()){e.next=119;break}c.MaskSettingVideo&&at.playVideoStream(c.MaskSettingVideo),c.isMaskSettingOn&&S.a.Notify_APPUI(C.jd,null),e.next=127;break;case 119:if(c.videoCaptureHiddenCanvas||c.isSupportVideoFrameOrBitmapCapture||(c.videoCaptureHiddenCanvas=A.g.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),c.videoCaptureHiddenCanvasCtx=c.videoCaptureHiddenCanvas.getContext("2d")),v.isVideoEncodeHandleReady()){e.next=124;break}return nt.warn("not isVideoEncodeHandleReady so return"),_.a.add_monitor("not isVideoEncodeHandleReady so return"),e.abrupt("return");case 124:c.videoCaptureValue?c.videoCaptureValue=Object.assign(c.videoCaptureValue,r):c.videoCaptureValue=r,c.videoCaptureValue.ssid&&(S.a.localSsrc=c.videoCaptureValue.ssid),c.StartVideoMediaCapture();case 127:if(c.isSupportVideoFrameOrBitmapCapture||A.g.isSupportVideoFrameOrBitmapCapture()&&A.g.isSelfPreviewRenderWithVideo())try{u=c.VideoMaskSettingCanvas.transferControlToOffscreen(),v.transportSettingCanvas(u,"MaskOfflineCanvas",c.replaceCanvasMap.videoMaskSettingCanvasId)}catch(e){v.transportSettingCanvas(null,"MaskOfflineCanvas",c.replaceCanvasMap.videoMaskSettingCanvasId)}else c.Update_Mask_Texture(c.maskCoordinate,c.videoCaptureWidth,c.videoCaptureHeight);return e.abrupt("break",907);case 129:return p=r.canvas,this.isSupportImageCapture||A.g.isSupportImageCapture()&&A.g.isSelfPreviewRenderWithVideo()?(f=S.a.SPECIAL_ID,S.a.localVideoEncMGR&&(m=S.a.localVideoEncMGR.map.get(f))&&(y={command:"update_mask_canvas_size",rendercanvasID:p,width:r.width,height:r.height},m.postMessage(y))):(r.canvas=document.getElementById(p),r.canvas&&(r.canvas.width=r.width,r.canvas.height=r.height)),e.abrupt("break",907);case 132:if(!this.isSupportVideoFrameOrBitmapCapture){e.next=146;break}if(!r.bgdom){e.next=142;break}if((E=document.getElementById(r.bgdom))&&E.width&&E.height){e.next=138;break}return S.a.Notify_APPUI(C.cc,2),e.abrupt("return");case 138:this.BgImage=E,createImageBitmap(E).then((function(e){v.transportBgImageBitMap(e,"BgImage")})).catch((function(e){S.a.Notify_APPUI(C.cc,2)})),e.next=144;break;case 142:this.BgImage=null,v.transportBgImageBitMap(null,"BgImage");case 144:e.next=156;break;case 146:if(!r.bgdom){e.next=154;break}if((I=document.getElementById(r.bgdom))&&I.width&&I.height){e.next=151;break}return S.a.Notify_APPUI(C.cc,2),e.abrupt("return");case 151:this.BgImage=I,e.next=155;break;case 154:this.BgImage=null;case 155:this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);case 156:return e.abrupt("break",907);case 157:if(this.maskCoordinate.dx=r.dx,this.maskCoordinate.dy=r.dy,this.maskCoordinate.dWidth=r.dWidth,this.maskCoordinate.dHeight=r.dHeight,!this.isSupportVideoFrameOrBitmapCapture){e.next=181;break}if(!r.maskdom){e.next=174;break}if((M=document.getElementById(r.maskdom))&&M.width&&M.height){e.next=167;break}return S.a.Notify_APPUI(C.cc,1),e.abrupt("return");case 167:this.MaskImage=M,D=this.maskCoordinate,P=this.videoCaptureWidth,O=this.videoCaptureHeight,createImageBitmap(M).then((function(e){v.transportMaskImageBitMap(e,"MaskImage",D,P,O)})).catch((function(e){S.a.Notify_APPUI(C.cc,1)})),e.next=179;break;case 174:this.MaskImage=null,N=this.maskCoordinate,L=this.videoCaptureWidth,W=this.videoCaptureHeight,v.transportMaskImageBitMap(null,"MaskImage",N,L,W);case 179:e.next=191;break;case 181:if(!r.maskdom){e.next=189;break}if((U=document.getElementById(r.maskdom))&&U.width&&U.height){e.next=186;break}return S.a.Notify_APPUI(C.cc,1),e.abrupt("return");case 186:this.MaskImage=U,e.next=190;break;case 189:this.MaskImage=null;case 190:this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);case 191:return e.abrupt("break",907);case 192:return this.isMaskSettingStarted=!1,this.isMaskSettingOn=!1,r.isSwitch&&(this.isVBSettingOn=!0,v.Notify_Video_Encode_Thread({command:"StartVBSetting",isSwitch:r.isSwitch})),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),this.VideoMaskSettingCanvas&&(this.VideoMaskSettingCanvasctx&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),this.VideoMaskSettingCanvasctx=null),this.VideoMaskSettingCanvas=null),this.isCanvasScaled=!1,v.Notify_Video_Encode_Thread({command:"finishMaskSetting"}),this.isStartVideoCapture||this.isVBSettingOn||this.Stop_Video_Capture(),e.abrupt("break",907);case 201:return this.isMirrorMyVideo=r.isMirrorMyVideo,v.Notify_Video_Encode_Thread({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo}),this.isSupportOffscreenCanvas?(this.VideoRenderObj&&this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo),v.Notify_Video_Decode_Thread({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo,isSupportOffscreenCanvas:this.isSupportOffscreenCanvas})):(this.VideoRenderObj||(this.VideoRenderObj=new me(Object.assign({},it({Notify_APPUI:S.a.Notify_APPUI.bind(S.a),isSupportOffscreenCanvas:!1,jsMediaEngine:v,globalTracingLogger:k.a},S.a.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:4}:{})))),this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo)),e.abrupt("break",907);case 205:return v.Notify_Video_Decode_Thread({command:"newActiveSpeakerSsrc",ssrc:r.ssrc}),e.abrupt("break",907);case 207:return v.Notify_Video_Decode_Thread({command:"cancelNewActiveSpeakerSsrcBefreCallback",ssrc:r.ssrc,haddata:r.haddata}),e.abrupt("break",907);case 209:if(r.ssrc=r.userId,r.canvas=document.getElementById(r.canvas),r.x=Math.floor(r.x),r.y=Math.floor(r.y),r.width=Math.floor(r.width),r.height=Math.floor(r.height),this.isCreateVideoWaterMark=r.enableWaterMark,this.videoWaterMarkName=this.isCreateVideoWaterMark?r.waterMarkText:"",this.isMultiView||r.isMyself||this.CheckCurrentActiveSSRC(r.ssrc),!(this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||S.a.enableVirtualBackgroundWithoutSAB)){e.next=229;break}B=A.e.getIsRenderSelfVideoInEncodeWorker(S.a.localSsrc&&Object(A.b)(r.ssrc)===Object(A.b)(S.a.localSsrc)),F=B?S.a.localVideoEncMGR:S.a.localVideoDecMGR,G=S.a.SPECIAL_ID,j=r.canvas.id,this.replaceCanvasMap.videoDecodeCanvasIds||(this.replaceCanvasMap.videoDecodeCanvasIds=[]),this.replaceCanvasMap.videoEncodeCanvasIds||(this.replaceCanvasMap.videoEncodeCanvasIds=[]),B?-1===this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(j)&&this.replaceCanvasMap.videoEncodeCanvasIds.push(j):-1===this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(j)&&this.replaceCanvasMap.videoDecodeCanvasIds.push(j);try{F&&(K=r.canvas.transferControlToOffscreen(),(q=F.map.get(G))&&(Q={command:"renderOfflineCanvas",ssrc:r.ssrc,rendercanvasID:j,canvas:K,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,waterMarkText:r.waterMarkText,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition,x:r.x,y:r.y,width:r.width,height:r.height,zone:r.zone,fillMode:r.fillMode,fillModeForResolution:r.fillModeForResolution},q.postMessage(Q,[K])))}catch(e){F&&(J=F.map.get(G))&&(X={command:"renderOfflineCanvas",rendercanvasID:j,ssrc:r.ssrc,videoWaterMarkName:this.videoWaterMarkName,isCreateVideoWaterMark:this.isCreateVideoWaterMark,waterMarkText:r.waterMarkText,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition,x:r.x,y:r.y,width:r.width,height:r.height,zone:r.zone,fillMode:r.fillMode,fillModeForResolution:r.fillModeForResolution},J.postMessage(X))}e.next=248;break;case 229:if(r.isMyself||v.Notify_Video_Decode_Thread({command:"RenderInMain"}),!this.videoRenderArray.length){e.next=238;break}i=0;case 232:if(!(i<this.videoRenderArray.length)){e.next=238;break}if(this.videoRenderArray[i].ssrc!=r.ssrc||this.videoRenderArray[i].zone!=r.zone){e.next=235;break}return e.abrupt("return");case 235:i++,e.next=232;break;case 238:if(this.videoRenderArray.push(r),this.VideoRenderObj||(this.VideoRenderObj=new me(Object.assign({},it(it({Notify_APPUI:S.a.Notify_APPUI.bind(S.a),isSupportOffscreenCanvas:!1,jsMediaEngine:v},S.a.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:4}:{}),{},{globalTracingLogger:k.a})))),r.canvasList&&r.canvasList.forEach((function(e){yt.videoRenderArray.push(Object.assign({},r,{canvas:e}))})),!this.bVideoDecodeWorker2MainUsingSAB){e.next=244;break}return e.next=244,this.bVideoDecodeWorker2MainSABPostSuccessDeferred.promise;case 244:this.bVideoDecodeWorker2MainUsingSAB||(nt("Start_Video_Play"),this.Start_Video_Play()),this.VideoRenderObj.Set_Render_Array(this.videoRenderArray,S.a.enableMultiDecodeVideoWithoutSAB),this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition});case 248:return v.UpdateVideoPlayStatus(!0),e.abrupt("break",907);case 250:return Y=r.canvas,this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||S.a.enableVirtualBackgroundWithoutSAB?(f=S.a.SPECIAL_ID,Z=null,S.a.localVideoEncMGR&&S.a.enableVirtualBackgroundWithoutSAB&&(Z=S.a.localVideoEncMGR.map.get(f)),S.a.localVideoDecMGR&&(m=S.a.localVideoDecMGR.map.get(f))&&(y={command:"update_canvas_size",rendercanvasID:Y,width:r.width,height:r.height},m.postMessage(y),Z&&Z.postMessage(y))):(r.canvas=document.getElementById(Y),r.canvas&&(r.canvas.width=r.width,r.canvas.height=r.height)),this.UpdateVideoPlayStatus(!0),e.abrupt("break",907);case 254:if((this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||S.a.enableVirtualBackgroundWithoutSAB)&&($=A.e.getIsRenderSelfVideoInEncodeWorker(S.a.localSsrc&&Object(A.b)(r.userId)===Object(A.b)(S.a.localSsrc)),ee=S.a.SPECIAL_ID,m=null,$&&S.a.localVideoEncMGR?m=S.a.localVideoEncMGR.map.get(ee):S.a.localVideoDecMGR&&(m=S.a.localVideoDecMGR.map.get(ee)),m&&(y={command:"zoomrender",ssrc:r.userId,x:r.x,y:r.y,width:r.width,height:r.height,canvas:r.canvas,zone:r.zone,RGBA:r.RGBA},m.postMessage(y))),this.videoRenderArray.length)for(i=0;i<this.videoRenderArray.length;i++)this.videoRenderArray[i].ssrc==r.userId&&this.videoRenderArray[i].zone==r.zone&&(this.videoRenderArray[i].x=r.x,this.videoRenderArray[i].y=r.y,this.videoRenderArray[i].width=r.width,this.videoRenderArray[i].height=r.height);return e.abrupt("break",907);case 257:if(this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,r.ssrc=r.userId,(this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||S.a.enableVirtualBackgroundWithoutSAB)&&(A.e.getIsRenderSelfVideoInEncodeWorker(S.a.localSsrc&&Object(A.b)(r.ssrc)===Object(A.b)(S.a.localSsrc))?v.Notify_Video_Encode_Thread:v.Notify_Video_Decode_Thread)({command:"stopVideoRender",ssrc:r.ssrc,canvas:r.canvas,RGBA:r.RGBA,doNotClean:r.doNotClean,x:r.x,y:r.y,zone:r.zone}),this.videoRenderArray.length)for(i=0;i<this.videoRenderArray.length;i++)this.videoRenderArray[i].ssrc==r.ssrc&&this.videoRenderArray[i].zone==r.zone&&(re=this.videoRenderArray.splice(i,1),r.doNotClean||this.VideoRenderObj.clearUseridRender(re,r.RGBA),S.a.enableMultiDecodeVideoWithoutSAB&&this.VideoRenderObj.GiveBack_Display(re),this.VideoRenderObj.Set_Render_Array(this.videoRenderArray,S.a.enableMultiDecodeVideoWithoutSAB),0==this.videoRenderArray.length&&(v.Notify_Video_Decode_Thread({command:"stopVideoRender",MFlag:!0}),this.Stop_Video_Play()));return e.abrupt("break",907);case 263:return this.isSupportVideoFrameOrBitmapCapture?(this.videoCaptureValue.videoCtrl&&!this.videoCaptureValue.videoCtrl.paused&&this.videoCaptureValue.videoCtrl.pause(),this.videoCaptureValue.videoCtrl.srcObject&&(this.videoCaptureValue.videoCtrl.srcObject=null),this.videoCaptureValue.videoCtrl.src&&(this.videoCaptureValue.videoCtrl.src=null),ie=r instanceof Array?r[0]:r,ae=A.g.getDocumentHandle(ie),this.videoCaptureValue.videoCtrl=ae,this.captureVideoOutPutVideoDom=ae,at.playVideoStream(this.videoCaptureValue.videoCtrl)):(ne=[],r instanceof Array?ne=r:ne.push(r),oe=this.videoCaptureValue.canvasCtrlList,se=oe.filter((function(e){return-1!==ne.indexOf(e.k)})).map((function(e){return e.dom})),this.switchCanvasForVideoCapture(se)),e.abrupt("break",907);case 265:if(v.Update_Video_Encrpt(S.a.e2eencrypt),this.isSupportVideoShare&&(ue=new MessageChannel,v.Notify_Video_Thread_Msg_Channel(ue,ue)),this.videoCaptureHiddenCanvas||this.isSupportVideoFrameOrBitmapCapture||(this.videoCaptureHiddenCanvas=A.g.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),this.videoCaptureHiddenCanvasCtx=this.videoCaptureHiddenCanvas.getContext("2d")),v.isVideoEncodeHandleReady()){e.next=272;break}return nt.warn("not isVideoEncodeHandleReady so return"),_.a.add_monitor("not isVideoEncodeHandleReady so return"),e.abrupt("return");case 272:return this.isStartVideoCapture?nt.warn("video capture is already started, do not call again."):(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},r),this.isStartVideoCapture=!0,this.bVideoEncodeMainThreadConsumerIntervalEnable&&this.videoEncodeRingbufferConsumer&&this.videoEncodeRingbufferConsumer.consume(),this.isSupportVideoTrackReader||this.isSupportMediaStreamTrackProcessor?(r.canvas instanceof Array?r.canvas[0]:r.canvas,A.g.isGoogleNestChrome()&&!A.g.isHighVersionGoolgeNestChrome()||A.g.isSelfPreviewRenderWithVideo()&&A.g.isSupportVideoFrameOrBitmapCapture()?r.videoCtrl=document.getElementById(r.video):this.MaskSettingVideo?r.videoCtrl=this.MaskSettingVideo:r.videoCtrl=document.createElement("video")):(r.canvasCtrlList=[],r.canvasCtrl=this.videoCaptureHiddenCanvas,A.g.isSelfPreviewRenderWithVideo()?r.videoCtrl=document.getElementById(r.video):A.g.browser.isSafari?this.MaskSettingVideo?r.videoCtrl=this.MaskSettingVideo:((de=document.createElement("video")).setAttribute("style","position:fixed;top:-10000px;left:-10000px;"),document.body.appendChild(de),r.videoCtrl=de):this.MaskSettingVideo?r.videoCtrl=this.MaskSettingVideo:r.videoCtrl=document.createElement("video")),this.ReadyCapureWidth=r.width?r.width:640,this.ReadyCapureHeight=r.width?r.height:360,this.captureVideoOutPutVideoDom=r.videoCtrl,this.videoCaptureValue=r,this.videoCaptureValue.ssid&&(S.a.localSsrc=this.videoCaptureValue.ssid),this.Start_Video_Capture()),e.abrupt("break",907);case 274:return ce=this,e.abrupt("return",new Promise((function(e,t){try{if(yt.bVideoEncodeMainThreadConsumerIntervalEnable&&yt.videoEncodeRingbufferConsumer&&yt.videoEncodeRingbufferConsumer.cancelConsume(),at.isCaptureVideoInProgress)return S.a.Notify_APPUI(C.td,null),t(new Error("Too many calls : the device is opening camera now, cannot stop video capture"));ce.isStartVideoCapture&&ce.Stop_Video_Capture(),S.a.Notify_APPUI(C.ud,null),e(!0)}catch(e){S.a.Notify_APPUI(C.td,null),t(e)}})));case 277:return 0==this.audioRenderArray.length&&(this.audioRenderArray.push(r),this.Start_Audio_Play()),e.abrupt("break",907);case 279:if(this.audioRenderArray.length>0)for(this.Stop_Audio_Play(),i=0;i<this.audioRenderArray.length;i++)this.audioRenderArray[i].ssrc==r.ssrc&&this.audioRenderArray.splice(i,1);return e.abrupt("break",907);case 281:return e.next=283,v.pushMessageToWorker(T.g.AUDIO_DECODE,{bPause:r.bPause},"PAUSE_OR_RESUME_AUDIO_DECODE",!1,!0);case 283:return e.abrupt("break",907);case 284:if(this.captureAudioMuted=!1,this.audioInputLevel&&this.audioInputLevel.start(),this.useAudioBridge&&this.audioBridge&&this.audioBridge.unmute(),!r.issiphone){e.next=293;break}if(!this.WebSipClient){e.next=291;break}return this.WebSipClient.unmute(),e.abrupt("return");case 291:e.next=294;break;case 293:this.UnMuteAudio();case 294:return e.abrupt("break",907);case 295:if(this.captureAudioMuted=!0,this.audioInputLevel&&this.audioInputLevel.stop(),this.useAudioBridge&&this.audioBridge&&this.audioBridge.mute(),!r.issiphone){e.next=304;break}if(!this.WebSipClient){e.next=302;break}return this.WebSipClient.mute(),e.abrupt("return");case 302:e.next=305;break;case 304:this.MuteAudio();case 305:return e.abrupt("break",907);case 306:if(this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"startSharingRender"}):v.Notify_Sharing_Decode_Thread({command:"startSharingRender"}),this.currentshareactive=r.ssrc,null==this.currentshareactive&&_.a.add_monitor2("SSRC"),this.isCreateSharingWaterMark=r.enableWaterMark,this.sharingWaterMarkName=this.isCreateSharingWaterMark?r.waterMarkText:"",this.isSupportOffscreenCanvas)try{f=S.a.SPECIAL_ID,this.replaceCanvasMap.sharingMainCanvasId=r.canvas.id,m=null,this.isSupportVideoShare?S.a.localVideoDecMGR&&(m=S.a.localVideoDecMGR.map.get(f)):S.a.localSharingDecMGR&&(m=S.a.localSharingDecMGR.map.get(f)),m&&(this.sharingRenderCanvas=r.canvas.transferControlToOffscreen(),y={command:"sharingRenderCanvas",canvas:this.sharingRenderCanvas,rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,isFromMainSession:r.isFromMainSession,watermarkPosition:r.watermarkPosition},m.postMessage(y,[y.canvas]))}catch(e){f=S.a.SPECIAL_ID,m=null,this.isSupportVideoShare?S.a.localVideoDecMGR&&(m=S.a.localVideoDecMGR.map.get(f)):S.a.localSharingDecMGR&&(m=S.a.localSharingDecMGR.map.get(f)),m&&(y={command:"sharingRenderCanvas",rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,isFromMainSession:r.isFromMainSession,watermarkPosition:r.watermarkPosition},m.postMessage(y))}else this.SharingRenderObj||(this.SharingRenderObj=new Ce(Object.assign({},{Notify_APPUI:S.a.Notify_APPUI.bind(S.a),PubSub:w.a,jsMediaEngine:v,globalTracingLogger:k.a}))),this.sharingDisplay=new z(r.canvas,0,void 0,{preserveDrawingBuffer:!1}),this.SharingRenderObj.Set_Render_WebGL(this.sharingDisplay),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,r.isFromMainSession),this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition}),this.sharingInterval||(this.sharingInterval=this.JsMediaSDK_SharingRenderInterval(this.sharingIntervalTime,r.isVideoShare)),v.UpdateSharingPlayStatus(!0);return e.abrupt("break",907);case 313:return v.UpdateSharingPlayStatus(!1),this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"stopSharingRender"}):v.Notify_Sharing_Decode_Thread({command:"stopSharingRender"}),this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.sharingInterval&&(clearInterval(this.sharingInterval),this.sharingInterval=0),this.sharingDisplay&&(this.sharingDisplay.clear(),this.sharingDisplay.cleanup(),this.sharingDisplay=null),this.SharingRenderObj&&(this.SharingRenderObj.ClearQueue(),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName})),e.abrupt("break",907);case 321:if(he=r.width,le=r.height,nt("UPDATE_SHARING_DECODE_PARAM",r),this.SharingRenderObj?this.SharingRenderObj.Update_Sharing_Canvas_Size({width:he,height:le}):this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"UPDATE_SHARING_CANVAS_SIZE",width:he,height:le}):v.Notify_Sharing_Decode_Thread({command:"UPDATE_SHARING_CANVAS_SIZE",width:he,height:le}),!v.isSharingNotClearChromeVersion()){e.next=326;break}return e.abrupt("return",nt("isSharingNotClearChromeVersion",v.isSharingNotClearChromeVersion()));case 326:if(S.a.rwgAgent){e.next=328;break}return e.abrupt("break",907);case 328:if(!this.isSupportVideoShare){e.next=332;break}v.Notify_Sharing_Video_Decode_Thread({command:"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",data:{width:he,height:le}}),e.next=334;break;case 332:return e.next=334,v.pushMessageToWorker(T.g.SHARING_DECODE,{width:he,height:le},"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",!1,!0);case 334:case 335:case 336:return e.abrupt("break",907);case 337:if(r.AudioSelectValue){e.next=339;break}return e.abrupt("return");case 339:if(pe=Date.now(),tt.setSpeakerId(r.AudioSelectValue),!this.useAudioBridge||!this.audioBridge){e.next=345;break}return this.audioBridge.changeSpeaker(r.AudioSelectValue),tt.sendSpeakerDevice(Date.now()-pe,!0),e.abrupt("return");case 345:return this.selectComputerAudioSpeaker(r.AudioSelectValue,pe),e.abrupt("break",907);case 347:return tt.changeDenoiseSwitch(r.switch),e.abrupt("break",907);case 349:if(fe=Object.assign({},this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO,r),!this.isSupportVideoTrackReader&&!this.isSupportMediaStreamTrackProcessor){if(fe.canvasCtrlList=[],fe.canvas instanceof Array)for(i=0;i<fe.canvas.length;i++)fe.canvasCtrlList.push({k:fe.canvas[i],dom:A.g.getDocumentHandle(fe.canvas[i])});else fe.canvasCtrlList.push({k:fe.canvas,dom:A.g.getDocumentHandle(fe.canvas)});fe.canvasCtrl=fe.canvasCtrlList[0].dom}return fe.videoCtrl=this.captureVideoOutPutVideoDom,at.destoryVideoMediaStream(),this.videoCaptureValue=fe,this.videoCaptureValue.videoCtrl.srcObject&&(this.videoCaptureValue.videoCtrl.srcObject=null),this.videoCaptureValue.videoCtrl.src&&(this.videoCaptureValue.videoCtrl.src=null),this.StartVideoMediaCapture(),e.abrupt("break",907);case 358:return r.canvas&&(r.rendercanvasID=r.canvas),ge=Object.assign({},this.desktopSharingValue,r),this.EndSharingMediaStream(),this.desktopSharingValue=ge,this.StartDesktopMediaCapture(),e.abrupt("break",907);case 364:return this.currentactive!=r.ssrc&&(this.currentactive=r.ssrc,S.a.CurrentSSRC=this.currentactive),v.Notify_Audio_Thread_CurrentSSRC(S.a.CurrentSSRC),this.isSupportOffscreenCanvasForVideoDecode?(f=S.a.SPECIAL_ID,S.a.localVideoDecMGR&&(m=S.a.localVideoDecMGR.map.get(f))&&(y={command:"CHANGE_CURRENT_ACTIVE_SSRC",ssrc:r.ssrc},m.postMessage(y))):(this.VideoRenderObj||(this.VideoRenderObj=new me(Object.assign({},it(it({Notify_APPUI:S.a.Notify_APPUI.bind(S.a),isSupportOffscreenCanvas:!1,jsMediaEngine:v},S.a.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:4}:{}),{},{globalTracingLogger:k.a})))),this.VideoRenderObj.Change_Current_SSRC(this.currentactive)),e.abrupt("break",907);case 368:return this.currentshareactive!=r.ssrc&&(this.currentshareactive=r.ssrc),this.isSupportOffscreenCanvas?this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:r.ssrc,isFromMainSession:r.isFromMainSession}):(f=S.a.SPECIAL_ID,S.a.localSharingDecMGR&&(m=S.a.localSharingDecMGR.map.get(f))&&(y={command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:r.ssrc,isFromMainSession:r.isFromMainSession},m.postMessage(y))):(this.SharingRenderObj||(this.SharingRenderObj=new Ce(Object.assign({},{Notify_APPUI:S.a.Notify_APPUI.bind(S.a),PubSub:w.a,jsMediaEngine:v,globalTracingLogger:k.a}))),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,r.isFromMainSession)),e.abrupt("break",907);case 371:return this.Stop_Audio_Play(),e.abrupt("break",907);case 373:return this.Meeting_Fail_Over(r.audio_websocket_address,r.video_websocket_address),e.abrupt("break",907);case 375:return nt("jsEvent.END_MEDIA"),w.a.trigger(C.wc.END_MEDIA),this.destroy().catch((function(e){return nt.error(e)})),e.abrupt("break",907);case 379:if(!(this.audioCapture&&r&&this.audioCapture.AudioSelectValue!==r.AudioSelectValue&&this.audioCtx)){e.next=391;break}if(!this.enableHID){e.next=389;break}if(!this.hidAvalible){e.next=385;break}return e.next=384,Be.destroy();case 384:this.hidAvalible=!1;case 385:if(!r.microphoneLabel){e.next=389;break}return e.next=388,Be.init(r.microphoneLabel,r.defaultMuted);case 388:this.hidAvalible=e.sent;case 389:at.destoryAudioMediaStream();try{this.isCaputureNodeConnect=!1,this.audioCapture=r,this.audioCtx.sampleRate!=this.sampleRate&&(this.sampleRate=this.audioCtx.sampleRate,v.Modify_Audio_SampleRate(this.sampleRate)),this.Start_Audio_Capture(),v.Reset_Aec()}catch(e){this.JsMediaSDK_Log(e)}case 391:return e.abrupt("return");case 393:return r&&(v.Notify_Audio_Thread_Status(S.a.SPECIAL_ID,C.w),at.destoryAudioMediaStream(),this.Remove_Audio_Capture(),this.audioCapture=r,this.Start_Audio_Capture(),v.Reset_Aec()),e.abrupt("break",907);case 395:if(at.destoryAudioMediaStream(),this.captureAudioMuted=!1,!this.hidAvalible){e.next=401;break}return e.next=400,Be.destroy();case 400:this.hidAvalible=!1;case 401:if(S.a.ComputerAudioStatus=T.a.ComputerAudio_Null,!this.audioInputLevel){e.next=407;break}return this.audioInputLevel.destroy(),this.audioInputLevel=null,S.a.Notify_APPUI(C.Yb,null),e.abrupt("return");case 407:if(!this.useAudioBridge||!this.audioBridge){e.next=411;break}return this.audioBridge.leaveAudioWithoutDisconnect(),S.a.Notify_APPUI(C.Yb,null),e.abrupt("return");case 411:if(!(r&&r.issiphone&&this.webrtcaudiodom&&this.WebSipClient)){e.next=415;break}return this.webrtcaudiodom.muted=!0,this.WebSipClient.mute(),e.abrupt("return");case 415:if(S.a.ComputerAudioStatus!==T.a.ComputerAudio_Connecting){e.next=418;break}return S.a.Notify_APPUI(C.Yb,null),e.abrupt("return");case 418:this.audioEncodeRingBufferConsumer&&this.audioEncodeRingBufferConsumer.cancelConsume(),this.Remove_Audio_Capture(),this.Remove_Audio_Play(),this.CloseBoringPeerConnection();try{S.a.AudioNode&&(S.a.AudioNode.port=null)}catch(e){nt("AudioNode.port",e)}return S.a.AudioNode=null,S.a.workletWasmInitSuccess=!1,this.audioCtx&&(this.audioCtx.close(),this.isCaputureNodeConnect=!1),this.audioCtx=null,this.audioCapture=null,this.audioPlay=!1,this.audioDomNode=null,S.a.Notify_APPUI(C.Yb,null),e.abrupt("break",907);case 432:if(this.enableHID=r.CaptureAudioInfo.enableHID,!this.enableHID){e.next=438;break}if(!r.CaptureAudioInfo.microphoneLabel){e.next=438;break}return e.next=437,Be.init(r.CaptureAudioInfo.microphoneLabel,r.CaptureAudioInfo.defaultMuted);case 437:this.hidAvalible=e.sent;case 438:if(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connecting,e.prev=439,!r.checkAutoplay){e.next=443;break}return e.next=443,A.g.checkAudioAutoPlay();case 443:e.next=451;break;case 445:return e.prev=445,e.t1=e.catch(439),nt.error("audio auto play",e.t1),S.a.ComputerAudioStatus=T.a.ComputerAudio_Null,S.a.Notify_APPUI(C.Ub,null),e.abrupt("return",S.a.Notify_APPUI(C.f,e.t1));case 451:if(this.audioInputLevel&&(this.audioInputLevel.destroy(),this.audioInputLevel=null),!r.isPreviewMode){e.next=455;break}return r.CaptureAudio?(this.audioCapture=r.CaptureAudioInfo,this.audioInputLevel=new Ke({analyserCallback:function(){S.a.Notify_APPUI_SAFE(C.s)}}),at.shouldCaptureAudio()||S.a.Notify_APPUI(C.Xd,null),this.Start_Audio_Capture()):(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null)),e.abrupt("return");case 455:if(this.useAudioBridge=r.useAudioBridge&&r.audioBridge,!this.useAudioBridge){e.next=466;break}return tt.setUserId(r.CaptureAudioInfo.ssrc),tt.setIsAudioBridge(!0),ve=r.audioBridge,Se=ve.nginxHost,_e=ve.rwgHost,ye=ve.cid,be=ve.abToken,Ae=ve.supportLocalAB,e.next=462,this.previewInit({audioBridge:{nginxHost:Se,rwgHost:_e,cid:ye,abToken:be,isCapturingAudio:r.CaptureAudio,isJoinAudio:!0,supportLocalAB:Ae}});case 462:return r.CaptureAudio?(this.audioCapture=r.CaptureAudioInfo,this.Start_Audio_Capture()):(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null)),r.speakerInfo&&r.speakerInfo.defaultDeviceId&&tt.setSpeakerId(r.speakerInfo.defaultDeviceId),tt.sendSpeakerDevice(0,!0),e.abrupt("return");case 466:if(!r.issiphone){e.next=496;break}if(!this.WebSipClient){e.next=476;break}return e.prev=468,e.next=471,this.WebSipClient.clear();case 471:this.WebSipClient=null,e.next=476;break;case 474:e.prev=474,e.t2=e.catch(468);case 476:ke=r.sip.sipServer,Ee=r.sip.meetingnumber,Ie=r.sip.participantId;try{we=r.sip.sipNumberList[0].number.replace(" ","")}catch(e){we="+10000"}return Me=r.sip.audio,this.webrtcaudiodom=Me,this.WebSipClient=new WebSipClient(ke,Ee,Ie,we,"sip:zoom.wcl.sip@zoom.us",Me),e.prev=484,e.next=487,this.WebSipClient.connect();case 487:return e.next=489,this.WebSipClient.call();case 489:e.next=495;break;case 491:e.prev=491,e.t3=e.catch(484),k.a.error("Error connecting to SIP audio",e.t3),e.t3.name&&-1!=e.t3.name.indexOf("NotAllowedError")&&S.a.Notify_APPUI(C.Vd,null);case 495:return e.abrupt("return");case 496:if(e.prev=496,this.bAudioEncodeMainThreadConsumerIntervalEnable&&this.audioEncodeRingBufferConsumer&&this.audioEncodeRingBufferConsumer.consume(),this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.CloseBoringPeerConnection(),v.Notify_Audio_Thread_Status(S.a.SPECIAL_ID,C.w),this.audioCtx&&(this.audioCtx.close(),this.isCaputureNodeConnect=!1),De=A.g.getAudioContextConfigure(),this.audioCtx=new(window.AudioContext||window.webkitAudioContext)(De),this.audioCtx.sampleRate!=this.sampleRate&&(this.sampleRate=this.audioCtx.sampleRate,v.Modify_Audio_SampleRate(this.sampleRate)),this.disableAudioAGC=r.disableAudioAGC,this.disableNoiseSuppression=r.disableNoiseSuppression,this.disableBrowserAec=r.disableBrowserAec,this.bAudioDecodeUsingSAB&&_.a.add_monitor("ASSAB"),"suspended"===this.audioCtx.state&&this.audioCtx.resume(),ce=this,Re=null,S.a.decoderinworklet){e.next=517;break}Re=this.audioWorkletJsPath.audioWorkletPath,e.next=521;break;case 517:return e.next=519,A.g.isSDKSupportSIMD();case 519:Te=e.sent,Re=Te?this.audioWorkletJsPath.audioWorkletSIMDPath:this.audioWorkletJsPath.audioWorkletProcessPath;case 521:return e.next=523,this.audioCtx.audioWorklet.addModule(Re);case 523:if(S.a.AudioNode=new b(ce.audioCtx,"zoomAudioWorklet",A.g.browser.isSafari&&S.a.sharedBuffer?{processorOptions:{sharedBuffer:S.a.sharedBuffer,userAgent:navigator.userAgent}}:void 0),S.a.AudioNode.onprocessorerror=function(e){k.a.error("Exception thrown in AudioWorkletProcessor",e)},A.g.browser.isSafari&&!S.a.sharedBuffer&&S.a.AudioNode.postCMD("diableSharedArrayBuffer"),S.a.decoderinworklet||S.a.AudioNode.postCMD("disableDecoderinworklet"),S.a.decoderinworklet&&(this.isMultiView?S.a.AudioNode.postCMD("multiView",!0):S.a.CurrentSSRC&&S.a.AudioNode.postCMD("currentSSRC",S.a.CurrentSSRC),S.a.AudioNode.postCMD("initData",{userid:S.a.localAudioPara.userid,meetingnumb:S.a.localAudioPara.meetingnumb,meetingid:S.a.localAudioPara.meetingid,qoson:S.a.localAudioPara.qoson}),te((Pe=S.a.audioWasmInfo).dbVersion,Pe.url,void 0,!1,!0,Pe.databaseName,Pe.databaseDataType).then((function(e){e?S.a.AudioNode.postCMD("audiowasm",e):A.g.downloadBinary(Pe.url).then((function(e){S.a.AudioNode.postCMD("audiowasm",e)}))}))),xe=A.g.isSupportChromeWideAEC()&&!S.a.shareSystemAudio,!A.g.browser.isChrome||A.g.isAndroidBrowser()||A.g.isQuestBrowser()){e.next=562;break}if(!this.disableBrowserAec){e.next=534;break}this.isSupportBrowserAec=!1,e.next=540;break;case 534:if(e.t4=xe,e.t4){e.next=539;break}return e.next=538,this.isLocalP2PSupportedPromise;case 538:e.t4=e.sent;case 539:this.isSupportBrowserAec=e.t4;case 540:if(S.a.sharedBuffer&&S.a.AudioNode.postCMD("sharedBuffer",S.a.sharedBuffer),A.g.isGoogleNestChrome()){e.next=554;break}if(this.disableBrowserAec){e.next=554;break}if(!this.isSupportBrowserAec){e.next=553;break}if(xe){e.next=551;break}return Ve=ce.audioCtx.createMediaStreamDestination(),S.a.AudioNode.connect(Ve),Oe=Ve.stream,e.next=550,ce.chromeAecWorkAround(Ve.stream);case 550:Oe=e.sent;case 551:e.next=554;break;case 553:v.Notify_Audio_Thread_AEC_Status(S.a.SPECIAL_ID,!1);case 554:Ne=null,Ne=r.speakerInfo&&r.speakerInfo.defaultDeviceId?r.speakerInfo.defaultDeviceId:"",tt.setSpeakerId(Ne),Le=Date.now(),xe?S.a.AudioNode.connect(ce.audioCtx.destination):(ce.audioDomNode||(ce.audioDomNode=new Audio),ce.audioDomNode.srcObject=Oe,ce.audioDomNode.play()),ce.selectComputerAudioSpeaker(Ne,Le),e.next=588;break;case 562:if(S.a.sharedBuffer&&S.a.AudioNode.postCMD("sharedBuffer",A.g.browser.isSafari?null:S.a.sharedBuffer),!A.g.isAndroidBrowser()&&!A.g.isQuestBrowser()){e.next=587;break}if(We=ce.audioCtx.createMediaStreamDestination(),S.a.AudioNode.connect(We),!this.disableBrowserAec){e.next=570;break}this.isSupportBrowserAec=!1,e.next=573;break;case 570:return e.next=572,this.isLocalP2PSupportedPromise;case 572:this.isSupportBrowserAec=e.sent;case 573:if(Ue=We.stream,this.disableBrowserAec){e.next=582;break}if(!this.isSupportBrowserAec){e.next=581;break}return e.next=578,ce.chromeAecWorkAround(We.stream);case 578:Ue=e.sent,e.next=582;break;case 581:v.Notify_Audio_Thread_AEC_Status(S.a.SPECIAL_ID,!1);case 582:ce.audioDomNode||(ce.audioDomNode=new Audio),ce.audioDomNode.srcObject=Ue,ce.audioDomNode.play(),e.next=588;break;case 587:A.g.browser.isFirefox&&A.g.isFirefoxVersionHigherThan(116)?(Fe=ce.audioCtx.createMediaStreamDestination(),S.a.AudioNode.connect(Fe),Ge=Fe.stream,ce.audioDomNode||(ce.audioDomNode=new Audio),ce.audioDomNode.srcObject=Ge,He=null,je=Date.now(),He=r.speakerInfo&&r.speakerInfo.defaultDeviceId?r.speakerInfo.defaultDeviceId:"",tt.setSpeakerId(He),this.selectComputerAudioSpeaker(He,je),ce.audioDomNode.play()):(S.a.AudioNode.connect(ce.audioCtx.destination),tt.setSpeakerId("default"),tt.sendSpeakerDevice(0,!0));case 588:v.Notify_Audio_Decode_Thread({command:"stop_audio_incoming",stopPlayAudio:!1}),v.Notify_Audio_Encode_Thread({command:"startAudioEncode",ssid:r.CaptureAudioInfo.ssrc,audioMode:S.a.audioMode}),v.Update_Audio_Encrpt(S.a.e2eencrypt),qe=new MessageChannel,Qe=new MessageChannel,S.a.AudioNode.port.postMessage({status:"encodeAudioPort"},[Qe.port2]),S.a.AudioNode.port.postMessage({status:"decodeAudioPort"},[qe.port1]),S.a.AudioNode.port.postMessage({status:"sampleRate",data:ce.audioCtx.sampleRate}),v.Notify_Audio_Thread_Msg_Channel(qe,Qe),ce.Start_Audio_Play(),this.isSupportOffscreenCanvasForVideoDecode&&(ze=new MessageChannel,v.Notify_Audio_Video_Thread_Msg_Channel(ze),S.a.decoderinworklet?S.a.AudioNode.port.postMessage({status:"decodeVideoPort"},[ze.port2]):v.Notify_Audio_Thread_Msg_Channel2(ze),!this.isSupportVideoShare&&ce.isSupportOffscreenCanvas&&(Je=new MessageChannel,v.Notify_Video_Sharing_Msg_Channel(Je,Je))),r.CaptureAudio?(ce.audioCapture=r.CaptureAudioInfo,r.denoiseSwitch&&tt.changeDenoiseSwitch(r.denoiseSwitch),ce.Start_Audio_Capture(),this.firstSetDelay&&(this.firstSetDelay=!1,v.Reset_Aec(),v.Set_Aec_Delay())):(S.a.ComputerAudioStatus=T.a.ComputerAudio_Connected,S.a.Notify_APPUI(C.Ub,null)),e.next=608;break;case 602:e.prev=602,e.t5=e.catch(496),S.a.ComputerAudioStatus=T.a.ComputerAudio_Null,S.a.Notify_APPUI(C.Ub,null),nt.error(e.t5),this.JsMediaSDK_Log(e.t5);case 608:return e.abrupt("break",907);case 609:if(S.a.DesktopAudioStatus===T.a.DesktopAudio_Null){e.next=612;break}return S.a.Notify_APPUI(C.Wb,null),e.abrupt("return");case 612:if(e.t6=A.g.isSupportChromeWideAEC()&&S.a.ComputerAudioStatus!=T.a.ComputerAudio_Null&&!this.audioDomNode&&S.a.shareSystemAudio,!e.t6){e.next=617;break}return e.next=616,this.isLocalP2PSupportedPromise;case 616:e.t6=e.sent;case 617:if(!e.t6){e.next=631;break}return S.a.AudioNode.disconnect(),Xe=this.audioCtx.createMediaStreamDestination(),S.a.AudioNode.connect(Xe),Ye=Xe.stream,e.next=624,this.chromeAecWorkAround(Xe.stream);case 624:Ye=e.sent,this.audioDomNode||(this.audioDomNode=new Audio),this.audioDomNode.srcObject=Ye,Ze=tt.speakerId,$e=Date.now(),this.audioDomNode.setSinkId(Ze).then((function(){tt.sendSpeakerDevice(Date.now()-$e,!0)})).catch((function(e){_.a.add_monitor("AODF"),tt.sendSpeakerDevice(Date.now()-$e,!1),S.a.Notify_APPUI(C.v,null)})),this.audioDomNode.play();case 631:return S.a.DesktopAudioStatus=T.a.DesktopAudio_Connecting,e.prev=632,this.bAudioEncodeMainThreadConsumerIntervalEnable&&this.audioEncodeRingBufferConsumer&&this.audioEncodeRingBufferConsumer.consume(),v.Notify_Audio_Encode_Thread({command:"mute",bOn:C.w,sharing:!0}),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),et=A.g.getAudioContextConfigure(),this.sharingAudioCtx=new(window.AudioContext||window.webkitAudioContext)(et),ce=this,rt=this.audioWorkletJsPath.sharingAudioWorkletPath,e.next=642,this.sharingAudioCtx.audioWorklet.addModule(rt);case 642:S.a.SharingAudioNode=new b(ce.sharingAudioCtx,"zoomSharingAudioWorklet",void 0),S.a.sharedBuffer&&S.a.SharingAudioNode.postCMD("sharedBuffer",S.a.sharedBuffer),ot=new MessageChannel,S.a.SharingAudioNode.port.postMessage({status:"encodeAudioPort"},[ot.port1]),v.Notify_Audio_Thread_Msg_Channel3(ot),v.Notify_Audio_Encode_Thread({command:"startAudioEncode",ssid:r.CaptureAudioInfo.ssrc,samplerate:this.sharingAudioCtx.sampleRate,isSharing:!0,audioMode:S.a.audioMode}),v.Update_Audio_Encrpt(S.a.e2eencrypt),ce.Start_Desktop_Audio_Capture(),e.next=656;break;case 652:e.prev=652,e.t7=e.catch(632),nt.error(e.t7),this.JsMediaSDK_Log(e.t7);case 656:return S.a.DesktopAudioStatus=T.a.DesktopAudio_Connected,S.a.Notify_APPUI(C.Wb,null),e.abrupt("break",907);case 659:if(S.a.DesktopAudioStatus===T.a.DesktopAudio_Connected){e.next=662;break}return S.a.Notify_APPUI(C.ac,null),e.abrupt("return");case 662:A.g.isSupportChromeWideAEC()&&this.audioDomNode&&(S.a.AudioNode.disconnect(),this.CloseBoringPeerConnection(),this.audioDomNode=null,st="default"==tt.speakerId?"":tt.speakerId,S.a.AudioNode.connect(this.audioCtx.destination),ut=Date.now(),this.audioCtx.setSinkId(st).then((function(){tt.sendSpeakerDevice(Date.now()-ut,!0)})).catch((function(e){_.a.add_monitor("AODF"),tt.sendSpeakerDevice(Date.now()-ut,!1),S.a.Notify_APPUI(C.v,null)}))),dt=!1,r&&r.isPause&&(dt=!0),this.audioEncodeRingBufferConsumer&&this.audioEncodeRingBufferConsumer.cancelConsume(),this.Remove_Sharing_Audio_Capture(),dt||this.EndDesktopAudioMediaStream();try{S.a.SharingAudioNode&&(S.a.SharingAudioNode.port=null)}catch(e){nt("SharingAudioNode.port",e)}return S.a.SharingAudioNode=null,this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),this.sharingAudioCtx=null,S.a.DesktopAudioStatus=T.a.DesktopAudio_Null,S.a.Notify_APPUI(C.ac,null),e.abrupt("break",907);case 675:return nt("sdk start remote control 1"),ct=this.sharingWidthAndHeightInfo,ht=new R.a(Object.assign({dom:document},r)),this.remoteControl=ht,nt("sharingInfo",ct),ht.setDstWidthAndHeight(ct.logicWidth,ct.logicHeight),ht.setSrcWidthAndHeight(ct.logicWidth,ct.logicHeight),ht.setSrcScaleWidthAndHeight(r.scaleWidth,r.scaleHeight),ht.setSrcOffsetXY(r.srcOffsetX,r.srcOffsetY),ht.setRemoteOS(r.os),e.abrupt("return",ht.start().then((function(e){return S.a.Notify_APPUI(e?C.ed:C.dd),e&&(ht.onPasteTextLengthOverflow((function(){S.a.Notify_APPUI(C.yc)})),ht.onReturnCopiedText((function(e){nt(e),S.a.Notify_APPUI(C.xc,e)}))),e})).catch((function(e){return nt(e),S.a.Notify_APPUI(C.dd),k.a.error("An error occurred when trying to start remote control",e),_.a.add_monitor("RMCTF"),Promise.reject(e)})));case 687:return e.abrupt("return",this.remoteControl.destroy().then((function(e){return S.a.Notify_APPUI(e?C.R:C.Q),e})));case 689:return this.remoteControl&&(r.scaleWidth&&r.scaleHeight&&this.remoteControl.setSrcScaleWidthAndHeight(r.scaleWidth,r.scaleHeight),(V()(r.srcOffsetX)||V()(r.srcOffsetY))&&this.remoteControl.setSrcOffsetXYAndSendPDU(r.srcOffsetX,r.srcOffsetY),x()(r.isControllerNow)&&this.remoteControl.setIsControlerNow(r.isControllerNow),V()(r.os)&&this.remoteControl.setRemoteOS(r.os)),e.abrupt("break",907);case 691:return this.remoteControl&&this.remoteControl.sendPostionPDU(),e.abrupt("break",907);case 693:if(this.flipSend=!0,this.canISendNextSharingFrame=!0,r.mode?this.isSharingSupportImageCapture=A.g.isSupportImageCapture():this.isSharingSupportImageCapture=!1,this.isStartDesktopSharing){e.next=706;break}v.Update_Sharing_Encrpt(S.a.e2eencrypt),this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,r.canvas&&(r.rendercanvasID=r.canvas),this.isSupportSharingTrackReader||this.isSupportMediaStreamTrackProcessor?r.video=A.g.getDocumentHandle(r.canvas):(r.video=A.g.getDocumentHandle(r.video),r.canvas=A.g.getDocumentHandle(r.canvas)),this.desktopSharingValue=r,this.Start_Desktop_Sharing(),e.next=707;break;case 706:return e.abrupt("return");case 707:return e.abrupt("break",907);case 708:if(this.flipSend=!0,this.canISendNextSharingFrame=!0,S.a.shareSystemAudio=!1,this.sharingTrackReader)try{this.sharingTrackReader.stop()}catch(e){}if(!this.isStartDesktopSharing){e.next=718;break}this.desktopSharingSend=!1,this.StopSharingCapture(),this.isSupportVideoShare?v.Update_Sharing_Video_Encode_Status({command:"stopsharing"}):v.Update_Sharing_Encode_Status({command:"stopsharing"}),e.next=719;break;case 718:return e.abrupt("return");case 719:return e.abrupt("break",907);case 720:if(this.flipSend=!0,this.canISendNextSharingFrame=!1,!this.isStartDesktopSharing){e.next=727;break}this.desktopSharingSend=!1,this.isSupportVideoShare?v.Update_Sharing_Video_Encode_Status({command:"pause"}):v.Update_Sharing_Encode_Status({command:"pause"}),e.next=728;break;case 727:return e.abrupt("return");case 728:return e.abrupt("break",907);case 729:if(this.flipSend=!0,this.canISendNextSharingFrame=!0,!this.isStartDesktopSharing){e.next=737;break}this.desktopSharingSend=!0,this.isSupportMediaStreamTrackProcessor||this.isSupportSharingTrackReader||this.Process_Sharing(),this.isSupportVideoShare?v.Update_Sharing_Video_Encode_Status({command:"resume"}):v.Update_Sharing_Encode_Status({command:"resume"}),e.next=738;break;case 737:return e.abrupt("return");case 738:return e.abrupt("break",907);case 739:if(window.WebQrscanner){e.next=742;break}return console.error("qrScanner not loaded"),e.abrupt("return");case 742:return r.enable&&this.desktopSharingMediaStram?WebQrscanner.qrScanner.start(this.desktopSharingValue.video,(function(e){S.a.Notify_APPUI_SAFE(C.Fc,e)})):WebQrscanner.qrScanner.stop(),e.abrupt("break",907);case 744:if(this.isStartWhiteboardSharing=!0,r.canvas&&(r.rendercanvasID=r.canvas),this.isStartDesktopSharing){e.next=755;break}v.Update_Sharing_Encrpt(S.a.e2eencrypt),r.video=r.canvas=A.g.getDocumentHandle(r.canvas),this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,this.desktopSharingValue=r,this.Start_Whiteboard_Sharing(),e.next=756;break;case 755:return e.abrupt("return");case 756:return e.abrupt("break",907);case 757:if(this.isStartWhiteboardSharing=!1,!this.isStartDesktopSharing){e.next=764;break}this.desktopSharingSend=!1,this.isStartDesktopSharing=!1,v.Update_Sharing_Encode_Status({command:"stopsharing"}),e.next=765;break;case 764:return e.abrupt("return");case 765:return e.abrupt("break",907);case 766:return(lt=document.createElement("img")).src="chrome-extension://kgjfgplpablkjnlkjmjdecgdpfankdle/images/trash.png",lt.onload=function(){S.a.Notify_APPUI(C.cb,!0)},lt.onerror=function(){S.a.Notify_APPUI(C.cb,!1)},e.abrupt("break",907);case 772:if(r.evt!==C.gf&&r.evt!==C.df){e.next=785;break}if(nt("rwg answer from ui",r),r.answer){e.next=776;break}return e.abrupt("return");case 776:e.t8=r.answer.type,e.next=e.t8===T.h.ZOOM_CONNECTION_VIDEO?779:e.t8===T.h.ZOOM_CONNECTION_AUDIO?781:783;break;case 779:return w.a.trigger(C.wc.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,r),e.abrupt("break",783);case 781:return w.a.trigger(C.wc.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,r),e.abrupt("break",783);case 783:e.next=786;break;case 785:r.evt===C.af&&r.body&&r.body.token&&w.a.trigger(C.wc.AUDIO_BRIDGE_WS_TOKEN,r.body.token);case 786:return e.abrupt("break",907);case 787:if(v.setUserNodeListToWorker(r.userList),this.setvideokk||!r.encryptKey){e.next=794;break}return this.setvideokk=!0,e.next=792,v.pushMessageToWorker(T.g.VIDEO_DECODE,{KK:r.encryptKey},"MAIN_KK",!1,!0);case 792:return e.next=794,v.pushMessageToWorker(T.g.VIDEO_ENCODE,{KK:r.encryptKey},"MAIN_KK",!1,!0);case 794:return e.abrupt("break",907);case 795:return v.Notify_Audio_Thread_Interpretation_Mute(r.mute),e.abrupt("break",907);case 797:return v.Notify_Audio_Thread_Interpretation_Set_Lang(r.lang),e.abrupt("break",907);case 799:return v.Notify_Audio_Thread_Interpretation_Set_Interpreter(r.interpreterList),e.abrupt("break",907);case 801:return v.Notify_Audio_Thread_Interpretation_Enable(r.enable),e.abrupt("break",907);case 803:if(!r.enable||!this.isEnableVideoDecodeHardWareThread){e.next=812;break}if(null===this.videodecodehardwareflag){e.next=808;break}r.enable=this.videodecodehardwareflag,e.next=812;break;case 808:return e.next=810,A.g.IsSupportVideoDecodeHardwareAcceleration();case 810:this.videodecodehardwareflag=e.sent,r.enable=this.videodecodehardwareflag;case 812:return v.Notify_Video_Decode_Thread({command:"hwstatus",enable:r.enable}),e.abrupt("break",907);case 814:return H.z&&(r.enable&&this.videoencodehardwareflag&&!this.isAppleGraphic?r.enable=!0:r.enable=!1,v.Notify_Video_Encode_Thread({command:"hwstatus",enable:r.enable})),e.abrupt("break",907);case 816:return _.a.add_monitor("NoVideoHD"),!r.videohd&&this.videoencodehardwareflag&&(A.g.set720pcapacity(!1),_.a.add_monitor("CAPTURE720:"+!1),v.Notify_Video_Encode_Thread({command:"videohd",videohd:r.videohd})),e.abrupt("break",907);case 819:return v.Notify_Audio_Decode_Thread({command:"setShareVolumeLevel",userid:r.userid,shareVolume:r.shareVolume,isFromMainSession:r.isFromMainSession}),e.abrupt("break",907);case 821:return r.mediaActionType==C.if.SHARING_DECODE&&(this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"USER_NODE_LIST_IN_MAIN_SESSION",data:r}):v.Notify_Sharing_Decode_Thread({command:"USER_NODE_LIST_IN_MAIN_SESSION",data:r})),r.mediaActionType==C.if.SHARING_ENCODE&&(this.isSupportVideoShare?v.Notify_Sharing_Video_Encode_Thread({command:"USER_NODE_LIST_IN_MAIN_SESSION",data:r}):v.Notify_Sharing_Encode_Thread({command:"USER_NODE_LIST_IN_MAIN_SESSION",data:r})),r.mediaActionType==C.if.AUDIO_DECODE&&v.pushMessageToWorker(T.g.AUDIO_DECODE,r,"USER_NODE_LIST_IN_MAIN_SESSION",!1,!0),e.abrupt("break",907);case 825:return r.mediaActionType==C.if.SHARING_DECODE&&(this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"UPDATE_MEDIA_PARAMS",data:r}):v.Notify_Sharing_Decode_Thread({command:"UPDATE_MEDIA_PARAMS",data:r})),r.mediaActionType==C.if.SHARING_ENCODE&&(this.isSupportVideoShare?v.Notify_Sharing_Video_Encode_Thread({command:"UPDATE_MEDIA_PARAMS",data:r}):v.Notify_Sharing_Encode_Thread({command:"UPDATE_MEDIA_PARAMS",data:r})),r.mediaActionType==C.if.AUDIO_DECODE&&v.Notify_Audio_Decode_Thread({command:"UPDATE_MEDIA_PARAMS",data:r}),e.abrupt("break",907);case 829:return this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"SHARING_ADD_REV_CHANNEL_TYPE",data:r}):v.Notify_Sharing_Decode_Thread({command:"SHARING_ADD_REV_CHANNEL_TYPE",data:r}),e.abrupt("break",907);case 831:return this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:r}):v.Notify_Sharing_Decode_Thread({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:r}),e.abrupt("break",907);case 833:return this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"BUILD_MS_CHANNEL_IN_BO",data:r}):v.Notify_Sharing_Decode_Thread({command:"BUILD_MS_CHANNEL_IN_BO",data:r}),e.abrupt("break",907);case 835:return(pt=r.type)?pt===T.b.VIDEO?this.SWITCH_VIDEO_WATER_MARK(r):pt===T.b.SHARING&&this.SWITCH_SHARING_WATER_MARK(r):(this.SWITCH_VIDEO_WATER_MARK(r),this.SWITCH_SHARING_WATER_MARK(r)),e.abrupt("break",907);case 838:return v.Notify_Audio_Thread_CC_Set_Lang(r.lang),e.abrupt("break",907);case 840:return v.Notify_Audio_Decode_Thread({command:"BUILD_MA_CHANNEL_IN_BO",data:r}),e.abrupt("break",907);case 842:return v.Notify_Audio_Encode_Thread({command:"ENABLE_SHARE_TO_BO",data:r.enable}),e.abrupt("break",907);case 844:return v.Notify_Audio_Encode_Thread({command:"ENABLE_BROADCAST_TO_BO",data:r.enable}),e.abrupt("break",907);case 846:if(ft=document.getElementById(r.canvasId)){e.next=849;break}return e.abrupt("return");case 849:if(mt=null,gt=this.replaceCanvasMap.videoDecodeCanvasIds&&-1!==this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(r.canvasId),vt=this.replaceCanvasMap.videoEncodeCanvasIds&&-1!==this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(r.canvasId),r.canvasId===this.replaceCanvasMap.videoMaskSettingCanvasId?mt=S.a.localVideoEncMGR:r.canvasId===this.replaceCanvasMap.sharingMainCanvasId?mt=S.a.localSharingDecMGR:r.canvasId===this.replaceCanvasMap.sharingPreviewCanvasId?mt=S.a.localSharingEncMGR:(vt||gt)&&(mt=vt?S.a.localVideoEncMGR:S.a.localVideoDecMGR,this.lazyReplaceEncodeCanvasTimer&&(clearTimeout(this.lazyReplaceEncodeCanvasTimer),this.lazyReplaceEncodeCanvasTimer=null),this.lazyReplaceEncodeCanvasTimer=setTimeout((function(){var e=S.a.localVideoEncMGR;if(e){var t=e.map.get(S.a.SPECIAL_ID);t&&t.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}var r=S.a.localSharingEncMGR;if(r){var i=r.map.get(S.a.SPECIAL_ID);i&&i.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}if(yt.videoCaptureHiddenCanvas){var a=yt.videoCaptureHiddenCanvas,n=a.width,o=a.height;A.g.isSupport2dOffscreenCanvas()?yt.videoCaptureHiddenCanvas=new OffscreenCanvas(n,o):(yt.videoCaptureHiddenCanvas=document.createElement("canvas"),yt.videoCaptureHiddenCanvas.width=n,yt.videoCaptureHiddenCanvas.height=o),yt.videoCaptureHiddenCanvasCtx=yt.videoCaptureHiddenCanvas.getContext("2d")}if(yt.bgCanvas){var s=yt.bgCanvas,u=s.width,d=s.height;yt.bgCanvas=document.createElement("canvas"),yt.bgCanvas.width=u,yt.bgCanvas.height=d,yt.bgCanvasctx=yt.bgCanvas.getContext("2d"),!yt.VideoMaskSettingCanvas&&yt.PrevVideoMaskSettingCanvas?(yt.VideoMaskSettingCanvas=yt.PrevVideoMaskSettingCanvas,yt.Update_Mask_Texture(yt.maskCoordinate,yt.videoCaptureHiddenCanvas.width,yt.videoCaptureHiddenCanvas.height),yt.VideoMaskSettingCanvas=null):yt.Update_Mask_Texture(yt.maskCoordinate,yt.videoCaptureHiddenCanvas.width,yt.videoCaptureHiddenCanvas.height)}}),500)),mt)try{St=ft.transferControlToOffscreen(),(_t=mt.map.get(S.a.SPECIAL_ID))&&_t.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS",data:{canvasId:r.canvasId,canvas:St}},[St])}catch(e){}return e.abrupt("break",907);case 855:if(this.enableHID=r.enable,!r.enable){e.next=867;break}if(!this.hidAvalible){e.next=861;break}return e.next=860,Be.destroy();case 860:this.hidAvalible=!1;case 861:if(!r.microphoneLabel){e.next=865;break}return e.next=864,Be.init(r.microphoneLabel,r.defaultMuted);case 864:this.hidAvalible=e.sent;case 865:e.next=871;break;case 867:if(!this.hidAvalible){e.next=871;break}return e.next=870,Be.destroy();case 870:this.hidAvalible=!1;case 871:return e.abrupt("break",907);case 872:return v.Notify_Video_Decode_Thread({command:"ENABLE_VIDEO_OBSERVER",data:r.enable}),e.abrupt("break",907);case 874:return v.Notify_Video_Encode_Thread({command:"SWITCH_SHARING_TYPE",data:r.mode}),e.abrupt("break",907);case 876:return this.useAudioBridge&&this.audioBridge&&this.audioBridge.setSpeechVolumeLevel(r.userId,r.volume),r.issiphone||(S.a.decoderinworklet?S.a.AudioNode&&S.a.AudioNode.postCMD("setSpeechVolumeLevel",{userid:r.userId>>10,volume:r.volume}):v.Notify_Audio_Decode_Thread({command:"setSpeechVolumeLevel",userid:r.userId>>10,volume:r.volume})),e.abrupt("break",907);case 879:return this.audioBridge&&this.audioBridge.updateUserMuteUnmuteStatus(r),e.abrupt("break",907);case 881:return at._updateVideoConstraints({advanced:[r]}),e.abrupt("break",907);case 883:return S.a.clearMessageToRwg(),e.abrupt("break",907);case 885:return at.enableReuseStream(r.enable),e.abrupt("break",907);case 887:return at.presetConstraints(r||{}),e.abrupt("break",907);case 889:return at.destoryReuseStream({audio:r&&r.audio,video:r&&r.video}),e.abrupt("break",907);case 891:return Ct={command:"WHITEBOARD_JOIN_MESSAGE",data:r.message,nodeId:r.nodeId,encryptKey:r.encryptKey,sn:r.sn,dcsId:r.dcsId,EncodedSn:r.EncodedSn},this.isSupportVideoShare?v.Notify_Sharing_Video_Encode_Thread(Ct):v.Notify_Sharing_Encode_Thread(Ct),e.abrupt("break",907);case 894:return this.audioBridge?this.audioBridge.stopIncomingAudio(r):S.a.decoderinworklet?v.Notify_Audio_Decode_Thread({command:"stop_audio_incoming",stopPlayAudio:r}):S.a.AudioNode&&S.a.AudioNode.postCMD("stop_audio_incoming",r),e.abrupt("break",907);case 896:return console.log("SET_CODEC_MODE",r.mode),_.a.add_monitor("AUDIO_CODEC_MODE"+r.mode),S.a.audioMode=r.mode,v.Notify_Audio_Encode_Thread({command:"audioMode",mode:r.mode}),e.abrupt("break",907);case 901:if(this.isLandScape=r.isLandScape,at.videoStreamTrack){e.next=904;break}return e.abrupt("return");case 904:return this.isLandScape&&this.captureSize&&this.Change_Video_Capture_Resolution(this.captureSize.width,this.captureSize.height),e.abrupt("break",907);case 906:nt("CAN NOT HANDLE THE EVENT!");case 907:case"end":return e.stop()}}),e,this,[[439,445],[468,474],[484,491],[496,602],[632,652]])}))),function(e,t){return st.apply(this,arguments)}),SWITCH_VIDEO_WATER_MARK:function(e){var t=e.enableWaterMark,r=e.waterMarkText,i=void 0===r?"":r,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;this.isCreateVideoWaterMark=!!t,this.videoWaterMarkName=this.isCreateVideoWaterMark?i:"",this.VideoRenderObj?(t?this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.VideoRenderObj.Set_WaterMark_Flag(t),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o})):v.Notify_Video_Decode_Thread({command:"SWITCH_WATER_MARK_FLAG",isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o}),A.g.watermark.updateWaterMarkInfo(e)},SWITCH_SHARING_WATER_MARK:function(e){var t=e.enableWaterMark,r=e.waterMarkText,i=void 0===r?"":r,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;this.isCreateSharingWaterMark=!!t,this.sharingWaterMarkName=this.isCreateSharingWaterMark?i:"",this.SharingRenderObj?(t?this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.SharingRenderObj.Set_WaterMark_Flag(t),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o})):this.isSupportVideoShare?v.Notify_Sharing_Video_Decode_Thread({command:"SWITCH_SHARING_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o}):v.Notify_Sharing_Decode_Thread({command:"SWITCH_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o})},JsMediaSDK_VideoRenderInterval:function(e){return this.VideoRenderObj.Start_Draw.bind(this.VideoRenderObj)(C.Ic,e)},JsMediaSDK_SharingRenderInterval:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.SharingRenderObj.No_Bindthis_Interval.bind(this.SharingRenderObj),i=setInterval(r,t?20:e);return i},getShareStreamInfo:function(){if(!this.desktopSharingMediaStram)return null;var e=this.desktopSharingMediaStram.getVideoTracks();return e.length&&e[0].getSettings&&e[0].getSettings()||null},destroy:function(){var e=this;return u()(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(nt("destroy"),e.isDestroy=!0,e.EndSharingMediaStream(),v.closeAllMedia(),e.audioInputLevel&&(e.audioInputLevel.destroy(),e.audioInputLevel=null),!e.WebSipClient){t.next=14;break}return t.prev=6,t.next=9,e.WebSipClient.clear();case 9:e.WebSipClient=null,t.next=14;break;case 12:t.prev=12,t.t0=t.catch(6);case 14:if(e.audioBridge&&(e.audioBridge.destroy(!1),e.audioBridge=null),!e.hidAvalible){t.next=18;break}return t.next=18,Be.destroy();case 18:e.EndMedia(),v.Stop_Monitor(),v.destroyAllWorkers(),w.a.clearAllSubscriptions(),v.preserveMessageController.clear(),S.a.destroyQueueMessageToRwg();case 24:case"end":return t.stop()}}),t,null,[[6,12]])})))()}};t.default=ft}])}));
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/js_media.min.js-b425bd876c30ba223e93.map