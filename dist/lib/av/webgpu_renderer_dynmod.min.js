(()=>{var e={129:(e,t,r)=>{e.exports=r(1086)},6040:(e,t,r)=>{"use strict";var i=r(8251);e.exports=i},7264:(e,t,r)=>{"use strict";var i=r(4139);r(768),r(8549),r(7152),r(1372),e.exports=i},9692:(e,t,r)=>{"use strict";var i=r(7045);e.exports=i},5663:(e,t,r)=>{"use strict";var i=r(70);e.exports=i},1263:(e,t,r)=>{"use strict";r(6737);var i=r(1747);e.exports=i("Array","sort")},2757:(e,t,r)=>{"use strict";var i=r(8280),n=r(1263),s=Array.prototype;e.exports=function(e){var t=e.sort;return e===s||i(s,e)&&t===s.sort?n:t}},1926:(e,t,r)=>{"use strict";r(6750);var i=r(2046).Object,n=e.exports=function(e,t,r){return i.defineProperty(e,t,r)};i.defineProperty.sham&&(n.sham=!0)},3842:(e,t,r)=>{"use strict";r(8545),r(3643),r(4452),r(3997),r(5084),r(2596),r(5721),r(4954),r(4123),r(3377),r(2230),r(5344),r(1660),r(4610),r(3669),r(4810),r(3325),r(7024),r(8172),r(5205);var i=r(2046);e.exports=i.Symbol},1730:(e,t,r)=>{"use strict";r(9363),r(3643),r(7057),r(4954);var i=r(560);e.exports=i.f("iterator")},1661:(e,t,r)=>{"use strict";r(8537),r(3669);var i=r(560);e.exports=i.f("toPrimitive")},4997:(e,t,r)=>{"use strict";var i=r(6040);e.exports=i},2321:(e,t,r)=>{"use strict";var i=r(7264);r(3939),r(1785),r(1697),r(4664),r(3422),r(36),r(8703),r(6878),r(9671),r(359),e.exports=i},2231:(e,t,r)=>{"use strict";var i=r(9692);e.exports=i},9280:(e,t,r)=>{"use strict";var i=r(5663);e.exports=i},2159:(e,t,r)=>{"use strict";var i=r(2250),n=r(4640),s=TypeError;e.exports=function(e){if(i(e))return e;throw new s(n(e)+" is not a function")}},43:(e,t,r)=>{"use strict";var i=r(4018),n=String,s=TypeError;e.exports=function(e){if(i(e))return e;throw new s("Can't set "+n(e)+" as a prototype")}},2156:e=>{"use strict";e.exports=function(){}},6624:(e,t,r)=>{"use strict";var i=r(6285),n=String,s=TypeError;e.exports=function(e){if(i(e))return e;throw new s(n(e)+" is not an object")}},4436:(e,t,r)=>{"use strict";var i=r(7374),n=r(4849),s=r(575),a=function(e){return function(t,r,a){var o=i(t),u=s(o);if(0===u)return!e&&-1;var l,c=n(a,u);if(e&&r!=r){for(;u>c;)if((l=o[c++])!=l)return!0}else for(;u>c;c++)if((e||c in o)&&o[c]===r)return e||c||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},726:(e,t,r)=>{"use strict";var i=r(8311),n=r(1907),s=r(6946),a=r(9298),o=r(575),u=r(6968),l=n([].push),c=function(e){var t=1===e,r=2===e,n=3===e,c=4===e,h=6===e,f=7===e,d=5===e||h;return function(p,g,v,y){for(var m,x,b=a(p),w=s(b),_=o(w),P=i(g,v),T=0,S=y||u,U=t?S(p,_):r||f?S(p,0):void 0;_>T;T++)if((d||T in w)&&(x=P(m=w[T],T,b),e))if(t)U[T]=x;else if(x)switch(e){case 3:return!0;case 5:return m;case 6:return T;case 2:l(U,m)}else switch(e){case 4:return!1;case 7:l(U,m)}return h?-1:n||c?c:U}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterReject:c(7)}},7171:(e,t,r)=>{"use strict";var i=r(8828),n=r(6264),s=r(798),a=n("species");e.exports=function(e){return s>=51||!i((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},7623:(e,t,r)=>{"use strict";var i=r(8828);e.exports=function(e,t){var r=[][e];return!!r&&i((function(){r.call(null,t||function(){return 1},1)}))}},3427:(e,t,r)=>{"use strict";var i=r(1907);e.exports=i([].slice)},4321:(e,t,r)=>{"use strict";var i=r(3427),n=Math.floor,s=function(e,t){var r=e.length;if(r<8)for(var a,o,u=1;u<r;){for(o=u,a=e[u];o&&t(e[o-1],a)>0;)e[o]=e[--o];o!==u++&&(e[o]=a)}else for(var l=n(r/2),c=s(i(e,0,l),t),h=s(i(e,l),t),f=c.length,d=h.length,p=0,g=0;p<f||g<d;)e[p+g]=p<f&&g<d?t(c[p],h[g])<=0?c[p++]:h[g++]:p<f?c[p++]:h[g++];return e};e.exports=s},4010:(e,t,r)=>{"use strict";var i=r(1793),n=r(5468),s=r(6285),a=r(6264)("species"),o=Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(n(t)&&(t===o||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?o:t}},6968:(e,t,r)=>{"use strict";var i=r(4010);e.exports=function(e,t){return new(i(e))(0===t?0:t)}},5807:(e,t,r)=>{"use strict";var i=r(1907),n=i({}.toString),s=i("".slice);e.exports=function(e){return s(n(e),8,-1)}},3948:(e,t,r)=>{"use strict";var i=r(2623),n=r(2250),s=r(5807),a=r(6264)("toStringTag"),o=Object,u="Arguments"===s(function(){return arguments}());e.exports=i?s:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=o(e),a))?r:u?s(t):"Object"===(i=s(t))&&n(t.callee)?"Arguments":i}},7382:(e,t,r)=>{"use strict";var i=r(8828);e.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},9550:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},1626:(e,t,r)=>{"use strict";var i=r(9447),n=r(4284),s=r(5817);e.exports=i?function(e,t,r){return n.f(e,t,s(1,r))}:function(e,t,r){return e[t]=r,e}},5817:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5543:(e,t,r)=>{"use strict";var i=r(9447),n=r(4284),s=r(5817);e.exports=function(e,t,r){i?n.f(e,t,s(0,r)):e[t]=r}},9251:(e,t,r)=>{"use strict";var i=r(4284);e.exports=function(e,t,r){return i.f(e,t,r)}},8055:(e,t,r)=>{"use strict";var i=r(1626);e.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}},2532:(e,t,r)=>{"use strict";var i=r(5951),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},4535:(e,t,r)=>{"use strict";var i=r(4640),n=TypeError;e.exports=function(e,t){if(!delete e[t])throw new n("Cannot delete property "+i(t)+" of "+i(e))}},9447:(e,t,r)=>{"use strict";var i=r(8828);e.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},9552:(e,t,r)=>{"use strict";var i=r(5951),n=r(6285),s=i.document,a=n(s)&&n(s.createElement);e.exports=function(e){return a?s.createElement(e):{}}},8024:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},9287:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},376:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3440:(e,t,r)=>{"use strict";var i=r(6794).match(/firefox\/(\d+)/i);e.exports=!!i&&+i[1]},4328:(e,t,r)=>{"use strict";var i=r(6794);e.exports=/MSIE|Trident/.test(i)},6794:(e,t,r)=>{"use strict";var i=r(5951).navigator,n=i&&i.userAgent;e.exports=n?String(n):""},798:(e,t,r)=>{"use strict";var i,n,s=r(5951),a=r(6794),o=s.process,u=s.Deno,l=o&&o.versions||u&&u.version,c=l&&l.v8;c&&(n=(i=c.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(n=+i[1]),e.exports=n},3786:(e,t,r)=>{"use strict";var i=r(6794).match(/AppleWebKit\/(\d+)\./);e.exports=!!i&&+i[1]},1091:(e,t,r)=>{"use strict";var i=r(5951),n=r(6024),s=r(2361),a=r(2250),o=r(3846).f,u=r(7463),l=r(2046),c=r(8311),h=r(1626),f=r(9724);r(6128);var d=function(e){var t=function(r,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,s)}return n(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,n,p,g,v,y,m,x,b,w=e.target,_=e.global,P=e.stat,T=e.proto,S=_?i:P?i[w]:i[w]&&i[w].prototype,U=_?l:l[w]||h(l,w,{})[w],R=U.prototype;for(g in t)n=!(r=u(_?g:w+(P?".":"#")+g,e.forced))&&S&&f(S,g),y=U[g],n&&(m=e.dontCallGetSet?(b=o(S,g))&&b.value:S[g]),v=n&&m?m:t[g],(r||T||typeof y!=typeof v)&&(x=e.bind&&n?c(v,i):e.wrap&&n?d(v):T&&a(v)?s(v):v,(e.sham||v&&v.sham||y&&y.sham)&&h(x,"sham",!0),h(U,g,x),T&&(f(l,p=w+"Prototype")||h(l,p,{}),h(l[p],g,v),e.real&&R&&(r||!R[g])&&h(R,g,v)))}},8828:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},6024:(e,t,r)=>{"use strict";var i=r(1505),n=Function.prototype,s=n.apply,a=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(s):function(){return a.apply(s,arguments)})},8311:(e,t,r)=>{"use strict";var i=r(2361),n=r(2159),s=r(1505),a=i(i.bind);e.exports=function(e,t){return n(e),void 0===t?e:s?a(e,t):function(){return e.apply(t,arguments)}}},1505:(e,t,r)=>{"use strict";var i=r(8828);e.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},3930:(e,t,r)=>{"use strict";var i=r(1505),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},6833:(e,t,r)=>{"use strict";var i=r(9447),n=r(9724),s=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,o=n(s,"name"),u=o&&"something"===function(){}.name,l=o&&(!i||i&&a(s,"name").configurable);e.exports={EXISTS:o,PROPER:u,CONFIGURABLE:l}},1871:(e,t,r)=>{"use strict";var i=r(1907),n=r(2159);e.exports=function(e,t,r){try{return i(n(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},2361:(e,t,r)=>{"use strict";var i=r(5807),n=r(1907);e.exports=function(e){if("Function"===i(e))return n(e)}},1907:(e,t,r)=>{"use strict";var i=r(1505),n=Function.prototype,s=n.call,a=i&&n.bind.bind(s,s);e.exports=i?a:function(e){return function(){return s.apply(e,arguments)}}},1747:(e,t,r)=>{"use strict";var i=r(5951),n=r(2046);e.exports=function(e,t){var r=n[e+"Prototype"],s=r&&r[t];if(s)return s;var a=i[e],o=a&&a.prototype;return o&&o[t]}},5582:(e,t,r)=>{"use strict";var i=r(2046),n=r(5951),s=r(2250),a=function(e){return s(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?a(i[e])||a(n[e]):i[e]&&i[e][t]||n[e]&&n[e][t]}},6656:(e,t,r)=>{"use strict";var i=r(1907),n=r(1793),s=r(2250),a=r(5807),o=r(160),u=i([].push);e.exports=function(e){if(s(e))return e;if(n(e)){for(var t=e.length,r=[],i=0;i<t;i++){var l=e[i];"string"==typeof l?u(r,l):"number"!=typeof l&&"Number"!==a(l)&&"String"!==a(l)||u(r,o(l))}var c=r.length,h=!0;return function(e,t){if(h)return h=!1,t;if(n(this))return t;for(var i=0;i<c;i++)if(r[i]===e)return t}}}},9367:(e,t,r)=>{"use strict";var i=r(2159),n=r(7136);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},5951:function(e,t,r){"use strict";var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9724:(e,t,r)=>{"use strict";var i=r(1907),n=r(9298),s=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return s(n(e),t)}},8530:e=>{"use strict";e.exports={}},2416:(e,t,r)=>{"use strict";var i=r(5582);e.exports=i("document","documentElement")},3648:(e,t,r)=>{"use strict";var i=r(9447),n=r(8828),s=r(9552);e.exports=!i&&!n((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},6946:(e,t,r)=>{"use strict";var i=r(1907),n=r(8828),s=r(5807),a=Object,o=i("".split);e.exports=n((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?o(e,""):a(e)}:a},2647:(e,t,r)=>{"use strict";var i=r(1907),n=r(2250),s=r(6128),a=i(Function.toString);n(s.inspectSource)||(s.inspectSource=function(e){return a(e)}),e.exports=s.inspectSource},4932:(e,t,r)=>{"use strict";var i,n,s,a=r(551),o=r(5951),u=r(6285),l=r(1626),c=r(9724),h=r(6128),f=r(2522),d=r(8530),p="Object already initialized",g=o.TypeError,v=o.WeakMap;if(a||h.state){var y=h.state||(h.state=new v);y.get=y.get,y.has=y.has,y.set=y.set,i=function(e,t){if(y.has(e))throw new g(p);return t.facade=e,y.set(e,t),t},n=function(e){return y.get(e)||{}},s=function(e){return y.has(e)}}else{var m=f("state");d[m]=!0,i=function(e,t){if(c(e,m))throw new g(p);return t.facade=e,l(e,m,t),t},n=function(e){return c(e,m)?e[m]:{}},s=function(e){return c(e,m)}}e.exports={set:i,get:n,has:s,enforce:function(e){return s(e)?n(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=n(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}},1793:(e,t,r)=>{"use strict";var i=r(5807);e.exports=Array.isArray||function(e){return"Array"===i(e)}},2250:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},5468:(e,t,r)=>{"use strict";var i=r(1907),n=r(8828),s=r(2250),a=r(3948),o=r(5582),u=r(2647),l=function(){},c=o("Reflect","construct"),h=/^\s*(?:class|function)\b/,f=i(h.exec),d=!h.test(l),p=function(e){if(!s(e))return!1;try{return c(l,[],e),!0}catch(e){return!1}},g=function(e){if(!s(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!f(h,u(e))}catch(e){return!0}};g.sham=!0,e.exports=!c||n((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?g:p},7463:(e,t,r)=>{"use strict";var i=r(8828),n=r(2250),s=/#|\.prototype\./,a=function(e,t){var r=u[o(e)];return r===c||r!==l&&(n(t)?i(t):!!t)},o=a.normalize=function(e){return String(e).replace(s,".").toLowerCase()},u=a.data={},l=a.NATIVE="N",c=a.POLYFILL="P";e.exports=a},7136:e=>{"use strict";e.exports=function(e){return null==e}},6285:(e,t,r)=>{"use strict";var i=r(2250);e.exports=function(e){return"object"==typeof e?null!==e:i(e)}},4018:(e,t,r)=>{"use strict";var i=r(6285);e.exports=function(e){return i(e)||null===e}},7376:e=>{"use strict";e.exports=!0},5594:(e,t,r)=>{"use strict";var i=r(5582),n=r(2250),s=r(8280),a=r(1175),o=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&s(t.prototype,o(e))}},7181:(e,t,r)=>{"use strict";var i=r(5116).IteratorPrototype,n=r(8075),s=r(5817),a=r(4840),o=r(3742),u=function(){return this};e.exports=function(e,t,r,l){var c=t+" Iterator";return e.prototype=n(i,{next:s(+!l,r)}),a(e,c,!1,!0),o[c]=u,e}},183:(e,t,r)=>{"use strict";var i=r(1091),n=r(3930),s=r(7376),a=r(6833),o=r(2250),u=r(7181),l=r(5972),c=r(9192),h=r(4840),f=r(1626),d=r(8055),p=r(6264),g=r(3742),v=r(5116),y=a.PROPER,m=a.CONFIGURABLE,x=v.IteratorPrototype,b=v.BUGGY_SAFARI_ITERATORS,w=p("iterator"),_="keys",P="values",T="entries",S=function(){return this};e.exports=function(e,t,r,a,p,v,U){u(r,t,a);var R,M,B,G=function(e){if(e===p&&F)return F;if(!b&&e&&e in W)return W[e];switch(e){case _:case P:case T:return function(){return new r(this,e)}}return function(){return new r(this)}},k=t+" Iterator",E=!1,W=e.prototype,C=W[w]||W["@@iterator"]||p&&W[p],F=!b&&C||G(p),O="Array"===t&&W.entries||C;if(O&&(R=l(O.call(new e)))!==Object.prototype&&R.next&&(s||l(R)===x||(c?c(R,x):o(R[w])||d(R,w,S)),h(R,k,!0,!0),s&&(g[k]=S)),y&&p===P&&C&&C.name!==P&&(!s&&m?f(W,"name",P):(E=!0,F=function(){return n(C,this)})),p)if(M={values:G(P),keys:v?F:G(_),entries:G(T)},U)for(B in M)(b||E||!(B in W))&&d(W,B,M[B]);else i({target:t,proto:!0,forced:b||E},M);return s&&!U||W[w]===F||d(W,w,F,{name:p}),g[t]=F,M}},5116:(e,t,r)=>{"use strict";var i,n,s,a=r(8828),o=r(2250),u=r(6285),l=r(8075),c=r(5972),h=r(8055),f=r(6264),d=r(7376),p=f("iterator"),g=!1;[].keys&&("next"in(s=[].keys())?(n=c(c(s)))!==Object.prototype&&(i=n):g=!0),!u(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:d&&(i=l(i)),o(i[p])||h(i,p,(function(){return this})),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:g}},3742:e=>{"use strict";e.exports={}},575:(e,t,r)=>{"use strict";var i=r(3121);e.exports=function(e){return i(e.length)}},1176:e=>{"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},8075:(e,t,r)=>{"use strict";var i,n=r(6624),s=r(2220),a=r(376),o=r(8530),u=r(2416),l=r(9552),c=r(2522),h="prototype",f="script",d=c("IE_PROTO"),p=function(){},g=function(e){return"<"+f+">"+e+"</"+f+">"},v=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;y="undefined"!=typeof document?document.domain&&i?v(i):(t=l("iframe"),r="java"+f+":",t.style.display="none",u.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):v(i);for(var n=a.length;n--;)delete y[h][a[n]];return y()};o[d]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(p[h]=n(e),r=new p,p[h]=null,r[d]=e):r=y(),void 0===t?r:s.f(r,t)}},2220:(e,t,r)=>{"use strict";var i=r(9447),n=r(8661),s=r(4284),a=r(6624),o=r(7374),u=r(2875);t.f=i&&!n?Object.defineProperties:function(e,t){a(e);for(var r,i=o(t),n=u(t),l=n.length,c=0;l>c;)s.f(e,r=n[c++],i[r]);return e}},4284:(e,t,r)=>{"use strict";var i=r(9447),n=r(3648),s=r(8661),a=r(6624),o=r(470),u=TypeError,l=Object.defineProperty,c=Object.getOwnPropertyDescriptor,h="enumerable",f="configurable",d="writable";t.f=i?s?function(e,t,r){if(a(e),t=o(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&d in r&&!r[d]){var i=c(e,t);i&&i[d]&&(e[t]=r.value,r={configurable:f in r?r[f]:i[f],enumerable:h in r?r[h]:i[h],writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(a(e),t=o(t),a(r),n)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},3846:(e,t,r)=>{"use strict";var i=r(9447),n=r(3930),s=r(2574),a=r(5817),o=r(7374),u=r(470),l=r(9724),c=r(3648),h=Object.getOwnPropertyDescriptor;t.f=i?h:function(e,t){if(e=o(e),t=u(t),c)try{return h(e,t)}catch(e){}if(l(e,t))return a(!n(s.f,e,t),e[t])}},5407:(e,t,r)=>{"use strict";var i=r(5807),n=r(7374),s=r(4443).f,a=r(3427),o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"Window"===i(e)?function(e){try{return s(e)}catch(e){return a(o)}}(e):s(n(e))}},4443:(e,t,r)=>{"use strict";var i=r(3045),n=r(376).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,n)}},7170:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},5972:(e,t,r)=>{"use strict";var i=r(9724),n=r(2250),s=r(9298),a=r(2522),o=r(7382),u=a("IE_PROTO"),l=Object,c=l.prototype;e.exports=o?l.getPrototypeOf:function(e){var t=s(e);if(i(t,u))return t[u];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof l?c:null}},8280:(e,t,r)=>{"use strict";var i=r(1907);e.exports=i({}.isPrototypeOf)},3045:(e,t,r)=>{"use strict";var i=r(1907),n=r(9724),s=r(7374),a=r(4436).indexOf,o=r(8530),u=i([].push);e.exports=function(e,t){var r,i=s(e),l=0,c=[];for(r in i)!n(o,r)&&n(i,r)&&u(c,r);for(;t.length>l;)n(i,r=t[l++])&&(~a(c,r)||u(c,r));return c}},2875:(e,t,r)=>{"use strict";var i=r(3045),n=r(376);e.exports=Object.keys||function(e){return i(e,n)}},2574:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},9192:(e,t,r)=>{"use strict";var i=r(1871),n=r(6285),s=r(4239),a=r(43);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return s(r),a(i),n(r)?(t?e(r,i):r.__proto__=i,r):r}}():void 0)},4878:(e,t,r)=>{"use strict";var i=r(2623),n=r(3948);e.exports=i?{}.toString:function(){return"[object "+n(this)+"]"}},581:(e,t,r)=>{"use strict";var i=r(3930),n=r(2250),s=r(6285),a=TypeError;e.exports=function(e,t){var r,o;if("string"===t&&n(r=e.toString)&&!s(o=i(r,e)))return o;if(n(r=e.valueOf)&&!s(o=i(r,e)))return o;if("string"!==t&&n(r=e.toString)&&!s(o=i(r,e)))return o;throw new a("Can't convert object to primitive value")}},2046:e=>{"use strict";e.exports={}},4239:(e,t,r)=>{"use strict";var i=r(7136),n=TypeError;e.exports=function(e){if(i(e))throw new n("Can't call method on "+e);return e}},4840:(e,t,r)=>{"use strict";var i=r(2623),n=r(4284).f,s=r(1626),a=r(9724),o=r(4878),u=r(6264)("toStringTag");e.exports=function(e,t,r,l){var c=r?e:e&&e.prototype;c&&(a(c,u)||n(c,u,{configurable:!0,value:t}),l&&!i&&s(c,"toString",o))}},2522:(e,t,r)=>{"use strict";var i=r(5816),n=r(6499),s=i("keys");e.exports=function(e){return s[e]||(s[e]=n(e))}},6128:(e,t,r)=>{"use strict";var i=r(7376),n=r(5951),s=r(2532),a="__core-js_shared__",o=e.exports=n[a]||s(a,{});(o.versions||(o.versions=[])).push({version:"3.39.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5816:(e,t,r)=>{"use strict";var i=r(6128);e.exports=function(e,t){return i[e]||(i[e]=t||{})}},1470:(e,t,r)=>{"use strict";var i=r(1907),n=r(5482),s=r(160),a=r(4239),o=i("".charAt),u=i("".charCodeAt),l=i("".slice),c=function(e){return function(t,r){var i,c,h=s(a(t)),f=n(r),d=h.length;return f<0||f>=d?e?"":void 0:(i=u(h,f))<55296||i>56319||f+1===d||(c=u(h,f+1))<56320||c>57343?e?o(h,f):i:e?l(h,f,f+2):c-56320+(i-55296<<10)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},9846:(e,t,r)=>{"use strict";var i=r(798),n=r(8828),s=r(5951).String;e.exports=!!Object.getOwnPropertySymbols&&!n((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},3467:(e,t,r)=>{"use strict";var i=r(3930),n=r(5582),s=r(6264),a=r(8055);e.exports=function(){var e=n("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,o=s("toPrimitive");t&&!t[o]&&a(t,o,(function(e){return i(r,this)}),{arity:1})}},2595:(e,t,r)=>{"use strict";var i=r(5582),n=r(1907),s=i("Symbol"),a=s.keyFor,o=n(s.prototype.valueOf);e.exports=s.isRegisteredSymbol||function(e){try{return void 0!==a(o(e))}catch(e){return!1}}},9197:(e,t,r)=>{"use strict";for(var i=r(5816),n=r(5582),s=r(1907),a=r(5594),o=r(6264),u=n("Symbol"),l=u.isWellKnownSymbol,c=n("Object","getOwnPropertyNames"),h=s(u.prototype.valueOf),f=i("wks"),d=0,p=c(u),g=p.length;d<g;d++)try{var v=p[d];a(u[v])&&o(v)}catch(e){}e.exports=function(e){if(l&&l(e))return!0;try{for(var t=h(e),r=0,i=c(f),n=i.length;r<n;r++)if(f[i[r]]==t)return!0}catch(e){}return!1}},4411:(e,t,r)=>{"use strict";var i=r(9846);e.exports=i&&!!Symbol.for&&!!Symbol.keyFor},4849:(e,t,r)=>{"use strict";var i=r(5482),n=Math.max,s=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):s(r,t)}},7374:(e,t,r)=>{"use strict";var i=r(6946),n=r(4239);e.exports=function(e){return i(n(e))}},5482:(e,t,r)=>{"use strict";var i=r(1176);e.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}},3121:(e,t,r)=>{"use strict";var i=r(5482),n=Math.min;e.exports=function(e){var t=i(e);return t>0?n(t,9007199254740991):0}},9298:(e,t,r)=>{"use strict";var i=r(4239),n=Object;e.exports=function(e){return n(i(e))}},6028:(e,t,r)=>{"use strict";var i=r(3930),n=r(6285),s=r(5594),a=r(9367),o=r(581),u=r(6264),l=TypeError,c=u("toPrimitive");e.exports=function(e,t){if(!n(e)||s(e))return e;var r,u=a(e,c);if(u){if(void 0===t&&(t="default"),r=i(u,e,t),!n(r)||s(r))return r;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),o(e,t)}},470:(e,t,r)=>{"use strict";var i=r(6028),n=r(5594);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},2623:(e,t,r)=>{"use strict";var i={};i[r(6264)("toStringTag")]="z",e.exports="[object z]"===String(i)},160:(e,t,r)=>{"use strict";var i=r(3948),n=String;e.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},4640:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},6499:(e,t,r)=>{"use strict";var i=r(1907),n=0,s=Math.random(),a=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++n+s,36)}},1175:(e,t,r)=>{"use strict";var i=r(9846);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8661:(e,t,r)=>{"use strict";var i=r(9447),n=r(8828);e.exports=i&&n((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},551:(e,t,r)=>{"use strict";var i=r(5951),n=r(2250),s=i.WeakMap;e.exports=n(s)&&/native code/.test(String(s))},366:(e,t,r)=>{"use strict";var i=r(2046),n=r(9724),s=r(560),a=r(4284).f;e.exports=function(e){var t=i.Symbol||(i.Symbol={});n(t,e)||a(t,e,{value:s.f(e)})}},560:(e,t,r)=>{"use strict";var i=r(6264);t.f=i},6264:(e,t,r)=>{"use strict";var i=r(5951),n=r(5816),s=r(9724),a=r(6499),o=r(9846),u=r(1175),l=i.Symbol,c=n("wks"),h=u?l.for||l:l&&l.withoutSetter||a;e.exports=function(e){return s(c,e)||(c[e]=o&&s(l,e)?l[e]:h("Symbol."+e)),c[e]}},8545:(e,t,r)=>{"use strict";var i=r(1091),n=r(8828),s=r(1793),a=r(6285),o=r(9298),u=r(575),l=r(8024),c=r(5543),h=r(6968),f=r(7171),d=r(6264),p=r(798),g=d("isConcatSpreadable"),v=p>=51||!n((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),y=function(e){if(!a(e))return!1;var t=e[g];return void 0!==t?!!t:s(e)};i({target:"Array",proto:!0,arity:1,forced:!v||!f("concat")},{concat:function(e){var t,r,i,n,s,a=o(this),f=h(a,0),d=0;for(t=-1,i=arguments.length;t<i;t++)if(y(s=-1===t?a:arguments[t]))for(n=u(s),l(d+n),r=0;r<n;r++,d++)r in s&&c(f,d,s[r]);else l(d+1),c(f,d++,s);return f.length=d,f}})},9363:(e,t,r)=>{"use strict";var i=r(7374),n=r(2156),s=r(3742),a=r(4932),o=r(4284).f,u=r(183),l=r(9550),c=r(7376),h=r(9447),f="Array Iterator",d=a.set,p=a.getterFor(f);e.exports=u(Array,"Array",(function(e,t){d(this,{type:f,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,l(void 0,!0);switch(e.kind){case"keys":return l(r,!1);case"values":return l(t[r],!1)}return l([r,t[r]],!1)}),"values");var g=s.Arguments=s.Array;if(n("keys"),n("values"),n("entries"),!c&&h&&"values"!==g.name)try{o(g,"name",{value:"values"})}catch(e){}},6737:(e,t,r)=>{"use strict";var i=r(1091),n=r(1907),s=r(2159),a=r(9298),o=r(575),u=r(4535),l=r(160),c=r(8828),h=r(4321),f=r(7623),d=r(3440),p=r(4328),g=r(798),v=r(3786),y=[],m=n(y.sort),x=n(y.push),b=c((function(){y.sort(void 0)})),w=c((function(){y.sort(null)})),_=f("sort"),P=!c((function(){if(g)return g<70;if(!(d&&d>3)){if(p)return!0;if(v)return v<603;var e,t,r,i,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)y.push({k:t+i,v:r})}for(y.sort((function(e,t){return t.v-e.v})),i=0;i<y.length;i++)t=y[i].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}}));i({target:"Array",proto:!0,forced:b||!w||!_||!P},{sort:function(e){void 0!==e&&s(e);var t=a(this);if(P)return void 0===e?m(t):m(t,e);var r,i,n=[],c=o(t);for(i=0;i<c;i++)i in t&&x(n,t[i]);for(h(n,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:l(t)>l(r)?1:-1}}(e)),r=o(n),i=0;i<r;)t[i]=n[i++];for(;i<c;)u(t,i++);return t}})},8537:()=>{},9721:(e,t,r)=>{"use strict";var i=r(1091),n=r(5582),s=r(6024),a=r(3930),o=r(1907),u=r(8828),l=r(2250),c=r(5594),h=r(3427),f=r(6656),d=r(9846),p=String,g=n("JSON","stringify"),v=o(/./.exec),y=o("".charAt),m=o("".charCodeAt),x=o("".replace),b=o(1..toString),w=/[\uD800-\uDFFF]/g,_=/^[\uD800-\uDBFF]$/,P=/^[\uDC00-\uDFFF]$/,T=!d||u((function(){var e=n("Symbol")("stringify detection");return"[null]"!==g([e])||"{}"!==g({a:e})||"{}"!==g(Object(e))})),S=u((function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")})),U=function(e,t){var r=h(arguments),i=f(t);if(l(i)||void 0!==e&&!c(e))return r[1]=function(e,t){if(l(i)&&(t=a(i,this,p(e),t)),!c(t))return t},s(g,null,r)},R=function(e,t,r){var i=y(r,t-1),n=y(r,t+1);return v(_,e)&&!v(P,n)||v(P,e)&&!v(_,i)?"\\u"+b(m(e,0),16):e};g&&i({target:"JSON",stat:!0,arity:3,forced:T||S},{stringify:function(e,t,r){var i=h(arguments),n=s(T?U:g,null,i);return S&&"string"==typeof n?x(n,w,R):n}})},7024:(e,t,r)=>{"use strict";var i=r(5951);r(4840)(i.JSON,"JSON",!0)},8172:()=>{},6750:(e,t,r)=>{"use strict";var i=r(1091),n=r(9447),s=r(4284).f;i({target:"Object",stat:!0,forced:Object.defineProperty!==s,sham:!n},{defineProperty:s})},5264:(e,t,r)=>{"use strict";var i=r(1091),n=r(9846),s=r(8828),a=r(7170),o=r(9298);i({target:"Object",stat:!0,forced:!n||s((function(){a.f(1)}))},{getOwnPropertySymbols:function(e){var t=a.f;return t?t(o(e)):[]}})},3643:()=>{},5205:()=>{},7057:(e,t,r)=>{"use strict";var i=r(1470).charAt,n=r(160),s=r(4932),a=r(183),o=r(9550),u="String Iterator",l=s.set,c=s.getterFor(u);a(String,"String",(function(e){l(this,{type:u,string:n(e),index:0})}),(function(){var e,t=c(this),r=t.string,n=t.index;return n>=r.length?o(void 0,!0):(e=i(r,n),t.index+=e.length,o(e,!1))}))},3997:(e,t,r)=>{"use strict";r(366)("asyncIterator")},3674:(e,t,r)=>{"use strict";var i=r(1091),n=r(5951),s=r(3930),a=r(1907),o=r(7376),u=r(9447),l=r(9846),c=r(8828),h=r(9724),f=r(8280),d=r(6624),p=r(7374),g=r(470),v=r(160),y=r(5817),m=r(8075),x=r(2875),b=r(4443),w=r(5407),_=r(7170),P=r(3846),T=r(4284),S=r(2220),U=r(2574),R=r(8055),M=r(9251),B=r(5816),G=r(2522),k=r(8530),E=r(6499),W=r(6264),C=r(560),F=r(366),O=r(3467),A=r(4840),V=r(4932),L=r(726).forEach,I=G("hidden"),N="Symbol",D="prototype",z=V.set,j=V.getterFor(N),q=Object[D],Y=n.Symbol,H=Y&&Y[D],X=n.RangeError,J=n.TypeError,K=n.QObject,Z=P.f,Q=T.f,$=w.f,ee=U.f,te=a([].push),re=B("symbols"),ie=B("op-symbols"),ne=B("wks"),se=!K||!K[D]||!K[D].findChild,ae=function(e,t,r){var i=Z(q,t);i&&delete q[t],Q(e,t,r),i&&e!==q&&Q(q,t,i)},oe=u&&c((function(){return 7!==m(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a}))?ae:Q,ue=function(e,t){var r=re[e]=m(H);return z(r,{type:N,tag:e,description:t}),u||(r.description=t),r},le=function(e,t,r){e===q&&le(ie,t,r),d(e);var i=g(t);return d(r),h(re,i)?(r.enumerable?(h(e,I)&&e[I][i]&&(e[I][i]=!1),r=m(r,{enumerable:y(0,!1)})):(h(e,I)||Q(e,I,y(1,m(null))),e[I][i]=!0),oe(e,i,r)):Q(e,i,r)},ce=function(e,t){d(e);var r=p(t),i=x(r).concat(pe(r));return L(i,(function(t){u&&!s(he,r,t)||le(e,t,r[t])})),e},he=function(e){var t=g(e),r=s(ee,this,t);return!(this===q&&h(re,t)&&!h(ie,t))&&(!(r||!h(this,t)||!h(re,t)||h(this,I)&&this[I][t])||r)},fe=function(e,t){var r=p(e),i=g(t);if(r!==q||!h(re,i)||h(ie,i)){var n=Z(r,i);return!n||!h(re,i)||h(r,I)&&r[I][i]||(n.enumerable=!0),n}},de=function(e){var t=$(p(e)),r=[];return L(t,(function(e){h(re,e)||h(k,e)||te(r,e)})),r},pe=function(e){var t=e===q,r=$(t?ie:p(e)),i=[];return L(r,(function(e){!h(re,e)||t&&!h(q,e)||te(i,re[e])})),i};l||(R(H=(Y=function(){if(f(H,this))throw new J("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?v(arguments[0]):void 0,t=E(e),r=function(e){var i=void 0===this?n:this;i===q&&s(r,ie,e),h(i,I)&&h(i[I],t)&&(i[I][t]=!1);var a=y(1,e);try{oe(i,t,a)}catch(e){if(!(e instanceof X))throw e;ae(i,t,a)}};return u&&se&&oe(q,t,{configurable:!0,set:r}),ue(t,e)})[D],"toString",(function(){return j(this).tag})),R(Y,"withoutSetter",(function(e){return ue(E(e),e)})),U.f=he,T.f=le,S.f=ce,P.f=fe,b.f=w.f=de,_.f=pe,C.f=function(e){return ue(W(e),e)},u&&(M(H,"description",{configurable:!0,get:function(){return j(this).description}}),o||R(q,"propertyIsEnumerable",he,{unsafe:!0}))),i({global:!0,constructor:!0,wrap:!0,forced:!l,sham:!l},{Symbol:Y}),L(x(ne),(function(e){F(e)})),i({target:N,stat:!0,forced:!l},{useSetter:function(){se=!0},useSimple:function(){se=!1}}),i({target:"Object",stat:!0,forced:!l,sham:!u},{create:function(e,t){return void 0===t?m(e):ce(m(e),t)},defineProperty:le,defineProperties:ce,getOwnPropertyDescriptor:fe}),i({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:de}),O(),A(Y,N),k[I]=!0},5084:()=>{},3313:(e,t,r)=>{"use strict";var i=r(1091),n=r(5582),s=r(9724),a=r(160),o=r(5816),u=r(4411),l=o("string-to-symbol-registry"),c=o("symbol-to-string-registry");i({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=a(e);if(s(l,t))return l[t];var r=n("Symbol")(t);return l[t]=r,c[r]=t,r}})},2596:(e,t,r)=>{"use strict";r(366)("hasInstance")},5721:(e,t,r)=>{"use strict";r(366)("isConcatSpreadable")},4954:(e,t,r)=>{"use strict";r(366)("iterator")},4452:(e,t,r)=>{"use strict";r(3674),r(3313),r(751),r(9721),r(5264)},751:(e,t,r)=>{"use strict";var i=r(1091),n=r(9724),s=r(5594),a=r(4640),o=r(5816),u=r(4411),l=o("symbol-to-string-registry");i({target:"Symbol",stat:!0,forced:!u},{keyFor:function(e){if(!s(e))throw new TypeError(a(e)+" is not a symbol");if(n(l,e))return l[e]}})},3377:(e,t,r)=>{"use strict";r(366)("matchAll")},4123:(e,t,r)=>{"use strict";r(366)("match")},2230:(e,t,r)=>{"use strict";r(366)("replace")},5344:(e,t,r)=>{"use strict";r(366)("search")},1660:(e,t,r)=>{"use strict";r(366)("species")},4610:(e,t,r)=>{"use strict";r(366)("split")},3669:(e,t,r)=>{"use strict";var i=r(366),n=r(3467);i("toPrimitive"),n()},4810:(e,t,r)=>{"use strict";var i=r(5582),n=r(366),s=r(4840);n("toStringTag"),s(i("Symbol"),"Symbol")},3325:(e,t,r)=>{"use strict";r(366)("unscopables")},768:(e,t,r)=>{"use strict";var i=r(6264),n=r(4284).f,s=i("metadata"),a=Function.prototype;void 0===a[s]&&n(a,s,{value:null})},8549:(e,t,r)=>{"use strict";r(366)("asyncDispose")},1697:(e,t,r)=>{"use strict";r(366)("customMatcher")},7152:(e,t,r)=>{"use strict";r(366)("dispose")},3939:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0},{isRegisteredSymbol:r(2595)})},3422:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:r(2595)})},1785:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:r(9197)})},36:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:r(9197)})},8703:(e,t,r)=>{"use strict";r(366)("matcher")},6878:(e,t,r)=>{"use strict";r(366)("metadataKey")},1372:(e,t,r)=>{"use strict";r(366)("metadata")},4664:(e,t,r)=>{"use strict";r(366)("observable")},9671:(e,t,r)=>{"use strict";r(366)("patternMatch")},359:(e,t,r)=>{"use strict";r(366)("replaceAll")},2560:(e,t,r)=>{"use strict";r(9363);var i=r(9287),n=r(5951),s=r(4840),a=r(3742);for(var o in i)s(n[o],o),a[o]=a.Array},1086:(e,t,r)=>{"use strict";var i=r(2757);e.exports=i},8251:(e,t,r)=>{"use strict";var i=r(1926);e.exports=i},4139:(e,t,r)=>{"use strict";var i=r(3842);r(2560),e.exports=i},7045:(e,t,r)=>{"use strict";var i=r(1730);r(2560),e.exports=i},70:(e,t,r)=>{"use strict";var i=r(1661);e.exports=i}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";let e;const t=()=>e;var i=r(4997),n=r(2321),s=r(2231);function a(e){return a="function"==typeof n&&"symbol"==typeof s?function(e){return typeof e}:function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e},a(e)}var o=r(9280);const u=[{u:1,v:0},{u:1,v:1},{u:0,v:1},{u:1,v:0},{u:0,v:0},{u:0,v:1}],l=[{x:1,y:1},{x:1,y:-1},{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}],c=[60,120,180,360,540,720,1080,2160],h=[180,360,540,720,1080,2160],f=0,d=3;function p(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function g(e,t){return e.get(y(e,t))}function v(e,t,r){return e.set(y(e,t),r),r}function y(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}new Map([["useinbandfec",1],["maxaveragebitrate",48e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3]]),new Map([["useinbandfec",1],["maxaveragebitrate",64e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]]),new Map([["stereo",1]]);var m=new WeakMap,x=new WeakMap,b=new WeakMap,w=new WeakMap,_=new WeakMap,P=new WeakMap,T=new WeakMap,S=new WeakMap,U=new WeakMap,R=new WeakMap,M=new WeakMap,B=new WeakMap,G=new WeakMap,k=new WeakMap,E=new WeakMap,W=new WeakMap,C=new WeakMap,F=new WeakMap;const O=class{constructor(e,t){p(this,m,0),p(this,x,-1),p(this,b,0),p(this,w,0),p(this,_,-1),p(this,P,null),p(this,T,-1),p(this,S,null),p(this,U,null),p(this,R,null),p(this,M,!1),p(this,B,null),p(this,G,null),p(this,k,null),p(this,E,null),p(this,W,null),p(this,C,!1),p(this,F,""),v(m,this,e),v(x,this,t)}getIndex(){return g(m,this)}lock(){v(M,this,!0)}unlock(){v(M,this,!1)}isLocked(){return g(M,this)}getZIndex(){return g(x,this)}setWidth(e){v(b,this,e)}setHeight(e){v(w,this,e)}getWidth(){return g(b,this)}getHeight(){return g(w,this)}getRawData(){return g(P,this)}setRawData(e){v(P,this,e)}setIsNew(e){v(C,this,e)}isNew(){return g(C,this)}setColorFormat(e){v(F,this,e)}getColorFormat(){return g(F,this)}setPendingVideoFrame(e){g(B,this)&&(g(B,this).close(),v(B,this,null)),v(B,this,e)}clearPendingVideoFrame(){g(B,this)&&(g(B,this).close(),v(B,this,null))}setTextureLayerType(e){v(_,this,e)}getTextureLayerType(){return g(_,this)}setTextureType(e){v(T,this,e)}getTextureType(){return g(T,this)}getPendingVideoFrame(){return g(B,this)}getUVCoords(){return g(U,this)}setUVCoords(e){v(U,this,e)}getUVCoordsBuffer(){return g(E,this)}setUVCoordsBuffer(e){v(E,this,e)}evalViewport(e,t,r,i,n){g(R,this)||v(R,this,{}),g(R,this).x=Math.floor(e),g(R,this).w=Math.floor(r),g(R,this).h=Math.floor(i),0==g(_,this)?g(R,this).y=Math.floor(n-(t+i)):g(R,this).y=Math.floor(t),g(R,this).x<0&&(g(R,this).x=0),g(R,this).y<0&&(g(R,this).y=0),g(R,this).minDepth=0,g(R,this).maxDepth=1}setViewport(e){v(R,this,e)}getViewport(){return g(R,this)}getTextureGroup(){return g(S,this)}setTextureGroup(e){v(S,this,e)}setUniformBuffer(e){v(G,this,e)}getUniformBuffer(){return g(G,this)}setClearColorUniformBuffer(e){v(k,this,e)}getClearColorUniformBuffer(){return g(k,this)}setTextureBufferGroup(e){v(W,this,e)}getTextureBufferGroup(){return g(W,this)}destroyTextureBufferGroup(){g(W,this)&&v(W,this,null)}recycle(e){this.destroyTextureBufferGroup(),e&&e.destroyTextureGroup(this),g(B,this)&&(g(B,this).close(),v(B,this,null)),g(G,this)&&(g(G,this).destroy(),v(G,this,null)),g(k,this)&&(g(k,this).destroy(),v(k,this,null)),v(m,this,-1),v(x,this,-1),v(_,this,-1),v(P,this,null),v(T,this,-1),v(U,this,null),v(R,this,null),v(M,this,!1),v(C,this,!1),v(F,this,"")}};function A(e,r,i){if(!e||r<0||i<0)throw new Error("isDimensionsOverMaxDimension2DSize() invalid parameters. res=".concat(e,", width=").concat(r,", height=").concat(i));let n=!1,s=0;const a=e.acquireGPUFeaturesHelper();return a&&(s=a.queryMaxTextureDimension2D(),s>0&&(n=r>s||i>s)),n&&(console.log("isDimensionsOverMaxDimension2DSize() w:".concat(r," h:").concat(i," max:").concat(s)),t().tracing.add_monitor("WGPU isDimensionsOverMaxDimension2DSize() w:".concat(r," h:").concat(i," max:").concat(s))),n}function V(e,t,r){L(e,t),t.set(e,r)}function L(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function I(e,t){return e.get(D(e,t))}function N(e,t,r){return e.set(D(e,t),r),r}function D(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var z=new WeakMap,j=new WeakMap,q=new WeakMap,Y=new WeakMap,H=new WeakMap,X=new WeakMap,J=new WeakMap,K=new WeakMap,Z=new WeakMap,Q=new WeakMap,$=new WeakMap,ee=new WeakMap,te=new WeakMap,re=new WeakMap,ie=new WeakMap,ne=new WeakMap,se=new WeakMap,ae=new WeakMap,oe=new WeakMap,ue=new WeakMap,le=new WeakMap,ce=new WeakMap,he=new WeakMap,fe=new WeakMap,de=new WeakMap,pe=new WeakMap,ge=new WeakMap,ve=new WeakMap,ye=new WeakMap,me=new WeakMap,xe=new WeakMap,be=new WeakMap,we=new WeakMap,_e=new WeakMap,Pe=new WeakMap,Te=new WeakMap,Se=new WeakMap,Ue=new WeakMap,Re=new WeakMap,Me=new WeakMap,Be=new WeakMap,Ge=new WeakMap,ke=new WeakMap,Ee=new WeakMap,We=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Oe=new WeakMap,Ae=new WeakMap,Ve=new WeakMap,Le=new WeakMap,Ie=new WeakMap,Ne=new WeakMap,De=new WeakMap,ze=new WeakSet;function je(e,r,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(D(ze,this,tt).call(this),!I(re,this)||!I(ie,this)||!I(re,this).isGPUDeviceReady())return void(i instanceof VideoFrame&&i.close());const s=D(ze,this,it).call(this,0);if(s.isLocked()){const a=s.getPendingVideoFrame();!a||a.codedWidth==e&&a.codedHeight==r?i instanceof VideoFrame&&i.close():i instanceof VideoFrame?s.setPendingVideoFrame(i):(n&&D(ze,this,Ye).call(this,s,e,r,i),t().tracing.globaltracing_error("updateVideoFrameBaseTextureLayer() an unexpected case!"),console.error("updateVideoFrameBaseTextureLayer() an unexpected case!"))}else i instanceof VideoFrame?s.getPendingVideoFrame()!=i&&s.setPendingVideoFrame(i):(n&&D(ze,this,Ye).call(this,s,e,r,i),t().tracing.globaltracing_error("updateVideoFrameBaseTextureLayer() an unexpected case!"),console.error("updateVideoFrameBaseTextureLayer() an unexpected case!")),s.setTextureLayerType(0),s.setTextureType(0),s.lock();this.markRenderingStateReady()}function qe(e,t,r,i,n,s){D(ze,this,tt).call(this);const a=D(ze,this,it).call(this,0);if(a.setTextureLayerType(0),a.setTextureType(1),a.clearPendingVideoFrame(),a.isLocked()){const e=a.getWidth(),i=a.getHeight();e==t&&i==r||(a.setWidth(t),a.setHeight(r),a.setIsNew(!0))}else a.setWidth(t),a.setHeight(r),a.setIsNew(!0),a.lock();const o=D(ze,this,dt).call(this,i,t,r,s),u=I(re,this).writeToYuvTexturesBufferGroup(o,n);a.setTextureBufferGroup(u)}function Ye(e,t,r,i){const n=D(ze,this,gt).call(this,t,r);n.label="RgbaTexBuffer(".concat(e.getIndex(),")-").concat(n.size);let s=e.getTextureBufferGroup();if(s=D(ze,this,vt).call(this,e,s,n),!s||!s.buffer)return console.warn("[updateRgbaBaseTexLayer()] texLayer(".concat(e.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();D(ze,this,Je).call(this,I(z,this),t,r,i,s),this.markRenderingStateReady()}function He(e,t,r,i,n){const s=D(ze,this,it).call(this,1);if(s.setTextureLayerType(1),s.setTextureType(2),s.isLocked()){const e=s.getWidth(),i=s.getHeight();e==t&&i==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();const a=I(re,this).writeToRgbaTextureBuffer(e,t,r,i,n);s.setTextureBufferGroup(a)}function Xe(e,t,r,i,n){const s=D(ze,this,it).call(this,2);if(s.setTextureLayerType(1),s.setTextureType(2),s.isLocked()){const e=s.getWidth(),i=s.getHeight();e==t&&i==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();const a=I(re,this).writeToRgbaTextureBuffer(e,t,r,i,n);s.setTextureBufferGroup(a)}function Je(e,t,r,i,n){const s=D(ze,this,it).call(this,0);if(s.setTextureLayerType(0),s.setTextureType(2),s.isLocked()){const e=s.getWidth(),i=s.getHeight();e==t&&i==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();const a=I(re,this).writeToRgbaTextureBuffer(e,t,r,i,n);s.setTextureBufferGroup(a)}function Ke(e,t,r){if(!D(ze,this,mt).call(this,e))return;if(!D(ze,this,xt).call(this,I(q,this)))return;if(!I(ie,this))return void console.log("drawVideoFrameBaseTextureLayer() canvas is invalid? canvas=".concat(I(ie,this)));const i=D(ze,this,it).call(this,0);let n=i.getUVCoords(),s=D(ze,this,Qe).call(this,I(Y,this),I(H,this),I(q,this),I(Z,this),r,e.width,e.height).uvCoords;n||(n=new Float32Array(12)),n.set(s,0),i.setUVCoords(n);const a=I(q,this).width>I(q,this).height,o=I(ie,this).width>e.width,u=I(ie,this).height>e.height;let l=o?e.width:I(ie,this).width,c=u?e.height:I(ie,this).height;if(a){const r=Math.abs(t.left)*l,n=Math.abs(t.top)*c,s=e.x+(e.width-r)/2;let a=0;a=e.y>=0?e.y+(e.height-n)/2:0,i.evalViewport(s,a,r,n,I(ie,this).height)}else{let t=e.height*I(q,this).width/I(q,this).height;t>e.width&&(t=e.width);let r=I(q,this).height/I(q,this).width*t;const n=e.x+e.width/2-t/2;let s=0;s=e.y>0?e.y+(e.height-r)/2:0===e.y&&e.height>r?(e.height-r)/2:0,i.evalViewport(n,s,t,r,I(ie,this).height)}N(De,this,e);const h=D(ze,this,st).call(this);h&&h.buffer&&i.setUniformBuffer(h.buffer)}function Ze(e,t,r){const i=D(ze,this,it).call(this,0);let n=i.getUVCoords(),s=D(ze,this,Qe).call(this,I(Y,this),I(H,this),I(q,this),I(Z,this),r,e.width,e.height).uvCoords;n||(n=new Float32Array(12)),n.set(s,0),i.setUVCoords(n);const a=I(q,this).width>I(q,this).height,o=I(ie,this).width>e.width,u=I(ie,this).height>e.height;let l=o?e.width:I(ie,this).width,c=u?e.height:I(ie,this).height;if(a){const r=Math.abs(t.left)*l,n=Math.abs(t.top)*c,s=e.x+(e.width-r)/2;let a=0;a=e.y>=0?e.y+(e.height-n)/2:0,i.evalViewport(s,a,r,n,I(ie,this).height)}else{let t=e.height*I(q,this).width/I(q,this).height;t>e.width&&(t=e.width);let r=I(q,this).height/I(q,this).width*t;const n=e.x+e.width/2-t/2;let s=0;s=e.y>0?e.y+(e.height-r)/2:0===e.y&&e.height>r?(e.height-r)/2:0,i.evalViewport(n,s,t,r,I(ie,this).height)}N(De,this,e);let h=null;h=0==i.getTextureType()?D(ze,this,st).call(this):D(ze,this,at).call(this,I(Z,this)),h&&h.buffer&&i.setUniformBuffer(h.buffer)}function Qe(e,r,i,n,s,a,o){const u=this.isUseFillMode({w:i.width,h:i.height,rotation:n}),l={width:a,height:o},c={width:e,height:r};return t().graphics.calculateUVCoordsForMultiView(u,l,c,i,n,s)}function $e(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=e.width,a=e.height;n&&(s=n.width,a=n.height);let o,u,l,c,h=1==i||3==i?r:t,f=1==i||3==i?t:r,d=h/f*a;d>s?(o=0,l=1,u=(a-f/h*s)/2/a,c=1-u):(u=0,c=1,o=(s-d)/2/s,l=1-o),o=2*o-1,l=2*l-1,u=1-2*u,c=1-2*c;let p=[{x:l,y:u},{x:l,y:c},{x:o,y:c},{x:l,y:u},{x:o,y:u},{x:o,y:c}];I(re,this)&&I(re,this).updateVertexCoords(p)}function et(e,t,r,i,n){var s,a,o,u;if(this.isUseFillMode({w:r,h:i,rotation:n}))s=0,a=0,o=1,u=1;else{var l=1==n||3==n?i:r,c=1==n||3==n?r:i,h=l/c*t;h>e?(s=0,o=1,u=1-(a=(t-c/l*e)/2/t)):(a=0,u=1,o=1-(s=(e-h)/2/e))}const f={top:a=1-2*a,left:s=2*s-1,right:o=2*o-1,bottom:u=1-2*u};return N(Ge,this,f),f}function tt(){I(re,this)||t().tracing.globaltracing_error("[WebGPURenderDisplay] renderer is not attached!")}function rt(e){if(e<0)throw new Error("[hasZIndexTexLayer] ".concat(e," is an invalid parameter!"));return I(Me,this).has(e)}function it(e){let t=null;return D(ze,this,rt).call(this,e)?t=I(Me,this).get(e):(t=new O(I(z,this),e),I(Me,this).set(e,t)),t}function nt(e,t,r){I(ie,this)&&(N(xe,this,e),N(Pe,this,e&&r===d?1:0),N(Te,this,t),e||N(be,this,r))}function st(){var e;if(!I(De,this))return null;const t={rotation:I(Z,this),enable_rounded_corner:I(Ee,this),radius_lt_x:I(We,this),radius_lt_y:I(Ce,this),radius_lb_x:I(Fe,this),radius_lb_y:I(Oe,this),radius_rt_x:I(Ae,this),radius_rt_y:I(Ve,this),radius_rb_x:I(Le,this),radius_rb_y:I(Ie,this),aa_width:I(Ne,this),viewport_rect:I(De,this)};let r=null,i=I(Re,this).get(0);if(i){let e=i.buffer,n=i.uniform;if(n)if("yuvMode"in n)e&&e.destroy(),i=null;else if("rotation"in n){if(n.rotation!=t.rotation||n.enable_rounded_corner!=t.enable_rounded_corner||n.radius_lt_x!=t.radius_lt_x||n.radius_lt_y!=t.radius_lt_y||n.radius_lb_x!=t.radius_lb_x||n.radius_lb_y!=t.radius_lb_y||n.radius_rt_x!=t.radius_rt_x||n.radius_rt_y!=t.radius_rt_y||n.radius_rb_x!=t.radius_rb_x||n.radius_rb_y!=t.radius_rb_y||n.aa_width!=t.aa_width||n.viewport_rect!=t.viewport_rect){const i=D(ze,this,lt).call(this,t);r=I(re,this).writeUniformBuffer("VideoFrameTexLayerUniformBuffer(idx=".concat(I(z,this),")"),i,e)}}else e&&e.destroy(),i=null}if(!i){const e=D(ze,this,lt).call(this,t);r=I(re,this).writeUniformBuffer("VideoFrameTexLayerUniformBuffer(idx=".concat(I(z,this),")"),e)}return!r&&null!==(e=i)&&void 0!==e&&e.buffer&&(r=i.buffer),r?(i||(i={}),i.uniform=t,i.buffer=r,I(Re,this).set(0,i),i):null}function at(e){if(-1==I(we,this))return null;if(!I(De,this))return null;const t={yuvMode:1,colorRange:I(we,this),rotation:e,enable_rounded_corner:I(Ee,this),radius_lt_x:I(We,this),radius_lt_y:I(Ce,this),radius_lb_x:I(Fe,this),radius_lb_y:I(Oe,this),radius_rt_x:I(Ae,this),radius_rt_y:I(Ve,this),radius_rb_x:I(Le,this),radius_rb_y:I(Ie,this),aa_width:I(Ne,this),viewport_rect:I(De,this)};let r=null,i=I(Re,this).get(0);if(i){const e=i.uniform;if(r=i.buffer,e.yuvMode!=t.yuvMode||e.colorRange!=t.colorRange||e.rotation!=t.rotation||e.enable_rounded_corner!=t.enable_rounded_corner||e.radius_lt_x!=t.radius_lt_x||e.radius_lt_y!=t.radius_lt_y||e.radius_lb_x!=t.radius_lb_x||e.radius_lb_y!=t.radius_lb_y||e.radius_rt_x!=t.radius_rt_x||e.radius_rt_y!=t.radius_rt_y||e.radius_rb_x!=t.radius_rb_x||e.radius_rb_y!=t.radius_rb_y||e.aa_width!=t.aa_width||e.viewport_rect!=t.viewport_rect){const e=D(ze,this,ct).call(this,t);r=I(re,this).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(I(z,this),")"),e,r)}}else{i={};const e=D(ze,this,ct).call(this,t);r=I(re,this).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(I(z,this),")"),e)}return r?(i.uniform=t,i.buffer=r,I(Re,this).set(0,i),i):null}function ot(){if(!I(Ue,this))return null;const e={cursorFlag:I(Te,this),cursorInfo:I(Ue,this)};let t=null,r=I(Re,this).get(1);if(r){const i=r.uniform;if(t=r.buffer,i.cursorFlag!=e.cursorFlag||i.cursorInfo!=e.cursorInfo){const r=D(ze,this,ht).call(this,e);t=I(re,this).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(I(z,this),")"),r,t)}}else{r={};const i=D(ze,this,ht).call(this,e);t=I(re,this).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(I(z,this),")"),i)}return t?(r.uniform=e,r.buffer=t,I(Re,this).set(1,r),r):null}function ut(e,t){return Math.ceil(e/t)*t}function lt(e){let t=D(ze,this,ut).call(this,15*Float32Array.BYTES_PER_ELEMENT,16);const r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.rotation,r[1]=e.enable_rounded_corner,r[2]=e.radius_lt_x,r[3]=e.radius_lt_y,r[4]=e.radius_lb_x,r[5]=e.radius_lb_y,r[6]=e.radius_rt_x,r[7]=e.radius_rt_y,r[8]=e.radius_rb_x,r[9]=e.radius_rb_y,r[10]=e.aa_width,r[11]=e.viewport_rect.x,r[12]=e.viewport_rect.y,r[13]=e.viewport_rect.width,r[14]=e.viewport_rect.height,r}function ct(e){let t=D(ze,this,ut).call(this,17*Float32Array.BYTES_PER_ELEMENT,16);const r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.yuvMode,r[1]=e.colorRange,r[2]=e.rotation,r[3]=e.enable_rounded_corner,r[4]=e.radius_lt_x,r[5]=e.radius_lt_y,r[6]=e.radius_lb_x,r[7]=e.radius_lb_y,r[8]=e.radius_rt_x,r[9]=e.radius_rt_y,r[10]=e.radius_rb_x,r[11]=e.radius_rb_y,r[12]=e.aa_width,r[13]=e.viewport_rect.x,r[14]=e.viewport_rect.y,r[15]=e.viewport_rect.width,r[16]=e.viewport_rect.height,r}function ht(e){const t=D(ze,this,ut).call(this,5*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.cursorFlag,r[1]=e.cursorInfo.x,r[2]=e.cursorInfo.y,r[3]=e.cursorInfo.w,r[4]=e.cursorInfo.h,r}function ft(e){if(!e||0==e.length)return null;const t=D(ze,this,ut).call(this,4*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function dt(e,t,r,i){let n=t*r,s=e.subarray(0,n),a=0,o=0;1==i?(o=t/2*r/2,a=o):2==i&&(o=t*r/2,a=0);let u=e.subarray(n,n+o);return{yPlane:{buffer:s,width:t,height:r},crPlane:{buffer:0!=a?e.subarray(n+o,n+o+a):null,width:t/2,height:r/2},cbPlane:{buffer:u,width:t/2,height:r/2}}}function pt(e,t,r){let i="",n=0,s=0,a=0;1==r?(n=e/2*t/2,s=n,i="i420",a=Uint8Array.BYTES_PER_ELEMENT):2==r&&(n=e*t/2,s=0,i="nv12",a=Uint16Array.BYTES_PER_ELEMENT);const o=D(ze,this,ut).call(this,Uint8Array.BYTES_PER_ELEMENT*e,256),u=D(ze,this,ut).call(this,a*e/2,256);let l=o*t+u*t/2;return s>0&&(l+=u*t/2),{colorFormat:i,size:l,yPlane:{width:o,height:t},uvPlane:{width:u,height:t/2}}}function gt(e,t){const r=D(ze,this,ut).call(this,Uint32Array.BYTES_PER_ELEMENT*e,256);return{colorFormat:"rgba",width:r,height:t,size:r*t}}function vt(e,t,r){return t?t.buffer?r.size>t.buffer.size?(I(me,this).recycleTextureBufferGroup(e),t.buffer=I(me,this).requestTextureBuffer(r),t.bufferConfig=r):"mapped"==t.buffer.mapState?t.bufferArray&&t.bufferArray.byteLength<r.size&&(I(me,this).recycleTextureBufferGroup(e),t.buffer=I(me,this).requestTextureBuffer(r),t.bufferConfig=r):(I(me,this).recycleTextureBufferGroup(e),t.buffer=I(me,this).requestTextureBuffer(r),t.bufferConfig=r):(t.buffer=I(me,this).requestTextureBuffer(r),t.bufferConfig=r):((t={}).buffer=I(me,this).requestTextureBuffer(r),t.bufferConfig=r),t}function yt(){const e=[];for(let t=0;t<u.length;++t){let r=u[t];e.push(r.u),e.push(r.v)}return e}function mt(e){return e&&0!=e.width&&0!=e.height}function xt(e){return e&&0!=e.width&&0!=e.height}function bt(){if(I(me,this))for(const[e,t]of I(Me,this))t&&(I(me,this).recycleTextureBufferGroup(t,!1),I(me,this).destroyTextureGroup(t,!0));else t().tracing.globaltracing_error("clearTexLayerResources() GPUResManager is not attached!")}function wt(){N(Ee,this,1),N(We,this,0),N(Ce,this,0),N(Fe,this,0),N(Oe,this,0),N(Ae,this,0),N(Ve,this,0),N(Le,this,0),N(Ie,this,0),N(Ne,this,0),N(De,this,null)}const _t=class{constructor(e,t){var r;L(this,r=ze),r.add(this),V(this,z,0),V(this,j,0),V(this,q,{}),V(this,Y,0),V(this,H,0),V(this,X,0),V(this,J,0),V(this,K,-1),V(this,Z,0),V(this,Q,-1),V(this,$,0),V(this,ee,0),V(this,te,!1),V(this,re,null),V(this,ie,null),V(this,ne,!1),V(this,se,0),V(this,ae,!1),V(this,oe,0),V(this,ue,0),V(this,le,0),V(this,ce,0),V(this,he,0),V(this,fe,0),V(this,de,0),V(this,pe,0),V(this,ge,!1),V(this,ve,-1),V(this,ye,0),V(this,me,null),V(this,xe,0),V(this,be,-1),V(this,we,-1),V(this,_e,0),V(this,Pe,0),V(this,Te,0),V(this,Se,0),V(this,Ue,null),V(this,Re,new Map),V(this,Me,new Map),V(this,Be,{top:0,left:0,bottom:0,right:0}),V(this,Ge,null),V(this,ke,null),function(e,t,r){(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[o];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?i(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"reuse",!1),V(this,Ee,1),V(this,We,0),V(this,Ce,0),V(this,Fe,0),V(this,Oe,0),V(this,Ae,0),V(this,Ve,0),V(this,Le,0),V(this,Ie,0),V(this,Ne,0),V(this,De,null),N(z,this,e),N(me,this,t),N(j,this,e||0),I(q,this).top=0,I(q,this).left=0,I(q,this).width=0,I(q,this).height=0,N(Y,this,0),N(H,this,0),N(X,this,0),N(J,this,0),N(Q,this,-1),N($,this,0),N(ee,this,0),this.markRenderingStateIdle()}addRenderer(e){N(re,this,e)}removeRenderer(){N(re,this,null)}setGPUResMgr(e){N(me,this,e)}removeGPUResMgr(){N(me,this,null)}attachCanvas(e,t){N(ie,this,e),N(ke,this,t)}getAttachedCanvas(){return I(ie,this)}getCanvasId(){return I(ke,this)}detachCanvas(){N(ie,this,null),N(ke,this,null)}bindSsrc(e){N(ye,this,e)}unbindSsrc(){N(ye,this,0)}drawSelfVideo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!D(ze,this,mt).call(this,e))return;if(!D(ze,this,xt).call(this,I(q,this)))return;D(ze,this,tt).call(this),D(ze,this,nt).call(this,1,I(ge,this),I(Q,this));let i=null;i=t?D(ze,this,et).call(this,e.width,e.height,e.width,e.height,0):D(ze,this,et).call(this,e.width,e.height,I(q,this).width,I(q,this).height,I(Z,this)),D(ze,this,Ke).call(this,e,i,r)}drawRemoteVideo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!I(ie,this))return;if(!D(ze,this,mt).call(this,e))return;if(!D(ze,this,xt).call(this,I(q,this)))return;D(ze,this,tt).call(this);const r=this.isRgbaMode(I(Q,this))?1:0;D(ze,this,nt).call(this,r,I(ge,this),I(Q,this));const i=D(ze,this,et).call(this,e.width,e.height,I(q,this).width,I(q,this).height,I(Z,this));D(ze,this,Ze).call(this,e,i,t)}updateCursorPosInfo(e,t,r,i,n){if(!I(fe,this)||e&&(i<0||n<0))return;const s=D(ze,this,it).call(this,1),a=D(ze,this,it).call(this,0);if(s.setUVCoords(a.getUVCoords()),s.evalViewport(t,r,i,n,I(ie,this).height),e&&I(ge,this)){const e=t/I(q,this).width,s=r/I(q,this).height,a=i/I(q,this).width,o=n/I(q,this).height;N(Ue,this,{x:e,y:s,w:a,h:o})}else N(Ue,this,{x:0,y:0,w:0,h:0});const o=D(ze,this,ot).call(this);o&&o.buffer&&s.setUniformBuffer(o.buffer)}isHasWholeFrame(){return I(fe,this)}setMultiView(e){N(ne,this,e)}setFillMode(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;N($,this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0),N(ee,this,e)}getFillMode(){return I($,this)}setColorRange(e){N(we,this,e)}getFillModeForResolution(){return I(ee,this)}getTextureIndex(){return I(j,this)}isUseFillMode(e){let{w:t,h:r,rotation:i}=e;if(!I($,this))return!1;if(!I(ee,this))return!0;if(!t||!r)return!1;const n=1===i||1===i?r/t:t/r;return(Array.isArray(I(ee,this))?I(ee,this):[I(ee,this)]).some((e=>Math.abs(n-e)<.01))}setVideoMode(e){N(Q,this,e)}getVideoMode(){return I(Q,this)}setWatermarkFlag(e){N(se,this,e),e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))}setWatermarkRepeated(e){N(ae,this,e)}isWatermarkRepeated(){return!!I(ae,this)}setWatermarkOpacity(e){N(oe,this,e||.15)}getWatermarkOpacity(){return I(oe,this)}setWatermarkPosition(e){N(ue,this,e||16)}getWatermarkPosition(){return I(ue,this)}isSetWatermark(){return I(se,this)}isRgbaMode(e){return-1!==[f,d].indexOf(e)}getTextureWidth(){return I(Y,this)}getTextureHeight(){return I(H,this)}getRotation(){return I(Z,this)}getCroppingParams(){return I(q,this)}getViewPosition(){let e=[0,0,1,1];if(!I(Ge,this))return e;const{top:t,left:r,bottom:i,right:n}=I(Ge,this);return e[0]=(1-t)/2,e[1]=(1+r)/2,e[2]=(1-i)/2,e[3]=(1+n)/2,e}recoverTextures(){}setRoundedCornerRadius(e){console.log("setRoundedCornerRadius() radiusSet:".concat(JSON.stringify(e))),e&&(N(We,this,e.radius_lt_x),N(Ce,this,e.radius_lt_y),N(Fe,this,e.radius_lb_x),N(Oe,this,e.radius_lb_y),N(Ae,this,e.radius_rt_x),N(Ve,this,e.radius_rt_y),N(Le,this,e.radius_rb_x),N(Ie,this,e.radius_rb_y))}setAntialiasWidth(e){N(Ne,this,e)}updateWatermark(e,r,i){const n=D(ze,this,it).call(this,2);if(!I(ie,this)||!I(re,this))return D(ze,this,bt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length!=e*r*4)return I(me,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(A(I(me,this),e,r))return I(me,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(N(le,this,e),N(ce,this,r),N(se,this,1),N(_e,this,1),!D(ze,this,rt).call(this,0)){console.log("[updateWatermark] base layer is not ready, set data to the texture layer for creating texture later."),I(me,this).recycleTextureBufferGroup(n),this.markRenderingStatePending();const t={index:I(z,this),width:e,height:r,data:i};return void n.setRawData(t)}const s=D(ze,this,it).call(this,0).getViewport();if(s)try{const t=D(ze,this,gt).call(this,e,r);t.label="WatermarkTexBuffer(".concat(n.getIndex(),")-").concat(t.size);let a=n.getTextureBufferGroup();if(a=D(ze,this,vt).call(this,n,a,t),!a||!a.buffer)return console.warn("[updateWatermark()] texLayer(".concat(n.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();D(ze,this,Xe).call(this,I(z,this),e,r,i,a),s&&n.setViewport(s);let o=n.getUVCoords(),u=D(ze,this,yt).call(this);o||(o=new Float32Array(12)),o.set(u,0),n.setUVCoords(o),n.setRawData(null),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateWatermark() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateWatermark() error:".concat(e.message)),I(me,this).recycleTextureBufferGroup(n),this.markRenderingStatePending()}else{console.log("[updateWatermark] base layer's viewport is not ready, set data to the texture layer for creating texture later."),I(me,this).recycleTextureBufferGroup(n),this.markRenderingStatePending();const t={index:I(z,this),width:e,height:r,data:i};n.setRawData(t)}}updateCursor(e,r,i,n){const s=D(ze,this,it).call(this,1);if(!I(ie,this)||!I(re,this))return D(ze,this,bt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length!=e*r*4)return I(me,this).recycleTextureBufferGroup(s),void this.markRenderingStatePending();if(n!=I(ve,this)){N(ve,this,n),N(de,this,e),N(pe,this,r),N(ge,this,1);try{const t=D(ze,this,gt).call(this,e,r);t.label="CursorTexBuffer(".concat(s.getIndex(),")-").concat(t.size);let n=s.getTextureBufferGroup();if(n=D(ze,this,vt).call(this,s,n,t),!n||!n.buffer)return void console.warn("[updateCursor()] texLayer(".concat(s.getIndex(),") cannot apply a GPU buffer!"));if("mapped"!=n.buffer.mapState)return void console.error("updateCursor() why buffer state is not mapped!");D(ze,this,He).call(this,I(z,this),e,r,i,n),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateCursor() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateCursor() error:".concat(e.message)),I(me,this).recycleTextureBufferGroup(s),this.markRenderingStatePending()}}}updateSelfVideoTextures(e,r,i,n){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;D(ze,this,tt).call(this);const o=D(ze,this,it).call(this,0);if(!I(ie,this)||!I(re,this))return i&&i instanceof VideoFrame&&i.close(),D(ze,this,bt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length%4!=0)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();if(1!=e||1!=r){if(N(Y,this,e),N(H,this,r),N(Z,this,a),Object.assign(I(q,this),n),!s)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();try{D(ze,this,je).call(this,e,r,i),this.markRenderingStateReady()}catch(e){console.log("[WebGPURenderDisplay] updateSelfVideoTextures() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateSelfVideoTextures() error:".concat(e.message)),this.markRenderingStatePending(),i instanceof VideoFrame&&i.close(),D(ze,this,it).call(this,0).setPendingVideoFrame(null)}}else{o.setPendingVideoFrame(null),D(ze,this,bt).call(this),i&&i instanceof VideoFrame&&i.close();const e=D(ze,this,ft).call(this,i);if(e)if(I(re,this)){let t=o.getClearColorUniformBuffer();t=I(re,this).writeUniformBuffer("ClearColorUniformBuffer",e,t),o.setClearColorUniformBuffer(t),o.setTextureType(3)}else console.warn("updateSelfVideoTextures() renderer is not attached!");else t().tracing.globaltracing_error("updateSelfVideoTextures() cannot create the uniform buffer array.");this.markRenderingStateReady()}}updateRemoteVideoTexturesImageBitmap(e,r,i,n,s){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=D(ze,this,it).call(this,0);if(!I(re,this)||!I(ie,this))return i&&i instanceof VideoFrame&&i.close(),D(ze,this,bt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();if(N(Y,this,e),N(H,this,r),Number.isNaN(s)||N(Z,this,s),Object.assign(I(q,this),n),!a)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();try{D(ze,this,je).call(this,e,r,i),this.markRenderingStateReady()}catch(e){console.log("[WebGPURenderDisplay] updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),this.markRenderingStatePending(),i instanceof VideoFrame&&i.close(),o.setPendingVideoFrame(null)}}updateRemoteVideoTextures(e,r,i,n,s){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6?arguments[6]:void 0;const u=D(ze,this,it).call(this,0);if(!I(ie,this)||!I(re,this))return D(ze,this,bt).call(this),void this.markRenderingStatePending();if(!D(ze,this,mt).call(this,o))return I(me,this).recycleTextureBufferGroup(u),void this.markRenderingStatePending();D(ze,this,tt).call(this);const l=this.isRgbaMode(I(Q,this));if(e<=0||r<=0||!n||!n.length||n.length!=e*r*3/2&&!l||i&&(i.top<0||i.left<0||i.left+i.width>e||i.top+i.height>r))return I(me,this).recycleTextureBufferGroup(u),void this.markRenderingStatePending();if(l)try{D(ze,this,je).call(this,e,r,n,!0),N(we,this,a?0:1),N(Z,this,s),Object.assign(I(q,this),i),N(Y,this,e),N(H,this,r),N(X,this,I(ie,this).width),N(J,this,I(ie,this).height)}catch(e){console.error("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateRemoteVideoTextures() error:".concat(e.message)),u.setPendingVideoFrame(null),this.markRenderingStatePending()}finally{I(me,this).recycleTextureBufferGroup(u)}else try{const t=D(ze,this,pt).call(this,e,r,I(Q,this));t.label="YuvVideoTexBuffer(".concat(u.getIndex(),")-").concat(t.size),u.setColorFormat(t.colorFormat);let o=u.getTextureBufferGroup();if(o=D(ze,this,vt).call(this,u,o,t),!o||!o.buffer)return console.warn("[updateRemoteVideoTextures()] texLayer(".concat(u.getIndex(),") cannot apply a GPUBuffer!")),void this.markRenderingStatePending();N(we,this,a?0:1),N(Z,this,s),Object.assign(I(q,this),i),N(Y,this,e),N(H,this,r),N(X,this,I(ie,this).width),N(J,this,I(ie,this).height),D(ze,this,qe).call(this,I(z,this),e,r,n,o,I(Q,this)),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message," cs:").concat(e.stack)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateRemoteVideoTextures() error:".concat(e.message)),I(me,this).recycleTextureBufferGroup(u),this.markRenderingStatePending()}}drawNextOutputPictureFrame(e,r,i,n,s){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6?arguments[6]:void 0,u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=D(ze,this,it).call(this,0);if(!I(ie,this)||!I(re,this))return D(ze,this,bt).call(this),void this.markRenderingStatePending();if(A(I(me,this),e,r))return I(me,this).recycleTextureBufferGroup(l),void this.markRenderingStatePending();s=s||0;let c=(i=i||{top:0,left:0,width:e,height:r}).width!=I(q,this).width||i.height!=I(q,this).height,h=i.top!=I(q,this).top||i.left!=I(q,this).left,f=o.width!=I(X,this)||o.height!=I(J,this),d=e!=I(Y,this)||r!=I(H,this),p=s!=I(K,this);o.canvas=I(ie,this),(c||f||p)&&D(ze,this,$e).call(this,I(ie,this),i.width,i.height,s,o);const g=function(e,t){if(!e||null==t)throw new Error("evalCroppingRect() invalid parameters!");return 1===t||3===t?{top:e.top,left:e.left,width:e.height,height:e.width}:e}(i,s),v=function(e,t){let r=0,i=0,n=0,s=0;const a=t.width/t.height;return e.width/e.height>a?(i=e.height,r=i*a,n=(e.width-r)/2,s=0):(r=e.width,i=r/a,n=0,s=(e.height-i)/2),r<=e.canvas.width&&(n=(e.canvas.width-r)/2),i<=e.canvas.height&&(s=(e.canvas.height-i)/2),{x:n,y:s,width:r,height:i}}(o,g);if(l.evalViewport(v.x,v.y,v.width,v.height,I(ie,this).height),N(De,this,v),c||h||d||p||!l.getUVCoords()){let n=t().graphics.calculateUVCoord({width:e,height:r},i,I(ie,this),s),a=l.getUVCoords();a||(a=new Float32Array(12)),a.set(n.uvCoords),l.setUVCoords(a)}let y=a?0:1;y!=I(we,this)&&N(we,this,y),N(xe,this,0),N(be,this,1),Object.assign(I(q,this),i),N(Y,this,e),N(H,this,r),N(K,this,s),N(X,this,I(ie,this).width),N(J,this,I(ie,this).height),l.setColorFormat("i420");try{const t=D(ze,this,pt).call(this,e,r,1);if(t.label="YuvShareTexBuffer(".concat(l.getIndex(),")-").concat(t.size),u){let i=l.getTextureBufferGroup();if(i=D(ze,this,vt).call(this,l,i,t),!i||!i.buffer)return console.warn("[drawNextOutputPictureFrame()] texLayer(".concat(l.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();D(ze,this,qe).call(this,I(z,this),e,r,n,i,1);const s=D(ze,this,at).call(this,I(K,this));s&&s.buffer&&l.setUniformBuffer(s.buffer)}I(ge,this)?N(Te,this,1):N(Te,this,0),N(fe,this,1),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] drawNextOutputPictureFrame() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_drawNextOutputPictureFrame() error:".concat(e.message)),I(me,this).recycleTextureBufferGroup(l),this.markRenderingStatePending()}}clearCanvas(e){I(re,this)&&I(re,this).clearAttachedCanvas()}updateSelfMaskImage(e,r,i){const n=D(ze,this,it).call(this,3);if(!I(ie,this))return I(me,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length!=e*r*4)return I(me,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(!D(ze,this,rt).call(this,0))return console.log("[updateSelfMaskImage] base layer is not ready."),I(me,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();try{const t=D(ze,this,gt).call(this,e,r);let s=n.getTextureBufferGroup();if(s=D(ze,this,vt).call(this,n,s,t),!s||!s.buffer)return console.warn("[updateSelfMaskImage()] texLayer(".concat(n.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();if(s.buffer.label="SelfMaskImageTexBuffer(".concat(n.getIndex(),")-").concat(t.size),n.setTextureLayerType(1),n.setTextureType(2),n.isLocked()){const t=n.getWidth(),i=n.getHeight();t==e&&i==r||(n.setWidth(e),n.setHeight(r),n.setIsNew(!0))}else n.setWidth(e),n.setHeight(r),n.setIsNew(!0),n.lock();const a=I(re,this).writeToRgbaTextureBuffer(I(z,this),e,r,i,s);n.setTextureBufferGroup(a);const o=D(ze,this,it).call(this,0),u=o.getViewport();u&&n.setViewport(u),n.setUVCoords(o.getUVCoords()),this.isSetWatermark()&&I(le,this)&&I(ce,this),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateSelfMaskImage() error:".concat(e.message)),t().tracing.add_monitor("WGPU WebGPURenderDisplay_updateSelfMaskImage() error:".concat(e.message)),I(me,this).recycleTextureBufferGroup(n),this.markRenderingStatePending()}}readPixelsSyncRequest(e,t,r,i){}isAvaiable(){return!0}markRenderingStateReady(){N(he,this,2)}markRenderingStateRendering(){N(he,this,3)}markRenderingStatePending(){N(he,this,1)}markRenderingStateIdle(){N(he,this,0)}isRenderingStateReady(){return 2===I(he,this)}isInTargetRenderingState(e){return I(he,this)===e}getWatermarkWidth(){return I(le,this)}getWatermarkHeight(){return I(ce,this)}getIndex(){return I(z,this)}getRenderingState(){return I(he,this)}recycle(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const[t,r]of I(Me,this))r&&(I(me,this).recycleTextureBufferGroup(r,e),r.recycle(I(me,this)));N(Be,this,{top:0,left:0,bottom:0,right:0}),this.markRenderingStateIdle(),I(Me,this).clear(),I(Re,this).clear(),this.unbindSsrc(),D(ze,this,wt).call(this)}cleanup(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recycle(e),this.removeRenderer(),this.detachCanvas(),this.removeGPUResMgr()}clear(){console.log("WebGPURenderDisplay.clear"),this.clearCanvas(),N(fe,this,0),N(ge,this,0),N(ve,this,-1),this.recycle()}clearDisplay(){console.log("WebGPURenderDisplay.clearDisplay"),this.clearCanvas()}getTextureLayersMap(){return I(Me,this)}getTextureLayerByZIndex(e){return D(ze,this,it).call(this,e)}getUsedBuffersCount(){let e=0;for(const[t,r]of I(Me,this))r&&r.getTextureBufferGroup()&&r.getTextureBufferGroup().buffer&&e++;return e}consumePendingGPUEvents(){if(I(se,this)){const e=D(ze,this,it).call(this,2).getRawData();e&&this.updateWatermark(I(le,this),I(ce,this),e.data)}}resizeCanvasTo(e,t){I(ie,this)&&(I(ie,this).width=e,I(ie,this).height=t)}};function Pt(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Tt(e,t){return e.get(Ut(e,t))}function St(e,t,r){return e.set(Ut(e,t),r),r}function Ut(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Rt=new WeakMap,Mt=new WeakMap,Bt=new WeakMap,Gt=new WeakMap,kt=new WeakMap;const Et=class{constructor(e,t,r){Pt(this,Rt,0),Pt(this,Mt,null),Pt(this,Bt,null),Pt(this,Gt,0),Pt(this,kt,null),St(Rt,this,e),St(Gt,this,t),St(kt,this,r),St(Mt,this,[]),St(Bt,this,[])}initPool(e){if(e>Tt(Rt,this))throw new Error("initSize=".concat(e," is larger than maxSize=").concat(Tt(Rt,this),", invalid!"));if(e<0)throw new Error("initSize=".concat(e," is smaller than 0, invalid!"));for(let t=0;t<e;t++){const e=new _t(t,Tt(kt,this));Tt(Mt,this).push(e)}}expandPool(e){if(Tt(Mt,this).length>=Tt(Rt,this))return;let t=0;if(Tt(Mt,this).length+e>=Tt(Rt,this)&&(t=Tt(Rt,this)-Tt(Mt,this).length),t>0){const e=Tt(Mt,this).length;for(let r=0;r<t;r++){const t=new _t(r+e,Tt(kt,this));Tt(Mt,this).push(t)}}}pop(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.isPoolEmpty()&&this.expandPool(4);const e=Tt(Mt,this).pop();return e&&(e.markRenderingStatePending(),Tt(Bt,this).push(e)),e}recycle(e){if(Tt(Mt,this).length<Tt(Rt,this)){e.recycle(),Tt(Mt,this).push(e);const t=Tt(Bt,this).indexOf(e);-1!=t&&Tt(Bt,this).splice(t,1)}}clear(){if(Tt(Mt,this)){for(const e of Tt(Mt,this))e&&e.clear();Tt(Mt,this).length=0}}cleanup(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Tt(Mt,this).forEach((t=>{t.cleanup(e)})),Tt(Bt,this).forEach((t=>{t.cleanup(e)})),St(Mt,this,[]),St(Bt,this,[])}isPoolEmpty(){return 0==Tt(Mt,this).length}getInUseRenderDisplays(){return Tt(Bt,this)}getAllRenderDisplays(){return Tt(Mt,this)}isServeForVideoRendering(){return 1===Tt(Gt,this)}isServeForShareRendering(){return 2===Tt(Gt,this)}isServingForNow(e){return Tt(Gt,this)===e}};class Wt{getVideoRenderDisplay(e,t,r,i,n){throw new Error("getVideoRenderDisplay() should be implemented by subclass.")}getRenderDisplay(e,t,r){throw new Error("getRenderDisplay() should be implemented by subclass.")}createVideoRenderDisplay(e,t,r){throw new Error("createVideoRenderDisplay() should be implemented by subclass.")}}function Ct(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Ft(e,t){return e.get(Ot(e,t))}function Ot(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var At=new WeakMap,Vt=new WeakMap,Lt=new WeakMap;class It extends Wt{constructor(){super(),Ct(this,At,new Map),Ct(this,Vt,new Map),Ct(this,Lt,null)}setGPUResourceMgrGetter(e){var t,r;r=e,(t=Lt).set(Ot(t,this),r)}getVideoRenderDisplay(e,t,r,i,n){let s=Ft(At,this).get(e);s||(s=new Et(r,1,Ft(Lt,this)),s.initPool(r),Ft(At,this).set(e,s));let a=s.pop();return a?(a.setMultiView(!0),a):null}getRenderDisplay(e,t,r){r&&r.clearCache&&Ft(Vt,this).clear();let i=Ft(Vt,this).get(e);return i||(i=new Et(1,2,Ft(Lt,this)),i.initPool(1),Ft(Vt,this).set(e,i)),i.pop()}createVideoRenderDisplay(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=new _t(r,Ft(Lt,this));return n.addRenderer(i),n.attachCanvas(e,t),n}getInUseCanvasRenderDisplayList(e){let t=[],r=null;if(1==e?r=Ft(At,this):2==e&&(r=Ft(Vt,this)),r)for(const[e,i]of r){let r={};r.canvas=e,r.renderDisplays=i.getInUseRenderDisplays(),r.renderDisplays.length>0&&t.push(r)}return t}recycleRenderDisplay(e,t){if(e){const t=e.getAttachedCanvas();if(t){let r=Ft(At,this).get(t);r&&(e.setWatermarkFlag(0),e.setVideoMode(-1),r.recycle(e));let i=Ft(Vt,this).get(t);i&&(e.setWatermarkFlag(0),e.setVideoMode(-1),i.recycle(e))}}}cleanup(e){var t;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null==e||null===(t=e.cleanup)||void 0===t||t.call(e,r);for(const[e,t]of Ft(At,this))t.cleanup(r);for(const[e,t]of Ft(Vt,this))t.cleanup(r)}cleanupByCanvas(e){let t=Ft(At,this).get(e);t&&(t.cleanup(),Ft(At,this).delete(e));let r=Ft(Vt,this).get(e);r&&(r.cleanup(),Ft(Vt,this).delete(e))}collectInUseRenderDisplays(e){return this.getInUseCanvasRenderDisplayList(e)}collectInUseRenderDisplaysByCanvas(e,t){let r=null;return e&&(1==t?r=Ft(At,this).get(e).getInUseRenderDisplays():2==t&&(r=Ft(Vt,this).get(e).getInUseRenderDisplays())),r}getRenderDisplayMap(e){let t=null;return 1==e?t=Ft(At,this):2==e&&(t=Ft(Vt,this)),t}}const Nt="\n      @group(0) @binding(0) var watermarkSampler: sampler;\n      @group(0) @binding(1) var watermarkTex: texture_2d<f32>;\n  \n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) pos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n  \n          var output: VertexOutput;\n          output.Position = vec4<f32>(pos, 0.0, 1.0);\n          output.uv = vec2f(uvPos.x, uvPos.y);\n          return output;\n      }\n  \n      @fragment\n      fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(watermarkTex, watermarkSampler, uv);\n          if (color.r == 0 && color.g == 0 && color.b == 0) {\n              color.a = 0;\n          }\n          return color;\n      }\n  ",Dt="\n  \n      struct FsUniforms {\n          cursorFlag: f32,\n          cursorInfo: vec4f\n      };\n  \n      @group(0) @binding(0) var cursorSampler: sampler;\n      @group(0) @binding(1) var cursorTex: texture_2d<f32>;\n      @group(0) @binding(2) var<uniform> uniforms: FsUniforms;\n  \n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) pos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n  \n          var output: VertexOutput;\n          output.Position = vec4<f32>(pos, 0.0, 1.0);\n          output.uv = vec2f(uvPos.x, 1 - uvPos.y);\n          return output;\n      }\n  \n      @fragment\n      fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, uv);\n          // if (uniforms.cursorFlag == 1) {\n          //     if (uniforms.cursorInfo.z > 0.0 \n          //         && uv.x >= uniforms.cursorInfo.x\n          //         && uv.y >= uniforms.cursorInfo.y\n          //         && uv.x < uniforms.cursorInfo.x + uniforms.cursorInfo.z\n          //         && uv.y < uniforms.cursorInfo.y + uniforms.cursorInfo.w) {\n  \n          //         var cursorCoord: vec2f = uv - uniforms.cursorInfo.xy;\n          //         cursorCoord = cursorCoord / uniforms.cursorInfo.zw;\n          //         var cursorColor: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, cursorCoord);\n          //         color = color * (1.0 - cursorColor.a) + cursorColor * cursorColor.a;\n          //     }\n          // }\n  \n          return color;\n      }\n  ",zt="\n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n      ) -> @builtin(position) vec4<f32> {\n          return vec4<f32>(vtxPos, 0.0, 1.0);\n      }\n      \n      @fragment\n      fn f_main() -> @location(0) vec4<f32> {\n          return vec4(0.0, 0.0, 0.0, 1.0);\n      }\n  ";function jt(e,t,r){qt(e,t),t.set(e,r)}function qt(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Yt(e,t){return e.get(Xt(e,t))}function Ht(e,t,r){return e.set(Xt(e,t),r),r}function Xt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Jt=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,$t=new WeakMap,er=new WeakMap,tr=new WeakMap,rr=new WeakMap,ir=new WeakMap,nr=new WeakMap,sr=new WeakMap,ar=new WeakMap,or=new WeakMap,ur=new WeakMap,lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,fr=new WeakMap,dr=new WeakMap,pr=new WeakMap,gr=new WeakMap,vr=new WeakMap,yr=new WeakMap,mr=new WeakMap,xr=new WeakMap,br=new WeakSet;function wr(e){e&&e.forEach((e=>{e.markRenderingStatePending()}));const r=Xt(br,this,Fr).call(this,e);if(Yt(rr,this)&&Yt(tr,this)&&Yt(sr,this))if(Yt(Jt,this)&&0!=Yt(Jt,this).width&&0!=Yt(Jt,this).height&&Yt(tr,this)&&Yt(tr,this).getCurrentTexture()&&0!=Yt(tr,this).getCurrentTexture().width&&0!=Yt(tr,this).getCurrentTexture().height)try{if(!Yt(ur,this)){const e=Yt(xr,this).byteLength,t=e;Ht(ur,this,Yt(sr,this).acquireBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,e,!0,!1)),new Float32Array(Yt(ur,this).getMappedRange()).set(Yt(xr,this)),Yt(ur,this).unmap()}const e=Xt(br,this,Rr).call(this);for(const[t,i]of r)Xt(br,this,Ar).call(this,t,i,e);const t=Xt(br,this,Cr).call(this,Yt(tr,this).getCurrentTexture().createView()),i=e.beginRenderPass(t);i.setVertexBuffer(0,Yt(ur,this));for(const[e,t]of r)if(t&&0!=t.length)for(const e of t){if(e.unlock(),-1==e.getTextureLayerType())continue;const t=e.getTextureType();let r=e.getUVCoords();if(3!==t&&!r)continue;const n=Yt(Jt,this).width,s=Yt(Jt,this).height;let a=e.getViewport();if(!a||Number.isNaN(a.x)||Number.isNaN(a.y)||Number.isNaN(a.w)||Number.isNaN(a.h)||a.x<0||a.y<0)continue;if(a.x+a.w>n){let e=a.x+a.w-n;if(!(e>0&&e<=5))continue;a.w-=e,a.w<=0&&(a.w=1)}if(a.y+a.h>s){let e=a.y+a.h-s;if(!(e>0&&e<=5))continue;a.h-=e,a.h<=0&&(a.h=1)}const o=Xt(br,this,Or).call(this,e);if(!o)continue;if(5!==o.pipelineType){let t=e.getUVCoordsBuffer();if(!t){const i=r.byteLength;t=Yt(sr,this).acquireBuffer(i,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,r.byteLength,!1,!1),e.setUVCoordsBuffer(t)}Yt(rr,this).queue.writeBuffer(t,0,r,0,r.length),i.setVertexBuffer(1,t)}i.setViewport(a.x,a.y,a.w,a.h,a.minDepth,a.maxDepth);const u=o.pipeline;i.setPipeline(u);const l=Yt(rr,this).createBindGroup({layout:u.getBindGroupLayout(0),entries:o.entries});i.setBindGroup(0,l),i.draw(6,1,0,0)}i.end(),Xt(br,this,Mr).call(this)}catch(e){t().tracing.globaltracing_error("[WebGUPRenderer] renderNoMsaa() error:".concat(e.message))}finally{Yt(er,this).recycleInUsedGPUBuffers(r)}else Yt(er,this).recycleInUsedGPUBuffers(r);else Yt(er,this).recycleInUsedGPUBuffers(r)}function _r(e){if(!Yt(rr,this)||!Yt(tr,this))return;const t=Yt(rr,this).createBuffer({label:"VertexBuffer",size:Yt(xr,this).byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0});new Float32Array(t.getMappedRange()).set(Yt(xr,this)),t.unmap();const r=Xt(br,this,Rr).call(this),i=Xt(br,this,Fr).call(this,e);for(const[e,t]of i)Xt(br,this,Ar).call(this,e,t,r);const n=Xt(br,this,Ir).call(this,Yt(Jt,this)),s=Xt(br,this,Wr).call(this,0,n.createView(),Yt(tr,this).getCurrentTexture().createView()),a=r.beginRenderPass(s);a.setVertexBuffer(0,t);for(const[e,t]of i)if(t&&0!=t.length)for(const e of t){if(e.unlock(),-1==e.getTextureLayerType())continue;let t=e.getUVCoords();if(!t)continue;let r=e.getUVCoordsBuffer();if(!r){const i=t.byteLength;r=Yt(sr,this).acquireBuffer(i,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,t.byteLength,!1,!0),e.setUVCoordsBuffer(r)}Yt(rr,this).queue.writeBuffer(r,0,t,0,t.length),a.setVertexBuffer(1,r);const i=Yt(Jt,this).width,n=Yt(Jt,this).height;let s=e.getViewport();if(!s||Number.isNaN(s.x)||Number.isNaN(s.y)||Number.isNaN(s.w)||Number.isNaN(s.h)||s.x<0||s.y<0||s.x+s.w>i||s.y+s.h>n)continue;const o=Xt(br,this,Or).call(this,e,!0);if(!o)continue;a.setViewport(s.x,s.y,s.w,s.h,s.minDepth,s.maxDepth);const u=o.pipeline;a.setPipeline(u);const l=Yt(rr,this).createBindGroup({layout:u.getBindGroupLayout(0),entries:o.entries});a.setBindGroup(0,l),a.draw(6,1,0,0)}a.end(),Xt(br,this,Mr).call(this),e.forEach((e=>{e.markRenderingStatePending()}))}function Pr(e){if(!Array.isArray(e))return;let t=[];for(let r=0;r<e.length;++r){let i=e[r];t.push(i.x),t.push(i.y)}Yt(xr,this).set(t,0)}function Tr(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=e.getTextureBufferGroup();if(!Yt(rr,this))return console.warn("[evalYuvTextureGroup] GPUDevice is not ready!"),i&&i.buffer&&i.buffer.unmap(),null;if(!t)return console.warn("[evalYuvTextureGroup] command encoder is invalid!"),i&&i.buffer&&i.buffer.unmap(),null;if(!i)return r||null;"unmapped"!=i.buffer.mapState&&i.buffer.unmap();let n=null,s=null,a=null;const o=e.getWidth(),u=e.getHeight(),l=null!=r&&(o!=r.yPlaneTex.width||u!=r.yPlaneTex.height);let c=!0;r&&(l?(Yt(er,this).destroyTextureGroup(e),c=!0):(n=r.yPlaneTex,s=r.uPlaneTex,a=r.vPlaneTex,c=!1));let h=!1,f="r8unorm";if(i&&i.bufferConfig&&"nv12"==i.bufferConfig.colorFormat&&(f="rg8unorm",h=!0),c){const t=e.getIndex(),r=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,i=Yt(or,this).assembleTextureConfig(o,u,r,"r8unorm",1),l=Yt(or,this).assembleTextureConfig(o/2,u/2,r,f,1);n=Yt(or,this).acquireTexture(i),n&&(n.label="RD(".concat(t,")-YPlaneTexture")),h?(s=Yt(or,this).acquireTexture(l),s&&(s.label="RD(".concat(t,")-UVPlaneTexture"))):(s=Yt(or,this).acquireTexture(l),s&&(s.label="RD(".concat(t,")-UPlaneTexture")),a=Yt(or,this).acquireTexture(l),a&&(a.label="RD(".concat(t,")-VPlaneTexture")))}t.copyBufferToTexture({buffer:i.buffer,offset:i.yPlaneBuffer.offset,bytesPerRow:i.yPlaneBuffer.bytesPerRow,rowsPerImage:i.yPlaneBuffer.rowsPerImage},{texture:n},[o,u,1]),t.copyBufferToTexture({buffer:i.buffer,offset:i.uPlaneBuffer.offset,bytesPerRow:i.uPlaneBuffer.bytesPerRow,rowsPerImage:i.uPlaneBuffer.rowsPerImage},{texture:s},[o/2,u/2,1]),i.vPlaneBuffer.offset>0&&!h&&t.copyBufferToTexture({buffer:i.buffer,offset:i.vPlaneBuffer.offset,bytesPerRow:i.vPlaneBuffer.bytesPerRow,rowsPerImage:i.vPlaneBuffer.rowsPerImage},{texture:a},[o/2,u/2,1]);let d={};return d.yPlaneTex=n,d.uPlaneTex=s,d.vPlaneTex=a,d}function Sr(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=e.getTextureBufferGroup();if(!Yt(rr,this))return console.warn("[evalRgbaTexture] GPUDevice is not ready!"),i&&i.buffer&&i.buffer.unmap(),null;if(!t)return console.warn("[evalRgbaTexture] command encoder is invalid!"),i&&i.buffer&&i.buffer.unmap(),null;if(!i)return r||null;"unmapped"!=i.buffer.mapState&&i.buffer.unmap();const n=e.getIndex(),s=e.getWidth(),a=e.getHeight(),o=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;let u=null;const l=null!=r&&(s!=r.width||a!=r.height);let c=!0;if(r&&(l?(Yt(er,this).destroyTextureGroup(e),c=!0):(u=r,c=!1)),c){const e=Yt(or,this).assembleTextureConfig(s,a,o,"rgba8unorm",1);u=Yt(or,this).acquireTexture(e),u&&(u.label="RD(".concat(n,")-rgbaTexture"))}return t.copyBufferToTexture({buffer:i.buffer,offset:0,bytesPerRow:i.bytesPerRow,rowsPerImage:i.rowsPerImage},{texture:u},[s,a,1]),u}function Ur(e,t){return Math.ceil(e/t)*t}function Rr(){return Yt(rr,this)?(Yt(nr,this)||Ht(nr,this,Yt(rr,this).createCommandEncoder()),Yt(nr,this)):(t().tracing.globaltracing_error("GPUDevice is not ready! No available command encoder."),null)}function Mr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Yt(nr,this)&&e?Yt(rr,this).queue.submit([Yt(nr,this).finish(),e.finish()]):Yt(nr,this)?Yt(rr,this).queue.submit([Yt(nr,this).finish()]):e&&Yt(rr,this).queue.submit([e.finish()]),Ht(nr,this,null)}function Br(e,t){if(!Yt(rr,this))return null;if(!Yt(vr,this)){let r=Yt(rr,this).createBindGroupLayout({label:"CursorTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});if(!r)return null;const i=Yt(rr,this).createPipelineLayout({label:"CursorTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[r]}),n={label:"CursorTexRenderPipeline(".concat(e,")"),layout:i,vertex:{module:Yt(rr,this).createShaderModule({code:Dt}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:Dt}),entryPoint:"f_main",targets:[{format:Yt(ir,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(n.multisample={count:4}),Ht(vr,this,Yt(rr,this).createRenderPipeline(n))}return Yt(vr,this)}function Gr(e,t){if(!Yt(rr,this))return null;if(!Yt(gr,this)){let r=Yt(rr,this).createBindGroupLayout({label:"WatermarkTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}}]});if(!r)return null;const i=Yt(rr,this).createPipelineLayout({label:"WatermarkTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[r]}),n={label:"WatermarkTexRenderPipeline(".concat(e,")"),layout:i,vertex:{module:Yt(rr,this).createShaderModule({code:Nt}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:Nt}),entryPoint:"f_main",targets:[{format:Yt(ir,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(n.multisample={count:4}),Ht(gr,this,Yt(rr,this).createRenderPipeline(n))}return Yt(gr,this)}function kr(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Yt(rr,this)||!e)return null;if(!Yt(fr,this)){const r=Yt(rr,this).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:6,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i={label:"YuvRenderPipeline",layout:Yt(rr,this).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[r]}),vertex:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:Yt(ir,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),Ht(fr,this,Yt(rr,this).createRenderPipeline(i))}return Yt(fr,this)}function Er(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Yt(rr,this)||!e)return null;if(!Yt(dr,this)){const r=Yt(rr,this).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i={label:"YuvRenderPipeline",layout:Yt(rr,this).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[r]}),vertex:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:Yt(ir,this)}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),Ht(dr,this,Yt(rr,this).createRenderPipeline(i))}return Yt(dr,this)}function Wr(e,t,r){return{label:"renderPass - ".concat(e),colorAttachments:[{view:t,resolveTarget:r,loadOp:"clear",storeOp:"discard"}]}}function Cr(e){return e&&(e.label="canvas-texture-view"),{label:"RenderPassNoMsaa",colorAttachments:[{view:e,loadOp:"clear",storeOp:"store"}]}}function Fr(e){let t=new Map;for(let r=0;r<e.length;++r){const i=e[r],n=i.getTextureLayersMap(),s=i.isSetWatermark();for(let e=0;e<4;++e)if(n.has(e)){const r=n.get(e);if(r){let i=t.get(e);i||(i=[]),2===e?s&&(i.push(r),t.set(e,i)):(i.push(r),t.set(e,i))}}}return t}function Or(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null,i=null,n=null,s=null;const a=e.getZIndex(),o=e.getTextureType(),u=e.getColorFormat();if(0==a){if(0==o){s=0,r=this.acquireVideoFrameRenderPipeline("\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      struct FsUniforms {\n        rotation: f32,\n        enable_rounded_corner: f32,\n        radius_lt_x: f32,\n        radius_lt_y: f32,\n        radius_lb_x: f32,\n        radius_lb_y: f32,\n        radius_rt_x: f32,\n        radius_rt_y: f32,\n        radius_rb_x: f32,\n        radius_rb_y: f32,\n        aa_width: f32,\n        viewport_x: f32,\n        viewport_y: f32,\n        viewport_w: f32,\n        viewport_h: f32,\n      };\n  \n      @group(0) @binding(0) var vfSampler: sampler;\n      @group(0) @binding(1) var vfTexture: texture_external;\n      @group(0) @binding(2) var<uniform> vsUniforms: FsUniforms;\n      @group(0) @binding(3) var<uniform> fsUniforms: FsUniforms;\n      \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n          \n          if (vsUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vsUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vsUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vsUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n  \n          return output;\n      }\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>, @builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(vfTexture, vfSampler, uv);\n\n          // rounded corner\n          var canvas_uv: vec2<f32> = (fragCoord.xy - vec2<f32>(fsUniforms.viewport_x, fsUniforms.viewport_y)) / vec2<f32>(fsUniforms.viewport_w, fsUniforms.viewport_h);\n          var corner_radius: vec2<f32> = mix(\n            mix(vec2(fsUniforms.radius_lb_x, fsUniforms.radius_lb_y), vec2(fsUniforms.radius_rb_x, fsUniforms.radius_rb_y), step(0.5, canvas_uv.x)),\n            mix(vec2(fsUniforms.radius_lt_x, fsUniforms.radius_lt_y), vec2(fsUniforms.radius_rt_x, fsUniforms.radius_rt_y), step(0.5, canvas_uv.x)),\n            step(0.5, canvas_uv.y)\n          );\n\n          var safe_corner_radius: vec2<f32> = max(corner_radius, vec2(0.0001));\n          var d: vec2<f32> = max(corner_radius - canvas_uv, canvas_uv - (1.0 - corner_radius));\n          d = max(d, vec2<f32>(0.0));   \n          var dist: f32 = length(d / safe_corner_radius);\n\n          var max_corner_radius: f32 = max(max(corner_radius.x, corner_radius.y), 0.001);\n          var is_zero_radius: f32 = step(0.001, max_corner_radius);\n          var rounded_alpha: f32 = smoothstep(1.0, 1.0 - fsUniforms.aa_width, dist);\n          var final_alpha: f32 = mix(1.0, rounded_alpha, fsUniforms.enable_rounded_corner * is_zero_radius);\n\n          return vec4<f32>(color.rgb, color.a * 1.0);\n      }\n  ",t),i=this.acquireVideoFrameSampler();const a=e.getPendingVideoFrame();if(!a||0==a.codedWidth||0==a.codedHeight||!a.format)return e.setPendingVideoFrame(null),null;const o=e.getUniformBuffer();if(!o)return null;n=[{binding:0,resource:i},{binding:1,resource:Yt(rr,this).importExternalTexture({source:a})},{binding:2,resource:{buffer:o}},{binding:3,resource:{buffer:o}}]}else if(3==o){s=5,r=this.acquireClearColorRenderPipeline("\n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n      ) -> @builtin(position) vec4<f32> {\n          return vec4<f32>(vtxPos, 0.0, 1.0);\n      }\n  \n      struct ClearColorUniforms {\n          clearColor: vec4<f32>,\n      };\n  \n      @group(0) @binding(0) var<uniform> uniforms: ClearColorUniforms;\n      @fragment\n      fn f_main() -> @location(0) vec4<f32> {\n          return uniforms.clearColor;\n      }\n  ");const t=e.getClearColorUniformBuffer();if(!t)return null;n=[{binding:0,resource:{buffer:t}}]}else if(1==o){"i420"==u?(s=1,r=Xt(br,this,kr).call(this,"\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n\n      struct FsUniforms {\n          yuvMode: f32,\n          colorRange: f32,\n          rotation: f32,\n          enable_rounded_corner: f32,\n          radius_lt_x: f32,\n          radius_lt_y: f32,\n          radius_lb_x: f32,\n          radius_lb_y: f32,\n          radius_rt_x: f32,\n          radius_rt_y: f32,\n          radius_rb_x: f32,\n          radius_rb_y: f32,\n          aa_width: f32,\n          viewport_x: f32,\n          viewport_y: f32,\n          viewport_w: f32,\n          viewport_h: f32,\n      };\n  \n      @group(0) @binding(0) var yPlaneSampler: sampler;\n      @group(0) @binding(1) var uvPlaneSampler: sampler;\n      @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n      @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n      @group(0) @binding(4) var vPlaneTex: texture_2d<f32>;\n      @group(0) @binding(5) var<uniform> fsUniforms: FsUniforms;\n      @group(0) @binding(6) var<uniform> vsUniforms: FsUniforms;\n      // @group(0) @binding(7) var<storage, read_write> outputBuffer: array<f32>;\n  \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n  \n          if (vsUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vsUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vsUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vsUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n          \n          return output;\n      }\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>, @builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n          let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n          var u: f32;\n          var v: f32;\n          if (fsUniforms.yuvMode == 1) {\n              u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n              v = textureSampleBaseClampToEdge(vPlaneTex, uvPlaneSampler, uv).r;\n          } else {\n              u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n              v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).a;\n          }\n  \n          const yuv2RGB_L = mat4x4(\n              1.1643835616, 0, 1.7927410714, -0.9729450750,\n              1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n              1.1643835616, 2.1124017857, 0, -1.1334022179,\n              0, 0, 0, 1\n          );\n  \n          const yuv2RGB_F = mat4x4(\n              1.0, 0, 1.402, -.701,\n              1.0, -.34413, -.71414, .529135,\n              1.0, 1.772, 0, -.886,\n              0, 0, 0, 1\n          );\n  \n          var color = vec4<f32>(y, u, v, 1.0);\n          if (fsUniforms.colorRange == 0) {\n              color = color * yuv2RGB_L;\n          } else {\n              color = color * yuv2RGB_F;\n          }\n  \n          // support rounded corner\n          // rounded corner\n          var canvas_uv: vec2<f32> = (fragCoord.xy - vec2<f32>(fsUniforms.viewport_x, fsUniforms.viewport_y)) / vec2<f32>(fsUniforms.viewport_w, fsUniforms.viewport_h);\n          var corner_radius: vec2<f32> = mix(\n            mix(vec2(fsUniforms.radius_lb_x, fsUniforms.radius_lb_y), vec2(fsUniforms.radius_rb_x, fsUniforms.radius_rb_y), step(0.5, canvas_uv.x)),\n            mix(vec2(fsUniforms.radius_lt_x, fsUniforms.radius_lt_y), vec2(fsUniforms.radius_rt_x, fsUniforms.radius_rt_y), step(0.5, canvas_uv.x)),\n            step(0.5, canvas_uv.y)\n          );\n\n          var safe_corner_radius: vec2<f32> = max(corner_radius, vec2(0.0001));\n          var d: vec2<f32> = max(corner_radius - canvas_uv, canvas_uv - (1.0 - corner_radius));\n          d = max(d, vec2<f32>(0.0));\n          var dist: f32 = length(d / safe_corner_radius);\n\n          var max_corner_radius: f32 = max(max(corner_radius.x, corner_radius.y), 0.001);\n          var is_zero_radius: f32 = step(0.001, max_corner_radius);\n          var rounded_alpha: f32 = smoothstep(1.0, 1.0 - fsUniforms.aa_width, dist);\n          var final_alpha: f32 = mix(1.0, rounded_alpha, fsUniforms.enable_rounded_corner * is_zero_radius);\n\n          return vec4<f32>(color.rgb, color.a * 1.0);\n      }\n  ",t)):"nv12"==u&&(s=2,r=Xt(br,this,Er).call(this,"\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      struct FsUniforms {\n          yuvMode: f32,\n          colorRange: f32,\n          rotation: f32,\n          enable_rounded_corner: f32,\n          radius_lt_x: f32,\n          radius_lt_y: f32,\n          radius_lb_x: f32,\n          radius_lb_y: f32,\n          radius_rt_x: f32,\n          radius_rt_y: f32,\n          radius_rb_x: f32,\n          radius_rb_y: f32,\n          aa_width: f32,\n          viewport_x: f32,\n          viewport_y: f32,\n          viewport_w: f32,\n          viewport_h: f32,\n      };\n      \n      @group(0) @binding(0) var yPlaneSampler: sampler;\n      @group(0) @binding(1) var uvPlaneSampler: sampler;\n      @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n      @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n      @group(0) @binding(4) var<uniform> fsUniforms: FsUniforms;\n      @group(0) @binding(5) var<uniform> vsUniforms: FsUniforms;\n      // @group(0) @binding(5) var<storage, read_write> outputBuffer: array<f32>;\n      \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n          \n          if (vsUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vsUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vsUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vsUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n              \n          return output;\n      }\n  \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>, @builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n          let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n          var u: f32;\n          var v: f32;\n          u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n          v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).g;\n  \n          const yuv2RGB_L = mat4x4(\n              1.1643835616, 0, 1.7927410714, -0.9729450750,\n              1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n              1.1643835616, 2.1124017857, 0, -1.1334022179,\n              0, 0, 0, 1\n          );\n  \n          const yuv2RGB_F = mat4x4(\n              1.0, 0, 1.402, -.701,\n              1.0, -.34413, -.71414, .529135,\n              1.0, 1.772, 0, -.886,\n              0, 0, 0, 1\n          );\n  \n          var color = vec4<f32>(y, u, v, 1.0);\n          if (fsUniforms.colorRange == 0) {\n              color = color * yuv2RGB_L;\n          } else {\n              color = color * yuv2RGB_F;\n          }\n  \n          // outputBuffer[0] = y;\n          // outputBuffer[1] = u;\n          // outputBuffer[2] = v;\n          // outputBuffer[3] = color.r;\n          // outputBuffer[4] = color.g;\n          // outputBuffer[5] = color.b;\n          // outputBuffer[6] = color.a;\n  \n          // rounded corner\n          var canvas_uv: vec2<f32> = (fragCoord.xy - vec2<f32>(fsUniforms.viewport_x, fsUniforms.viewport_y)) / vec2<f32>(fsUniforms.viewport_w, fsUniforms.viewport_h);\n          var corner_radius: vec2<f32> = mix(\n            mix(vec2(fsUniforms.radius_lb_x, fsUniforms.radius_lb_y), vec2(fsUniforms.radius_rb_x, fsUniforms.radius_rb_y), step(0.5, canvas_uv.x)),\n            mix(vec2(fsUniforms.radius_lt_x, fsUniforms.radius_lt_y), vec2(fsUniforms.radius_rt_x, fsUniforms.radius_rt_y), step(0.5, canvas_uv.x)),\n            step(0.5, canvas_uv.y)\n          );\n\n          var safe_corner_radius: vec2<f32> = max(corner_radius, vec2(0.0001));\n          var d: vec2<f32> = max(corner_radius - canvas_uv, canvas_uv - (1.0 - corner_radius));\n          d = max(d, vec2<f32>(0.0));\n          var dist: f32 = length(d / safe_corner_radius);\n\n          var max_corner_radius: f32 = max(max(corner_radius.x, corner_radius.y), 0.001);\n          var is_zero_radius: f32 = step(0.001, max_corner_radius);\n          var rounded_alpha: f32 = smoothstep(1.0, 1.0 - fsUniforms.aa_width, dist);\n          var final_alpha: f32 = mix(1.0, rounded_alpha, fsUniforms.enable_rounded_corner * is_zero_radius);\n\n          // return vec4<f32>(color.rgb, color.a * 1.0);\n          return color;\n        }\n  ",t)),i=this.acquireYuvTexturesSamplers();const a=e.getUniformBuffer();if(!a)return null;const o=e.getTextureGroup();o&&("i420"==u?n=[{binding:0,resource:i[0]},{binding:1,resource:i[1]},{binding:2,resource:o.yPlaneTex.createView()},{binding:3,resource:o.uPlaneTex.createView()},{binding:4,resource:o.vPlaneTex.createView()},{binding:5,resource:{buffer:a}},{binding:6,resource:{buffer:a}}]:"nv12"==u&&(n=[{binding:0,resource:i[0]},{binding:1,resource:i[1]},{binding:2,resource:o.yPlaneTex.createView()},{binding:3,resource:o.uPlaneTex.createView()},{binding:4,resource:{buffer:a}},{binding:5,resource:{buffer:a}}]))}}else if(2==a||3==a){s=3,r=Xt(br,this,Gr).call(this,a,t),i=this.acquireBlendTextureSampler();const o=e.getTextureGroup();o&&(n=[{binding:0,resource:i},{binding:1,resource:o.createView()}])}else if(1==a){s=4,r=Xt(br,this,Br).call(this,a,t),i=this.acquireBlendTextureSampler();const o=e.getUniformBuffer();if(!o)return null;const u=e.getTextureGroup();u&&(n=[{binding:0,resource:i},{binding:1,resource:u.createView()},{binding:2,resource:{buffer:o}}])}if(5===s){if(!r||!n)return null}else if(!r||!i||!n||null==s)return null;return{pipelineType:s,pipeline:r,entries:n}}function Ar(e,t,r){for(const i of t){const t=i.getTextureType();0!=t&&3!=t&&(0==e?Xt(br,this,Vr).call(this,i,r):1!=e&&2!=e&&3!=e||Xt(br,this,Lr).call(this,i,r))}}function Vr(e,t){let r=e.getTextureGroup();r?e.isNew()&&(r=Xt(br,this,Tr).call(this,e,t,r),e.setIsNew(!1)):(r=Xt(br,this,Tr).call(this,e,t,null),e.setIsNew(!1)),r&&e.setTextureGroup(r)}function Lr(e,t){let r=e.getTextureGroup();r?e.isNew()&&(r=Xt(br,this,Sr).call(this,e,t,r),e.setIsNew(!1)):(r=Xt(br,this,Sr).call(this,e,t,null),e.setIsNew(!1)),r&&e.setTextureGroup(r)}function Ir(e){if(!e||!Yt(rr,this))return Yt(mr,this)?Yt(mr,this):null;if(Yt(mr,this)){if(Yt(mr,this).width!=e.width||Yt(mr,this).height!=e.height){const t=Yt(or,this).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,Yt(ir,this),4);Ht(mr,this,Yt(or,this).acquireTexture(t))}}else{const t=Yt(or,this).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,Yt(ir,this),4);Ht(mr,this,Yt(or,this).acquireTexture(t))}return Yt(mr,this)}const Nr=class{constructor(e,t){var r;if(qt(this,r=br),r.add(this),jt(this,Jt,null),jt(this,Kt,0),jt(this,Zt,0),jt(this,Qt,!1),jt(this,$t,!1),jt(this,er,null),jt(this,tr,null),jt(this,rr,null),jt(this,ir,null),jt(this,nr,null),jt(this,sr,null),jt(this,ar,null),jt(this,or,null),jt(this,ur,null),jt(this,lr,null),jt(this,cr,null),jt(this,hr,null),jt(this,fr,null),jt(this,dr,null),jt(this,pr,null),jt(this,gr,null),jt(this,vr,null),jt(this,yr,null),jt(this,mr,null),jt(this,xr,new Float32Array(12)),!t)throw new Error("[WebGPURenderer] resMgr is an invalid param! ".concat(t));Ht(Jt,this,e),Ht(er,this,t),this.initialize(e)}switchMsaa(e){Ht($t,this,e)}isMsaaEnabled(){return Yt($t,this)}setCanvas(e){e&&Ht(Jt,this,e)}setDevice(e){e&&Ht(rr,this,e)}setRenderArgs(e,t){Ht(Kt,this,e||0),Ht(Zt,this,Yt(Kt,this)?3:t?4:6),Ht(Qt,this,t||!1)}setTextureIndex(e){Ht(Kt,this,e||0)}initialize(e){Yt(rr,this)||(Ht(rr,this,Yt(er,this).acquireGPUDevice()),Yt(rr,this))?(Yt(ir,this)||Ht(ir,this,Yt(er,this).acquireCanvasFormat()),Yt(sr,this)||Ht(sr,this,Yt(er,this).acquireGPUBufferMgr()),Yt(ar,this)||Ht(ar,this,Yt(er,this).acquireGPUBufferPool()),Yt(or,this)||Ht(or,this,Yt(er,this).acquireGPUTextureMgr()),this.configureGPUContext(e),Xt(br,this,Pr).call(this,l)):t().tracing.globaltracing_error("[WebGPURenderer] initialize() device is not ready!")}isGPUDeviceReady(){return null!=Yt(rr,this)}render(e){Yt($t,this)?Xt(br,this,_r).call(this,e):Xt(br,this,wr).call(this,e)}updateVertexCoords(e){Xt(br,this,Pr).call(this,e)}createRGBATexture(e,r,i,n,s){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(r<0)return t().tracing.globaltracing_error("[createRGBATexture] ".concat(r," is an invalid index!")),null;if(!Yt(sr,this))return console.warn("[createRGBATexture] buffer manager is not ready!"),null;if(!Yt(rr,this))return console.warn("[createRGBATexture] GPUDevice is not ready!"),null;if(null==s||void 0===s)return console.warn("[createRGBATexture] rgbaData is invalid!"),null;if(!e)return console.warn("[createRGBATexture] command encoder is invalid!"),null;const o=Xt(br,this,Ur).call(this,Uint32Array.BYTES_PER_ELEMENT*i,256),u=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,l=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;let c=null;const h=null!=a&&(i!=a.width||n!=a.height);let f=!0;if(a&&(h?(Yt(or,this).recycleTexture(a),f=!0):(c=a,f=!1)),f){const e=Yt(or,this).assembleTextureConfig(i,n,l,"rgba8unorm",1);c=Yt(or,this).acquireTexture(e),c&&(c.label="RD(".concat(r,")-rgbaTexture"))}const d=Yt(sr,this).acquireBuffer("".concat(r,"_Y"),u,o*n,!0,!1),p=new Uint8Array(d.getMappedRange()),g=i*Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<n;++e)p.set(s.subarray(e*g,(e+1)*g),e*o);return d.unmap(),e.copyBufferToTexture({buffer:d,offset:0,bytesPerRow:o,rowsPerImage:n},{texture:c},[i,n,1]),c}writeToYuvTexturesBufferGroup(e,t){if(!(Yt(sr,this)&&e&&t&&t.buffer&&t.bufferConfig&&"mapped"==t.buffer.mapState))return null;let r=e.yPlane,i=e.cbPlane,n=e.crPlane;const s=Xt(br,this,Ur).call(this,Uint8Array.BYTES_PER_ELEMENT*r.width,256);let a=Uint8Array.BYTES_PER_ELEMENT;"nv12"==t.bufferConfig.colorFormat&&(a=Uint16Array.BYTES_PER_ELEMENT);const o=Xt(br,this,Ur).call(this,a*i.width,256),u=s*r.height;let l=0,c=s*r.height+o*i.height;n&&n.buffer&&(c+=o*n.height,l=0+u+o*i.height);let h=t.buffer,f=t.bufferArray;f||(f=h.getMappedRange(0,c),t.bufferArray=f);const d=new Uint8Array(f),p=r.width*Uint8Array.BYTES_PER_ELEMENT;if(0+r.height*s>=d.length)return console.error("[WebGPURenderer] write yPlane is out of range! yPlaneOffset=".concat(0,", yPlane.height=").concat(r.height,", yPlaneBytesPerRow=").concat(s,", mappedArray.len=").concat(d.length)),null;for(let e=0;e<r.height;++e)d.set(r.buffer.subarray(e*p,(e+1)*p),0+e*s);let g=p/2;if(0==l&&(g=i.width*Uint16Array.BYTES_PER_ELEMENT),u+i.height*o>d.length)return null;for(let e=0;e<i.height;++e)d.set(i.buffer.subarray(e*g,(e+1)*g),u+e*o);if(l>0){if(l+n.height*o>d.length)return null;for(let e=0;e<n.height;++e)d.set(n.buffer.subarray(e*g,(e+1)*g),l+e*o)}return t.buffer=h,t.yPlaneBuffer={bytesPerRow:s,rowsPerImage:r.height,offset:0},t.uPlaneBuffer={bytesPerRow:o,rowsPerImage:i.height,offset:u},t.vPlaneBuffer={bytesPerRow:o,rowsPerImage:n.height,offset:l},t}writeToRgbaTextureBuffer(e,t,r,i,n){if(!(Yt(sr,this)&&i&&n&&n.buffer))return null;const s=Xt(br,this,Ur).call(this,Uint32Array.BYTES_PER_ELEMENT*t,256),a=n.buffer;let o=n.bufferArray;o||(o=a.getMappedRange(),n.bufferArray=o);const u=new Uint8Array(o),l=t*Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<r;++e)u.set(i.subarray(e*l,(e+1)*l),e*s);return n.buffer=a,n.bytesPerRow=s,n.rowsPerImage=r,n}produceVideoFrame(e,t){return new VideoFrame(e,t)}writeUniformBuffer(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Yt(rr,this))return t().tracing.globaltracing_error("writeUniformBuffer() GPUDevice is not ready yet."),null;if(!r||0==r.length)return null;let n=i;return i&&r.byteLength>i.size&&(i.destroy(),i=null,n=null),n?n.label=e:n=Yt(rr,this).createBuffer({label:e,size:r.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Yt(rr,this).queue.writeBuffer(n,0,r,0,r.length),n}acquireBlendTextureSampler(){return Yt(rr,this)?(Yt(yr,this)||Ht(yr,this,Yt(rr,this).createSampler({})),Yt(yr,this)):null}configureGPUContext(e){Yt(tr,this)||(Ht(tr,this,e.getContext("webgpu")),Yt(tr,this)?Yt(tr,this).configure({device:Yt(rr,this),format:Yt(ir,this),alphaMode:"premultiplied"}):t().tracing.globaltracing_error("configureGPUContext() webgpuContext is invalid! canvas=".concat(e)))}unconfigureGPUContext(){Yt(tr,this)&&(Yt(tr,this).unconfigure(),Ht(tr,this,null))}acquireVideoFrameRenderPipeline(e,t){if(!Yt(rr,this)||!e)return null;if(!Yt(lr,this)){const r=Yt(rr,this).createBindGroupLayout({label:"VideoFrameBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,externalTexture:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),i={label:"VideoFrameRenderPipeline",layout:Yt(rr,this).createPipelineLayout({label:"VideoFramePipelineLayout",bindGroupLayouts:[r]}),vertex:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:Yt(ir,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),Ht(lr,this,Yt(rr,this).createRenderPipeline(i))}return Yt(lr,this)}acquireClearColorRenderPipeline(e){if(!Yt(rr,this)||!e)return null;if(!Yt(cr,this)){const t=Yt(rr,this).createBindGroupLayout({label:"ClearColorBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),r={label:"ClearColorRenderPipeline",layout:Yt(rr,this).createPipelineLayout({label:"ClearColorPipelineLayout",bindGroupLayouts:[t]}),vertex:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:e}),entryPoint:"f_main",targets:[{format:Yt(ir,this)}]},primitive:{topology:"triangle-list"}};Ht(cr,this,Yt(rr,this).createRenderPipeline(r))}return Yt(cr,this)}acquireVideoFrameSampler(){return Yt(rr,this)?(Yt(hr,this)||Ht(hr,this,Yt(rr,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})),Yt(hr,this)):null}acquireYuvTexturesSamplers(){if(!Yt(rr,this))return null;if(!Yt(pr,this)){Ht(pr,this,[]);const e=Yt(rr,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),t=Yt(rr,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"});Yt(pr,this).push(e),Yt(pr,this).push(t)}return Yt(pr,this)}clearAttachedCanvas(){if(!Yt(rr,this)||!Yt(tr,this)||!Yt(ur,this))return;if(!Yt(Jt,this)||0==Yt(Jt,this).width||0==Yt(Jt,this).height)return;const e=Yt(rr,this).createCommandEncoder(),t=e.beginRenderPass({colorAttachments:[{view:Yt(tr,this).getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]}),r=Yt(rr,this).createRenderPipeline({layout:"auto",vertex:{module:Yt(rr,this).createShaderModule({code:zt}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:Yt(rr,this).createShaderModule({code:zt}),entryPoint:"f_main",targets:[{format:Yt(ir,this)}]},primitive:{topology:"triangle-list"}});t.setVertexBuffer(0,Yt(ur,this)),t.setPipeline(r),t.draw(6),t.end(),Yt(rr,this).queue.submit([e.finish()])}clear(){console.log("WebGPURender.clear")}cleanup(){this.unconfigureGPUContext(),Ht(Jt,this,null),Ht(ir,this,null),Ht(nr,this,null),Ht(ur,this,null),Ht(lr,this,null),Ht(cr,this,null),Ht(hr,this,null),Ht(fr,this,null),Ht(dr,this,null),Ht(pr,this,null),Ht(gr,this,null),Ht(vr,this,null),Ht(yr,this,null),Ht(mr,this,null),Yt(sr,this)&&Ht(sr,this,null),Yt(rr,this)&&Ht(rr,this,null)}};function Dr(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function zr(e,t){return e.get(qr(e,t))}function jr(e,t,r){return e.set(qr(e,t),r),r}function qr(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Yr=new WeakMap,Hr=new WeakMap,Xr=new WeakMap,Jr=new WeakMap,Kr=new WeakMap,Zr=new WeakMap,Qr=new WeakMap;const $r=class{constructor(e){Dr(this,Yr,1),Dr(this,Hr,{}),Dr(this,Xr,null),Dr(this,Jr,0),Dr(this,Kr,0),Dr(this,Zr,[]),Dr(this,Qr,new Map),jr(Xr,this,e)}acquireBuffer(e,t,r){let i,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return arguments.length>4&&void 0!==arguments[4]&&!arguments[4]?i=zr(Xr,this).createBuffer({size:r,usage:t,mappedAtCreation:n}):zr(Qr,this).has(e)?i=zr(Qr,this).get(e):zr(Zr,this).length>0?(i=zr(Zr,this).pop(),zr(Qr,this).set(e,i)):(i=zr(Xr,this).createBuffer({size:r,usage:t,mappedAtCreation:n}),zr(Qr,this).set(e,i)),i}releaseBuffer(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(zr(Qr,this).has(e)){const t=zr(Qr,this).get(e);r?zr(Zr,this).push(t):t.destroy(),zr(Qr,this).delete(e)}else r||-1!=zr(Zr,this).indexOf(t)&&(zr(Zr,this)[index]=zr(Zr,this)[zr(Zr,this).length-1],zr(Zr,this).pop(),t.destroy())}getNumUsedBuffers(){return zr(Jr,this)}getNumFreeBuffers(){return zr(Kr,this)}cleanup(){zr(Zr,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),zr(Qr,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),zr(Zr,this).length=0,zr(Qr,this).clear(),jr(Jr,this,0),jr(Kr,this,0)}release(e){3==e&&(zr(Zr,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),zr(Zr,this).length=0,jr(Kr,this,0))}getResourceType(){return zr(Yr,this)}collectResourceInfo(){let e=0,t=0,r="";for(const[i,n]of zr(Qr,this))e++,t+=n.size,r+="[GPUBufferMgr] entry{key:".concat(i,", buffer:{label:").concat(n.label," size:").concat(n.size,"}}\n");for(const r of zr(Zr,this))e++,t+=r.size;return r+="[GPUBufferMgr] freeBuffers{size:".concat(zr(Zr,this).length,"}\n"),r+="[GPUBufferMgr] total: count:".concat(e," usedBytes:").concat(t,"\n"),zr(Hr,this).type=zr(Yr,this),zr(Hr,this).count=e,zr(Hr,this).usedBytes=t,zr(Hr,this).output=r,zr(Hr,this)}onOccupancyLevelEvaluated(e){console.log("[GPUBufferManager] onOccupancyLevelEvaluated() level:".concat(e)),t().tracing.add_monitor("WGPU GPUBufferManager_onOccupancyLevelEvaluated() level:".concat(e)),this.release(e)}};function ei(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function ti(e,t){return e.get(function(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}(e,t))}var ri=new WeakMap,ii=new WeakMap,ni=new WeakMap;const si=class{constructor(){ei(this,ri,2),ei(this,ii,[]),ei(this,ni,[])}acquire(e){let t=null;const r=ti(ii,this).findIndex((t=>t&&t.width==e.w&&t.height==e.h&&t.format==e.format&&t.usage==e.usage));return r>-1&&(t=ti(ii,this).splice(r,1)[0]),t&&ti(ni,this).push(t),t}recycle(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=ti(ni,this).indexOf(e);-1!=r&&ti(ni,this).splice(r,1),t?e.destroy():(ti(ii,this).push(e),e.label="")}pushToAvailablePool(e){e&&ti(ii,this).push(e)}pushToInUsePool(e){e&&ti(ni,this).push(e)}release(e){if(3==e&&ti(ii,this).length>0){for(const e of ti(ii,this))e.destroy();ti(ii,this).length=0}}cleanup(){for(const e of ti(ii,this))e.destroy();for(const e of ti(ni,this))e.destroy();ti(ii,this).length=0,ti(ni,this).length=0}getAvailablePool(){return ti(ii,this)}getInUsedPool(){return ti(ni,this)}getResourceType(){return ti(ri,this)}};function ai(e,t,r){oi(e,t),t.set(e,r)}function oi(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ui(e,t){return e.get(li(e,t))}function li(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var ci=new WeakMap,hi=new WeakMap,fi=new WeakMap,di=new WeakMap,pi=new WeakSet;function gi(e){let t=ui(fi,this).get(e.level),r=null;return t?(r=t.acquire(e),r||(r=li(pi,this,yi).call(this,e),r?t.pushToInUsePool(r):console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e))))):(r=li(pi,this,yi).call(this,e),r?(t=new si,t.pushToInUsePool(r),ui(fi,this).set(e.level,t)):console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e)))),r}function vi(e){const t=e.zOrder;let r=ui(di,this).get(t);return r?(e.w>r.width||e.h>r.height)&&(r.destroy(),r=li(pi,this,yi).call(this,e),ui(di,this).set(t,r)):(r=li(pi,this,yi).call(this,e),ui(di,this).set(t,r)),r}function yi(e){if(!ui(ci,this))return null;if(0==e.w||0==e.h)return null;const t={size:{width:e.w,height:e.h},format:e.format,usage:e.usage};return e.sampleCount>0&&(t.sampleCount=e.sampleCount),ui(ci,this).createTexture(t)}function mi(e){let t=h[h.length-1];for(let r=0;r<h.length;++r)if(e<=h[r]){t=h[r];break}return t}function xi(e){return e&&e.zOrder&&e.zOrder==TEX_LAYER_Z_IDX.WATERMARK}const bi=class{constructor(e){var t;oi(this,t=pi),t.add(this),ai(this,ci,null),ai(this,hi,{}),ai(this,fi,new Map),ai(this,di,new Map),function(e,t,r){e.set(li(e,t),r)}(ci,this,e)}assembleTextureConfig(e,t,r,i,n){return{w:e,h:t,usage:r,format:i,sampleCount:n,level:li(pi,this,mi).call(this,t)}}isSameTextureConfig(e,t){return!(!e||!t)&&e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount}evalTexConfig(e){if(!e)throw new Error("hasSameTextureConfig() invalid input!");const t=ui(fi,this).keys();let r=e;for(const i of t)if(this.isSameTextureConfig(i,e)){r=i;break}return r}needNewTexturesMapEntry(e,t){return!(!t||e&&e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount)}acquireTexture(e){if(!e||e.w<=0||e.h<=0)return console.error("[GPUTextureMgr] acquireTexture() texConfig is invalid"),null;let t=null;return t=li(pi,this,xi).call(this,e)?li(pi,this,vi).call(this,e):li(pi,this,gi).call(this,e),t}recycleTexture(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const r=this.assembleTextureConfig(e.width,e.height,e.usage,e.format,e.sampleCount);let i=ui(fi,this).get(r.level);if(i)i.recycle(e,t);else if(console.warn("recycleTexture(".concat(e.label,") texture is not found in the map!, destroy:").concat(t)),t)e.destroy();else{const t=new si;t.pushToAvailablePool(e),ui(fi,this).set(r.level,t)}}cleanup(){for(const[e,t]of ui(fi,this))t&&t.cleanup();ui(fi,this).clear()}collectResourceInfo(){let e=0,t=0,r="";for(const[i,n]of ui(fi,this))if(n){const s=n.getAvailablePool();for(const r of s)e++,"r8unorm"==r.format?t+=r.width*r.height:"rgba8unorm"==r.format&&(t+=r.width*r.height*Uint32Array.BYTES_PER_ELEMENT);const a=n.getInUsedPool();for(const r of a)e++,"r8unorm"==r.format?t+=r.width*r.height:"rgba8unorm"==r.format&&(t+=r.width*r.height*Uint32Array.BYTES_PER_ELEMENT);(s.length>0||a.length>0)&&(r+="[GPUTexturePool] level:".concat(i," pool:{ava_count:").concat(s.length," in_used_count:").concat(a.length,"}\n"))}return r+="[GPUTexturePool] total: count:".concat(e," usedBytes:").concat(t,"\n"),ui(hi,this).type=2,ui(hi,this).count=e,ui(hi,this).usedBytes=t,ui(hi,this).output=r,ui(hi,this)}onOccupancyLevelEvaluated(e){if(console.log("[GPUTextureManager] onOccupancyLevelEvaluated() level:".concat(e)),t().tracing.add_monitor("WGPU GPUTextureManager_onOccupancyLevelEvaluated() level:".concat(e)),3==e)for(const[t,r]of ui(fi,this))r&&r.release(e)}};var wi=r(129),_i=r.n(wi);function Pi(e,t,r){Ti(e,t),t.set(e,r)}function Ti(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Si(e,t){return e.get(Ri(e,t))}function Ui(e,t,r){return e.set(Ri(e,t),r),r}function Ri(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Mi=new WeakMap,Bi=new WeakMap,Gi=new WeakMap,ki=new WeakMap,Ei=new WeakSet;function Wi(e,t,r){if(Si(Gi,this).set(e,t),r){let e=Array.from(Si(Gi,this).entries());_i()(e).call(e,((e,t)=>e[0]-t[0])),Si(Gi,this).clear(),e.forEach((e=>{let[t,r]=e;Si(Gi,this).set(t,r)}))}}function Ci(e,t){if(!e||0==e.length)return null;let r=0,i=0,n=null;for(const s of e)"mapped"==s.mapState?(r+=1,n||s.size>=t&&(n=s)):i+=1;if(r>0&&0==i||r>=2&&0!=i){if(n){const t=e.indexOf(n);-1!=t&&e.splice(t,1)}return n}return null}const Fi=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var r;Ti(this,r=Ei),r.add(this),Pi(this,Mi,0),Pi(this,Bi,0),Pi(this,Gi,new Map),Pi(this,ki,0),Ui(Bi,this,e),Ui(ki,this,t)}isUpToThreshold(e,t){if(e!=Si(Bi,this)||t<=0)return!1;if(0==Si(ki,this))return!1;const r=Si(Gi,this).get(t);return!!r&&r.length>=Si(ki,this)}push(e,t,r){if(e!=Si(Bi,this)||!r||t<=0)return!1;let i=null,n=!1;if(Si(Gi,this).has(t)){if(i=Si(Gi,this).get(t),i||(i=[],n=!0),!(i.length<Si(ki,this)))return!1;i.push(r)}else i=[],i.push(r),n=!0;return n&&Ri(Ei,this,Wi).call(this,t,i,n),!0}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;let r=e.level,i=e.bytesPerRow,n=e.size;if(r!=Si(Bi,this)||i<=0)return console.error("[GPUBufferPoolEntry] acquire() level(".concat(r,") or bpr=").concat(i," is invalid!")),null;let s=null,a=!1;if(Si(Gi,this).has(i)){let e=Si(Gi,this).get(i);if(e){const t=e.findIndex((e=>"mapped"==e.mapState&&e.size>=n));t>-1?s=e.splice(t,1)[0]:a=!0}else a=!0}else a=!0;if(a&&!s&&!t){let t=2,a=!1;r>=c[6]&&(a=!0);for(const[r,o]of Si(Gi,this))if((t>0||a)&&r>i){if(s=Ri(Ei,this,Ci).call(this,o,n),s){e.bytesPerRow=r;break}t--}}return s}recycle(e,t,r){if(e!=Si(Bi,this)||t<=0||!r)return!1;let i=!1;if(Si(Gi,this).has(t)){let e=!1,n=Si(Gi,this).get(t);n||(n=[],e=!0),n.push(r),e&&Ri(Ei,this,Wi).call(this,t,n,e),i=!0}else i=this.push(e,t,r);return i}release(e){if(3==e){for(const[e,t]of Si(Gi,this))if(t){for(const e of t)"mapped"!=e.mapState&&"unmapped"!=e.mapState||e.destroy();t.length=0}Si(Gi,this).clear()}}cleanup(){for(const[e,t]of Si(Gi,this))if(t){for(const e of t)"mapped"!=e.mapState&&"unmapped"!=e.mapState||e.destroy();t.length=0}Si(Gi,this).clear()}getPool(){return Si(Gi,this)}hasBytesPerRowAsKey(e){return Si(Gi,this).has(e)}getResourceType(){return Si(Mi,this)}getPoolThreshold(){return Si(ki,this)}canLendBufferCrossLevel(e,t){let r=!0;if(Si(Gi,this).has(t)){const i=Si(Gi,this).get(t);if(i){let t=0,n=0;for(const e of i)"mapped"==e.mapState?t+=1:n+=1;r=e>=c[6]?t>0:t>0&&0==n||t>=2&&0!=n}}else r=!1;return r}};function Oi(e,t,r){Ai(e,t),t.set(e,r)}function Ai(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Vi(e,t){return e.get(Ii(e,t))}function Li(e,t,r){return e.set(Ii(e,t),r),r}function Ii(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Ni=new WeakMap,Di=new WeakMap,zi=new WeakMap,ji=new WeakMap,qi=new WeakMap,Yi=new WeakMap,Hi=new WeakSet;function Xi(e){if(!e)return;const t=e.colorFormat;if("rgba"==t){const t=Ii(Hi,this,Ji).call(this,e.height);t>0&&t<c[6]&&(e.size=e.width*t,e.height=t),e.level=t,e.bytesPerRow=e.width}else if("i420"==t){const t=Ii(Hi,this,Ji).call(this,e.yPlane.height);t>0&&t<c[6]&&(e.size=e.yPlane.width*t+e.uvPlane.width*t,e.yPlane.height=t,e.uvPlane.height=t/2),e.level=t,e.bytesPerRow=e.yPlane.width}else if("nv12"==t){const t=Ii(Hi,this,Ji).call(this,e.yPlane.height);t>0&&t<c[6]&&(e.size=e.yPlane.width*t+e.uvPlane.width*t/2,e.yPlane.height=t,e.uvPlane.height=t/2),e.level=t,e.bytesPerRow=e.yPlane.width}}function Ji(e){if(e<=0)return 0;let t=c[6];for(let r=0;r<c.length;++r)if(e<=c[r]){t=c[r];break}return t}function Ki(e){const t=c.indexOf(e);return t>-1&&t+1<=c.length-1?c[t+1]:e}function Zi(e){if(!e)return 0;let t=0;const r=e.colorFormat;if("rgba"==r?t=e.height:"i420"!=r&&"nv12"!=r||(t=e.yPlane.height),0==t)return 0;let i=0;return i=t<=c[2]?90:t>c[2]&&t<=c[5]?60:15,i}function Qi(e){return e.mapAsync(GPUMapMode.WRITE,0,e.size)}function $i(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Vi(qi,this).set(e,t),r){let e=Array.from(Vi(qi,this).entries());_i()(e).call(e,((e,t)=>e[0]-t[0])),Vi(qi,this).clear(),e.forEach((e=>{let[t,r]=e;Vi(qi,this).set(t,r)}))}}function en(e){if(!e)return null;let t=e.level,r=e.bytesPerRow;e.size;const i=Ii(Hi,this,Ki).call(this,t);if(i<=t)return null;if(!Vi(qi,this).has(i))return null;const n=Vi(qi,this).get(i);if(!n)return null;if(!n.hasBytesPerRowAsKey(r))return null;if(!n.canLendBufferCrossLevel(t,r))return null;const s={};Object.assign(s,e),s.level=i;const a=n.acquire(s,!0);return a&&(e.level=i,e.bytesPerRow=s.bytesPerRow),a}const tn=class{constructor(e){var t;Ai(this,t=Hi),t.add(this),Oi(this,Ni,0),Oi(this,Di,{}),Oi(this,zi,null),Oi(this,ji,[]),Oi(this,qi,new Map),Oi(this,Yi,0),Li(zi,this,e)}acquire(e){if(!e)throw new Error("acquire() bufferConfig is invalid!");Ii(Hi,this,Xi).call(this,e);let t=null,r=null;if(0==Vi(qi,this).size){if(Vi(zi,this)){const i=Vi(zi,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});let n=!1;if(!r){const t=Ii(Hi,this,Zi).call(this,e);r=new Fi(e.level,t),n=!0}i&&(Li(Yi,this,Vi(Yi,this)+1),t=i,t.label="".concat(e.label,"-").concat(Vi(Yi,this))),Ii(Hi,this,$i).call(this,e.level,r,n)}}else if(Vi(qi,this).has(e.level)){r=Vi(qi,this).get(e.level);let i=!1;if(!r){const t=Ii(Hi,this,Zi).call(this,e);r=new Fi(e.level,t),i=!0}if(t=r.acquire(e),t)t.label="".concat(e.label,"-").concat(Vi(Yi,this));else if(t=Ii(Hi,this,en).call(this,e),!t)if(r.isUpToThreshold(e.level,e.bytesPerRow))console.log("[GPUBufferPool]acquire() next level cant help and pool is up to threshold! Only to wait for a while...");else{const r=Vi(zi,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});r&&(Li(Yi,this,Vi(Yi,this)+1),t=r,t.label="".concat(e.label,"-").concat(Vi(Yi,this)))}i&&Ii(Hi,this,$i).call(this,e.level,r,i)}else{let i=!1;if(t=Ii(Hi,this,en).call(this,e),t)t.label="".concat(e.label,"-").concat(Vi(Yi,this));else{const n=Vi(zi,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});if(!r){const t=Ii(Hi,this,Zi).call(this,e);r=new Fi(e.level,t),i=!0}n&&(Li(Yi,this,Vi(Yi,this)+1),t=n,t.label="".concat(e.label,"-").concat(Vi(Yi,this)))}i&&Ii(Hi,this,$i).call(this,e.level,r,i)}return t&&Vi(ji,this).push(t),t}recycle(e,r){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return;const n=Vi(ji,this).indexOf(e);if(-1!=n?Vi(ji,this).splice(n,1):(console.error("[BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(r),", needToRecycle=").concat(i)),t().tracing.add_monitor("[BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(r),", needToRecycle=").concat(i))),r)if(i){"unmapped"!=e.mapState&&e.unmap(),"unmapped"==e.mapState&&Ii(Hi,this,Qi).call(this,e).then((()=>{})).catch((t=>{console.warn("mapAsyncBuffer() error:".concat(t)),e.destroy(),e=null}));let t=Vi(qi,this).get(r.level);t&&t.recycle(r.level,r.bytesPerRow,e),e.label=""}else e.destroy(),e=null;else e.destroy()}recycleInUsedGPUBuffers(e,t){for(const[r,i]of e)for(const e of i)if(e){const r=e.getTextureBufferGroup();r&&r.buffer&&(r.bufferArray&&(r.bufferArray=null),this.recycle(r.buffer,r.bufferConfig)),e.destroyTextureBufferGroup(t)}}recycleTextureBufferGroup(e,t){if(e&&t){const r=t.acquireGPUBufferPool();if(r){const i=e.getTextureBufferGroup();i&&i.buffer&&(i.bufferArray&&(i.bufferArray=null),r.recycle(i.buffer,i.bufferConfig),e.destroyTextureBufferGroup(t))}}}cleanup(){for(const e of Vi(ji,this))"unmapped"!=e.mapState&&e.unmap(),e.destroy();Vi(ji,this).length=0;for(const[e,t]of Vi(qi,this))t&&t.cleanup();Vi(qi,this).clear()}release(e){if(3==e){for(const[t,r]of Vi(qi,this))r&&r.release(e);Vi(qi,this).clear()}}getResourceType(){return Vi(Ni,this)}collectResourceInfo(){let e=0,t=0,r="";for(const[i,n]of Vi(qi,this))if(n){const s=n.getPool();for(const[a,o]of s){e+=o.length;let s=0,u=0;for(const e of o)t+=e.size,"mapped"==e.mapState?s+=1:u+=1;r+="[GPUBufferPool] level:".concat(i," bpr:").concat(a," threshold:").concat(n.getPoolThreshold()," pool:{len:").concat(o.length," ava_count:").concat(s," pending_count:").concat(u,"}\n")}}let i=0;for(const r of Vi(ji,this))e+=1,t+=r.size,i+=1;return r+="[GPUBufferPool] in_used_count:".concat(i,"\n"),r+="[GPUBufferPool] total: count:".concat(e," usedBytes:").concat(t,"\n"),Vi(Di,this).type=Vi(Ni,this),Vi(Di,this).count=e,Vi(Di,this).usedBytes=t,Vi(Di,this).output=r,Vi(Di,this)}onOccupancyLevelEvaluated(e){t().tracing.add_monitor("WGPU GPUBufferPool_onOccupancyLevelEvaluated() level:".concat(e)),console.log("[GPUBufferPool] onOccupancyLevelEvaluated() level:".concat(e)),this.release(e)}getInUsedPoolCount(){return Vi(ji,this).length}};function rn(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function nn(e,t){return e.get(an(e,t))}function sn(e,t,r){return e.set(an(e,t),r),r}function an(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var on=new WeakMap,un=new WeakMap;const ln=class{constructor(e){rn(this,on,null),rn(this,un,null),sn(on,this,e),e&&sn(un,this,e.features)}getAdapterFeatures(){return nn(un,this)}getAdapterLimits(){return nn(on,this)?nn(on,this).limits:null}queryMaxTextureDimension2D(){const e=this.getAdapterLimits();return e?e.maxTextureDimension2D:0}queryMaxBufferSize(){const e=this.getAdapterLimits();return e?e.maxBufferSize:0}queryAdapterFeature(e){return!(!nn(un,this)||!e)&&nn(un,this).has(e)}isTimestampQuerySupported(){return this.queryAdapterFeature("timestamp-query")}getGPUAdapter(){return nn(on,this)}cleanup(){sn(on,this,null),sn(un,this,null)}};function cn(e,t,r){hn(e,t),t.set(e,r)}function hn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function fn(e,t){return e.get(pn(e,t))}function dn(e,t,r){return e.set(pn(e,t),r),r}function pn(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var gn=new WeakMap,vn=new WeakMap,yn=new WeakMap,mn=new WeakMap,xn=new WeakSet;function bn(){let e=0;const t="---WatchDog(".concat(fn(mn,this),") starts analyzing---\n");console.log("".concat(t));for(const t of fn(vn,this)){const r=t.collectResourceInfo();console.log("".concat(r.output));const i=pn(xn,this,wn).call(this,r);t.onOccupancyLevelEvaluated(i),i>e&&(e=i)}const r=pn(xn,this,_n).call(this,e);r!=fn(gn,this)&&(clearInterval(fn(yn,this)),dn(yn,this,null),dn(gn,this,r),this.monitor())}function wn(e){let t=0;return 2==e.type?t=e.usedBytes<=31457280?0:e.usedBytes<=94371840?1:e.usedBytes<=157286400?2:3:1==e.type?t=e.usedBytes<=5242880?0:e.usedBytes<=10485760?1:e.usedBytes<=15728640?2:3:0==e.type&&(t=e.usedBytes<=52428800?0:e.usedBytes<=104857600?1:e.usedBytes<=209715200?2:3),t}function _n(e){let t=0;switch(e){case 0:t=6e4;break;case 1:default:t=45e3;break;case 2:t=3e4;break;case 3:t=15e3}return t}const Pn=class{constructor(e){var t;hn(this,t=xn),t.add(this),cn(this,gn,3e4),cn(this,vn,[]),cn(this,yn,null),cn(this,mn,""),dn(mn,this,e)}addObservable(e){fn(vn,this).push(e)}removeObservable(e){const t=fn(vn,this).indexOf(e);-1!=t&&fn(vn,this).splice(t,1)}removeAllObservables(){fn(vn,this).length=0}monitor(){fn(yn,this)||dn(yn,this,setInterval((()=>{pn(xn,this,bn).call(this)}),fn(gn,this)))}cleanup(){this.removeAllObservables(),clearInterval(fn(yn,this)),dn(yn,this,null),dn(gn,this,0)}};function Tn(e,t,r){Sn(e,t),t.set(e,r)}function Sn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Un(e,t){return e.get(Mn(e,t))}function Rn(e,t,r){return e.set(Mn(e,t),r),r}function Mn(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Bn=new WeakMap,Gn=new WeakMap,kn=new WeakMap,En=new WeakMap,Wn=new WeakMap,Cn=new WeakMap,Fn=new WeakMap,On=new WeakMap,An=new WeakMap,Vn=new WeakMap,Ln=new WeakMap,In=new WeakSet;function Nn(e){return void 0!==e&&"yPlaneTex"in e}const Dn=class{constructor(){var e;Sn(this,e=In),e.add(this),Tn(this,Bn,null),Tn(this,Gn,null),Tn(this,kn,null),Tn(this,En,null),Tn(this,Wn,null),Tn(this,Cn,null),Tn(this,Fn,null),Tn(this,On,null),Tn(this,An,null),Tn(this,Vn,null),Tn(this,Ln,"")}addRendererProviderModule(e){Rn(Vn,this,e)}setLabel(e){Rn(Ln,this,e)}async initialize(){if(navigator.gpu){if(!Un(Bn,this)&&(Rn(Bn,this,await navigator.gpu.requestAdapter()),!Un(Bn,this)))return console.error("[WebGPUResManager] initialize() Couldn't request WebGPU adapter."),t().tracing.globaltracing_error("WebGPU device was lost: ".concat(info.message," reason=").concat(info.reason)),void t().graphics.create_webgl_context_failed_monitor("WebGPUDeviceLost");Un(kn,this)||(Rn(kn,this,await Un(Bn,this).requestDevice()),Un(kn,this).lost.then((async e=>{"destroyed"!=e.reason&&(console.error("WebGPU device was lost: ".concat(e.message," reason=").concat(e.reason)),t().tracing.globaltracing_error("WebGPU device was lost: ".concat(e.message," reason=").concat(e.reason)),t().graphics.create_webgl_context_failed_monitor("WebGPUDeviceLost")),Un(Vn,this)&&Un(Vn,this).rendererUnconfigureGPUContext(),this.cleanup(),"destroyed"!=e.reason&&(Rn(kn,this,null),await this.initialize(),Un(Vn,this)&&Un(Vn,this).rendererReinitialize())}))),Un(Gn,this)||("function"==typeof Un(Bn,this).requestAdapterInfo?Rn(Gn,this,await Un(Bn,this).requestAdapterInfo()):"info"in Un(Bn,this)&&Rn(Gn,this,Un(Bn,this).info)),Un(En,this)||Rn(En,this,navigator.gpu.getPreferredCanvasFormat()),Un(Wn,this)||Rn(Wn,this,new $r(Un(kn,this))),Un(Cn,this)||Rn(Cn,this,new bi(Un(kn,this))),Un(Fn,this)||Rn(Fn,this,new tn(Un(kn,this))),Un(On,this)||Rn(On,this,new ln(Un(Bn,this))),Un(An,this)||(Rn(An,this,new Pn(Un(Ln,this))),Un(An,this).addObservable(Un(Wn,this)),Un(An,this).addObservable(Un(Cn,this)),Un(An,this).addObservable(Un(Fn,this)),Un(An,this).monitor())}else console.error("[WebGPUResManager] initialize() WebGPU is not supported!")}acquireGPUDevice(){return Un(kn,this)}acquireCanvasFormat(){return Un(En,this)}acquireGPUAdapterInfo(){return Un(Gn,this)}destroyGPUDevice(){Un(kn,this)&&(Un(kn,this).destroy(),Rn(kn,this,null))}acquireGPUBufferMgr(){return Un(Wn,this)}acquireGPUTextureMgr(){return Un(Cn,this)}acquireGPUBufferPool(){return Un(Fn,this)}acquireGPUFeaturesHelper(){return Un(On,this)}cleanup(){Un(Wn,this)&&(Un(Wn,this).cleanup(),Rn(Wn,this,null)),Un(Cn,this)&&(Un(Cn,this).cleanup(),Rn(Cn,this,null)),Un(Fn,this)&&(Un(Fn,this).cleanup(),Rn(Fn,this,null)),Un(On,this)&&(Un(On,this).cleanup(),Rn(On,this,null)),Un(An,this)&&(Un(An,this).cleanup(),Rn(An,this,null)),Rn(Vn,this,null),this.destroyGPUDevice()}recycleTextureBufferGroup(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&Un(Fn,this)){const r=e.getTextureBufferGroup();r&&r.buffer&&(r.bufferArray&&(r.bufferArray=null),Un(Fn,this).recycle(r.buffer,r.bufferConfig,t),e.destroyTextureBufferGroup(this))}}recycleInUsedGPUBuffers(e){for(const[t,r]of e)for(const e of r)if(e){const t=e.getTextureBufferGroup();t&&t.buffer&&(t.bufferArray&&(t.bufferArray=null),Un(Fn,this).recycle(t.buffer,t.bufferConfig)),e.destroyTextureBufferGroup(this)}}requestTextureBuffer(e){if(!Un(Fn,this))return null;if(function(e,r){if(!e||r<0)throw new Error("isBufferSizeOverMaxSize() invalid parameters. res=".concat(e,", bufferSize=").concat(r));let i=!1,n=0;const s=e.acquireGPUFeaturesHelper();return s&&(n=s.queryMaxBufferSize(),n>0&&(i=r>n)),i&&(console.log("isBufferSizeOverMaxSize() bufferSize:".concat(r," max:").concat(n)),t().tracing.add_monitor("isBufferSizeOverMaxSize() bufferSize:".concat(r," max:").concat(n))),i}(this,e.size))return t().tracing.globaltracing_error("requestTextureBuffer() a buffer size that exceeds the max size of GPUBuffer is required.(size:".concat(e.size,")")),null;const r=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC;return e.usage=r,Un(Fn,this).acquire(e)}destroyTextureGroup(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const i=e.getTextureGroup();if(!i)return;if(!Un(Cn,this))return void t().tracing.globaltracing_error("destroyTextureGroup() mGPUTextureMgr is undefined!");const n=e.getTextureType();i&&(1==n?(Un(Cn,this).recycleTexture(i.yPlaneTex,r),Un(Cn,this).recycleTexture(i.uPlaneTex,r),i.vPlaneTex&&Un(Cn,this).recycleTexture(i.vPlaneTex,r)):2==n?Un(Cn,this).recycleTexture(i,r):Mn(In,this,Nn).call(this,i)?(Un(Cn,this).recycleTexture(i.yPlaneTex,r),Un(Cn,this).recycleTexture(i.uPlaneTex,r),i.vPlaneTex&&Un(Cn,this).recycleTexture(i.vPlaneTex,r)):Un(Cn,this).recycleTexture(i,r),e.setTextureGroup(null))}};globalThis.__dyn_modules__.webgpu_renderer_dynmod={init:function(t){e=t},exports:{createWebGPUResManager:()=>new Dn,createWebGPURenderer:(e,t)=>new Nr(e,t),createWebGPURenderDisplayMgr:()=>new It}}})()})();
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/webgpu_renderer_dynmod.min.js-c012878116c173d24825.map