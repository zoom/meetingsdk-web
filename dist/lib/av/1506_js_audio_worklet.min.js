!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e){function s(){this.a=[],this.b=0,this.residue=null}function i(){this.ssrcQueueMap=new Map,i.prototype.AddQueue=function(t){var e=new s;return this.ssrcQueueMap.set(t,e),e},i.prototype.DeleteQueue=function(t){this.ssrcQueueMap.delete(t)},i.prototype.GetQueue=function(t){return this.ssrcQueueMap.get(t)},i.prototype.GetQueueData=function(t){return this.ssrcQueueMap.get(t).dequeue()},i.prototype.PutQueueData=function(t,e){this.ssrcQueueMap.get(t).enqueue(e)},i.prototype.GetQueueLength=function(t){var e=this.ssrcQueueMap.get(t);return null!==e?e.getLength():0}}s.prototype.getLength=function(){return this.a.length-this.b},s.prototype.isEmpty=function(){return 0==this.a.length},s.prototype.enqueue=function(t){this.a.push(t)},s.prototype.dequeue=function(){if(0!=this.a.length){var t=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),t}return null},s.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0};var a=function(){function t(){this.map=new Map,this.AudioQueueMGR=new i,this.timemap=new Map}return t.prototype.Add=function(t,e){this.map.put(t,e),this.AudioQueueMGR.AddQueue(t)},t.prototype.Clear=function(){this.map.clear()},t.prototype.Keys=function(){return this.map.keys()},t.prototype.UpdateSSRCTimeMap=function(t){this.timemap=t},t.prototype.GetSSRCTimeMap=function(t){return this.timemap?this.timemap.get(t):null},t}();var r,h,u=!1,n=new a,o=10,f=!1,A=null,l=0,_=23,E=0,d=0,S=null,c=null,p=new Map,T=0;function b(t,e,s,i){if(t=0,u&&n){var a=n.AudioQueueMGR.GetQueue(t);if(a||(a=n.AudioQueueMGR.AddQueue(t)),s){var r=s.length/12,f=0,A=0;for(f=0;f<r;f++){t=0;for(A=12*f+0;A<12*f+4;A++)t+=s[A]*Math.pow(256,A-12*f);t>>=10;var l=0;for(A=12*f+4;A<12*f+12;A++)l+=s[A]*Math.pow(256,A-12*f-4);p.set(t,l)}var _=e;m(s)}else _=e;a.enqueue(_);var E=n?n.AudioQueueMGR.GetQueueLength(0):0;if(E>7)h&&h.postMessage({status:"delay"});else if(E>50)for(var d=E-o;d>=0;)g(t),d--}}function g(t){if(0,n){var e=n.AudioQueueMGR.GetQueue(0);if(e){var s=e.dequeue();return m(s),s}return null}}function m(t){if(h){var e={status:"trash",data:t};h.postMessage(e,[e.data.buffer])}}class I{constructor(t,e,s){if(this.STATE_READ_READY=0,this.STATE_READ_INDEX=1,this.STATE_WRITE_READY=2,this.STATE_WRITE_INDEX=3,this.STATE_DATA_COUNT=4,this.STATE_CACHE_SIZE=5,this.STATY_READY_NO=0,this.STATY_READY_YES=1,this.sabState=new Uint32Array(t),this.sabBuffer=new Float32Array(e),this.perFrameLength=s,this.bufferLen=this.sabBuffer.length,this.supportSpecialOptimization=this.bufferLen%s==0,this.bufferIndex=null,this.supportSpecialOptimization){let t=this.bufferLen/s;this.bufferIndex=[];for(let e=0;e<t;e++)this.bufferIndex.push(this.sabBuffer.subarray(e*s,e*s+s))}this.placeBuffer=new Float32Array(this.perFrameLength),this.QUANTUM_SIZE=128,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MIN_VALUE=6,this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE),this.setCacheSize(this.CACHE_SIZE_MIN_VALUE),this._counter=0}getCacheSize(){return Atomics.load(this.sabState,this.STATE_CACHE_SIZE)}setCacheSize(t){t>this.CACHE_SIZE_MAX_VALUE&&(t=this.CACHE_SIZE_MAX_VALUE),t<this.CACHE_SIZE_MIN_VALUE&&(t=this.CACHE_SIZE_MIN_VALUE),Atomics.store(this.sabState,this.STATE_CACHE_SIZE,t)}setQuantumSize(t){this.QUANTUM_SIZE=t,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE)}isNeedMoreData(){let t=Atomics.load(this.sabState,this.STATE_CACHE_SIZE);return Atomics.load(this.sabState,this.STATE_DATA_COUNT)<t*this.QUANTUM_SIZE}shouldAdjustCacheBuffer(){this._counter>0&&this.setCacheSize(this.getCacheSize()+1)}clear(){this.sabState&&(this.sabState[this.STATE_READ_READY]=0,this.sabState[this.STATE_READ_INDEX]=0,this.sabState[this.STATE_WRITE_READY]=0,this.sabState[this.STATE_WRITE_INDEX]=0,this.sabState[this.STATE_DATA_COUNT]=0),this._counter=0}setWriteReady(){this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES}isReady(){return this.sabState[this.STATE_WRITE_READY]&&this.sabState[this.STATE_READ_READY]}getDataCount(){return Atomics.load(this.sabState,this.STATE_DATA_COUNT)}write(t){if(t.length!==this.perFrameLength)return;let e=this.sabState[this.STATE_READ_READY];return this.sabState[this.STATE_WRITE_READY]||(this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES,this.sabState[this.STATE_WRITE_INDEX]=0),e?this.supportSpecialOptimization?this.writeSpecial(t):this.writeNormal(t):void 0}writeNormal(t){let e=this.sabState[this.STATE_WRITE_INDEX];if(this.bufferLen-e>=this.perFrameLength)this.sabBuffer.set(t,e);else{let s=t.subarray(0,this.bufferLen-e),i=t.subarray(s.length);this.sabBuffer.set(s,e),this.sabBuffer.set(i)}(e+=this.perFrameLength)>=this.bufferLen&&(e-=this.bufferLen),this.sabState[this.STATE_WRITE_INDEX]=e,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}writeSpecial(t){let e=this.sabState[this.STATE_WRITE_INDEX];this.bufferIndex[e].set(t),e=(e+1)%this.bufferIndex.length,this.sabState[this.STATE_WRITE_INDEX]=e,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}read(){let t=this.sabState[this.STATE_READ_READY],e=this.sabState[this.STATE_WRITE_READY];if(t||(this.sabState[this.STATE_READ_READY]=this.STATY_READY_YES,this.sabState[this.STATE_READ_INDEX]=0),!e)return null;let s=this.supportSpecialOptimization?this.readSpecial():this.readNormal();return null===s?this.shouldAdjustCacheBuffer():this._counter++,s}readNormal(){let t=this.sabState[this.STATE_READ_INDEX],e=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(e<this.perFrameLength)return null;if(e>this.bufferLen){let s=Math.ceil((e-this.bufferLen)/this.perFrameLength)+1;t=(s*this.perFrameLength+t)%this.bufferLen,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,s*this.perFrameLength)}let s=null;if(this.bufferLen-t>=this.perFrameLength)s=this.sabBuffer.subarray(t,t+this.perFrameLength);else{let e=this.sabBuffer.subarray(t),i=this.sabBuffer.subarray(0,this.perFrameLength-e.length);(s=this.placeBuffer).set(e),s.set(i,e.length)}return(t+=this.perFrameLength)>=this.bufferLen&&(t-=this.bufferLen),this.sabState[this.STATE_READ_INDEX]=t,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}readSpecial(){let t=this.sabState[this.STATE_READ_INDEX],e=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(e<this.perFrameLength)return null;if(e>this.bufferLen){let s=Math.ceil((e-this.bufferLen)/this.perFrameLength)+1;t=(s+t)%this.bufferIndex.length,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,s*this.perFrameLength)}let s=this.bufferIndex[t];return t=(t+1)%this.bufferIndex.length,this.sabState[this.STATE_READ_INDEX]=t,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}}const C="undefined"!=typeof SharedArrayBuffer;registerProcessor("zoomAudioWorklet",class extends AudioWorkletProcessor{static get parameterDescriptors(){return[{name:"pcm",defaultValue:1}]}constructor(){super(),this.port.onmessage=this.handleMessage.bind(this),this.sampleRate_=0,this.tenMilliSecondsLength_=0,this.g_sharedbuffer=null,this.encodeSAB=null,this.decodeSAB=null,this.aecSAB=null}handleMessage(t){var e=t.data;switch(e.status){case"data":u&&(b(e.data.ssrc,e.data.data,e.data.time),A=e.data.ssrc);break;case"stopPlayAudio":u=!1;break;case"startPlayAudio":u=!0;break;case"close":break;case"StartCaptureAudio":f=!0,E=0;break;case"CurrentSSRC":A=e.data;break;case"encodeAudioPort":r&&r.close(),r=t.ports[0];break;case"decodeAudioPort":h&&h.close(),(h=t.ports[0]).onmessage=function(t){if(u&&(b(t.data.ssrc,t.data.data,t.data.time),A=t.data.ssrc),f&&t.data.aec){var e={command:"EchoCancel",data:t.data.aec,channels:t.data.channels,sampleHz:t.data.sampleHz};r.postMessage(e,[e.data.buffer])}};break;case"decodeAudioPortWithVideo":c=t.ports[0];break;case"sampleRate":this.sampleRate_=e.data,this.sampleRate_>=8e3&&(this.tenMilliSecondsLength_=this.sampleRate_/100,d=Math.ceil(3*this.tenMilliSecondsLength_/128),S=new Float32Array(128*d));break;case"sharedBuffer":if(C){const t=e.data;this.g_sharedbuffer=t,this.g_sharedbuffer&&(this.encodeSAB=new I(this.g_sharedbuffer.inputState,this.g_sharedbuffer.inputBuffer,128),this.decodeSAB=new I(this.g_sharedbuffer.outputState,this.g_sharedbuffer.outputBuffer,128),this.aecSAB=new I(this.g_sharedbuffer.aecState,this.g_sharedbuffer.aecBuffer,128))}}}process(t,e,s){if(C&&this.g_sharedbuffer)return this.SABProcess(t,e,s);let i=t[0],a=e[0];if(!this.sampleRate_||!a[0])return!0;if(function(t,e,s,i){if(n){var a=n.AudioQueueMGR.GetQueue(0),r=null;if(a){if(a.residue){let t=a.residue.length-T;if(t>s)return i.set(a.residue.subarray(T,T+s),i.length-s),void(T+=s);if(t===s)return i.set(a.residue.subarray(T,T+s),i.length-s),m(a.residue),a.residue=null,void(T=0);r=a.residue,i.set(a.residue.subarray(T,r.length),i.length-s),m(a.residue),a.residue=null,T=0,s-=t}for(var h=a.dequeue();h&&h.length<s;)i.set(h,i.length-s),m(h),s-=h.length,h=a.dequeue();if(h){if(h.length===s)return i.set(h,i.length-s),T=0,void m(h);h.length>s&&(i.set(h.subarray(0,s),i.length-s),a.residue=h,T=s)}}}}(0,0,a[0].length,a[0]),i[0]&&f&&(S.set(i[0],128*E),++E==d&&(E=0,r.postMessage({command:"EncodeAudioFrame",data:S}))),A&&++l==_){l=0;var h=function(t){if(t>>=10,n){var e=p.get(t);return e?(p.set(t,0),e):0}}(A);h&&(c?c.postMessage({data:h}):this.port.postMessage({status:"InstantAudioTime",data:h}))}for(let t=1;t<a.length;++t)a[t].set(a[0]);return!0}inputData(t){if(!this.encodeSAB)return!0;this.encodeSAB.write(t[0][0])}outputData(t){if(!this.decodeSAB)return!0;let e=this.decodeSAB.read();if(null===e)return!0;for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)t[s][i].set(e)}SABProcess(t,e,s){let i=t[0],a=e[0];return!(this.g_sharedbuffer&&this.sampleRate_&&a[0]&&(i[0]&&f&&this.inputData(t),this.outputData(e),this.aecSAB&&e&&e[0]&&e[0][0]&&this.aecSAB.write(e[0][0]),0))}})}]);