!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ZoomTPModule",[],t):"object"==typeof exports?exports.ZoomTPModule=t():e.ZoomTPModule=t()}(self,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r,o,s,i,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isEnableTP=t.ZoomTPWebSocket=t.initWorker=t.initTPModule=t.setCmd=t.tpLogger=void 0;const u=c(n(3)),l=n(4),d=n(6),f=n(7);let h,p,g={},_=!1,m=0;t.setCmd=function(e){p=e};const y=null===(i=null===(s=null===(o=null===(r=null===self||void 0===self?void 0:self.document)||void 0===r?void 0:r.currentScript)||void 0===o?void 0:o.src)||void 0===s?void 0:s.replace)||void 0===i?void 0:i.call(s,"tp.min.js","tp.wasm");function w(){return a(this,void 0,void 0,(function*(){return h||(h=new Promise((e,n)=>a(this,void 0,void 0,(function*(){const n=new u.default;n.addEventListener("error",e=>{null===t.tpLogger||void 0===t.tpLogger||(0,t.tpLogger)("directReport","tp worker error "+(null==e?void 0:e.message)),_=!0,p&&p.socketError("tp worker error "+(null==e?void 0:e.message))}),n.addEventListener("message",r=>{"inited"===r.data.type?e(n):"fallback"===r.data.type?(_=!0,e(null)):"log"===r.data.type?null===t.tpLogger||void 0===t.tpLogger||(0,t.tpLogger)(r.data.level,r.data.message):"heartbeat"===r.data.type&&(m&&clearTimeout(m),!_&&b(null==g?void 0:g.options)&&(m=self.setTimeout(()=>{var e;const n="tp worker no-heartbeat visibility:"+(null===(e=self.document)||void 0===e?void 0:e.visibilityState);null===t.tpLogger||void 0===t.tpLogger||(0,t.tpLogger)("directReport",n),_=!0,p&&p.socketError(n)},2e4)))}),n.postMessage({type:"init",wasmUrl:g.wasmUrl||y})})))),h}))}t.initTPModule=function(e){return a(this,void 0,void 0,(function*(){return g=e||{},"function"!=typeof importScripts?(t.tpLogger=(0,f.logger)(g.logInstance),w().then(e=>{e&&(l.TPSocket.target=e)})):new Promise((e,n)=>{t.tpLogger=(e,t)=>{postMessage({type:"log",level:e,message:t})},self.addEventListener("message",t=>{"boolean"==typeof t.data.fallback&&(_=t.data.fallback,_&&n()),"init_tp_port"===t.data.type?(l.TPSocket.target=t.data.port,g={options:t.data.options},self.portInited=!0,e()):"init_worker"!==t.data.type||self.portInited||(self.postMessage("init_tp"),g={options:t.data.options})}),self.postMessage("init_tp")})}))},t.initWorker=function(e,n){return a(this,void 0,void 0,(function*(){const r=yield w();if(!r)return;r.addEventListener("error",t=>{t.message&&t.message.includes("RuntimeError:")&&e.postMessage({type:"error",fallback:!0})});let o=!1;e.addEventListener("message",s=>{if("init_tp"!==s.data||o)"log"===s.data.type&&(null===t.tpLogger||void 0===t.tpLogger||(0,t.tpLogger)(s.data.level,s.data.message));else{const{port1:t,port2:s}=new MessageChannel;e.postMessage({type:"init_tp_port",port:t,fallback:_,options:(n||g).options},[t]),r.postMessage({type:"add_port",port:s},[s]),o=!0}}),e.postMessage({type:"init_worker",fallback:_,options:(n||g).options})}))};class v{constructor(e,t){if(!e)throw new Error("Failed to construct ZoomTPWebSocket, the url is required.");const n="string"==typeof e?new URL(e):e;return!_&&(0,d.isRlb)(n,g.options)?new l.TPSocket(n):new WebSocket(n,t)}}function b(e){return(0,d.getOption)(e,47,1)}t.ZoomTPWebSocket=v,Object.setPrototypeOf(v.prototype,WebSocket.prototype),t.isEnableTP=b},function(e,t,n){"use strict";function r(e){const t=new URLSearchParams(e.search);return e.hostname.includes("rwg")&&(t.has("dn2")||t.has("islch"))}function o(e){return e.pathname.includes("/wc/media")&&e.hostname.includes("rwg")&&"m"===e.searchParams.get("type")}function s(e){return e.pathname.includes("/wc/media")&&e.hostname.includes("rwg")&&"x"===e.searchParams.get("type")}function i(e){return e.pathname.includes("/wc/media")&&e.hostname.includes("rwg")&&"v"===e.searchParams.get("type")&&"16"===e.searchParams.get("mode")}function a(e){return e.pathname.includes("/ab/signal")&&e.hostname.includes("rwg")&&e.searchParams.get("rwg")===e.hostname}var c;Object.defineProperty(t,"__esModule",{value:!0}),t.URL_TYPE=t.getUrlType=t.isAudioBridge=t.isVideoBridge=t.isXmpp=t.isBoMaster=t.isRwg=void 0,t.isRwg=r,t.isBoMaster=o,t.isXmpp=s,t.isVideoBridge=i,t.isAudioBridge=a,t.getUrlType=function(e){const t="string"==typeof e?new URL(e):e;return r(t)?c.RWG:o(t)?c.BO_MASTER:s(t)?c.XMPP:i(t)?c.VIDEO_BRIDGE:a(t)?c.AUDIO_BRIDGE:c.UNKNOWN},function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.RWG=1]="RWG",e[e.BO_MASTER=2]="BO_MASTER",e[e.XMPP=3]="XMPP",e[e.VIDEO_BRIDGE=4]="VIDEO_BRIDGE",e[e.AUDIO_BRIDGE=5]="AUDIO_BRIDGE"}(c||(t.URL_TYPE=c={}))},function(e,t,n){"use strict";e.exports=function(e,t,n,r){var o=self||window;try{try{var s;try{s=new o.Blob([e])}catch(t){(s=new(o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder)).append(e),s=s.getBlob()}var i=o.URL||o.webkitURL,a=i.createObjectURL(s),c=new o[t](a,n);return i.revokeObjectURL(a),c}catch(r){return new o[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new o[t](r,n)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n(2),o=n.n(r);function s(){return o()('!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Monitor=void 0;class r{static setConnection(e){this.connection=e}static setLogger(e){this.logger=e}static setConnectionError(e){this.connectionError=!0}static addMonitor(e,t){var n;this.timeBase||(this.timeBase=Date.now(),this.cache.push(`STARTTPMONITOR${this.timeBase}(0)`)),this.cache.push(`${e}(${Math.ceil(Date.now()-this.timeBase)})`),t&&(null===(n=this.logger)||void 0===n||n.call(this,e))}static transform(e){return"WCL_M,TP;"+e.replace(/,/g,"-")}static sendMonitor(e){if(this.connection){const t={evt:4167,seq:1,body:{data:this.transform(e)}};this.connection.send(JSON.stringify(t))}this.logger&&this.connectionError&&this.logger(e)}static startMonitor(){setInterval(()=>{this.cache.length>0&&(this.connection||this.logger&&this.connectionError)&&(this.sendMonitor(this.cache.join("")),this.cache=[])},1e4)}}t.Monitor=r,r.cache=[],r.connectionError=!1,r.timeBase=0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionManager=void 0;class r{static setHelperConnectionMap(e,t){this.helperConnectionMap.set(e,t)}static setIdConnectionMap(e,t){this.idConnectionMap.set(e,t)}static setHandlerIdMap(e,t){this.handlerIdMap.set(e,t)}static getById(e){return this.idConnectionMap.get(e)}static getByHandler(e){return this.getById(this.handlerIdMap.get(e))}static getByHelper(e){return this.helperConnectionMap.get(e)}static removeHelperConnectionMap(e){this.helperConnectionMap.delete(e)}static removeIdConnectionMap(e){this.idConnectionMap.delete(e)}static removeHandlerIdMap(e){this.handlerIdMap.delete(e)}}t.ConnectionManager=r,r.idConnectionMap=new Map,r.handlerIdMap=new Map,r.helperConnectionMap=new Map},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=o(n(3)),a=n(4),c=n(1);n(7);var u,l;function h(e,t){}function d(e,t){postMessage({type:"log",level:e,message:t})}function f(e){return r(this,void 0,void 0,(function*(){s.Monitor.setLogger(e=>d("directReport",e)),s.Monitor.startMonitor(),u=yield(0,i.default)({instantiateWasm:(t,n)=>r(this,void 0,void 0,(function*(){const o=e;let s;try{s=yield function(e,t=3,n=1e3){return r(this,void 0,void 0,(function*(){for(let r=0;r<t;r++)try{const t=yield fetch(e,{credentials:"same-origin"});return t.ok||d("directReport","load tp.wasm fail : "+t.statusText),yield t.arrayBuffer()}catch(e){if(d("directReport",`load tp.wasm retry (${r+1}/${t}) : ${e.message}`),r===t-1)throw e;yield new Promise(e=>setTimeout(e,n))}}))}(o)}catch(e){return d("directReport","fetch tp wasm error"),void postMessage({type:"fallback"})}const{instance:i,module:a}=yield WebAssembly.instantiate(s,t);return n(i),i.exports}))}).catch(()=>{d("directReport","init tp wasm error"),postMessage({type:"fallback"})}),(l={create_wcl_tp_handler:u.cwrap("create_wcl_tp_handler","number",[]),init_tp_worker:u.cwrap("init_tp_worker","",[]),destroy_wcl_tp_handler:u.cwrap("destroy_wcl_tp_handler","",["number"]),wcl_tp_handler_connect:u.cwrap("wcl_tp_handler_connect","",["number","number"]),wcl_tp_handler_close:u.cwrap("wcl_tp_handler_close","",["number"]),wcl_tp_handler_send:u.cwrap("wcl_tp_handler_send","",["number","array","number"]),wcl_tp_helper_on_connect:u.cwrap("wcl_tp_helper_on_connect","",["number"]),wcl_tp_helper_on_close:u.cwrap("wcl_tp_helper_on_close","",["number"]),wcl_tp_helper_on_message:u.cwrap("wcl_tp_helper_on_message","",["number","array","number"]),thread_run:u.cwrap("thread_run","",[])}).init_tp_worker();let t=0;setInterval(()=>{l.thread_run(),t++,t>300&&(postMessage({type:"heartbeat"}),t=0)},10),postMessage({type:"inited"})}))}self.addEventListener("unhandledrejection",e=>{d("error",e.error||e.reason)}),self.addEventListener("error",e=>{d("error",e.error||e.reason),s.Monitor.setConnectionError(!0),s.Monitor.addMonitor("TPERR,2",!0),postMessage({type:"fallback"})}),self.addEventListener("message",e=>{let t=e.data;switch(t.type){case"init":f(t.wasmUrl).catch(()=>{s.Monitor.setConnectionError(!0),s.Monitor.addMonitor("TPERR,1",!0),postMessage({type:"fallback"})});break;case"connect":new a.Connection(t.id,t.url,u,l,self,d,"");break;case"add_port":t.port.addEventListener("message",e=>{"connect"===e.data.type&&new a.Connection(e.data.id,e.data.url,u,l,t.port,d,"")}),t.port.start()}}),self.js_wss_connect=function(e,t){var n;null===(n=c.ConnectionManager.getById(t))||void 0===n||n.js_wss_connect(e)},self.js_wss_send=function(e,t,n){var r;null===(r=c.ConnectionManager.getByHelper(e))||void 0===r||r.js_wss_send(t,n)},self.js_wss_close=function(e){var t;null===(t=c.ConnectionManager.getByHelper(e))||void 0===t||t.js_wss_close()},self.js_app_on_message=function(e,t,n){var r;null===(r=c.ConnectionManager.getByHandler(e))||void 0===r||r.js_app_on_message(t,n)},self.js_helper_destoryed=function(e){var t;null===(t=c.ConnectionManager.getByHelper(e))||void 0===t||t.js_helper_destoryed()},self.js_app_on_connect=function(e,t){var n;null===(n=c.ConnectionManager.getByHandler(e))||void 0===n||n.js_app_on_connect(t)},self.js_app_on_close=function(e,t){var n;null===(n=c.ConnectionManager.getByHandler(e))||void 0===n||n.js_app_on_close(t)},self.on_socket_monitor=function(e,t,n){const r=new TextDecoder("utf-8"),o=new Uint8Array(u.HEAP8.buffer,t,n);const i="PORT,"+e+","+r.decode(o);s.Monitor.addMonitor(i)},self.wasm_memory_alert=function(e,t){const n="TPMEMALERT,"+e+","+t;s.Monitor.addMonitor(n,!0)},self.wcl_trace_log=h,self.LOG_OUT=h},function(e,t,n){"use strict";n.r(t);var r,o=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n;(e=void 0!==(e=e||{})?e:{}).ready=new Promise((function(e,r){t=e,n=r}));var o,s=Object.assign({},e),i=[],a="./this.program",c="";c=self.location.href,r&&(c=r),c=0!==c.indexOf("blob:")?c.substr(0,c.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)};var u,l,h=e.print||console.log.bind(console),d=e.printErr||console.warn.bind(console);Object.assign(e,s),s=null,e.arguments&&(i=e.arguments),e.thisProgram&&(a=e.thisProgram),e.quit&&e.quit,e.wasmBinary&&(u=e.wasmBinary),e.noExitRuntime,"object"!=typeof WebAssembly&&L("no native wasm support detected");var f=!1;function p(e,t){e||L(t)}var _,g,m,y,v,w,M,b,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function P(e,t,n){for(var r=t+n,o=t;e[o]&&!(o>=r);)++o;if(o-t>16&&e.buffer&&C)return C.decode(e.subarray(t,o));for(var s="";t<o;){var i=e[t++];if(128&i){var a=63&e[t++];if(192!=(224&i)){var c=63&e[t++];if((i=224==(240&i)?(15&i)<<12|a<<6|c:(7&i)<<18|a<<12|c<<6|63&e[t++])<65536)s+=String.fromCharCode(i);else{var u=i-65536;s+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else s+=String.fromCharCode((31&i)<<6|a)}else s+=String.fromCharCode(i)}return s}function k(e,t){return e?P(m,e,t):""}function E(e,t,n,r){if(!(r>0))return 0;for(var o=n,s=n+r-1,i=0;i<e.length;++i){var a=e.charCodeAt(i);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i)),a<=127){if(n>=s)break;t[n++]=a}else if(a<=2047){if(n+1>=s)break;t[n++]=192|a>>6,t[n++]=128|63&a}else if(a<=65535){if(n+2>=s)break;t[n++]=224|a>>12,t[n++]=128|a>>6&63,t[n++]=128|63&a}else{if(n+3>=s)break;t[n++]=240|a>>18,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}}return t[n]=0,n-o}function I(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++n):t+=3}return t}function S(t){_=t,e.HEAP8=g=new Int8Array(t),e.HEAP16=y=new Int16Array(t),e.HEAP32=w=new Int32Array(t),e.HEAPU8=m=new Uint8Array(t),e.HEAPU16=v=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=b=new Float64Array(t)}var T=e.INITIAL_MEMORY||20971520;(l=e.wasmMemory?e.wasmMemory:new WebAssembly.Memory({initial:T/65536,maximum:2048}))&&(_=l.buffer),T=_.byteLength,S(_);var A,O,R=[],x=[],D=[],U=0,j=null,W=null;function L(t){e.onAbort&&e.onAbort(t),d(t="Aborted("+t+")"),f=!0,t+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(t);throw n(r),r}function B(e){return e.startsWith("data:application/octet-stream;base64,")}function F(e){try{if(e==A&&u)return new Uint8Array(u);if(o)return o(e);throw"both async and sync fetching of the wasm failed"}catch(e){L(e)}}B(A="tp.wasm")||(O=A,A=e.locateFile?e.locateFile(O,c):c+O);var H={101252:e=>{js_helper_destoryed(e)},101281:(e,t)=>{js_wss_connect(e,t)},101309:(e,t,n)=>{js_wss_send(e,t,n)},101338:e=>{js_wss_close(e)},101360:(e,t,n)=>{js_app_on_message(e,t,n)},101395:(e,t)=>{js_app_on_connect(e,t)},101426:(e,t)=>{js_app_on_close(e,t)},101455:(e,t,n)=>{on_socket_monitor(e,t,n)},101490:(e,t)=>{LOG_OUT(e,t)},101511:(e,t)=>{wcl_trace_log(e,t)}};function Y(t){for(;t.length>0;)t.shift()(e)}function N(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){M[this.ptr+4>>2]=e},this.get_type=function(){return M[this.ptr+4>>2]},this.set_destructor=function(e){M[this.ptr+8>>2]=e},this.get_destructor=function(){return M[this.ptr+8>>2]},this.set_refcount=function(e){w[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,g[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=g[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,g[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=g[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=w[this.ptr>>2];w[this.ptr>>2]=e+1},this.release_ref=function(){var e=w[this.ptr>>2];return w[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){M[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return M[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Ae(this.get_type()))return M[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function G(){d("missing function: $SOCKFS"),L(-1)}function z(){d("missing function: $FS"),L(-1)}function $(e){var t=G.getSocket(e);if(!t)throw new z.ErrnoError(8);return t}function V(e){for(var t=e.split("."),n=0;n<4;n++){var r=Number(t[n]);if(isNaN(r))return null;t[n]=r}return(t[0]|t[1]<<8|t[2]<<16|t[3]<<24)>>>0}function X(e){return parseInt(e)}function K(e){var t,n,r,o,s=[];if(!/^((?=.*::)(?!.*::.+::)(::)?([\\dA-F]{1,4}:(:|\\b)|){5}|([\\dA-F]{1,4}:){6})((([\\dA-F]{1,4}((?!\\3)::|:\\b|$))|(?!\\2\\3)){2}|(((2[0-4]|1\\d|[1-9])?\\d|25[0-5])\\.?\\b){4})$/i.test(e))return null;if("::"===e)return[0,0,0,0,0,0,0,0];for((e=e.startsWith("::")?e.replace("::","Z:"):e.replace("::",":Z:")).indexOf(".")>0?((t=(e=e.replace(new RegExp("[.]","g"),":")).split(":"))[t.length-4]=X(t[t.length-4])+256*X(t[t.length-3]),t[t.length-3]=X(t[t.length-2])+256*X(t[t.length-1]),t=t.slice(0,t.length-2)):t=e.split(":"),r=0,o=0,n=0;n<t.length;n++)if("string"==typeof t[n])if("Z"===t[n]){for(o=0;o<8-t.length+1;o++)s[n+o]=0;r=o-1}else s[n+r]=ke(parseInt(t[n],16));else s[n+r]=t[n];return[s[1]<<16|s[0],s[3]<<16|s[2],s[5]<<16|s[4],s[7]<<16|s[6]]}function Z(e,t){return m.fill(0,e,e+t),e}function q(e,t,n,r,o){switch(t){case 2:n=V(n),Z(e,16),o&&(w[o>>2]=16),y[e>>1]=t,w[e+4>>2]=n,y[e+2>>1]=ke(r);break;case 10:n=K(n),Z(e,28),o&&(w[o>>2]=28),w[e>>2]=t,w[e+8>>2]=n[0],w[e+12>>2]=n[1],w[e+16>>2]=n[2],w[e+20>>2]=n[3],y[e+2>>1]=ke(r);break;default:return 5}return 0}var J={address_map:{id:1,addrs:{},names:{}},lookup_name:function(e){var t,n=V(e);if(null!==n)return e;if(null!==(n=K(e)))return e;if(J.address_map.addrs[e])t=J.address_map.addrs[e];else{var r=J.address_map.id++;p(r<65535,"exceeded max address mappings of 65535"),t="172.29."+(255&r)+"."+(65280&r),J.address_map.names[t]=e,J.address_map.addrs[e]=t}return t},lookup_addr:function(e){return J.address_map.names[e]?J.address_map.names[e]:null}},Q={varargs:void 0,get:function(){return Q.varargs+=4,w[Q.varargs-4>>2]},getStr:function(e){return k(e)}};function ee(e){return(255&e)+"."+(e>>8&255)+"."+(e>>16&255)+"."+(e>>24&255)}function te(e){var t="",n=0,r=0,o=0,s=0,i=0,a=0,c=[65535&e[0],e[0]>>16,65535&e[1],e[1]>>16,65535&e[2],e[2]>>16,65535&e[3],e[3]>>16],u=!0,l="";for(a=0;a<5;a++)if(0!==c[a]){u=!1;break}if(u){if(l=ee(c[6]|c[7]<<16),-1===c[5])return t="::ffff:",t+=l;if(0===c[5])return t="::","0.0.0.0"===l&&(l=""),"0.0.0.1"===l&&(l="1"),t+=l}for(n=0;n<8;n++)0===c[n]&&(n-o>1&&(i=0),o=n,i++),i>r&&(s=n-(r=i)+1);for(n=0;n<8;n++)r>1&&0===c[n]&&n>=s&&n<s+r?n===s&&(t+=":",0===s&&(t+=":")):(t+=Number(Ce(65535&c[n])).toString(16),t+=n<7?":":"");return t}function ne(e,t){var n,r=y[e>>1],o=Ce(v[e+2>>1]);switch(r){case 2:if(16!==t)return{errno:28};n=ee(n=w[e+4>>2]);break;case 10:if(28!==t)return{errno:28};n=te(n=[w[e+8>>2],w[e+12>>2],w[e+16>>2],w[e+20>>2]]);break;default:return{errno:5}}return{family:r,addr:n,port:o}}function re(e){return M[e>>2]+4294967296*w[e+4>>2]}function oe(e){return e%4==0&&(e%100!=0||e%400==0)}var se=[0,31,60,91,121,152,182,213,244,274,305,335],ie=[0,31,59,90,120,151,181,212,243,273,304,334];function ae(e){var t=I(e)+1,n=Ee(t);return n&&E(e,g,n,t),n}var ce=[];function ue(e,t,n){var r=function(e,t){var n;for(ce.length=0,t>>=2;n=m[e++];)t+=105!=n&t,ce.push(105==n?w[t]:b[t++>>1]),++t;return ce}(t,n);return H[e].apply(null,r)}function le(e){try{return l.grow(e-_.byteLength+65535>>>16),S(l.buffer),1}catch(e){}}var he={};function de(){if(!de.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:a||"./this.program"};for(var t in he)void 0===he[t]?delete e[t]:e[t]=he[t];var n=[];for(var t in e)n.push(t+"="+e[t]);de.strings=n}return de.strings}var fe=[null,[],[]];function pe(e,t){var n=fe[e];0===t||10===t?((1===e?h:d)(P(n,0)),n.length=0):n.push(t)}var _e=[31,29,31,30,31,30,31,31,30,31,30,31],ge=[31,28,31,30,31,30,31,31,30,31,30,31];function me(e,t){g.set(e,t)}function ye(e,t,n,r){var o=w[r+40>>2],s={tm_sec:w[r>>2],tm_min:w[r+4>>2],tm_hour:w[r+8>>2],tm_mday:w[r+12>>2],tm_mon:w[r+16>>2],tm_year:w[r+20>>2],tm_wday:w[r+24>>2],tm_yday:w[r+28>>2],tm_isdst:w[r+32>>2],tm_gmtoff:w[r+36>>2],tm_zone:o?k(o):""},i=k(n),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var c in a)i=i.replace(new RegExp(c,"g"),a[c]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(e,t,n){for(var r="number"==typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function d(e,t){return h(e,t,"0")}function f(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function _(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var r=oe(n.getFullYear()),o=n.getMonth(),s=(r?_e:ge)[o];if(!(t>s-n.getDate()))return n.setDate(n.getDate()+t),n;t-=s-n.getDate()+1,n.setDate(1),o<11?n.setMonth(o+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),o=p(n),s=p(r);return f(o,t)<=0?f(s,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return l[e.tm_mon].substring(0,3)},"%B":function(e){return l[e.tm_mon]},"%C":function(e){return d((e.tm_year+1900)/100|0,2)},"%d":function(e){return d(e.tm_mday,2)},"%e":function(e){return h(e.tm_mday,2," ")},"%g":function(e){return _(e).toString().substring(2)},"%G":function(e){return _(e)},"%H":function(e){return d(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),d(t,2)},"%j":function(e){return d(e.tm_mday+function(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}(oe(e.tm_year+1900)?_e:ge,e.tm_mon-1),3)},"%m":function(e){return d(e.tm_mon+1,2)},"%M":function(e){return d(e.tm_min,2)},"%n":function(){return"\\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return d(e.tm_sec,2)},"%t":function(){return"\\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return d(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&oe(e.tm_year)||(t=1)}}else{t=52;var r=(e.tm_wday+7-e.tm_yday-1)%7;(4==r||5==r&&oe(e.tm_year%400-1))&&t++}return d(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return d(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var c in i=i.replace(/%%/g,"\\0\\0"),g)i.includes(c)&&(i=i.replace(new RegExp(c,"g"),g[c](s)));i=i.replace(/\\0\\0/g,"%");var m,y,v,M,b,C,P=(m=i,y=!1,M=v>0?v:I(m)+1,b=new Array(M),C=E(m,b,0,b.length),y&&(b.length=C),b);return P.length>t?0:(me(P,e),P.length-1)}function ve(t){return e["_"+t]}function we(e,t,n,r,o){var s={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function(e,t,n){E(e,m,t,n)}(e,t=Te(n),n)}return t},array:e=>{var t=Te(e.length);return me(e,t),t}},i=ve(e),a=[],c=0;if(r)for(var u=0;u<r.length;u++){var l=s[n[u]];l?(0===c&&(c=Ie()),a[u]=l(r[u])):a[u]=r[u]}var h=i.apply(null,a);return h=function(e){return 0!==c&&Se(c),function(e){return"string"===t?k(e):"boolean"===t?Boolean(e):e}(e)}(h)}var Me,be={i:function(e){return Ee(e+24)+24},h:function(e,t,n){throw new N(e).init(t,n),e},K:function(e,t,n,r){var o=$(e),s=o.sock_ops.accept(o);return t&&q(t,s.family,J.lookup_name(s.daddr),s.dport,n),s.stream.fd},J:function(e,t,n){var r=$(e),o=function(e,t,n){if(n&&0===e)return null;var r=ne(e,t);if(r.errno)throw new z.ErrnoError(r.errno);return r.addr=J.lookup_addr(r.addr)||r.addr,r}(t,n);return r.sock_ops.bind(r,o.addr,o.port),0},b:function(e,t,n){return Q.varargs=n,0},I:function(e,t){},H:function(e,t,n){d("__syscall_getsockname "+e);var r=$(e);return q(t,r.family,J.lookup_name(r.saddr||"0.0.0.0"),r.sport,n),0},G:function(e,t,n,r,o){var s=$(e);return 1===t&&4===n?(w[r>>2]=s.error,w[o>>2]=4,s.error=null,0):-50},n:function(e,t,n){return Q.varargs=n,0},F:function(e,t){var n=$(e);return n.sock_ops.listen(n,t),0},E:function(e,t,n){},m:function(e,t,n,r){Q.varargs=r},D:function(e){},C:function(e,t,n){},B:function(e,t,n,r,o,s){var i=$(e),a=i.sock_ops.recvmsg(i,n);return a?(o&&q(o,i.family,J.lookup_name(a.addr),a.port,s),m.set(a.buffer,t),a.buffer.byteLength):0},A:function(e,t,n){var r,o,s=$(e),i=M[t+8>>2],a=w[t+12>>2],c=M[t>>2],u=w[t+4>>2];if(c){var l=ne(c,u);if(l.errno)return-l.errno;o=l.port,r=J.lookup_addr(l.addr)||l.addr}for(var h=0,d=0;d<a;d++)h+=w[i+(8*d+4)>>2];var f=new Uint8Array(h),p=0;for(d=0;d<a;d++)for(var _=M[i+(8*d+0)>>2],m=w[i+(8*d+4)>>2],y=0;y<m;y++)f[p++]=g[_+y>>0];return s.sock_ops.sendmsg(s,f,0,h,r,o)},l:function(e,t,n){},x:function(){return!0},w:function(e,t){var n=new Date(1e3*re(e));w[t>>2]=n.getUTCSeconds(),w[t+4>>2]=n.getUTCMinutes(),w[t+8>>2]=n.getUTCHours(),w[t+12>>2]=n.getUTCDate(),w[t+16>>2]=n.getUTCMonth(),w[t+20>>2]=n.getUTCFullYear()-1900,w[t+24>>2]=n.getUTCDay();var r=Date.UTC(n.getUTCFullYear(),0,1,0,0,0,0),o=(n.getTime()-r)/864e5|0;w[t+28>>2]=o},v:function(e,t){var n=new Date(1e3*re(e));w[t>>2]=n.getSeconds(),w[t+4>>2]=n.getMinutes(),w[t+8>>2]=n.getHours(),w[t+12>>2]=n.getDate(),w[t+16>>2]=n.getMonth(),w[t+20>>2]=n.getFullYear()-1900,w[t+24>>2]=n.getDay();var r=0|function(e){return(oe(e.getFullYear())?se:ie)[e.getMonth()]+e.getDate()-1}(n);w[t+28>>2]=r,w[t+36>>2]=-60*n.getTimezoneOffset();var o=new Date(n.getFullYear(),0,1),s=new Date(n.getFullYear(),6,1).getTimezoneOffset(),i=o.getTimezoneOffset(),a=0|(s!=i&&n.getTimezoneOffset()==Math.min(i,s));w[t+32>>2]=a},u:function(e,t,n){var r=(new Date).getFullYear(),o=new Date(r,0,1),s=new Date(r,6,1),i=o.getTimezoneOffset(),a=s.getTimezoneOffset(),c=Math.max(i,a);function u(e){var t=e.toTimeString().match(/\\(([A-Za-z ]+)\\)$/);return t?t[1]:"GMT"}M[e>>2]=60*c,w[t>>2]=Number(i!=a);var l=u(o),h=u(s),d=ae(l),f=ae(h);a<i?(M[n>>2]=d,M[n+4>>2]=f):(M[n>>2]=f,M[n+4>>2]=d)},j:function(){L("")},c:function(e,t,n){return ue(e,t,n)},f:function(){return Date.now()},t:function(e,t,n){m.copyWithin(e,t,t+n)},s:function(e){var t,n,r=m.length;if((e>>>=0)>134217728)return self.wasm_memory_alert(e,134217728),!1;for(var o=1;o<=4;o*=2){var s=r*(1+.2/o);if(s=Math.min(s,e+100663296),le(Math.min(134217728,(t=Math.max(e,s))+((n=65536)-t%n)%n)))return!0}return!1},z:function(e,t){var n=0;return de().forEach((function(r,o){var s=t+n;M[e+4*o>>2]=s,function(e,t,n){for(var r=0;r<e.length;++r)g[t++>>0]=e.charCodeAt(r);n||(g[t>>0]=0)}(r,s),n+=r.length+1})),0},y:function(e,t){var n=de();M[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),M[t>>2]=r,0},e:function(e){return 52},k:function(e,t,n,r){return 52},q:function(e,t,n,r,o){return 70},g:function(e,t,n,r){for(var o=0,s=0;s<n;s++){var i=M[t>>2],a=M[t+4>>2];t+=8;for(var c=0;c<a;c++)pe(e,m[i+c]);o+=a}return M[r>>2]=o,0},r:function(e,t,n,r){var o,s=0,i=0,a=0,c=0,u=0,l=0;function h(e,t,n,r,o,s){var i,a,c;return a=10===e?28:16,o=10===e?te(o):ee(o),p(!q(i=Ee(a),e,o,s)),c=Ee(32),w[c+4>>2]=e,w[c+8>>2]=t,w[c+12>>2]=n,w[c+24>>2]=r,M[c+20>>2]=i,w[c+16>>2]=10===e?28:16,w[c+28>>2]=0,c}if(n&&(a=w[n>>2],c=w[n+4>>2],u=w[n+8>>2],l=w[n+12>>2]),u&&!l&&(l=2===u?17:6),!u&&l&&(u=17===l?2:1),0===l&&(l=6),0===u&&(u=1),!e&&!t)return-2;if(-1088&a)return-1;if(0!==n&&2&w[n>>2]&&!e)return-1;if(32&a)return-2;if(0!==u&&1!==u&&2!==u)return-7;if(0!==c&&2!==c&&10!==c)return-6;if(t&&(t=k(t),i=parseInt(t,10),isNaN(i)))return 1024&a?-2:-8;if(!e)return 0===c&&(c=2),0==(1&a)&&(s=2===c?Pe(2130706433):[0,0,0,1]),o=h(c,u,l,null,s,i),M[r>>2]=o,0;if(null!==(s=V(e=k(e))))if(0===c||2===c)c=2;else{if(!(10===c&&8&a))return-2;s=[0,0,Pe(65535),s],c=10}else if(null!==(s=K(e))){if(0!==c&&10!==c)return-2;c=10}return null!=s?(o=h(c,u,l,e,s,i),M[r>>2]=o,0):4&a?-2:(s=V(e=J.lookup_name(e)),0===c?c=2:10===c&&(s=[0,0,Pe(65535),s]),o=h(c,u,l,null,s,i),M[r>>2]=o,0)},a:l,p:ye,o:function(e,t,n,r,o){return ye(e,t,n,r)},d:function(e){var t=null;if(!t){t=new Array(16);for(var n=(new Date).getTime(),r=0;r<16;r++){var o=(n+256*Math.random())%256|0;n=n/256|0,t[r]=o}}t[6]=15&t[6]|64,t[8]=63&t[8]|128,me(t,e)}},Ce=(function(){var t={a:be};function r(t,n){var r,o=t.exports;e.asm=o,e.asm.M,r=e.asm.L,x.unshift(r),function(t){if(U--,e.monitorRunDependencies&&e.monitorRunDependencies(U),0==U&&(null!==j&&(clearInterval(j),j=null),W)){var n=W;W=null,n()}}()}function o(e){r(e.instance)}function s(e){return(u||"function"!=typeof fetch?Promise.resolve().then((function(){return F(A)})):fetch(A,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+A+"\'";return e.arrayBuffer()})).catch((function(){return F(A)}))).then((function(e){return WebAssembly.instantiate(e,t)})).then((function(e){return e})).then(e,(function(e){d("failed to asynchronously prepare wasm: "+e),L(e)}))}if(U++,e.monitorRunDependencies&&e.monitorRunDependencies(U),e.instantiateWasm)try{return e.instantiateWasm(t,r)}catch(e){d("Module.instantiateWasm callback failed with error: "+e),n(e)}(u||"function"!=typeof WebAssembly.instantiateStreaming||B(A)||"function"!=typeof fetch?s(o):fetch(A,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(o,(function(e){return d("wasm streaming compile failed: "+e),d("falling back to ArrayBuffer instantiation"),s(o)}))}))).catch(n)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.L).apply(null,arguments)},e._init_tp_worker=function(){return(e._init_tp_worker=e.asm.N).apply(null,arguments)},e._thread_run=function(){return(e._thread_run=e.asm.O).apply(null,arguments)},e._create_wcl_tp_handler=function(){return(e._create_wcl_tp_handler=e.asm.P).apply(null,arguments)},e._destroy_wcl_tp_handler=function(){return(e._destroy_wcl_tp_handler=e.asm.Q).apply(null,arguments)},e._wcl_tp_handler_connect=function(){return(e._wcl_tp_handler_connect=e.asm.R).apply(null,arguments)},e._wcl_tp_handler_send=function(){return(e._wcl_tp_handler_send=e.asm.S).apply(null,arguments)},e._wcl_tp_handler_close=function(){return(e._wcl_tp_handler_close=e.asm.T).apply(null,arguments)},e._wcl_tp_helper_on_connect=function(){return(e._wcl_tp_helper_on_connect=e.asm.U).apply(null,arguments)},e._wcl_tp_helper_on_close=function(){return(e._wcl_tp_helper_on_close=e.asm.V).apply(null,arguments)},e._wcl_tp_helper_on_message=function(){return(e._wcl_tp_helper_on_message=e.asm.W).apply(null,arguments)},e._ntohs=function(){return(Ce=e._ntohs=e.asm.X).apply(null,arguments)}),Pe=e._htonl=function(){return(Pe=e._htonl=e.asm.Y).apply(null,arguments)},ke=e._htons=function(){return(ke=e._htons=e.asm.Z).apply(null,arguments)},Ee=e._malloc=function(){return(Ee=e._malloc=e.asm._).apply(null,arguments)},Ie=e.stackSave=function(){return(Ie=e.stackSave=e.asm.$).apply(null,arguments)},Se=e.stackRestore=function(){return(Se=e.stackRestore=e.asm.aa).apply(null,arguments)},Te=e.stackAlloc=function(){return(Te=e.stackAlloc=e.asm.ba).apply(null,arguments)},Ae=e.___cxa_is_pointer_type=function(){return(Ae=e.___cxa_is_pointer_type=e.asm.ca).apply(null,arguments)};function Oe(n){function r(){Me||(Me=!0,e.calledRun=!0,f||(Y(x),t(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),function(){if(e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)t=e.postRun.shift(),D.unshift(t);var t;Y(D)}()))}n=n||i,U>0||(function(){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)t=e.preRun.shift(),R.unshift(t);var t;Y(R)}(),U>0||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),r()}),1)):r()))}if(e.cwrap=function(e,t,n,r){var o=(n=n||[]).every(e=>"number"===e||"boolean"===e);return"string"!==t&&o&&!r?ve(e):function(){return we(e,t,n,arguments)}},W=function e(){Me||Oe(),Me||(W=e)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Oe(),e.ready});t.default=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;const o=n(1),s=n(5),i=n(0),a=n(6);t.Connection=class{constructor(e,t,n,r,c,u,l){this.messageId=e,this.wssUrl=t,this.Module=n,this.API=r,this.target=c,this.tpLogger=u,this.logBase=l,this.isOpened=!1,this.isClosing=!1,this.isClosed=!1,this.fallback=!1,this.isTPConnectFinished=!1,this.encoder=new TextEncoder,this.decoder=new TextDecoder("utf-8"),this.messageCache=[],this.type=a.URL_TYPE.UNKNOWN,this.debugWS=null,this.cache=[],this.id=(0,s.getId)(),this.send=e=>{var t,n;if(this.fallback)(null===(t=this.socket)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&(null===(n=this.socket)||void 0===n||n.send(e));else{let t=e;"string"==typeof t&&(this.debugWS&&this.debugWS.readyState===WebSocket.OPEN&&this.debugWS.send("send "+e),t=this.encoder.encode(t+"\\n")),this.tp_send(t)}},this.onclose=e=>{this.interval&&self.clearInterval(this.interval),this.target.postMessage({type:"close",id:this.messageId,reason:e.reason,code:e.code}),o.ConnectionManager.removeIdConnectionMap(this.id),this.type===a.URL_TYPE.RWG&&i.Monitor.setConnectionError(!0),this.isClosed=!0},this.type=(0,a.getUrlType)(t),this.sendLog=e=>i.Monitor.addMonitor(e,this.type===a.URL_TYPE.RWG),this.sendLog("TPWSURL,"+this.type+","+this.id),this.target.addEventListener("message",e=>{let t=e.data;if(t.id===this.messageId)switch(t.type){case"send":this.send(t.data);break;case"close":this.fallback?this.socket.close():this.tp_close();break;case"close_wss":0}}),o.ConnectionManager.setIdConnectionMap(this.id,this),this.tp_connect(),this.interval=self.setInterval(()=>{this.cache.length&&(this.cache.forEach(e=>{var t;if(this.socket)if("send"===e.type)try{this.socket.readyState===WebSocket.OPEN&&this.socket.send(e.data)}catch(e){0,null===(t=this.tpLogger)||void 0===t||t.call(this,"directReport",null==e?void 0:e.message)}else"close"===e.type&&this.socket.close()}),this.cache=[])},10)}tp_connect(){this.handler=this.API.create_wcl_tp_handler(),o.ConnectionManager.setHandlerIdMap(this.handler,this.id),this.API.wcl_tp_handler_connect(this.handler,this.id)}tp_send(e){let t=new Uint8Array(e);this.API.wcl_tp_handler_send(this.handler,t,e.byteLength)}tp_close(){if(this.isClosing||this.isClosed)return;if(this.sendLog("TPCLO,"+this.type),this.isClosing=!0,null===this.handler)return;let e=this.handler;this.socket&&this.socket.readyState===WebSocket.OPEN||(this.sendLog("TPCLOBE,"+this.type+","+this.socket.readyState),this.cleanSocket(this.socket),this.onclose({code:1006,reason:""})),this.handler=null,this.API.wcl_tp_handler_close(e),this.API.destroy_wcl_tp_handler(e),o.ConnectionManager.removeHandlerIdMap(e)}cleanSocket(e){e&&(e.onopen=null,e.onclose=null,e.onmessage=null,e.onerror=null)}connectWebSocket(e){return r(this,void 0,void 0,(function*(){return new Promise((t,n)=>{this.socket&&this.cleanSocket(this.socket);const r=new URL(e);this.isTPConnectFinished&&this.sendLog("TPREC,"+this.type);const o=this.socket=new WebSocket(r);o.binaryType="arraybuffer",o.onopen=()=>{this.sendLog("TPWSO,"+this.type),t(o),this.isOpened=!0},o.onerror=e=>{this.sendLog("TPWSE,"+this.type),this.fallback?this.target.postMessage({type:"error",id:this.messageId}):(this.helper&&this.API.wcl_tp_helper_on_close(this.helper),this.isOpened||n(e))},o.onmessage=e=>{if(this.isTPConnectFinished||this.messageCache.push(e.data),this.fallback)this.target.postMessage({type:"message",data:e.data,id:this.messageId});else if(this.helper){let t=new Uint8Array(e.data);this.API.wcl_tp_helper_on_message(this.helper,t,e.data.byteLength)}},o.onclose=e=>{var t;if(this.sendLog("TPWSC,"+this.type),this.fallback)this.target.postMessage({type:"close",id:this.messageId,reason:e.reason,code:e.code});else{const r=e.code,o=e.reason;this.helper&&this.API.wcl_tp_helper_on_close(this.helper),null===(t=this.tpLogger)||void 0===t||t.call(this,"directReport","WebSocket closeCode "+r+" closeReason "+o),this.isOpened||n(e),this.isClosing&&this.onclose(e)}}})}))}js_wss_connect(e){o.ConnectionManager.setHelperConnectionMap(e,this),this.helper=e,this.connectWebSocket(this.wssUrl).then(()=>{this.helper&&this.API.wcl_tp_helper_on_connect(this.helper)}).catch(()=>{this.target.postMessage({type:"error",id:this.messageId}),this.type===a.URL_TYPE.RWG&&i.Monitor.setConnectionError(!0)})}js_wss_send(e,t){if(!this.fallback){var n=new Uint8Array(t),r=this.Module.HEAP8.subarray(e,e+t);n.set(r,0),this.cache.push({type:"send",data:n})}}js_wss_close(){this.sendLog("TPCBC,"+this.type),!this.fallback&&this.isTPConnectFinished&&this.cache.push({type:"close"})}js_app_on_message(e,t){const n=new Uint8Array(this.Module.HEAP8.buffer,e,t),r=this.decoder.decode(n);this.debugWS&&this.debugWS.readyState===WebSocket.OPEN&&this.debugWS.send("receive "+r),this.target.postMessage({type:"message",data:r,id:this.messageId})}js_helper_destoryed(){o.ConnectionManager.removeHelperConnectionMap(this.helper),this.helper=null}js_app_on_connect(e){this.sendLog("TPCBCON,"+this.type+","+e),0===e?(this.target.postMessage({type:"open",id:this.messageId}),this.type===a.URL_TYPE.RWG&&i.Monitor.setConnection(this)):(this.sendLog("TPFBK,"+this.type),this.fallback=!0,this.target.postMessage({type:"open",fallback:!0,id:this.messageId}),this.messageCache.forEach(e=>{this.target.postMessage({type:"message",data:e,id:this.messageId})})),this.isTPConnectFinished=!0}js_app_on_close(e){this.sendLog("TPCBCLO,"+this.type+","+e),o.ConnectionManager.removeHandlerIdMap(this.handler),this.handler=null,this.onclose({reason:"",code:e})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getId=void 0;const r=function*(){let e=1;for(;;)yield e,e=e<65535?e+1:1}();t.getId=function(){return r.next().value}},function(e,t,n){"use strict";function r(e){const t=new URLSearchParams(e.search);return e.hostname.includes("rwg")&&(t.has("dn2")||t.has("islch"))}function o(e){return e.pathname.includes("/wc/media")&&e.hostname.includes("rwg")&&"m"===e.searchParams.get("type")}function s(e){return e.pathname.includes("/wc/media")&&e.hostname.includes("rwg")&&"x"===e.searchParams.get("type")}function i(e){return e.pathname.includes("/wc/media")&&e.hostname.includes("rwg")&&"v"===e.searchParams.get("type")&&"16"===e.searchParams.get("mode")}function a(e){return e.pathname.includes("/ab/signal")&&e.hostname.includes("rwg")&&e.searchParams.get("rwg")===e.hostname}var c;Object.defineProperty(t,"__esModule",{value:!0}),t.URL_TYPE=t.getUrlType=t.isAudioBridge=t.isVideoBridge=t.isXmpp=t.isBoMaster=t.isRwg=void 0,t.isRwg=r,t.isBoMaster=o,t.isXmpp=s,t.isVideoBridge=i,t.isAudioBridge=a,t.getUrlType=function(e){const t="string"==typeof e?new URL(e):e;return r(t)?c.RWG:o(t)?c.BO_MASTER:s(t)?c.XMPP:i(t)?c.VIDEO_BRIDGE:a(t)?c.AUDIO_BRIDGE:c.UNKNOWN},function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.RWG=1]="RWG",e[e.BO_MASTER=2]="BO_MASTER",e[e.XMPP=3]="XMPP",e[e.VIDEO_BRIDGE=4]="VIDEO_BRIDGE",e[e.AUDIO_BRIDGE=5]="AUDIO_BRIDGE"}(c||(t.URL_TYPE=c={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuid=void 0,t.uuid=function(){var e;return(null===(e=null===crypto||void 0===crypto?void 0:crypto.randomUUID)||void 0===e?void 0:e.call(crypto))||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}]);\n',"Worker",{name:"zoom-tp"},void 0)}},function(e,t,n){"use strict";var r,o,s,i,a,c,u,l,d,f,h,p,g,_,m,y=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},w=this&&this.__classPrivateFieldSet||function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.TPSocket=void 0;const v=n(5),b=n(1),M=n(0);class P extends Event{constructor(e,t){super(e),Object.assign(this,t)}}class k extends EventTarget{get url(){return y(this,a,"f")}set url(e){}get readyState(){return y(this,c,"f")}set readyState(e){}get protocol(){return y(this,u,"f")}set protocol(e){}get bufferedAmount(){return y(this,l,"f")}set bufferedAmount(e){}get extensions(){return y(this,d,"f")}set extensions(e){}get OPEN(){return y(this,f,"f")}set OPEN(e){}get CONNECTING(){return y(this,h,"f")}set CONNECTING(e){}get CLOSING(){return y(this,p,"f")}set CLOSING(e){}get CLOSED(){return y(this,g,"f")}set CLOSED(e){}constructor(e,t){var n,P,k,E,O;super(),r.add(this),this.isRlb=!0,this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.binaryType="arraybuffer",s.set(this,(0,v.uuid)()),i.set(this,!1),a.set(this,void 0),c.set(this,WebSocket.CONNECTING),u.set(this,""),l.set(this,0),d.set(this,""),f.set(this,WebSocket.OPEN),h.set(this,WebSocket.CONNECTING),p.set(this,WebSocket.CLOSING),g.set(this,WebSocket.CLOSED),_.set(this,e=>{var t;let n=e.data;if(n.id===y(this,s,"f"))switch(n.type){case"open":y(this,c,"f")===WebSocket.CONNECTING&&(w(this,c,WebSocket.OPEN,"f"),this.isRlb=!n.fallback,y(this,r,"m",m).call(this,"open"));break;case"close":y(this,r,"m",m).call(this,"close",{reason:n.reason,code:n.code}),y(this,i,"f")&&(null===M.tpLogger||void 0===M.tpLogger||(0,M.tpLogger)("directReport","callback close event")),null===(t=o.target)||void 0===t||t.removeEventListener("message",y(this,_,"f")),w(this,c,WebSocket.CLOSED,"f");break;case"error":y(this,r,"m",m).call(this,"error");break;case"message":y(this,r,"m",m).call(this,"message",{data:n.data})}});const S="string"==typeof e?new URL(e):e;S.searchParams.set("rlb","1"),w(this,a,S.toString(),"f"),(0,b.isRwg)(S)&&(w(this,i,!0,"f"),(0,M.setCmd)(this)),o.target&&o.target instanceof MessagePort?self.addEventListener("message",e=>{var t;"error"===(null===(t=e.data)||void 0===t?void 0:t.type)&&y(this,r,"m",m).call(this,"error")}):null===(n=o.target)||void 0===n||n.addEventListener("error",e=>{e.message&&e.message.includes("RuntimeError:")&&y(this,r,"m",m).call(this,"error")}),null===(P=o.target)||void 0===P||P.addEventListener("message",y(this,_,"f")),null===(k=o.target)||void 0===k||k.postMessage({type:"connect",url:y(this,a,"f"),id:y(this,s,"f")}),o.target instanceof MessagePort&&(null===(O=null===(E=o.target)||void 0===E?void 0:E.start)||void 0===O||O.call(E))}send(e){var t;y(this,c,"f")===WebSocket.OPEN&&(null===(t=o.target)||void 0===t||t.postMessage({type:"send",data:e,id:y(this,s,"f")}))}close(){var e;y(this,i,"f")&&(null===M.tpLogger||void 0===M.tpLogger||(0,M.tpLogger)("directReport","call close tp")),w(this,c,WebSocket.CLOSING,"f"),null===(e=o.target)||void 0===e||e.postMessage({type:"close",id:y(this,s,"f")})}socketError(e){y(this,r,"m",m).call(this,"error",{code:4001,reason:e})}}t.TPSocket=k,o=k,s=new WeakMap,i=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,h=new WeakMap,p=new WeakMap,g=new WeakMap,_=new WeakMap,r=new WeakSet,m=function(e,t={}){var n;const r=new P(e,t);null===(n=this["on"+e])||void 0===n||n.call(this,r),this.dispatchEvent(r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuid=void 0,t.uuid=function(){var e;return(null===(e=null===crypto||void 0===crypto?void 0:crypto.randomUUID)||void 0===e?void 0:e.call(crypto))||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isRlb=t.getOption=void 0;const r=n(1);function o(e,t,n){try{let r=e.length;if(t>r)return 0;let o=e.slice(r-t-n+1,r-t+1);if(o){return parseInt(o,16)}}catch(e){}return 0}t.getOption=o,t.isRlb=function(e,t){return!!o(t,47,1)&&!!((0,r.isRwg)(e)||(0,r.isBoMaster)(e)||(0,r.isXmpp)(e)||(0,r.isVideoBridge)(e)||(0,r.isAudioBridge)(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0,t.logger=function(e=console){return(t,n,r,o)=>{var s,i,a,c;"directReport"===t?null===(s=e.directReport||e.log)||void 0===s||s(n,o||["TP_INFO"]):"error"===t?null===(i=e.error)||void 0===i||i.call(e,n,r):"warn"===t?null===(a=e.warn)||void 0===a||a.call(e,n):null===(c=e.log)||void 0===c||c.call(e,n)}}}])}));
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/tp.min.js-9433bdfc18666d7118dd.map