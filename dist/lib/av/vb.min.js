!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VB=e():t.VB=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){"use strict";r.r(e),r.d(e,"QOS_DEFAULT_POLLING_INTERVAL",(function(){return n})),r.d(e,"VIDEO_MONITOR_LOG_SECOENDS",(function(){return i})),r.d(e,"THREAD_STATE_IDLE",(function(){return o})),r.d(e,"THREAD_STATE_CREATING",(function(){return a})),r.d(e,"THREAD_STATE_CREATED",(function(){return s})),r.d(e,"MEDIA_S2C_KEEPALIVE",(function(){return E})),r.d(e,"MEDIA_AUDIO_DATA",(function(){return u})),r.d(e,"MEDIA_AUDIO_RTCP",(function(){return _})),r.d(e,"MEDIA_AUDIO_FEATURE",(function(){return c})),r.d(e,"MEDIA_VIDEO_DATA",(function(){return d})),r.d(e,"MEDIA_VIDEO_RTCP",(function(){return h})),r.d(e,"MEDIA_NTP_UPDATE",(function(){return T})),r.d(e,"VIDEO_KEYFRAME_REQ",(function(){return R})),r.d(e,"VIDEO_CAPTURER_RESOLUTION_360P",(function(){return f})),r.d(e,"VIDEO_CAPTURER_RESOLUTION_720P",(function(){return l})),r.d(e,"VIDEO_CAPTURER_RESOLUTION_1080P",(function(){return A})),r.d(e,"UPDATE_ENCRYPTION_GCM_MODEL_KEY",(function(){return O})),r.d(e,"MEDIA_AUDIO_QOS_SESS_DATA",(function(){return I})),r.d(e,"INTERPRETATION_ENABLE",(function(){return S})),r.d(e,"INTERPRETATION_SET_LANG",(function(){return N})),r.d(e,"INTERPRETATION_MUTE",(function(){return D})),r.d(e,"INTERPRETATION_SET_INTERPRETER",(function(){return p})),r.d(e,"DATA_DIRECTION_FROM_RECEIVE",(function(){return m})),r.d(e,"DATA_DIRECTION_FROM_SEND",(function(){return C})),r.d(e,"RWG_WCL_PDU_QOS_DATA",(function(){return v})),r.d(e,"RWG_WCL_PDU_QOS_DATA_VIDEO",(function(){return V})),r.d(e,"serverHeartbeatMaxTimeoutSeconds",(function(){return g})),r.d(e,"RQUEST_ANIMATION_MODE",(function(){return U})),r.d(e,"SET_INTERVAL_MODE",(function(){return L})),r.d(e,"VIDEO_INVALID",(function(){return M})),r.d(e,"VIDEO_RGBA",(function(){return x})),r.d(e,"VIDEO_I420",(function(){return P})),r.d(e,"VIDEO_NV12",(function(){return B})),r.d(e,"VIDEO_BGRA",(function(){return b})),r.d(e,"EVENT_ROLLBACK_BUFFER",(function(){return G})),r.d(e,"EVENT_NEEDMORE_DATA",(function(){return F})),r.d(e,"EVENT_CAPTURE_DATA",(function(){return y})),r.d(e,"EVENT_CACHE_SIZE",(function(){return w})),r.d(e,"WEBCODEC_ENCODE_OFF",(function(){return k})),r.d(e,"WEBCODEC_DECODE_OFF",(function(){return H})),r.d(e,"QosSession",(function(){return W})),r.d(e,"QosConnectType",(function(){return Y})),r.d(e,"MAX_VIDEO_CAPTURE_FPS",(function(){return K})),r.d(e,"MIN_VIDEO_CAPTURE_FPS",(function(){return X})),r.d(e,"VIDEO_CAPTURE_FPS",(function(){return Q})),r.d(e,"VIDEO_CAPTURE_20FPS",(function(){return j})),r.d(e,"DOWN_VIDEO_CAPTURE_FPS",(function(){return Z})),r.d(e,"LOWER_VIDEO_CAPTURE_FPS",(function(){return z})),r.d(e,"VIDEO_DATA_MAX_SIZE",(function(){return q})),r.d(e,"VIDEO_FRAME_BUFFER_SIZE",(function(){return J})),r.d(e,"SHARING_NULL",(function(){return $})),r.d(e,"SHARING_NORMAL",(function(){return tt})),r.d(e,"SHARING_VIDEO_MODE",(function(){return et})),r.d(e,"SHARING_VIDEO_MODE_CAPTURED_FPS",(function(){return rt})),r.d(e,"SHARING_NORMAL_MODE_CAPTURED_FPS",(function(){return nt})),r.d(e,"VIDEO_RINGBUF_PKG_NUM",(function(){return it})),r.d(e,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_360P",(function(){return ot})),r.d(e,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_720P",(function(){return at})),r.d(e,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_1080p",(function(){return st})),r.d(e,"WCL_PLATFORM_TYPE",(function(){return Et})),r.d(e,"AS_CAPTURE_SOURCE",(function(){return ut})),r.d(e,"MEDIA_COMMAND",(function(){return _t})),r.d(e,"RENDER_UNSET",(function(){return ct})),r.d(e,"RENDER_IN_WORKER",(function(){return dt})),r.d(e,"RENDER_IN_MAIN",(function(){return ht})),r.d(e,"WEBRTC_NO_AUDIO_MODE",(function(){return Tt})),r.d(e,"WEBRTC_COMMPUTER_AUDIO_MODE",(function(){return Rt})),r.d(e,"WEBRTC_SHARE_AUDIO_MODE",(function(){return ft})),r.d(e,"WEBRTC_MULTI_AUDIO_MODE",(function(){return lt})),r.d(e,"VIDEO_FRAME",(function(){return At})),r.d(e,"SHARING_FRAME",(function(){return Ot})),r.d(e,"MAX_RENDER_WITHOUT_SAB",(function(){return It})),r.d(e,"ACTIVE_SPEAKER_SSRC",(function(){return St})),r.d(e,"FACE_MODE_UNKNOW",(function(){return Nt})),r.d(e,"FACE_MODE_USER",(function(){return Dt})),r.d(e,"FACE_MODE_ENVIRONMENT",(function(){return pt})),r.d(e,"ORIGINAL_SOUND_OFF",(function(){return mt})),r.d(e,"ORIGINAL_SOUND_ON",(function(){return Ct})),r.d(e,"ORIGINAL_SOUND_STEREO",(function(){return vt})),r.d(e,"ORIGINAL_SOUND_HIGHFIDELITY",(function(){return Vt})),r.d(e,"ORIGINAL_SOUND_HIGHFIDELITY_STEREO",(function(){return gt})),r.d(e,"SHARE_AUDIO",(function(){return Ut})),r.d(e,"ORIGINAL_SOUND_OFF_HIGH_BITRATE",(function(){return Lt})),r.d(e,"PUBLISHER_ICEConnectionState_Failed",(function(){return Mt})),r.d(e,"SUBSCRIBER_ICEConnectionState_Failed",(function(){return xt})),r.d(e,"NO_MESSAGE_FAILOVER",(function(){return Pt})),r.d(e,"WS_ERROR_FAILOVER",(function(){return Bt})),r.d(e,"WS_CLOSE_FAILOVER",(function(){return bt})),r.d(e,"RUNTIME_ERROR_FAILOVER",(function(){return Gt})),r.d(e,"WEBRTC_FALLBACK_TO_WASM",(function(){return Ft})),r.d(e,"VB_CONSTANT",(function(){return yt})),r.d(e,"AUDIO_ENCODE_WORKER",(function(){return wt})),r.d(e,"AUDIO_DECODE_WORKER",(function(){return kt})),r.d(e,"AUDIO_WASM_WORKLET",(function(){return Ht})),r.d(e,"AUDIO_WEBRTC_WORKLET",(function(){return Wt})),r.d(e,"DATACHANNEL_MONITOR_SEPARATOR",(function(){return Yt})),r.d(e,"LOADEDMETADATAT_IMEOUT",(function(){return Kt})),r.d(e,"MEDIA_SOLUTION_WEBRTC",(function(){return Xt})),r.d(e,"MEDIA_SOLUTION_WASM",(function(){return Qt})),r.d(e,"AudioProfile",(function(){return jt})),r.d(e,"REPORT_KEY_SHARE",(function(){return Zt})),r.d(e,"REPORT_KEY_NORMAL",(function(){return zt})),r.d(e,"WEBGL_CONTEXT_INVALID_WHEN_START",(function(){return qt})),r.d(e,"HEALTH_CHECK_TYPE",(function(){return Jt})),r.d(e,"HEALTH_CHECK_OPERATOR",(function(){return $t})),r.d(e,"REMINDER_AFTER_MUTED",(function(){return te})),r.d(e,"RECAPTURE_AUDIO_AFTER_MUTED",(function(){return ee})),r.d(e,"NET_QUALITY_LEVEL",(function(){return re})),r.d(e,"NET_BW_LEVEL",(function(){return ne}));const n=1e3,i=5,o=43,a=44,s=45,E=0,u=1,_=6,c=146,d=2,h=7,T=9,R=17,f=10,l=11,A=12,O=102,I=107,S=0,N=1,D=2,p=3,m=0,C=1,v=108,V=104,g=65,U=0,L=1,M=-1,x=0,P=1,B=2,b=3,G=0,F=1,y=2,w=3,k=1,H=2,W={SESSION_TYPE_CONF:0,SESSION_TYPE_AUDIO:1,SESSION_TYPE_DESKSHARE:2,SESSION_TYPE_VIDEO:3,SESSION_TYPE_CHAT:4,SESSION_TYPE_TELEPHONE:5,SESSION_TYPE_ZC_PING:6,SESSION_TYPE_TOTAL_CNT:7},Y={CONNECT_TYPE_UDP:0,CONNECT_TYPE_TCP:1},K=30,X=1,Q=24,j=20,Z=15,z=10,q=8294400,J=5,$=0,tt=1,et=2,rt=15,nt=5,it=400,ot=3,at=7,st=8,Et={DESKTOP:0,MOBILE:1,ANDROID:2,IPHONE:3},ut={DESKTOP_SOURCE:0,UAC_SOURCE:1},_t={SHARE_REMOTE_CONTROL_UAC_MOUSE:144,SHARE_REMOTE_CONTROL_UAC_JPEG_FRAME:145},ct=-1,dt=0,ht=1,Tt=0,Rt=1,ft=2,lt=Rt+ft,At=0,Ot=1,It=25,St=1,Nt=-1,Dt=0,pt=1,mt=0,Ct=1,vt=2|Ct,Vt=4|Ct,gt=vt|Vt,Ut=8,Lt=16,Mt=3,xt=107,Pt="100",Bt="101",bt="102",Gt="103",Ft="150",yt="WCL_M,isWebEnabled:1, isLocalEnabled:1, isSmartBkgnd:1, bkgType:2",wt=0,kt=1,Ht=2,Wt=3,Yt="{[WLCCONT]}",Kt=1e4,Xt=1,Qt=2,jt={[mt]:new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:48e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]]),[Ct]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[vt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[Vt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[gt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[Ut]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:"96000",operater:"add"}],["maxplaybackrate",{value:"48000",operater:"add"}],["sprop-maxcapturerate",{value:"48000",operater:"add"}]]),[Lt]:new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:64e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]])},Zt="SHARE",zt="NORMAL",qt="WebGLContextInvalidWhenStart",Jt={VIDEO:0,SHARE:1},$t={PAUSE:0,RESUME:1,STOP:2},te=!0,ee=!1,re={NET_QUALITY_UNKNOWN:-1,NET_QUALITY_VERY_BAD:0,NET_QUALITY_BAD:1,NET_QUALITY_NOT_GOOD:2,NET_QUALITY_NORMAL:3,NET_QUALITY_GOOD:4,NET_QUALITY_EXCELLENT:5},ne={NET_BW_LEVEL_UNKNOWN:-1,NET_BW_LEVEL_VERY_LOW:0,NET_BW_LEVEL_LOW:1,NET_BW_LEVEL_NORMAL:2}},function(t,e,r){"use strict";r.r(e),r.d(e,"START_MEDIA",(function(){return n})),r.d(e,"ADD_RENDER_VIDEO",(function(){return i})),r.d(e,"STOP_RENDER_VIDEO",(function(){return o})),r.d(e,"START_CAPTURE_VIDEO",(function(){return a})),r.d(e,"STOP_CAPTURE_VIDEO",(function(){return s})),r.d(e,"ADD_RENDER_AUDIO",(function(){return E})),r.d(e,"STOP_RENDER_AUDIO",(function(){return u})),r.d(e,"UNMUTE_AUDIO",(function(){return _})),r.d(e,"MUTE_AUDIO",(function(){return c})),r.d(e,"CHANGE_FRAME_RATE",(function(){return d})),r.d(e,"CHANGE_VIDEO_RESOLUTION",(function(){return h})),r.d(e,"CHANGE_AUDIO_SPEAKER",(function(){return T})),r.d(e,"CHANGE_VIDEO_CAPTURE_DEVICE",(function(){return R})),r.d(e,"CHANGE_CURRENT_ACTIVE_SSRC",(function(){return f})),r.d(e,"REMOVE_AUDIO_CAPTURE",(function(){return l})),r.d(e,"LEAVE_MEETING",(function(){return A})),r.d(e,"MEETING_FAIL_OVER",(function(){return O})),r.d(e,"END_MEDIA",(function(){return I})),r.d(e,"CHANGE_AUDIO_MIC",(function(){return S})),r.d(e,"WEBRTC_RESTART",(function(){return N})),r.d(e,"REMOVE_RENDER_AUDIO",(function(){return D})),r.d(e,"LEAVE_COMPUTER_AUDIO",(function(){return p})),r.d(e,"JOIN_COMPUTER_AUDIO",(function(){return m})),r.d(e,"START_SHARING",(function(){return C})),r.d(e,"STOP_SHARING",(function(){return v})),r.d(e,"SWITCH_CANVAS_FOR_VIDEO_CAPTURE",(function(){return V})),r.d(e,"START_REMOTE_CONTROL",(function(){return g})),r.d(e,"UPDATE_REMOTE_CONTROL_PROPERTIES",(function(){return U})),r.d(e,"CANCEL_REMOTE_CONTROL",(function(){return L})),r.d(e,"UPDATE_SUBSCRIBE_VIDEO",(function(){return M})),r.d(e,"START_DESKTOP_SHARING",(function(){return x})),r.d(e,"START_SHARING_WHITEBOARD",(function(){return P})),r.d(e,"STOP_DESKTOP_SHARING",(function(){return B})),r.d(e,"STOP_SHARING_WHITEBOARD",(function(){return b})),r.d(e,"PAUSE_DESKTOP_SHARING",(function(){return G})),r.d(e,"RESUME_DESKTOP_SHARING",(function(){return F})),r.d(e,"CHECK_CHROME_SHARING_EXTENSION",(function(){return y})),r.d(e,"SWITCH_CANVAS_FOR_SHARING_CAPTURE",(function(){return w})),r.d(e,"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",(function(){return k})),r.d(e,"COMMAND_SOCKET_MESSAGE_NOTIFY",(function(){return H})),r.d(e,"RESEND_REMOTE_CONTROL_POSITION_PDU",(function(){return W})),r.d(e,"AES_GCM_IV_VALUE",(function(){return Y})),r.d(e,"USER_NODE_LIST",(function(){return K})),r.d(e,"UPDATE_SHARING_DECODE_PARAM",(function(){return X})),r.d(e,"PAUSE_OR_RESUME_AUDIO_DECODE",(function(){return Q})),r.d(e,"UPDATE_CANVAS_SIZE",(function(){return j})),r.d(e,"CLEAR_CANVAS",(function(){return Z})),r.d(e,"ZOOM_RENDER",(function(){return z})),r.d(e,"CHANGE_SHARING_2ND_VIDEO_CAPTUREVIDEO_DEVICE",(function(){return q})),r.d(e,"SET_OTHER_AUDIO_VOLUME_LEVEL",(function(){return J})),r.d(e,"USER_NODE_AUDIO_STATUS_LIST",(function(){return $})),r.d(e,"UPDATE_MASK_CANVAS_SIZE",(function(){return tt})),r.d(e,"MOVE_PTZ_CAMERA",(function(){return et})),r.d(e,"START_STOP_REMOTE_CONTROL_CHECK",(function(){return rt})),r.d(e,"SEND_REMOTE_CONTROL_QR_CODE",(function(){return nt})),r.d(e,"AUDIO_CC_SELECT_LANGUAGE",(function(){return it})),r.d(e,"AUIOD_INTERPRETATION_MUTE",(function(){return ot})),r.d(e,"AUDIO_INTERPRETATION_SELECT_LANGUAGE",(function(){return at})),r.d(e,"AUDIO_INTERPRETATION_LIST_INFO",(function(){return st})),r.d(e,"AUDIO_INTERPRETATION_ENABLE",(function(){return Et})),r.d(e,"VIDEO_MASK_SETTING",(function(){return ut})),r.d(e,"UPDATE_BG_IMAGE",(function(){return _t})),r.d(e,"UPDATE_MASK_INFO",(function(){return ct})),r.d(e,"FINISH_MASK_SETTING",(function(){return dt})),r.d(e,"START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS",(function(){return ht})),r.d(e,"VIDEO_ENABLE_DECODE_HW",(function(){return Tt})),r.d(e,"VIDEO_ENABLE_ENCODE_HW",(function(){return Rt})),r.d(e,"JOIN_DESKTOP_AUDIO",(function(){return ft})),r.d(e,"LEAVE_DESKTOP_AUDIO",(function(){return lt})),r.d(e,"SET_DESKTOP_VOLUME",(function(){return At})),r.d(e,"MIRROR_MY_VIDEO",(function(){return Ot})),r.d(e,"REMOVE_EXPIRED_CANVAS",(function(){return It})),r.d(e,"WEBGL_LOST_REPLACE_CANVAS",(function(){return St})),r.d(e,"UPDATE_VIDEO_QUALITY",(function(){return Nt})),r.d(e,"SEND_RENDER_LOG",(function(){return Dt})),r.d(e,"USER_NODE_LIST_IN_MAIN_SESSION",(function(){return pt})),r.d(e,"UPDATE_MEDIA_PARAMS",(function(){return mt})),r.d(e,"SHARING_ADD_REV_CHANNEL_TYPE",(function(){return Ct})),r.d(e,"SHARING_REMOVE_REV_CHANNEL_TYPE",(function(){return vt})),r.d(e,"BUILD_MS_CHANNEL_IN_BO",(function(){return Vt})),r.d(e,"BUILD_MA_CHANNEL_IN_BO",(function(){return gt})),r.d(e,"ENABLE_SHARE_TO_BO",(function(){return Ut})),r.d(e,"ENABLE_BROADCAST_TO_BO",(function(){return Lt})),r.d(e,"SWITCH_WATER_MARK_FLAG",(function(){return Mt})),r.d(e,"START_VIDEO_VB_SETTING",(function(){return xt})),r.d(e,"UPDATE_VIDEO_VB_BG_IMAGE",(function(){return Pt})),r.d(e,"STOP_VIDEO_VB_SETTING",(function(){return Bt})),r.d(e,"START_VIDEO_STREAM_IN_VB_SETTING_SUCCESS",(function(){return bt})),r.d(e,"SWITCH_MASK_AND_VB",(function(){return Gt})),r.d(e,"VB_MODEL_PRELOADING_3S",(function(){return Ft})),r.d(e,"VB_MODEL_PRELOADING_10S",(function(){return yt})),r.d(e,"VB_MODEL_PRELOADING_OK",(function(){return wt})),r.d(e,"ENABLE_VIDEO_OBSERVER",(function(){return kt})),r.d(e,"SWITCH_SHARING_TYPE",(function(){return Ht})),r.d(e,"CHANGE_HID_ENABLE",(function(){return Wt})),r.d(e,"ADD_VIDEO_VB_SETTING_DOM",(function(){return Yt})),r.d(e,"REMOVE_VIDEO_VB_SETTING_DOM",(function(){return Kt})),r.d(e,"NEW_ACTIVE_SPEAKER_SSRC",(function(){return Xt})),r.d(e,"NEW_ACTIVE_SPEAKER_FIRST_FRAME_CALLBACK",(function(){return Qt})),r.d(e,"CANCEL_NEW_ACTIVE_SPEAKER_BEFORE_CALL_BACK",(function(){return jt})),r.d(e,"NOTIFY_SDK_JOIN_RWG_SUCCESS",(function(){return Zt})),r.d(e,"AUDIO_BRIDGE_FIRST_RECV_DATA",(function(){return zt})),r.d(e,"AUDIO_BRIDGE_CAN_SEND_DATA",(function(){return qt})),r.d(e,"FIRST_VIDEO_FRAME",(function(){return Jt})),r.d(e,"PREVIEW_INIT_VIDEO_DECODE_SUCCESS",(function(){return $t})),r.d(e,"PREVIEW_INIT_AUDIO_DECODE_SUCCESS",(function(){return te})),r.d(e,"WHITEBOARD_JOIN_MESSAGE",(function(){return ee})),r.d(e,"AUDIO_DENOISE_SWITCH",(function(){return re})),r.d(e,"SET_CODEC_MODE",(function(){return ne})),r.d(e,"STOP_AUDIO_INCOMING",(function(){return ie})),r.d(e,"MOBILE_ROTATE",(function(){return oe})),r.d(e,"SAVE_LOCAL_LOG",(function(){return ae})),r.d(e,"CHANGE_AUDIO_PROFILE",(function(){return se})),r.d(e,"AUDIO_JOIN_SUCCESS",(function(){return Ee})),r.d(e,"RWG_COMMAND_BYPASS_TO_WCL",(function(){return ue})),r.d(e,"SHARE_2ND_AUDIO_CAPTURE_DEVICE",(function(){return _e})),r.d(e,"SUBSCRIBE_VIDEO",(function(){return ce})),r.d(e,"UNSUBSCRIBE_VIDEO",(function(){return de})),r.d(e,"UI_SUBSCRIBE_VIDEO",(function(){return he})),r.d(e,"UI_UNSUBSCRIBE_VIDEO",(function(){return Te})),r.d(e,"MOBILE_CAPTURE_DEVICE_CHANGE",(function(){return Re})),r.d(e,"ON_HOLD",(function(){return fe})),r.d(e,"SET_ALL_SPEECH_VOLUME",(function(){return le})),r.d(e,"ENABLE_FILE_AUDIO_PLAYBACK_LOCALLY",(function(){return Ae})),r.d(e,"START_ANNOTATION_A",(function(){return Oe})),r.d(e,"ANNOTATION_ACTIONS",(function(){return Ie})),r.d(e,"STOP_ANNOTATION_A",(function(){return Se})),r.d(e,"START_ANNOTATION_SUCCESS",(function(){return Ne})),r.d(e,"DEVICE_CHANGE_EVENT",(function(){return De})),r.d(e,"RECAPTURE_AUDIO",(function(){return pe})),r.d(e,"REQUEST_PERMISSION",(function(){return me})),r.d(e,"REQUEST_PERMISSION_RESULT",(function(){return Ce})),r.d(e,"REQUEST_PERMISSIOM_POP_REMINDER",(function(){return ve})),r.d(e,"INIT_SUCCESS",(function(){return Ve})),r.d(e,"INIT_SUCCESS_VIDEO",(function(){return ge})),r.d(e,"INIT_SUCCESS_AUDIO",(function(){return Ue})),r.d(e,"INIT_SUCCESS_SHARING",(function(){return Le})),r.d(e,"USER_GRANT_CAPTURE_AUDIO",(function(){return Me})),r.d(e,"CURRENT_VIDEO_RESOLUTION",(function(){return xe})),r.d(e,"SHARING_DEC_THREAD_OK",(function(){return Pe})),r.d(e,"SHARING_DATA",(function(){return Be})),r.d(e,"SHARING_PARA",(function(){return be})),r.d(e,"SHARING_MORE_INFO",(function(){return Ge})),r.d(e,"VIDEO_DECODE_MAX_SIZE",(function(){return Fe})),r.d(e,"CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT",(function(){return ye})),r.d(e,"START_VIDEO_CAPTURE_SUCCESS",(function(){return we})),r.d(e,"STOP_VIDEO_CAPTURE_SUCCESS",(function(){return ke})),r.d(e,"START_REMOTE_CONTROL_SUCCESS",(function(){return He})),r.d(e,"CANCEL_REMOTE_CONTROL_SUCCESS",(function(){return We})),r.d(e,"REMOTE_CONTROL_COPIED_TEXT_NOTIFY",(function(){return Ye})),r.d(e,"MONITOR_LOG",(function(){return Ke})),r.d(e,"CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT",(function(){return Xe})),r.d(e,"DESKTOP_SHARING_CAPTURE_SUCCESS",(function(){return Qe})),r.d(e,"CHECK_CHROME_SHARING_EXTENSION_RESPONSE",(function(){return je})),r.d(e,"SHARING_DECODE_MAX_SIZE",(function(){return Ze})),r.d(e,"REQUEST_AUDIO_BRIDGE_TOKEN",(function(){return ze})),r.d(e,"SEND_MESSAGE_TO_RWG",(function(){return qe})),r.d(e,"AES_GCM_IV_RESPONSE",(function(){return Je})),r.d(e,"SHARING_DESKTOP_STREAM_HAVE_AUDIO",(function(){return $e})),r.d(e,"JOIN_COMPUTER_AUDIO_COMPLETE",(function(){return tr})),r.d(e,"JOIN_DESKTOP_AUDIO_COMPLETE",(function(){return er})),r.d(e,"LEAVE_COMPUTER_AUDIO_COMPLETE",(function(){return rr})),r.d(e,"LEAVE_DESKTOP_AUDIO_COMPLETE",(function(){return nr})),r.d(e,"HID_STATUS_MUTE",(function(){return ir})),r.d(e,"HID_STATUS_OFF_HOOK",(function(){return or})),r.d(e,"WB_MESSAGE",(function(){return ar})),r.d(e,"AUDIO_STREAM_FAILED",(function(){return sr})),r.d(e,"VIDEO_STREAM_FAILED",(function(){return Er})),r.d(e,"AUDIO_SPEAKER_SET_SUCCESS",(function(){return ur})),r.d(e,"FIRST_IOS_FRAME",(function(){return _r})),r.d(e,"AUDIOBRIDGE_EBABLE_SHARE_TO_BO_SUCCESS",(function(){return cr})),r.d(e,"AUDIOBRIDGE_SET_CC_LANG_SUCCESS",(function(){return dr})),r.d(e,"AUDIOBRIDGE_ENABLE_BROADCAST_TO_BO_SUCCESS",(function(){return hr})),r.d(e,"AUDIO_LEVEL_INDICATOR",(function(){return Tr})),r.d(e,"SYNC_RENDERER_TYPE_RESPONSE",(function(){return Rr})),r.d(e,"INIT_FAILED",(function(){return fr})),r.d(e,"INIT_FAILED_VIDEO",(function(){return lr})),r.d(e,"INIT_FAILED_AUDIO",(function(){return Ar})),r.d(e,"INIT_FAILED_SHARING",(function(){return Or})),r.d(e,"AUDIO_CAPTURE_FAILED",(function(){return Ir})),r.d(e,"AUDIO_WEBSOCKET_BROKEN",(function(){return Sr})),r.d(e,"VIDEO_WEBSOCKET_BROKEN",(function(){return Nr})),r.d(e,"SHARING_DEC_THREAD_FAILED",(function(){return Dr})),r.d(e,"AUDIO_ZERO_DATA",(function(){return pr})),r.d(e,"AUDIO_CTX_SAMPLERATE",(function(){return mr})),r.d(e,"USER_FORBIDDED_CAPTURE_VIDEO",(function(){return Cr})),r.d(e,"USER_CAMERA_IS_TAKEN_BY_OTHER_PROGRAMS",(function(){return vr})),r.d(e,"STOP_VIDEO_CAPTURE_FAILED",(function(){return Vr})),r.d(e,"START_REMOTE_CONTROL_FAILED",(function(){return gr})),r.d(e,"CANCEL_REMOTE_CONTROL_FAILED",(function(){return Ur})),r.d(e,"REMOTE_CONTROL_PASTE_TEXT_LENGTH_OVERFLOW",(function(){return Lr})),r.d(e,"USER_STOP_DESKTOP_SHARING",(function(){return Mr})),r.d(e,"USER_CANCEL_PERMISSION_REQUEST",(function(){return xr})),r.d(e,"DESKTOP_SHARING_CHROME_EXTENSION_UNINSTALLED",(function(){return Pr})),r.d(e,"DESKTOP_SHARING_PERMISSION_DENIED",(function(){return Br})),r.d(e,"DESKTOP_SHARING_TIME_OUT",(function(){return br})),r.d(e,"DESKTOP_SHARING_ERROR",(function(){return Gr})),r.d(e,"AUDIO_SPEAKER_SET_ERROR",(function(){return Fr})),r.d(e,"DESKTOP_SHARING_SYSTEM_ERROR",(function(){return yr})),r.d(e,"AUDIO_CLIPPING",(function(){return wr})),r.d(e,"AUDIO_AUTO_PLAY_FAILED",(function(){return kr})),r.d(e,"WCL_SIP_WEBSOCKET_CONNECT_ERROR",(function(){return Hr})),r.d(e,"SHARING_DESKTOP_STREAM_HAVE_NO_AUDIO",(function(){return Wr})),r.d(e,"WCL_AUDIO_BRIDGE_RECONNECT_START",(function(){return Yr})),r.d(e,"WCL_AUDIO_BRIDGE_RECONNECT_END",(function(){return Kr})),r.d(e,"WEBGL_LOST_IN_MULTI_VIEW",(function(){return Xr})),r.d(e,"MASK_SETTING_PARA_ERROR",(function(){return Qr})),r.d(e,"VIDEO_VB_SETTING_PARA_ERROR",(function(){return jr})),r.d(e,"NOTIFY_UI_FAILOVER",(function(){return Zr})),r.d(e,"AUDIO_CONNECT_HID_JOIN_FAILED",(function(){return zr})),r.d(e,"JOIN_COMPUTER_AUDIO_FAILURE",(function(){return qr})),r.d(e,"AUDIOBRIDGE_EBABLE_BROADCAST_TO_BO_FAILURE",(function(){return Jr})),r.d(e,"AUDIOBRIDGE_SET_CC_LANG_FAILURE",(function(){return $r})),r.d(e,"AUDIOBRIDGE_EBABLE_SHARE_TO_BO_FAILURE",(function(){return tn})),r.d(e,"AUDIO_MIC_SET_ERROR",(function(){return en})),r.d(e,"NOTIFY_UI_WMSC_FAILOVER",(function(){return rn})),r.d(e,"NOTIFY_UI_WMSC_WSS_DISCONNECTED",(function(){return nn})),r.d(e,"RECOVER_WEBRTC_AUDIO",(function(){return on})),r.d(e,"MEDIA_RECONNECT",(function(){return an})),r.d(e,"WEBGL_CONTEXT_INVALID",(function(){return sn})),r.d(e,"WASM_MEMORY_FAIL",(function(){return En})),r.d(e,"LOST_CAMERA_ACCESS",(function(){return un})),r.d(e,"WORKLET_PROCESS_EXCEPTIONS",(function(){return _n})),r.d(e,"VB_PROCESS_IMAGE_FAIL",(function(){return cn})),r.d(e,"MEDIA_HEALTH_CHECK_FAILED",(function(){return dn})),r.d(e,"START_ANNOTATION_FAILED",(function(){return hn})),r.d(e,"AUDIO_SENT_BYTES_ZERO",(function(){return Tn})),r.d(e,"EVENT_PARMS_ERROR",(function(){return Rn})),r.d(e,"AUDIO_STOP",(function(){return fn})),r.d(e,"AUDIO_START",(function(){return ln})),r.d(e,"AUDIO_REMOVE",(function(){return An})),r.d(e,"AUDIO_ILLEGAL",(function(){return On})),r.d(e,"SHARING_PARAM_INFO_FROM_SOCKET",(function(){return In})),r.d(e,"ZOOM_CONNECTION_VIDEO_OFFER_EVT",(function(){return Sn})),r.d(e,"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",(function(){return Nn})),r.d(e,"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",(function(){return Dn})),r.d(e,"ZOOM_CONNECTION_REMOVE_UDP_EVT",(function(){return pn})),r.d(e,"EVT_TYPE_WS_VIDEO_DATACHANNEL_ANSWER",(function(){return mn})),r.d(e,"WS_CONF_AB_TOKEN_REQ",(function(){return Cn})),r.d(e,"WS_CONF_AB_TOKEN_RES",(function(){return vn})),r.d(e,"WS_CONF_END_INDICATION",(function(){return Vn})),r.d(e,"WS_VIDEO_MULTI_SUBSCRIBE_REQ",(function(){return gn})),r.d(e,"WS_VIDEO_MULTI_UNSUBSCRIBE_REQ",(function(){return Un})),r.d(e,"RWG_MONITOR_LOG_EVENT",(function(){return Ln})),r.d(e,"WS_CONF_WCL_SET_FULL_HD_REQ",(function(){return Mn})),r.d(e,"PUBSUB_EVT",(function(){return xn})),r.d(e,"SHARING_FIRST_DECODE_FRAME_RECEIVED_SSRC",(function(){return Pn})),r.d(e,"MEDIA_CONNECTED",(function(){return Bn})),r.d(e,"HAVE_NO_WATERMARK",(function(){return bn})),r.d(e,"HAVE_WATERMARK",(function(){return Gn})),r.d(e,"SPEAKING_WHEN_MUTE",(function(){return Fn})),r.d(e,"AUDIO_QOS_DATA",(function(){return yn})),r.d(e,"VIDEO_QOS_DATA",(function(){return wn})),r.d(e,"VIDEOSHARE_QOS_DATA",(function(){return kn})),r.d(e,"NETWORK_QUALITY_CHANGE",(function(){return Hn})),r.d(e,"NETWORK_QUALITY_CHANGE_AUDIO",(function(){return Wn})),r.d(e,"sdkIvTypeKeyEnum",(function(){return Yn})),r.d(e,"CURRENT_DECODE_VIDEO_QUALITY",(function(){return Kn})),r.d(e,"CURRENT_DECODE_VIDEO_FPS",(function(){return Xn})),r.d(e,"ENABLE_REUSE_STREAM",(function(){return Qn})),r.d(e,"PRESET_MEDIA_CONSTRAINTS",(function(){return jn})),r.d(e,"DESTORY_REUSE_STREAM",(function(){return Zn})),r.d(e,"VB_SETTING_PARA_ERROR_TYPE",(function(){return zn})),r.d(e,"AUDIO_STREAM_MUTED",(function(){return qn})),r.d(e,"AUDIO_STREAM_UNMUTED",(function(){return Jn})),r.d(e,"VIDEO_STREAM_MUTED",(function(){return $n})),r.d(e,"VIDEO_STREAM_UNMUTED",(function(){return ti})),r.d(e,"EXPOSE_VB_FRAME",(function(){return ei})),r.d(e,"UNIFIED_VB_FRAME",(function(){return ri})),r.d(e,"UNIFIED_VB_STOP",(function(){return ni})),r.d(e,"UNIFIED_VB_PAUSE",(function(){return ii})),r.d(e,"UNIFIED_VB_ACK",(function(){return oi})),r.d(e,"ANNO_UNDO_STATUS",(function(){return ai})),r.d(e,"ANNO_REDO_STATUS",(function(){return si})),r.d(e,"CAPTURE_FAILED_REASON",(function(){return Ei})),r.d(e,"REQUEST_PERMISSION_STATUS",(function(){return ui}));const n=0,i=1,o=2,a=3,s=4,E=5,u=6,_=7,c=8,d=9,h=10,T=11,R=12,f=13,l=14,A=15,O=16,I=17,S=18,N=19,D=20,p=21,m=22,C=23,v=24,V=25,g=26,U=27,L=28,M=29,x=30,P=30.1,B=31,b=31.1,G=32,F=33,y=34,w=35,k=36,H=40,W=41,Y=42,K=43,X=44,Q=45,j=46,Z=47,z=48,q=49,J=50,$=51,tt=52,et=53,rt=54,nt=55,it=57,ot=58,at=59,st=60,Et=61,ut=62,_t=63,ct=64,dt=65,ht=66,Tt=70,Rt=71,ft=72,lt=73,At=74,Ot=75,It=76,St=77,Nt=78,Dt=79,pt=80,mt=81,Ct=82,vt=83,Vt=84,gt=85,Ut=86,Lt=87,Mt=90,xt=91,Pt=92,Bt=93,bt=94,Gt=95,Ft=96,yt=97,wt=98,kt=99,Ht=101,Wt=100,Yt=102,Kt=103,Xt=110,Qt=111,jt=112,Zt=113,zt=114,qt=115,Jt=116,$t=117,te=118,ee=120,re=121,ne=122,ie=123,oe=124,ae=125,se=126,Ee=127,ue=128,_e=129,ce=130,de=131,he=132,Te=133,Re=135,fe=136,le=137,Ae=138,Oe=150,Ie=152,Se=156,Ne=158,De=159,pe=160,me=161,Ce=162,ve=163,Ve=1,ge=1.1,Ue=1.2,Le=1.3,Me=2,xe=3,Pe=4,Be=5,be=6,Ge=6.1,Fe=7,ye=8,we=9,ke=10,He=11,We=12,Ye=13,Ke=14,Xe=15,Qe=16,je=17,Ze=18,ze=19,qe=20,Je=21,$e=23,tr=24,er=25,rr=26,nr=27,ir=28,or=29,ar=30,sr=31,Er=32,ur=33,_r=34,cr=35,dr=36,hr=37,Tr=38,Rr=39,fr=-1,lr=-1.1,Ar=-1.2,Or=-1.3,Ir=-2,Sr=-3,Nr=-4,Dr=-5,pr=-6,mr=-7,Cr=-8,vr=-9,Vr=-10,gr=-11,Ur=-12,Lr=-14,Mr=-15,xr=-16,Pr=-17,Br=-18,br=-19,Gr=-20,Fr=-21,yr=-22,wr=-23,kr=-24,Hr=-28,Wr=-27,Yr=-29,Kr=-31,Xr=-32,Qr=-33,jr=-34,Zr=-35,zr=-36,qr=-37,Jr=-38,$r=-39,tn=-40,en=-41,rn=-42,nn=-43,on=-44,an=-45,sn=-51,En=-52,un=-60,_n=-53,cn=-70,dn=-129,hn=-130,Tn=-136,Rn=-137,fn=0,ln=1,An=2,On=-1,In="SHARING_PARAM_INFO_FROM_SOCKET",Sn=24321,Nn=24322,Dn=24322,pn=24323,mn=24322,Cn=4300,vn=4299,Vn=7939,gn=12303,Un=12305,Ln=4167,Mn=4355,xn={ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",END_MEDIA:"END_MEDIA",DESTROY:"DESTROY",DC_COMING_MESSAGE:"DC_COMING_MESSAGE",AUDIO_BRIDGE_WS_TOKEN:"AUDIO_BRIDGE_WS_TOKEN"},Pn=70,Bn=170,bn=!1,Gn=!0,Fn=121,yn="AUDIO_QOS_DATA",wn="VIDEO_QOS_DATA",kn="VIDEOSHARE_QOS_DATA",Hn="NETWORK_QUALITY_CHANGE",Wn="NETWORK_QUALITY_CHANGE_AUDIO",Yn={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},Kn=66.5,Xn=66.6,Qn="ENABLE_REUSE_STREAM",jn="PRESET_MEDIA_CONSTRAINTS",Zn="DESTORY_REUSE_STREAM",zn={FAIL:4},qn="AUDIO_STREAM_MUTED",Jn="AUDIO_STREAM_UNMUTED",$n="VIDEO_STREAM_MUTED",ti="VIDEO_STREAM_UNMUTED",ei="EXPOSE_VB_FRAME",ri="UNIFIED_VB_FRAME",ni="UNIFIED_VB_STOP",ii="UNIFIED_VB_PAUSE",oi="UNIFIED_VB_ACK",ai="ANNO_UNDO_STATUS",si="ANNO_REDO_STATUS",Ei={USER_DENIED:1,SYSTEM_DENIED:2,DEVICE_IN_USE:3,NO_DEVICE:4,UNKNOWN_REASON:5,OVERCONSTRAINED:6,USER_DISMISS:7},ui={GRANTED_AUDIO_VIDEO:1,GRANTED_AUDIO:2,DENIED:3,EXCEPTION_FAILS:4,DISMISS:5}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{E(n.next(t))}catch(t){o(t)}}function s(t){try{E(n.throw(t))}catch(t){o(t)}}function E(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}E((n=n.apply(t,e||[])).next())}))},i=this&&this.__rest||function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=r(3),s=o(r(4)),E=r(1),u=o(r(5)),_=o(r(6));class c{constructor(t){this.isVBReady=!1,this.videoStream=null,this.isVBInitializing=!1,this.receiveTimer=null,this.msgChannel=null,this.isEnabled=!0,this.trackProcessor=null,this.isVBRunning=!1,this.frameRate=24,this.isStreamEnabled=!1,this.destoryed=!1,this._needFrame=!1,this._backend="",this.isMetadataLoaded=!1,this.isCapturing=!1,this.isReportVideoFrameError=!1;const e=t||{},{canvas:r,canvasID:n,bgImage:o,cdnPath:a}=e,s=i(e,["canvas","canvasID","bgImage","cdnPath"]);if(this.cdnPath=a||c.cdnPath,!this.cdnPath)throw new Error("VB module: cdnPath is not provided");this.vbWorkerUrl=this.cdnPath+"/vb_worker.min.js",this.initParam=s,this._needFrame=s.needFrame,r&&(this.cvsEle="string"==typeof r?document.querySelector("#"+r):r),o&&(this.bgImage=o),this.handle_message_from_vb_worker=this.handle_message_from_vb_worker.bind(this);const E=navigator.userAgent.toLocaleLowerCase();this.isSafari=E.includes("safari")&&!E.includes("chrome")&&!E.includes("chromium"),this.vbLoadingTimer=new _.default,this.handleLoadMetadata=this.handleLoadMetadata.bind(this),this.stats={fps:0,receivingFps:0,receivedFrames:0,generatedFrames:0,width:0,height:0}}set needFrame(t){this._needFrame=t,this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_NEED_FRAME,payload:t})}get needFrame(){return this._needFrame}get backend(){return this._backend}set ontimeout3s(t){this.vbLoadingTimer.ontimeout3s=t}set ontimeout10s(t){this.vbLoadingTimer.ontimeout10s=t}static isSupportVB(){return n(this,void 0,void 0,(function*(){try{const t=yield s.default.simd();return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&t&&"function"==typeof OffscreenCanvas}catch(t){return!1}}))}sendCanvas(){if(this.cvsEle){const t=this.cvsEle.transferControlToOffscreen();this.postMessage({cmd:a.VB_EVENT_TYPE.VB_RENDER_CANVAS,payload:t},[t])}}generateVBStream(){if(this.vbTrackGenerator){const t=this.vbTrackGenerator.writable;this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM,payload:t},[t])}else if(this.streamCanvas)if(this.isSafari){const t=this.streamCanvas.transferControlToOffscreen();this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM,payload:t},[t])}else this.streamRender=new u.default(this.streamCanvas,c.VB_STREAM_CANVAS),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM})}initialize(){return this.isVBReady?Promise.resolve():(this.isVBInitializing||(this.isVBInitializing=!0,this.vbLoadingTimer.isVBPredictDone=!1,this.initPromise=new Promise((t,e)=>n(this,void 0,void 0,(function*(){this.initReject=e,this.initResolve=t;try{const t=yield fetch(this.vbWorkerUrl);if(t.ok){const e=yield t.arrayBuffer();if(this.destoryed)return;const r=window.URL.createObjectURL(new Blob([e]));this.worker=new Worker(r,{name:c.VB_WORKER_NAME}),this.worker.addEventListener("message",this.handle_message_from_vb_worker),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_WORKER_INIT,payload:Object.assign(Object.assign({},this.initParam),{cdnPath:this.cdnPath})}),this.sendCanvas(),window.URL.revokeObjectURL(r)}else{const{url:r,status:n}=t;this.isVBInitializing=!1,e(`Fetch worker file failed. url: ${r}, status: ${n}`)}}catch(t){this.isVBInitializing=!1,e(t)}})))),this.initPromise)}send_frame(t){this.isVBReady&&("format"in t?this.postMessage({cmd:a.VB_EVENT_TYPE.VB_SEND_FRAME,payload:t},[t]):this.postMessage({cmd:a.VB_EVENT_TYPE.VB_SEND_FRAME,payload:t},[t.data.buffer]))}Crop_Mask_Bg_16V9(){let t,e,r,n=0,i=this.bgImage.width,o=this.bgImage.height;return 16/9*o>=i?(r=i,n=i/(16/9),t=0,e=(o-n)/2):(r=o*(16/9),n=o,t=(i-r)/2,e=0),{sx:t,sy:e,sw:r,sh:n}}set_background_image(t){if(this.bgImage=t,!this.isVBReady)return!1;const e=this.Crop_Mask_Bg_16V9();let r,n,i,o,s,E;r=e.sx,n=e.sy,i=e.sw,o=e.sh,i>1920?(s=1920,E=1080):(s=i,E=o),this.bgConvertCanvas||(this.bgConvertCanvas=new OffscreenCanvas(s,E)),this.bgConvertCanvas.width=s,this.bgConvertCanvas.height=E;let u=null;try{u=this.bgConvertCanvas.getContext("2d",{willReadFrequently:!0})}catch(t){}finally{u||(u=this.bgConvertCanvas.getContext("2d"))}if(!u)return!1;u.drawImage(t,r,n,i,o,0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);let _=u.getImageData(0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);return this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_BG,payload:_}),"close"in t&&t.close(),!0}set_background_blur(){this.isVBReady&&this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_BG,payload:"blur"})}handle_message_from_vb_worker(t){const{cmd:e}=t.data;switch(c.EXTERNAL_EVENTS.has(e)&&(e!==a.VB_EVENT_TYPE.VB_GENERATED_FRAME||this._needFrame)&&this.callback&&this.callback(t.data),e){case a.VB_EVENT_TYPE.VB_MODEL_READY:this.vbLoadingTimer.start();break;case a.VB_EVENT_TYPE.VB_PREDICT_DONE:{const{payload:e}=t.data;this.vbLoadingTimer.isVBPredictDone=!0,this.vbLoadingTimer.clear(),this._backend=e;break}case a.VB_EVENT_TYPE.VB_INIT_FAILED:{const{payload:e}=t.data;this.isVBInitializing=!1,this.initReject(e);break}case a.VB_EVENT_TYPE.VB_INIT_SUCCESS:this.isVBReady=!0,this.isVBInitializing=!1,this.bgImage&&this.set_background_image(this.bgImage),this.generateVBStream(),this.initResolve();break;case a.VB_EVENT_TYPE.VB_REQUEST_FRAME:if(this.updateConstraints(),this.captureVideoEle&&this.isVideoPlaying(this.captureVideoEle))if(window.VideoFrame){if(this.isMetadataLoaded)try{const t=new VideoFrame(this.captureVideoEle,{timestamp:1e3*performance.now()});this.send_frame(t),t.close()}catch(t){this.callback&&!this.isReportVideoFrameError&&(this.callback({cmd:a.VB_EVENT_TYPE.VB_WORKER_ERROR,payload:t}),this.isReportVideoFrameError=!0)}}else if(this.captureCtx){this.captureCtx.drawImage(this.captureVideoEle,0,0);const t=this.captureCtx.getImageData(0,0,this.captureVideoEle.videoWidth,this.captureVideoEle.videoHeight);this.streamRender&&this.isStreamEnabled&&!this.isEnabled&&this.streamRender.render(t),this.send_frame(t)}break;case a.VB_EVENT_TYPE.VB_GENERATED_FRAME:{const e=t.data.payload,{data_ptr:r}=e;this.streamRender&&this.isStreamEnabled&&this.streamRender.render(e),r&&this.freeMemory(r);break}case a.VB_EVENT_TYPE.VB_UPDATE_STATS:this.stats=t.data.payload;break;case a.VB_EVENT_TYPE.VB_RESOLUTION_CHANGE:{const{width:e,height:r}=t.data.payload;this.stats.width=e,this.stats.height=r}}}onMessage(t){this.callback=t}createCaptureEle(){window.MediaStreamTrackProcessor||(this.captureVideoEle=document.querySelector("#"+c.VB_CAPTURE_VIDEO),this.captureVideoEle||(this.captureVideoEle=document.createElement("video"),this.captureVideoEle.autoplay=!0,this.captureVideoEle.playsInline=!0,this.captureVideoEle.id=c.VB_CAPTURE_VIDEO,this.captureVideoEle.style.position="fixed",this.captureVideoEle.style.width="1px",this.captureVideoEle.style.height="1px",this.captureVideoEle.style.bottom="0px",this.captureVideoEle.style.right="0px",this.captureVideoEle.muted=!0,document.body.appendChild(this.captureVideoEle)),this.captureCanvas||window.VideoFrame||(this.captureCanvas=document.createElement("canvas"),this.captureCtx=this.captureCanvas.getContext("2d")))}isVideoPlaying(t){return(t.paused||t.ended)&&t.play(),t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}postMessage(t,e){var r,n;e?null===(r=this.worker)||void 0===r||r.postMessage(t,e):null===(n=this.worker)||void 0===n||n.postMessage(t)}updateStreamCanvasSize(t,e){this.streamCanvas&&(this.isSafari?this.postMessage({cmd:a.VB_EVENT_TYPE.VB_CHANGE_STREAM_CANVAS_SIZE,payload:{width:t,height:e}}):(this.streamCanvas.width=t,this.streamCanvas.height=e))}updateConstraints(){const t=this.videoStream.getVideoTracks()[0],{width:e,height:r,frameRate:n}=t.getSettings();e&&r&&(!this.streamCanvas||e===this.streamCanvas.width&&r===this.streamCanvas.height||this.updateStreamCanvasSize(e,r),this.captureCanvas&&(e!==this.captureCanvas.width&&(this.captureCanvas.width=e),r!==this.captureCanvas.height&&(this.captureCanvas.height=r))),n&&this.frameRate!=Math.min(n,24)&&(this.frameRate=Math.min(n,24),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_FRAME_RATE,payload:this.frameRate}))}captureVideo(t){return n(this,void 0,void 0,(function*(){if(this.isVBReady||this.isVBInitializing?this.isVBInitializing&&(yield this.initPromise):yield this.initialize(),this.isCapturing)return Promise.reject("Capture is already started");let e=!0;if("id"in t){if(!t.active)return Promise.reject("stream is not active");this.videoStream&&this.videoStream.id===t.id?e=!1:(this.stopCapture(),this.videoStream=t)}else if(this.videoStream&&this.captureConf===t)e=!1;else{this.stopCapture(),this.isCapturing=!0;try{this.videoStream=yield navigator.mediaDevices.getUserMedia(Object.assign(Object.assign({},t),{audio:!1})),this.captureConf=t,this.isCapturing=!1}catch(t){return this.isCapturing=!1,Promise.reject(t)}}if(this.createCaptureEle(),e){let t;if(!(t=this.videoStream.getVideoTracks()[0]))return Promise.reject("No video track in stream");{const e=t.getSettings(),{width:r=0,height:n=0,frameRate:i=24}=e;if(this.updateStreamCanvasSize(r,n),this.frameRate=Math.min(i,24),window.MediaStreamTrackProcessor){this.trackProcessor=new window.MediaStreamTrackProcessor({track:t});const e=this.trackProcessor.readable;this.postMessage({cmd:a.VB_EVENT_TYPE.VB_START,payload:{videoStream:e,frameRate:this.frameRate}},[e])}else this.captureVideoEle&&(this.isMetadataLoaded=!1,this.captureVideoEle.addEventListener("loadedmetadata",this.handleLoadMetadata),this.captureVideoEle.srcObject=this.videoStream,this.captureVideoEle.play(),this.captureCanvas&&(this.captureCanvas.width=r,this.captureCanvas.height=n),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_START,payload:{frameRate:this.frameRate}}))}}else{if(this.isVBRunning)return;this.videoStream.getVideoTracks()[0].enabled=!0,this.captureVideoEle&&this.captureVideoEle.play(),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_START})}this.isVBRunning=!0}))}stopCapture(t=!0){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_STOP,payload:t}),this.captureVideoEle&&this.captureVideoEle.pause(),this.videoStream&&t&&(this.videoStream.getTracks().forEach(t=>{t.stop()}),this.videoStream=null),this.isVBRunning=!1}setMirror(t){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_MIRROR,payload:t})}freeMemory(t){this.isVBReady&&this.postMessage({cmd:a.VB_EVENT_TYPE.VB_FREE_MEMORY,payload:t})}startReceiveMode(t){return t&&(this.captureConf=t),this.msgChannel||(this.msgChannel=new MessageChannel,this.msgChannel.port1.onmessage=t=>{var e;const{type:r,frame:n}=t.data;this.receiveTimer&&clearTimeout(this.receiveTimer),r===E.UNIFIED_VB_FRAME&&n?(null===(e=this.msgChannel)||void 0===e||e.port1.postMessage({type:E.UNIFIED_VB_ACK}),this.isEnabled?(this.isVBRunning&&this.stopCapture(),this.renderFrame(n)):n.close(),this.isSafari||(this.receiveTimer=setTimeout(()=>{this.captureConf&&!this.isVBRunning&&this.captureVideo(this.captureConf)},1e3))):r!==E.UNIFIED_VB_PAUSE&&r!==E.UNIFIED_VB_STOP||(this.captureConf&&!this.isVBRunning&&this.captureVideo(this.captureConf),r===E.UNIFIED_VB_STOP&&this.msgChannel&&(this.msgChannel.port1.onmessage=null,this.msgChannel=null))}),this.msgChannel.port2}enable(){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_TOGGLE_VB,payload:!0}),this.isEnabled=!0}disable(){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_TOGGLE_VB,payload:!1}),this.isEnabled=!1,!this.isVBRunning&&this.msgChannel&&this.captureConf&&(this.captureVideo(this.captureConf).catch(t=>{}),clearTimeout(this.receiveTimer))}renderFrame(t){return n(this,void 0,void 0,(function*(){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_RENDER_FRAME,payload:t}),"close"in t&&t.close()}))}destory(){this.destoryed=!0,this.stopCapture(),this.vbLoadingTimer.clear(),this.msgChannel&&(this.msgChannel.port2.onmessage=null),this.captureVideoEle&&document.body.removeChild(this.captureVideoEle),this.worker&&(this.worker.removeEventListener("message",this.handle_message_from_vb_worker),this.worker.terminate())}createStream(){if(this.isStreamEnabled=!0,this.vbStream)return this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM}),this.vbStream;if(window.MediaStreamTrackGenerator)this.vbTrackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.vbStream=new MediaStream([this.vbTrackGenerator]);else{if(this.streamCanvas=document.createElement("canvas"),this.videoStream){const t=this.videoStream.getVideoTracks()[0];if(t){const{width:e=0,height:r=0}=t.getSettings();this.streamCanvas.width=e,this.streamCanvas.height=r}}this.vbStream=this.streamCanvas.captureStream(24)}const t=this.vbStream.getVideoTracks()[0];return t&&(t.getStats=()=>this.stats),this.isVBReady&&this.generateVBStream(),this.vbStream}stopStream(){this.vbStream&&(this.isStreamEnabled=!1,this.postMessage({cmd:a.VB_EVENT_TYPE.VB_STOP_STREAM}))}handleLoadMetadata(){this.isMetadataLoaded=!0,this.captureVideoEle.removeEventListener("loadedmetadata",this.handleLoadMetadata)}}if(c.VB_WORKER_NAME="vb_worker",c.VB_CAPTURE_VIDEO="VB_CAPTURE_VIDEO",c.VB_STREAM_CANVAS="VB_STREAM_CANVAS",c.EXTERNAL_EVENTS=new Set([a.VB_EVENT_TYPE.VB_GENERATED_FRAME,a.VB_EVENT_TYPE.VB_INIT_FAILED,a.VB_EVENT_TYPE.VB_INIT_SUCCESS,a.VB_EVENT_TYPE.VB_MODEL_READY,a.VB_EVENT_TYPE.VB_PREDICT_DONE,a.VB_EVENT_TYPE.VB_VIDEO_FORMAT_UNSUPPORTED,a.VB_EVENT_TYPE.VB_WORKER_ERROR,a.VB_EVENT_TYPE.VB_GENERATE_FIRST_FRAME,a.VB_EVENT_TYPE.VB_RESOLUTION_CHANGE]),e.default=c,document){const t=document.currentScript;if(t){const e=t.src;if(e){let t=e.indexOf("/vb.min.js");-1!==t&&(c.cdnPath=e.substring(0,t))}}}},function(t,e,r){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.VB_VIDEOFRAME_COPYTO_ERROR=e.VB_EVENT_TYPE=void 0,function(t){t.VB_INIT_SUCCESS="VB_INIT_SUCCESS",t.VB_INIT_FAILED="VB_INIT_FAILED",t.VB_GENERATED_FRAME="VB_GENERATED_FRAME",t.VB_SEND_FRAME="VB_SEND_FRAME",t.VB_UPDATE_BG="VB_UPDATE_BG",t.VB_PREDICT_DONE="VB_PREDICT_DONE",t.VB_MODEL_READY="VB_MODEL_READY",t.VB_FREE_MEMORY="VB_FREE_MEMORY",t.VB_VIDEO_FORMAT_UNSUPPORTED="VB_VIDEO_FORMAT_UNSUPPORTED",t.VB_WORKER_INIT="VB_WORKER_INIT",t.VB_WORKER_ERROR="VB_WORKER_ERROR",t.VB_RENDER_CANVAS="VB_RENDER_CANVAS",t.VB_RENDER_FRAME="VB_RENDER_FRAME",t.VB_START="VB_START",t.VB_REQUEST_FRAME="VB_REQUEST_FRAME",t.VB_TOGGLE_VB="VB_TOGGLE_VB",t.VB_STOP="VB_STOP",t.VB_MIRROR="VB_MIRROR",t.VB_GENERATE_STREAM="VB_GENERATE_STREAM",t.VB_STOP_STREAM="VB_STOP_STREAM",t.VB_CHANGE_STREAM_CANVAS_SIZE="VB_CHANGE_STREAM_CANVAS_SIZE",t.VB_GENERATE_FIRST_FRAME="VB_GENERATE_FIRST_FRAME",t.VB_UPDATE_STATS="VB_UPDATE_STATS",t.VB_UPDATE_NEED_FRAME="VB_UPDATE_NEED_FRAME",t.VB_UPDATE_FRAME_RATE="VB_UPDATE_FRAME_RATE",t.VB_RESOLUTION_CHANGE="VB_RESOLUTION_CHANGE"}(n||(e.VB_EVENT_TYPE=n={})),e.VB_VIDEOFRAME_COPYTO_ERROR="VB_VIDEOFRAME_COPYTO_ERROR"},function(t,e,r){"use strict";r.r(e);let n=function(){};n.prototype={threads:async()=>(async t=>{if(!WebAssembly.validate(t))return!1;try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),!0}catch(t){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),simd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))},e.default=new n},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{E(n.next(t))}catch(t){o(t)}}function s(t){try{E(n.throw(t))}catch(t){o(t)}}function E(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}E((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(7)),a=r(0);e.default=class{constructor(t,e){this.isMirror=!1,this.display=new o.default(t,e,0,void 0,{preserveDrawingBuffer:!1},void 0,!1,!1)}renderFrame(t,e,r,n){if(this.display){let i={x:0,y:0,width:this.display.canvasElement.width,height:this.display.canvasElement.height};this.display.updateRemoteVideoTextures(t,e,n,r,0,!0,i,!1),this.display.drawRemoteVideo(i,this.isMirror)}}render(t){return n(this,void 0,void 0,(function*(){let e=a.VIDEO_RGBA;if("data_ptr"in t){const{data:e,format_width:r,format_height:n,valid_x:i,valid_y:o,valid_width:s,valid_height:E}=t;let u={top:o,left:i,width:s,height:E};this.display.setVideoMode(a.VIDEO_I420),this.renderFrame(r,n,e,u)}else if(self.VideoFrame&&t instanceof VideoFrame){const{format:r,visibleRect:n}=t;if(r&&n){if("I420"===r||"I420A"===r)e=a.VIDEO_I420;else if("NV12"===r)e=a.VIDEO_NV12;else{if("BGRA"!==r)return void(this.onUnsupportedFrame&&this.onUnsupportedFrame(r));e=a.VIDEO_BGRA}const{width:i,height:o}=n,s=new Uint8Array(t.allocationSize()),E={top:0,left:0,width:i,height:o};this.display.setVideoMode(e);try{yield t.copyTo(s),this.renderFrame(i,o,s,E)}catch(t){}t.close()}}else if(t instanceof ImageData){const{width:e,height:r}=t,n={top:0,left:0,width:e,height:r};this.display.setVideoMode(a.VIDEO_RGBA),this.renderFrame(e,r,t.data,n)}}))}updateSize(t,e){this.display.canvasElement.width=t,this.display.canvasElement.height=e}setMirror(t){this.isMirror=t}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.timer3s=null,this.timer10s=null,this.isVBPredictDone=!1,this.inited=!1}start(){this.inited=!0,this.clear(),this.timer3s=setTimeout(()=>{this.isVBPredictDone||this.ontimeout3s()},3e3),this.timer10s=setTimeout(()=>{this.isVBPredictDone||this.ontimeout10s()},1e4)}clear(){clearTimeout(this.timer3s),clearTimeout(this.timer10s),this.timer3s=null,this.timer10s=null}}},function(t,e,r){"use strict";r.r(e);var n=r(0);const i=t=>0==(t&t-1);var o=new class{constructor(){this._highFrequencyLogs={},this.fixVersion=""}setInstance(t,e){this._instance=t,this.fixVersion=e}getMessageFromErrorOrEvent(t,e){let r=t;return e instanceof ErrorEvent?(e.filename&&(r+=" File: ".concat(e.filename)),(e.lineno||e.colno)&&(r+=" Line: ".concat(e.lineno,":").concat(e.colno)),e.message&&(r+=" Message: ".concat(e.message)),e.error&&(r+="\nStack: ".concat(e.error.stack))):e instanceof Error?(e.fileName&&(r+=" File: ".concat(e.fileName)),(e.lineNumber||e.columnNumber)&&(r+=" Line: ".concat(e.lineNumber,":").concat(e.columnNumber)),e.message&&(r+=" Message: ".concat(e.message)),e.stack&&(r+=" Stack: ".concat(e.stack)),e.name&&(r+=" Name: ".concat(e.name)),e.constraint&&(r+=" Constraint: ".concat(e.constraint))):e instanceof CloseEvent?(e.code&&(r+=" Code: ".concat(e.code)),e.reason&&(r+=" Reason: ".concat(e.reason)),r+=" wasClean: ".concat(e.wasClean)):e instanceof DOMException?(e.message&&(r+=" Message: ".concat(e.message)),e.name&&(r+=" Name: ".concat(e.name))):r+=e?e.toString():"",r}error(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t=this.getMessageFromErrorOrEvent(t,e),this._highFrequencyLogs[t]?this._highFrequencyLogs[t]+=1:this._highFrequencyLogs[t]=1;const r=i(this._highFrequencyLogs[t]);this._instance&&r&&this._instance.error(t,[this.fixVersion])}severityerror(t,e){this._instance&&this._instance.error(JSON.stringify(t),e)}directReport(t,e){var r,n;this._instance&&(e||(e=["MEDIASDK_INFO"]),null===(r=(n=this._instance).directReport)||void 0===r||r.call(n,{msg:t},e))}warn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t=this.getMessageFromErrorOrEvent(t,e),this._instance&&this._instance.warn(t)}log(t){this._instance&&this._instance.log(t)}clearHighFrequencyLogs(){this._highFrequencyLogs={}}};new Error;const a=new Map;function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"|";return t?t.toString().replaceAll(/[,，]/g,e):""}let E=null,u=null;function _(t,e){var r,n;if(!function(t){const e=performance.now();return(!a.has(t)||e-a.get(t)>5e3)&&(a.set(t,e),!0)}(t))return;let i;try{i=s("object"==typeof e?JSON.stringify(e):e)}catch(t){i=s(e)}null===(r=u)||void 0===r||r("NEM-".concat(t,"-").concat(i)),o.error("NotifyUIError,event=".concat(t,",data=").concat(i)),null===(n=E)||void 0===n||n(t,e)}var c=r(1);const d="function"!=typeof importScripts;function h(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;d?o.error(t,e):T(t,e)}function T(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var r,n,i,o;(e instanceof Error||e instanceof ErrorEvent)&&(t+=" Message: "+(null===(r=e)||void 0===r?void 0:r.message)+" Stack: "+(null!==(n=null===(i=e)||void 0===i||null===(i=i.error)||void 0===i?void 0:i.stack)&&void 0!==n?n:null===(o=e)||void 0===o?void 0:o.stack),e=null);postMessage({status:61,errorMessage:t,errorEvent:e})}function R(t){postMessage({status:61,errorMessage:t,level:"low"})}function f(t){d?_(c.WEBGL_CONTEXT_INVALID,t):postMessage({status:-27,where:t})}const l=["","MOZ_","OP_","WEBKIT_"];function A(t,e){for(var r=0;r<l.length;++r){var n=l[r]+e,i=t.getExtension(n);if(i)return i}}new Map,new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(t,e){this.ssrcInfoMap.has(t)||this.ssrcInfoMap.set(t,{firstTime:0,lastTime:0,frames:0,fps:0}),this._calculateFPS(t,e),this._removeZeroFPS()}_calculateFPS(t,e){const r=this.ssrcInfoMap.get(t);if(0===r.frames?r.firstTime=e:r.lastTime=e,r.frames+=1,r.frames>2&&r.frames%5==0&&r.lastTime-r.firstTime>=1e3){const e=Math.floor(1e3/((r.lastTime-r.firstTime)/(r.frames-1)));r.fps!==e&&(this._notifyFPS(t,e),r.fps=e),r.firstTime=r.lastTime,r.frames=1}}_removeZeroFPS(){let t=Date.now();this.ssrcInfoMap.forEach((e,r)=>{const n=this.ssrcInfoMap.get(r);n&&t-n.lastTime>2e3&&(this.ssrcInfoMap.delete(r),this._notifyFPS(r,0))})}_notifyFPS(t,e){postMessage({status:66.6,data:{ssrc:t,fps:e}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this._removeZeroFPS(),this.timer=null},2500)}};function O(t,e){const r=Math.pow(10,e);return Math.floor(t*r)/r}function I(t,e){const r=Math.pow(10,e);return Math.ceil(t*r)/r}function S(t,e,r,n){return D(t,e),N(r,"set"),function(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}(t,r,n),n}function N(t,e){if(void 0===t)throw new TypeError("attempted to "+e+" private static field before its declaration")}function D(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}class p{static isEnableCanvasCtxOptionsOpt(){return e=m,D(t=p,p),N(e,"get"),function(t,e){return e.get?e.get.call(t):e.value}(t,e);var t,e}static setIsEnableCanvasCtxOptionsOpt(t){S(p,p,m,t)}}var m={writable:!0,value:!1},C=p;let v=new Map,V=[];function g(t){t.preventDefault()}function U(t,e,r,i,o,a,s){let E=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.canvasElement=t,this.canvasID=e,this.contextOptions=o,this.textureindex=r||0,this.texturestride=this.textureindex?3:s?4:6,this.initmask=s||!1,this.reuse=!1,this.isEnableCanvasAlphaChannel=E,U.prototype.ROTATION_CLOCK0=0,U.prototype.ROTATION_CLOCK90=1,U.prototype.ROTATION_CLOCK180=2,U.prototype.ROTATION_CLOCK270=3,this.webGLResources=a,a||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(a);var u=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(u),this.dummpyWaterMark=new Uint8Array(u),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=n.VIDEO_INVALID,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0}function L(t,e,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;var o=t.contextGL;let a=o.canvas.width,s=o.canvas.height;i&&(a=i.width,s=i.height);var E,u,_,c,d=n==t.ROTATION_CLOCK90||n==t.ROTATION_CLOCK270?r:e,h=n==t.ROTATION_CLOCK90||n==t.ROTATION_CLOCK270?e:r,T=d/h*s,R=h/d*a;T>a?(E=0,_=1,c=1-(u=(s-R)/2/s)):(u=0,c=1,_=1-(E=(a-T)/2/a)),E=2*E-1,_=2*_-1,u=1-2*u,c=1-2*c;var f=new Float32Array([_,u,E,u,_,c,E,c,_,u,E,u,_,c,E,c]);o.bindBuffer(o.ARRAY_BUFFER,t.vertexPosBuffer),o.bufferData(o.ARRAY_BUFFER,f,o.DYNAMIC_DRAW)}function M(t,e,r,n,i){var o=t.contextGL,a=n.top/r,s=n.left/e,E=a+(n.height-1)/r,u=s+n.width/e,_=[s,a,u,a,u,E,s,E];i==t.ROTATION_CLOCK90&&(_.unshift(_[6],_[7]),_=_.slice(0,8)),i==t.ROTATION_CLOCK180&&(_.unshift(_[4],_[5],_[6],_[7]),_=_.slice(0,8)),i==t.ROTATION_CLOCK270&&(_.push(_[0],_[1]),_=_.slice(2));var c=_[0],d=_[1];_[0]=_[2],_[1]=_[3],_[2]=c,_[3]=d;var h=new Float32Array([..._,1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,t.texturePosBuffer),o.bufferData(o.ARRAY_BUFFER,h,o.DYNAMIC_DRAW)}U.prototype.reinit=function(t){if(this.webGLResources=t,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;let t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();let t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},U.prototype.webGLContextLostSimulate=function(){let t="undefined"==typeof window?self:window;t.webGLEXTSimulate=t.webGLEXTSimulate||[],t.webGLEXTSimulate.push(A(this.contextGL,"WEBGL_lose_context"))},U.prototype.restoreContext=function(){if(this.contextGL)try{var t,e;if(null!==(t=this.canvasElement)&&void 0!==t&&t.loseContextExtension&&!this.canvasElement.restoreTimeoutId&&this.contextGL.isContextLost())this.canvasElement.restoreTimeoutId=setTimeout(()=>{f("WebGLRestoreTimeout")},1500),null===(e=this.canvasElement)||void 0===e||e.loseContextExtension.restoreContext()}catch(t){h("webgl restoreContext exception",t)}},U.prototype.webgGLContextLostCallback=function(t){R("webglcontextlost event: canvas listener size=".concat(V.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(V.join())),t.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(t,this.contextOptions.params)},U.prototype.removeEventListener=function(t,e){if(t&&e){0,t.restoreTimeoutId&&(clearTimeout(t.restoreTimeoutId),t.restoreTimeoutId=void 0),t.removeEventListener("webglcontextlost",e.contextLostHandler),t.removeEventListener("webglcontextrestored",e.contextRestoredHandler);const r=V.indexOf(this.canvasID);V.splice(r,1),v.delete(t)}},U.prototype.webGLContextRestoredCallback=function(t){R("webglcontextrestored event from canvas id: ".concat(this.canvasID)),this.canvasElement.restoreTimeoutId&&(clearTimeout(this.canvasElement.restoreTimeoutId),this.canvasElement.restoreTimeoutId=void 0),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(t,this.contextOptions.params)},U.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=A(this.contextGL,"WEBGL_lose_context"));let t=this.canvasElement,e=v.get(t);e&&this.removeEventListener(t,e),v.set(t,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),t.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),t.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===V.indexOf(this.canvasID)&&(V.push(this.canvasID),V.length>4&&R("webglcanvas listener size=".concat(V.length,", ids:").concat(V.join())))},U.prototype.isWebGL=function(){return this.contextGL},U.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},U.prototype.initContextGL=function(){for(var t,e,r,n=this.canvasElement,i=null,o=["webgl","experimental-webgl","moz-webgl","webkit-3d"],a=0;!i&&a<o.length;){var s=o[a];try{if(C.isEnableCanvasCtxOptionsOpt()){let t={depth:!1,stencil:!1,antialias:!1,alpha:this.isEnableCanvasAlphaChannel};if(this.contextOptions){let e={...this.contextOptions,...t};i=n.getContext(s,e)}else i=n.getContext(s,t)}else i=this.contextOptions?n.getContext(s,this.contextOptions):n.getContext(s)}catch(t){i=null}i&&"function"==typeof i.getParameter||(i=null),++a}if(this.contextGL=i,!i||i.isContextLost())return h("Failed when trying to get WebGLContext on canvas(".concat(null===(t=this.canvasElement)||void 0===t?void 0:t.width,",").concat(null===(e=this.canvasElement)||void 0===e?void 0:e.height,"), gl=").concat(i,", lost=").concat(null===(r=i)||void 0===r?void 0:r.isContextLost())),void f("InitWebGLFail");i.glInitSucceed=0},U.prototype.initProgram=function(){var t=this.contextGL;var e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,"\n    attribute vec4 vertexPos;\n    attribute vec4 texturePos;\n    attribute vec4 masktexturePos;\n    varying vec2 textureCoord;\n    varying vec2 masktextureCoord;\n\n    void main() {\n        gl_Position = vertexPos;\n        textureCoord = texturePos.xy;\n        masktextureCoord = masktexturePos.xy;\n    }\n  "),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)||t.isContextLost()||R("webgl Vertex shader failed to compile: "+t.getShaderInfoLog(e));var r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,"\n    precision highp float;\n    varying highp vec2 textureCoord;\n    varying highp vec2 masktextureCoord;\n    \n    uniform sampler2D ySampler;\n    uniform sampler2D uSampler;\n    uniform sampler2D vSampler;\n    uniform sampler2D cursorSampler;\n    uniform sampler2D waterMarkSampler;\n    uniform sampler2D previewVideoSampler;\n    uniform sampler2D maskSampler;\n    \n    uniform vec4 cursorInfo;\n    uniform int onlyRGBA;\n    uniform int bgraMode;\n    uniform int colorRange;\n    uniform int waterMarkFlag;\n    uniform int cursorFlag;\n    uniform int yuvmode;\n    \n    const int MAX_ELLIPSE_COUNT = 10;\n    uniform int maskFlag;                       // 0: mask disabled; 1: mask enabled;\n    uniform int maskMode;                       // 0: static mask; 1: dynamic mask;\n    uniform vec4 uEllipses[MAX_ELLIPSE_COUNT];  // each ellipse contains (cx, cy, rx, ry) 4-coords\n    uniform int uEllipseCount;                  // how many ellipses will draw\n\n    const mat4 YUV2RGB_L = mat4(\n      1.1643828125, 0, 1.59602734375, -0.87078515625,\n      1.1643828125, -0.39176171875, -0.81296875, 0.52959375,\n      1.1643828125, 2.017234375, 0, -1.081390625,\n      0, 0, 0, 1\n    );\n\n    const mat4 YUV2RGB_F = mat4(\n      1.0, 0, 1.402, -0.701,\n      1.0, -0.34413, -0.71414, 0.529135,\n      1.0, 1.772, 0, -0.886,\n      0, 0, 0, 1\n    );\n\n    void main(void) {\n      vec4 c;\n      if (waterMarkFlag != 1) {\n        if (onlyRGBA == 0) {\n          highp float y = texture2D(ySampler, textureCoord).r;\n          highp float u;\n          highp float v;\n\n          if (yuvmode == 1) {\n            u = texture2D(uSampler, textureCoord).r;\n            v = texture2D(vSampler, textureCoord).r;\n          } else {\n            u = texture2D(uSampler, textureCoord).r;\n            v = texture2D(uSampler, textureCoord).a;\n          }\n\n          if (colorRange == 0) {\n            c = vec4(y, u, v, 1) * YUV2RGB_L;\n          } else {\n            c = vec4(y, u, v, 1) * YUV2RGB_F;\n          }\n\n          if (cursorFlag == 1) {\n            if (cursorInfo.z > 0.0 && \n                textureCoord.x >= cursorInfo.x && \n                textureCoord.y >= cursorInfo.y && \n                textureCoord.x < cursorInfo.x + cursorInfo.z && \n                textureCoord.y < cursorInfo.y + cursorInfo.w) {\n              \n              vec2 cursorCoord = textureCoord - cursorInfo.xy;\n              cursorCoord /= cursorInfo.zw;\n              vec4 cursor = texture2D(cursorSampler, cursorCoord);\n              c = c * (1.0 - cursor.a) + cursor * cursor.a;\n            }\n          }\n        } else {\n          c = texture2D(previewVideoSampler, textureCoord);\n          if (bgraMode == 1) {\n            c = vec4(c.b, c.g, c.r, c.a);\n          }\n        }\n      } else {\n        c = texture2D(waterMarkSampler, textureCoord);\n        if (c.r == 0.0 && c.g == 0.0 && c.b == 0.0) {\n          c.a = 0.0;\n        }\n      }\n\n      if (maskFlag == 1 && waterMarkFlag != 1) {\n        vec4 mask = texture2D(maskSampler, masktextureCoord);\n        if (maskMode == 0) {\n          // -- handle static mask --\n          if (mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0) {\n            c = mask * mask.a + c * (1.0 - mask.a);\n          }\n        } else if (maskMode == 1) {\n          // -- handle dynamic mask -- \n          bool inEllipse = false; // variable for checking whether the pixel to be drawn hits ellipse\n          for (int i = 0; i < MAX_ELLIPSE_COUNT; i++) {\n            if (i > uEllipseCount) break;\n\n            vec2 ellipseCenter = uEllipses[i].xy;\n            vec2 ellipseRadii = uEllipses[i].zw;\n            vec2 ellipsePos = masktextureCoord - ellipseCenter;\n\n            float ellipseEq = (ellipsePos.x * ellipsePos.x) / (ellipseRadii.x * ellipseRadii.x) + \n                              (ellipsePos.y * ellipsePos.y) / (ellipseRadii.y * ellipseRadii.y);\n            if (ellipseEq <= 1.0) {\n              // the pixel in the ellipse range\n              inEllipse = true;\n              break;\n            }\n          }\n\n          if (inEllipse) {\n            c = mask * mask.a + c * (1.0 - mask.a);\n          }\n        }\n      }\n\n      if (waterMarkFlag != 1) {\n        c.a = 1.0;\n      }\n\n      gl_FragColor = c;\n    }\n"),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)||t.isContextLost()||R("webgl Fragment shader failed to compile: "+t.getShaderInfoLog(r));var n=t.createProgram();t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||t.isContextLost()||R("webgl Program failed to compile: "+t.getProgramInfoLog(n)),t.useProgram(n),this.shaderProgram=n},U.prototype.initBuffers=function(){var t=this.contextGL,e=this.shaderProgram,r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var n=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),this.vertexPosBuffer=r;var i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var o=t.getAttribLocation(e,"texturePos");if(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"masktexturePos");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),this.masktexturePosBuffer=a}this.texturePosBuffer=i},U.prototype.initTextures=function(t){var e=this.contextGL,r=this.shaderProgram;e.pixelStorei(e.UNPACK_ALIGNMENT,1);var i=this.initTexture();this.yTextureRef=i,this.oyTextureRef=i;var o=this.initTexture();this.uTextureRef=o,this.ouTextureRef=o;var a=this.initTexture();if(this.vTextureRef=a,this.ovTextureRef=a,t){this.BindTextures(n.VIDEO_I420);var s=this.initTexture(),E=e.getUniformLocation(r,"cursorSampler");e.uniform1i(E,this.textureindex*this.texturestride+3),this.cursorTextureRef=s;var u=this.initTexture(),_=e.getUniformLocation(r,"waterMarkSampler");e.uniform1i(_,4),this.waterMarkTextureRef=u;var c=this.initTexture();this.repeatedWaterMarkTextureRef=c;var d=this.initTexture(),h=e.getUniformLocation(r,"previewVideoSampler");e.uniform1i(h,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=d;var T=e.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=T}if(this.initmask){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1);var R=this.initTexture(),f=e.getUniformLocation(r,"maskSampler");e.uniform1i(f,this.textureindex*this.texturestride+6),this.maskTextureRef=R}var l=e.getUniformLocation(r,"colorRange");this.colorRangeRef=l,this.onlyRGBARef=e.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=e.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=e.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=e.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=e.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=e.getUniformLocation(r,"yuvmode")},U.prototype.BindTextures=function(t){var e=this.contextGL,r=this.shaderProgram;if(e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,this.yTextureRef),e.activeTexture(e.TEXTURE0+1),e.bindTexture(e.TEXTURE_2D,this.uTextureRef),e.activeTexture(e.TEXTURE0+2),e.bindTexture(e.TEXTURE_2D,this.vTextureRef),t==n.VIDEO_I420){let t=e.getUniformLocation(r,"ySampler");e.uniform1i(t,0);let n=e.getUniformLocation(r,"uSampler");e.uniform1i(n,1);let i=e.getUniformLocation(r,"vSampler");e.uniform1i(i,2)}else if(this.isRGBAMode(t)){let t=e.getUniformLocation(r,"previewVideoSampler");e.uniform1i(t,0);let n=e.getUniformLocation(r,"ySampler");e.uniform1i(n,0);let i=e.getUniformLocation(r,"uSampler");e.uniform1i(i,0);let o=e.getUniformLocation(r,"vSampler");e.uniform1i(o,0)}else if(t==n.VIDEO_NV12){let t=e.getUniformLocation(r,"ySampler");e.uniform1i(t,0);let n=e.getUniformLocation(r,"uSampler");e.uniform1i(n,1);let i=e.getUniformLocation(r,"vSampler");e.uniform1i(i,0)}let i=e.getUniformLocation(r,"previewVideoSampler");e.uniform1i(i,0);let o=e.getUniformLocation(r,"maskSampler");this.initmask?(e.activeTexture(e.TEXTURE0+6),e.bindTexture(e.TEXTURE_2D,this.maskTextureRef),e.uniform1i(o,6)):e.uniform1i(o,0);let a=e.getUniformLocation(r,"cursorSampler");e.uniform1i(a,0);let s=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(s,0)},U.prototype.initTexture=function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e},U.prototype.clearDisplay=function(){var t=this.contextGL;t&&(t.enable(t.BLEND),t.blendFunc(t.ZERO,t.ZERO)),this.render()},U.prototype.cleanup=function(){let t=this.canvasElement,e=v.get(t);if(e&&this.removeEventListener(t,e),t.defaultContextLostHandler||(t.defaultContextLostHandler=g,t.addEventListener("webglcontextlost",g,{capture:!1})),this.isAvaiable()){var r=this.contextGL;r.deleteProgram(this.program),r.activeTexture(r.TEXTURE0+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE2+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),this.textureindex||this.initmask||(r.activeTexture(r.TEXTURE3+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE4+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(this.getRepeatedWatermarkTextureValue(r)),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE5+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null)),r.bindBuffer(r.ARRAY_BUFFER,null),r.deleteTexture(this.yTextureRef),r.deleteTexture(this.uTextureRef),r.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(r.deleteTexture(this.cursorTextureRef),r.deleteTexture(this.waterMarkTextureRef),r.deleteTexture(this.repeatedWaterMarkTextureRef),r.deleteTexture(this.previewVideoTextureRef),r.deleteBuffer(this.vertexPosBuffer),r.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&r.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&r.deleteBuffer(this.masktexturePosBuffer),r.glInitSucceed=0}},U.prototype.drawNextOutputPicture=function(t,e,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var o=this.contextGL;o?this.drawNextOutputPictureFrame(t,e,r,n,i):this.drawNextOuptutPictureRGBA(t,e,r,n)},U.prototype.updateVertexInfoForMultiView=function(t,e,r,n,i){var o,a,s,E,u=this.contextGL;if(this.isUseFillMode({width:r,height:n,rotation:i}))o=0,a=0,s=1,E=1;else{var _=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?n:r,c=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r:n,d=_/c*e;d>t?(o=0,s=1,E=1-(a=(e-c/_*t)/2/e)):(a=0,E=1,s=1-(o=(t-d)/2/t))}o=2*o-1,s=2*s-1,a=1-2*a,E=1-2*E;var h=new Float32Array([s,a,o,a,s,E,o,E,1,1,-1,1,1,-1,-1,-1]);u.bindBuffer(u.ARRAY_BUFFER,this.vertexPosBuffer),u.bufferData(u.ARRAY_BUFFER,h,u.DYNAMIC_DRAW)},U.prototype.updateTextureInfoForMultiView=function(t,e,r,n,i,o,a){var s,E,u,_,c=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:n})){const i=n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?a/o:o/a,c=r.left||0,d=r.top||0;if(r.width/r.height>i){const n=r.height*i;s=d/e,E=(Math.round((r.width-n)/2)+c)/t,u=s+(r.height-1)/e,_=E+n/t}else{const n=r.width/i;u=(s=(Math.round((r.height-n)/2)+d)/e)+(n-1)/e,_=(E=c/t)+r.width/t}}else s=I(r.top/e,2),E=I(r.left/t,2),u=O((r.top+r.height-1)/e,2),_=O((r.width-1+r.left)/t,2);var d=[E,s,_,s,_,u,E,u];n==this.ROTATION_CLOCK90&&(d.unshift(d[6],d[7]),d=d.slice(0,8)),n==this.ROTATION_CLOCK180&&(d.unshift(d[4],d[5],d[6],d[7]),d=d.slice(0,8)),n==this.ROTATION_CLOCK270&&(d.push(d[0],d[1]),d=d.slice(2,10));var h=d[0],T=d[1];if(d[0]=d[2],d[1]=d[3],d[2]=h,d[3]=T,i)if(n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270){let t=d[1];d[1]=d[3],d[3]=t,t=d[5],d[5]=d[7],d[7]=t}else d[0]=1-d[0],d[2]=1-d[2],d[4]=1-d[4],d[6]=1-d[6];var R=new Float32Array([...d,1,0,0,0,1,1,0,1]);c.bindBuffer(c.ARRAY_BUFFER,this.texturePosBuffer),c.bufferData(c.ARRAY_BUFFER,R,c.DYNAMIC_DRAW)},U.prototype.drawNextOutputPictureFrame=function(t,e,r,i,o){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!this.isAvaiable())return;var u=this.contextGL,_=(this.texturePosBuffer,this.yTextureRef),c=this.uTextureRef,d=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),o=o||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:t,height:e}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,T=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,R=u.canvas.width!=this.canvasWidth||u.canvas.height!=this.canvasHeight,f=t!=this.textureWidth||e!=this.textureHeight,l=o!=this.picRotation;(h||R||l)&&L(this,r.width,r.height,o,s),(h||T||f||l)&&M(this,t,e,r,o);let A=a?0:1;A!=this.colorRange&&(u.uniform1i(this.colorRangeRef,A),this.colorRange=A),s?u.viewport(s.x,s.y,s.width,s.height):u.viewport(0,0,u.canvas.width,u.canvas.height),u.uniform1i(this.onlyRGBARef,0),u.uniform1i(this.yuvmodeRef,n.VIDEO_I420),Object.assign(this.croppingParams,r),this.textureWidth=t,this.textureHeight=e,this.picRotation=o,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height,u.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),u.clear(u.COLOR_BUFFER_BIT);var O=i,I=t*e;if(u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,_),E){var S=O.subarray(0,I);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t,e,0,u.LUMINANCE,u.UNSIGNED_BYTE,S)}var N=t/2*e/2;if(u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,c),E){var D=O.subarray(I,I+N);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t/2,e/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,D)}var p=N;if(u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,d),E){var m=O.subarray(I+N,I+N+p);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t/2,e/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,m)}u.activeTexture(u.TEXTURE3),u.bindTexture(u.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?u.uniform1i(this.cursorFlagRef,1):E&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyCursor),u.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),u.activeTexture(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,this.previewVideoTextureRef),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyWaterMark);var C=u.getUniformLocation(this.shaderProgram,"maskSampler");u.uniform1i(C,5),this.render(),this.hasWholeFrame=1},U.prototype.updateTextureBlock=function(t,e,r,n,i){if(this.isAvaiable()){var o=this.contextGL,a=i;if(!(!this.hasWholeFrame||t<=0||e<=0||r<0||n<0||r+t>this.textureWidth||n+e>this.textureHeight)&&i&&i.length==t*e*3/2){var s=this.yTextureRef,E=this.uTextureRef,u=this.vTextureRef,_=t*e,c=a.subarray(0,_);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,s),o.texSubImage2D(o.TEXTURE_2D,0,r,n,t,e,o.LUMINANCE,o.UNSIGNED_BYTE,c);var d=t/2*e/2,h=a.subarray(_,_+d);o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,E),o.texSubImage2D(o.TEXTURE_2D,0,r/2,n/2,t/2,e/2,o.LUMINANCE,o.UNSIGNED_BYTE,h);var T=d,R=a.subarray(_+d,_+d+T);o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,u),o.texSubImage2D(o.TEXTURE_2D,0,r/2,n/2,t/2,e/2,o.LUMINANCE,o.UNSIGNED_BYTE,R)}}},U.prototype.updateCursor=function(t,e,r){if(this.isAvaiable()){var n=this.contextGL;t<=0||e<=0||!r||r.length!=t*e*4||(n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,this.cursorTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,r),this.cursorWidth=t,this.cursorHeight=e,this.hasCursor=1)}},U.prototype.updateWatermark=function(t,e,r){if(this.isAvaiable()){this.contextGL;t<=0||e<=0||!r||r.length!=t*e*4||(this.watermarkData=r,this.watermarkWidth=t,this.watermarkHeight=e,this.hasWaterMark=1)}},U.prototype.drawWatermark=function(){if(this.isAvaiable()){var t=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){t.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(t.activeTexture(this.getRepeatedWatermarkTextureValue(t)),t.bindTexture(t.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,this.waterMarkTextureRef)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.watermarkWidth,this.watermarkHeight,0,t.RGBA,t.UNSIGNED_BYTE,this.watermarkData);let e=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(e,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,4,4)}}},U.prototype.render=function(){if(this.isAvaiable()){var t=this.contextGL;t.uniform1i(this.waterMarkFlagRef,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.drawWatermark()}},U.prototype.drawCursor=function(t,e,r,n,i){if(this.isAvaiable()){var o=this.contextGL;if(!(!this.hasWholeFrame||t&&(n<0||i<0))){o.viewport(0,0,o.canvas.width,o.canvas.height);var a=this.yTextureRef,s=this.uTextureRef,E=this.vTextureRef,u=this.cursorTextureRef;if(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,s),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,E),o.activeTexture(o.TEXTURE3),o.bindTexture(o.TEXTURE_2D,u),t&&this.hasCursor){let t=e/this.croppingParams.width,a=r/this.croppingParams.height,s=n/this.croppingParams.width,E=i/this.croppingParams.height;this.cx=t,this.cy=a,this.cw=s,this.ch=E,o.uniform4f(this.cursorInfoRef,t,a,s,E)}else o.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},U.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0},U.prototype.clearCanvas=function(t){if(this.isAvaiable()){var e=this.contextGL;t?e.clearColor(t.R,t.G,t.B,t.A):e.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),e.clear(e.COLOR_BUFFER_BIT)}},U.prototype.drawNextOuptutPictureRGBA=function(t,e,r,n){if(this.isAvaiable()){var i=n,o=this.canvasElement.getContext("2d"),a=o.getImageData(0,0,t,e);a.data.set(i),o.putImageData(a,0,0)}},U.prototype.isRGBAMode=function(t){return-1!==[n.VIDEO_RGBA,n.VIDEO_BGRA].indexOf(t)},U.prototype.updateRemoteVideoTextures=function(t,e,r,i,o){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(!this.isAvaiable())return;var E=this.contextGL,u=this.yTextureRef,_=this.uTextureRef,c=this.vTextureRef;E.enable(E.BLEND),E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA);const d=this.isRGBAMode(this.videoMode);if(t<=0||e<=0||!i||!i.length||i.length!=t*e*3/2&&!d||r&&(r.top<0||r.left<0||r.left+r.width>t||r.top+r.height>e))return!1;let h=a?0:1;if(this.colorRange=h,this.rotation=o,Object.assign(this.croppingParams,r),this.textureWidth=t,this.textureHeight=e,this.canvasWidth=E.canvas.width,this.canvasHeight=E.canvas.height,!s)return;if(E.bindTexture(E.TEXTURE_2D,u),d)return void E.texImage2D(E.TEXTURE_2D,0,E.RGBA,t,e,0,E.RGBA,E.UNSIGNED_BYTE,i);var T=i,R=t*e,f=T.subarray(0,R);E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE,t,e,0,E.LUMINANCE,E.UNSIGNED_BYTE,f);let l=0,A=0;this.videoMode==n.VIDEO_I420?(l=t/2*e/2,A=l):this.videoMode==n.VIDEO_NV12&&(l=t*e/2,A=0);var O=T.subarray(R,R+l);if(E.bindTexture(E.TEXTURE_2D,_),A){E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE,t/2,e/2,0,E.LUMINANCE,E.UNSIGNED_BYTE,O);var I=T.subarray(R+l,R+l+A);E.bindTexture(E.TEXTURE_2D,c),E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE,t/2,e/2,0,E.LUMINANCE,E.UNSIGNED_BYTE,I)}else E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE_ALPHA,t/2,e/2,0,E.LUMINANCE_ALPHA,E.UNSIGNED_BYTE,O);return!0},U.prototype.updateRemoteVideoTexturesImageBitmap=function(t,e,r,n,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(t<=0||e<=0||!r)return;if(!this.isAvaiable())return;var a=this.contextGL;if(this.textureWidth=t,this.textureHeight=e,Number.isNaN(i)||(this.rotation=i),Object.assign(this.croppingParams,n),!o)return;a.bindTexture(a.TEXTURE_2D,this.yTextureRef);const s=0,E=a.RGBA,u=a.RGBA,_=a.UNSIGNED_BYTE;a.texImage2D(a.TEXTURE_2D,s,E,u,_,r)},U.prototype.updateSelfMaskImage=function(t,e,r){if(!(t<=0||e<=0)&&r&&r.length==t*e*4&&this.isAvaiable()){var n=this.contextGL;n.bindTexture(n.TEXTURE_2D,this.maskTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,r)}},U.prototype.VideoFlip=function(){if(this.isAvaiable()){var t=this.contextGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1)}},U.prototype.drawRemoteVideo=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isAvaiable())return;var r=this.contextGL;let n=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(n,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,e,t.width,t.height),r.viewport(t.x,t.y,t.width,t.height),this.updateVertexInfoForMultiView(t.width,t.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()},U.prototype.readPixelsSyncRequest=function(t,e,r,n){if(this.isAvaiable()){var i,o=this.contextGL;return this.destination&&this.destination.length==r*n*4||(this.destination=new Uint8Array(r*n*4)),i=this.destination,o.flush(),o.readPixels(t,e,r,n,o.RGBA,o.UNSIGNED_BYTE,i),i}},U.prototype.updateSelfVideoTextures=function(t,e,r,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!(t<=0||e<=0)&&r&&r.length%4==0&&this.isAvaiable()){var a=this.contextGL;this.textureWidth=t,this.textureHeight=e,this.rotation=o,Object.assign(this.croppingParams,n),i&&(a.bindTexture(a.TEXTURE_2D,this.yTextureRef),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,r))}},U.prototype.drawSelfVideo=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var i=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,t.width,t.height),i.viewport(t.x,t.y,t.width,t.height),e?(i.enable(i.BLEND),i.blendFunc(i.ZERO,i.ZERO),this.updateVertexInfoForMultiView(t.width,t.height,t.width,t.height,this.ROTATION_CLOCK0)):(i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(t.width,t.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(n.VIDEO_RGBA),this.render()}},U.prototype.isSetWatermark=function(){return this.hasWaterMark},U.prototype.recoverTextures=function(){},U.prototype.setWatermarkFlag=function(t){this.hasWaterMark=t,t||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},U.prototype.setUniformFlag=function(t,e,r){if(this.isAvaiable()){var i=this.contextGL;i.uniform1i(this.onlyRGBARef,t),i.uniform1i(this.bgraModeRef,t&&r===n.VIDEO_BGRA?1:0),i.uniform1i(this.cursorFlagRef,e),t||i.uniform1i(this.yuvmodeRef,r)}},U.prototype.setVideoMode=function(t){this.videoMode=t},U.prototype.getVideoMode=function(t){return this.videoMode},U.prototype.setWatermarkRepeated=function(t){this.watermarkRepeated=t},U.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},U.prototype.setWatermarkOpacity=function(t){this.watermarkOpacity=t||.15},U.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},U.prototype.setWatermarkPosition=function(t){this.watermarkPosition=t||16},U.prototype.getWatermarkPosition=function(){return this.watermarkPosition},U.prototype.setMultiView=function(t){return this.isMultiView=t},U.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},U.prototype.getRepeatedWatermarkTextureValue=function(t){return this.isMultiView?t.TEXTURE30:t.TEXTURE7},U.prototype.setFillMode=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=t,this.fillModeForResolution=e},U.prototype.getFillMode=function(){return this.fillMode},U.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},U.prototype.getTextureIndex=function(){return this.textureindex},U.prototype.getTextureWidth=function(){return this.textureWidth},U.prototype.getTextureHeight=function(){return this.textureHeight},U.prototype.getCroppingParams=function(){return this.croppingParams},U.prototype.getIndex=function(){return this.textureindex},U.prototype.getWatermarkWidth=function(){return this.watermarkWidth},U.prototype.getWatermarkHeight=function(){return this.watermarkHeight},U.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},U.prototype.getAttachedCanvas=function(){return this.canvasElement},U.prototype.resizeCanvasTo=function(t,e){this.contextGL.canvas.width=t,this.contextGL.canvas.height=e},U.prototype.isUseFillMode=function(t){let{width:e,height:r,rotation:n}=t;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!e||!r)return!1;const i=n===this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?r/e:e/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some(t=>Math.abs(i-t)<.01)};e.default=U}]).default}));
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/vb.min.js-3185d780912e72f05a24.map