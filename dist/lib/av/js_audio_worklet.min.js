!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);var i=function(t,e){this._BYTES_PER_ELEMENT=e,this.capacity=(t.byteLength-8)/e,this.usableCapacity=this.capacity-1,this.buf=t,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storageUint8s=new Uint8Array(this.buf,8,t.byteLength-8)};i.prototype.available_read=function(){var t=Atomics.load(this.read_ptr,0),e=Atomics.load(this.write_ptr,0);return this._available_read(t,e)},i.prototype._available_read=function(t,e){return(e+this.capacity-t)%this.capacity},i.prototype.dequeue=function(){var t=Atomics.load(this.read_ptr,0);let e=new Uint32Array(this.buf,t*this._BYTES_PER_ELEMENT+8,1);return this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+4,t*this._BYTES_PER_ELEMENT+4+e[0])},i.prototype.addReadPtr=function(){var t=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(t+1)%this.capacity)},i.prototype.getReaderPtr=function(){return this.read_ptr[0]},i.prototype.setReaderPtr=function(t){Atomics.store(this.read_ptr,0,t%this.capacity)},i.prototype.get=function(t){let e=t%this.capacity,s=new Uint32Array(this.buf,e*this._BYTES_PER_ELEMENT+8,1);return this.storageUint8s.subarray(e*this._BYTES_PER_ELEMENT+4,e*this._BYTES_PER_ELEMENT+4+s[0])};var r=i;class a{constructor(t,e){this.rframes=t,this.wframes=e,this.cap=this.lcm(t,e),this.buffer=new Float32Array(this.cap),this.remain=0,this.woffset=0,this.roffset=0}gcd(t,e){return 0===e?t:this.gcd(e,t%e)}lcm(t,e){return t/this.gcd(t,e)*e}push(t){if(t.length!=this.wframes)return console.error("[Audio] critical error in AudioWorklet: data.length:",t.length,"this.woffset:",this.woffset,"this.cap:",this.cap),void _workletPrinter.log({message:`[Audio] critical error in AudioWorklet: ${t.length} ${this.woffset} ${this.cap}`});this.buffer.set(t,this.woffset),this.woffset+=t.length,this.remain+=t.length,this.woffset>=this.cap&&(this.woffset=0)}read(){if(!this.hasData())return null;let t=this.buffer.subarray(this.roffset,this.roffset+this.rframes);return this.remain-=this.rframes,this.roffset+=this.rframes,this.roffset>=this.cap&&(this.roffset=0),t}hasData(){return this.remain>=this.rframes}}s.d(e,"Update_SSRC_Time",(function(){return W})),s.d(e,"Get_SSRC_Latest_Time",(function(){return H})),globalThis.onerror=function(t){_workletPrinter.error(t.stack)},globalThis.onWasmModuleReady=function(){p=Module.cwrap("_Audio_Init","number",["number","string","string","number","number","boolean","boolean","boolean","number"]),A=p(C,P,T,0,0,!0,!1,D,1),_=Module.cwrap("_Audio_Decode","number",["number","number","number","number"]),S=Module.cwrap("_Get_Mixed_Audio","number",["number","number","number","number"]),g=Module.cwrap("_Update_Monitor_Send_Audio_Info","number",["number","number","number"]),E=Module.cwrap("_Update_Monitor_Receive_Audio_Info","number",["number","number","number"]),m=Module.cwrap("_setMultiViewFlag","number",["number","boolean"]),k=Module.cwrap("_Interpretation_Configure","number",["number","number","number","number"]),N=Module.cwrap("_Set_Speech_Volume_Level","number",["number","number","number"]),B=Module._malloc(4*O),Module.HEAPU32.subarray(B/4,B/4+O),m(A,M),h=new o,U=Module._malloc(z),Module.HEAP8.subarray(U,U+z),Z.port.postMessage({status:"WASM_INIT_SUCCESS",data:{audio_handle:0!==A}})},globalThis.onAbort=function(t){_workletPrinter.error("WASM onAbort "+(t?t.message:""),t)},globalThis.preInit=function(t){_workletPrinter.debug("WASM preInit"+(t?t.message:""),t)},globalThis.preRun=function(t){_workletPrinter.debug("WASM preRun"+(t?t.message:""),t)},globalThis._workletPrinter=new class{constructor(t){this.messageQueue=[],this.audioDecodeWorkerPort=t,this.userAgent="",this.isSafari=!1,this.debug=this.debug.bind(this),this.log=this.log.bind(this),this.warn=this.warn.bind(this),this.error=this.error.bind(this),this.print_=this.print_.bind(this)}setUserAgent(t){this.userAgent=t,this.userAgent.match(/AppleWebKit\/(\d+)\./)&&(this.isSafari=!0)}setAudioDecodeWorkerPort(t){this.audioDecodeWorkerPort=t}debug(t,...e){t="[Audio][Worklet]"+t,this.print_({level:"debug",message:t,data:e})}log(t,...e){t="[Audio][Worklet]"+t,this.print_({level:"log",message:t,data:e})}warn(t,...e){t="[Audio][Worklet]"+t,this.print_({level:"warn",message:t,data:e})}error(t,...e){t="[Audio][Worklet]"+t,this.print_({level:"error",message:t,data:e})}print_(t){if(this.messageQueue.push(t),this.audioDecodeWorkerPort)for(;this.messageQueue.length;){let t=this.messageQueue.shift();this.isSafari?this._postToWorkerPrint(t):console[t.level](t.message,t.data)}}_postToWorkerPrint(t){this.audioDecodeWorkerPort&&this.audioDecodeWorkerPort.postMessage({status:"workletMessage",data:{level:t.level,message:t.message,data:t.data}})}};class o{constructor(){this.interval=1e3,this.monitorLength=1024,this.timer=null,this.isOpen=!1}setWorkerType(t){this.isEncode=t}OpenStatus(){return this.isOpen}open(){this.close(),this.monitorInfoPtr||(this.monitorInfoPtr=Module._malloc(this.monitorLength)),this.isOpen=!0}sendLog(){const t=this.isEncode?g:E;if(t&&A&&this.monitorInfoPtr&&void 0!==this.isEncode){const e=t(A,this.monitorInfoPtr,this.monitorLength),s=Module.HEAPU8.subarray(this.monitorInfoPtr,this.monitorInfoPtr+e);if(e>0){const t=String.fromCharCode.apply(null,s);if(t)try{t.split("\n").forEach(t=>{t&&Z.port.postMessage({status:"AUDIO_MONITOR_LOG",data:t})})}catch(t){}}s.fill(0,0,this.monitorLength)}}close(){this.timer&&(clearInterval(this.timer),this.timer=null),this.monitorInfoPtr&&(freeWasmMemory(this.monitorInfoPtr),this.monitorInfoPtr=null),this.isOpen=!1}}var h=null;class n{constructor(){this.cacheSize=0,this.sameCacheSizeCounter=0}shouldSendCacheSize(t){return t===this.cacheSize&&this.sameCacheSizeCounter++,(this.cacheSize!==t||200===this.sameCacheSizeCounter)&&(this.sameCacheSizeCounter=0,this.cacheSize=t,!0)}}class u{constructor(){this.buffList=[],this.cacheMinSize=4,this.cacheMaxSize=16,this.cacheSize=this.cacheMinSize,this.onCacheSizeChange=null,this.onrollbackbuffer=null,this.onneedmoredata=null,this.isReady=!1,this.cacheSizeController=new n}push(t){this.isReady=!0,this.buffList.push({buff:t,offset:0})}copy(t,e,s,i){return t.length-e<=s.length-i?(0===e?s.set(t,i):s.set(t.subarray(e),i),t.length-e):(s.set(t.subarray(e,e+s.length-i),i),s.length-i)}increaseCacheSize(){this.isReady&&this.cacheSize++,this.cacheSize>this.cacheMaxSize&&(this.cacheSize=this.cacheMaxSize),this.onCacheSizeChange&&this.isReady&&this.cacheSizeController.shouldSendCacheSize(this.cacheSize)&&this.onCacheSizeChange(this.cacheSize)}copyTo(t){if(0===this.buffList.length)return t.fill(0),void this.increaseCacheSize();let e=this.buffList[0];if(e.buff.length-e.offset>=t.length)this.copy(e.buff,e.offset,t,0),e.offset+=t.length,e.offset===e.buff.length&&(this.buffList.shift(),this.onrollbackbuffer&&this.onrollbackbuffer(e.buff));else{if(this.buffList.length<2)return t.fill(0),void this.increaseCacheSize();let s=this.copy(e.buff,e.offset,t,0);this.buffList.shift(),this.onrollbackbuffer&&this.onrollbackbuffer(e.buff),e=this.buffList[0],s=this.copy(e.buff,e.offset,t,s),e.offset+=s}}requestMoreData(){this.buffList.length<this.cacheSize&&this.onneedmoredata&&this.onneedmoredata()}hasData(){return this.buffList.length>=2}}class l{constructor(t){this.buffList=[],this.frameLength=t,this.onframedata=null}copy(t,e,s,i){if(t[0].length*R<=s.length-i){for(let e=0;e<R;e++)for(let r=0;t[e]&&r<t[e].length;r++)s[i+r*R+e]=t[e][r];return(t[0].length-e)*R}for(let e=0;e<R;e++)for(let r=0;t[e]&&r<t[e].length&&i+r*R+e<s.length;r++)s[i+r*R+e]=t[e][r];return s.length-i}rollbackbuffer(t){this.buffList.push({buff:t,offset:0})}push(t){0===this.buffList.length&&this.buffList.push({buff:new Float32Array(this.frameLength),offset:0});let e=this.buffList[0];if(e.buff.length-e.offset>=t[0].length*R){let s=this.copy(t,0,e.buff,e.offset);e.offset+=s,e.buff.length===e.offset&&(this.buffList.shift(),this.onframedata&&this.onframedata(e.buff))}else{let s=this.copy(t,0,e.buff,e.offset);if(this.buffList.shift(),this.onframedata&&this.onframedata(e.buff),t[0].length*R>s){let e=[];for(let i=0;i<R;i++)e.push(t[i].subarray(Math.floor(s/R)+(s%R>i?1:0)));this.push(e)}}}}class f{constructor(t,e){this.context=e,this.decodePort=null,this.encodePort=null,this.captureSize=t/100*R,this.playBuffer=new u,this.playBuffer.onrollbackbuffer=t=>{this.decodePort},this.playBuffer.onneedmoredata=()=>{this.decodePort&&this.decodePort.postMessage({status:1})},this.playBuffer.onCacheSizeChange=t=>{this.decodePort&&this.decodePort.postMessage({status:3,cacheSize:t})},this.quantum=new Float32Array(128*w),this.captureBuffer=new l(this.captureSize),this.captureBuffer.onframedata=t=>{this.encodePort&&this.encodePort.postMessage({command:2,buffer:t},[t.buffer])}}setDecodePort(t){this.decodePort&&this.decodePort.close(),this.decodePort=t,this.decodePort.onmessage=this.handleDecodeData.bind(this)}setEncodePort(t){this.encodePort&&this.encodePort.close(),this.encodePort=t,this.encodePort.onmessage=this.handleEncodeData.bind(this)}handleDecodeData(t){this.context.isPlaying&&this.playBuffer.push(t.data.data)}handleEncodeData(t){switch(t.data.event){case 0:this.captureBuffer.rollbackbuffer(t.data.buffer)}}requestMoreData(){this.playBuffer.requestMoreData()}close(){this.decodePort&&(this.decodePort=null,this.decodePort.close()),this.encodePort&&(this.encodePort=null,this.encodePort.close())}write(t){this.captureBuffer.push(t)}read(){return this.playBuffer.copyTo(this.quantum),this.requestMoreData(),this.quantum}}class c{constructor(t,e,s){if(this.STATE_READ_READY=0,this.STATE_READ_INDEX=1,this.STATE_WRITE_READY=2,this.STATE_WRITE_INDEX=3,this.STATE_DATA_COUNT=4,this.STATE_CACHE_SIZE=5,this.STATY_READY_NO=0,this.STATY_READY_YES=1,this.sabState=new Uint32Array(t),this.sabBuffer=new Float32Array(e),this.perFrameLength=s,this.bufferLen=this.sabBuffer.length,this.supportSpecialOptimization=this.bufferLen%s==0,this.bufferIndex=null,this.supportSpecialOptimization){let t=this.bufferLen/s;this.bufferIndex=[];for(let e=0;e<t;e++)this.bufferIndex.push(this.sabBuffer.subarray(e*s,e*s+s))}this.placeBuffer=new Float32Array(this.perFrameLength),this.QUANTUM_SIZE=128,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MIN_VALUE=6,this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE),this.setCacheSize(this.CACHE_SIZE_MIN_VALUE),this._counter=0,this.onCacheSizeChange=null,this.cacheSizeController=new n}getCacheSize(){return Atomics.load(this.sabState,this.STATE_CACHE_SIZE)}setCacheSize(t){t>this.CACHE_SIZE_MAX_VALUE&&(t=this.CACHE_SIZE_MAX_VALUE),t<this.CACHE_SIZE_MIN_VALUE&&(t=this.CACHE_SIZE_MIN_VALUE),this.onCacheSizeChange&&this.cacheSizeController.shouldSendCacheSize(t)&&this.onCacheSizeChange(t),Atomics.store(this.sabState,this.STATE_CACHE_SIZE,t)}setQuantumSize(t){this.QUANTUM_SIZE=t,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE)}isNeedMoreData(){let t=Atomics.load(this.sabState,this.STATE_CACHE_SIZE);return Atomics.load(this.sabState,this.STATE_DATA_COUNT)<t*this.QUANTUM_SIZE}shouldAdjustCacheBuffer(){this._counter>0&&this.setCacheSize(this.getCacheSize()+1)}clear(){this.sabState&&(this.sabState[this.STATE_READ_READY]=0,this.sabState[this.STATE_READ_INDEX]=0,this.sabState[this.STATE_WRITE_READY]=0,this.sabState[this.STATE_WRITE_INDEX]=0,this.sabState[this.STATE_DATA_COUNT]=0),this._counter=0}setWriteReady(){this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES}isReady(){return this.sabState[this.STATE_WRITE_READY]&&this.sabState[this.STATE_READ_READY]}getDataCount(){return Atomics.load(this.sabState,this.STATE_DATA_COUNT)}write(t){if(t[0].length*R!==this.perFrameLength)return;let e=this.sabState[this.STATE_READ_READY];return this.sabState[this.STATE_WRITE_READY]||(this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES,this.sabState[this.STATE_WRITE_INDEX]=0),e?this.supportSpecialOptimization?this.writeSpecial(t):this.writeNormal(t):void 0}writeNormal(t){let e=this.sabState[this.STATE_WRITE_INDEX];for(let s=0;s<R;s++)for(let i=0;t[s]&&i<t[s].length;i++)this.sabBuffer[(e+i*R+s)%this.bufferLen]=t[s][i];e+=this.perFrameLength,e>=this.bufferLen&&(e-=this.bufferLen),this.sabState[this.STATE_WRITE_INDEX]=e,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}writeSpecial(t){let e=this.sabState[this.STATE_WRITE_INDEX];for(let s=0;s<R;s++)for(let i=0;t[s]&&i<t[s].length;i++)this.bufferIndex[e][i*R+s]=t[s][i];e=(e+1)%this.bufferIndex.length,this.sabState[this.STATE_WRITE_INDEX]=e,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}read(){let t=this.sabState[this.STATE_READ_READY],e=this.sabState[this.STATE_WRITE_READY];if(t||(this.sabState[this.STATE_READ_READY]=this.STATY_READY_YES,this.sabState[this.STATE_READ_INDEX]=0),!e)return null;let s=this.supportSpecialOptimization?this.readSpecial():this.readNormal();return null===s?this.shouldAdjustCacheBuffer():this._counter++,s}readNormal(){let t=this.sabState[this.STATE_READ_INDEX],e=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(e<this.perFrameLength)return null;if(e>this.bufferLen){let s=Math.ceil((e-this.bufferLen)/this.perFrameLength)+1;t=(s*this.perFrameLength+t)%this.bufferLen,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,s*this.perFrameLength)}let s=null;if(this.bufferLen-t>=this.perFrameLength)s=this.sabBuffer.subarray(t,t+this.perFrameLength);else{let e=this.sabBuffer.subarray(t),i=this.sabBuffer.subarray(0,this.perFrameLength-e.length);s=this.placeBuffer,s.set(e),s.set(i,e.length)}return t+=this.perFrameLength,t>=this.bufferLen&&(t-=this.bufferLen),this.sabState[this.STATE_READ_INDEX]=t,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}readSpecial(){let t=this.sabState[this.STATE_READ_INDEX],e=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(e<this.perFrameLength)return null;if(e>this.bufferLen){let s=Math.ceil((e-this.bufferLen)/this.perFrameLength)+1;t=(s+t)%this.bufferIndex.length,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,s*this.perFrameLength)}let s=this.bufferIndex[t];return t=(t+1)%this.bufferIndex.length,this.sabState[this.STATE_READ_INDEX]=t,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}}let d="undefined"!=typeof SharedArrayBuffer,b=!0;var p=null,_=null,A=null,S=null,g=null,E=null,m=null;let T=0,P=0,D=!1,C=0,y=0,M=!1,L=0,R=1,w=1,I=null;var k,B,N,U,O=10;let z=1500;var v=new Map;function W(t){if(t){var e=t.length/16,s=0,i=0;for(s=0;s<e;s++){var r=0;for(i=16*s+0;i<16*s+4;i++)r+=t[i]*Math.pow(256,i-16*s);r>>=10;var a=0;for(i=16*s+4;i<16*s+12;i++)a+=t[i]*Math.pow(256,i-16*s-4);v.set(r,a)}}}function H(t){t>>=10;var e=v.get(t);return e?(v.set(t,0),e):0}function F(t){let e=t[1];return 4294967296*t[2]+e}globalThis.update_play_time=function(t,e){if(e&&(L+=1,L>50)){L=0;var s=new Uint8Array(e),i=Module.HEAP8.subarray(t+0,t+e);if(s.set(i),Z.videoDecodePort)Z.videoDecodePort.postMessage({status:M?1:0,data:s},[s.buffer]);else{let t=new Uint32Array(s.buffer),e=null,i=null,r=0,a=0;for(let o=0;o<s.length/16;o++){let s=t[4*o];512&s?(e=t.subarray(4*o,4*o+4),a=F(e)):s>>10==y>>10&&(i=t.subarray(4*o,4*o+4),r=F(i))}if(!r&&!a)return;Z.port.postMessage({status:57,at:r,st:a})}}};let Y=null,x=null;globalThis.frame_callback=function(t,e,s,i,r,a,o,h){Y===t&&x.length==e*o||(x=Module.HEAPF32.subarray(t/4,t/4+e*o),Y=t),I.push(x),M||update_play_time(s,i)};let Z=null;class V extends AudioWorkletProcessor{static get parameterDescriptors(){return[{name:"pcm",defaultValue:1}]}constructor(t){super(),this.port.onmessage=this.handleMessage.bind(this),this.isPlaying=!1,this.isCapturing=!1,t&&t.processorOptions&&(t.processorOptions.audioEncodeChannelsNum&&(R=t.processorOptions.audioEncodeChannelsNum),t.processorOptions.audioDecodeChannelsNum&&(w=t.processorOptions.audioDecodeChannelsNum)),this.SABConstructor(t&&t.processorOptions?t.processorOptions.sharedBuffer:null),this.noSABConstructor(),Z=this,globalThis.fsHandler&&globalThis.fsHandler.setPort(this.port),t&&t.processorOptions&&t.processorOptions.userAgent&&_workletPrinter.setUserAgent(t.processorOptions.userAgent)}SABConstructor(t){this.sampleRate_=0,this.g_sharedbuffer=t||null,this.encodeSAB=null,this.decodeSAB=null,this.audioEncodePort=null,this.audioDecodePort=null,this.videoDecodePort=null,this.rtpSAB=null,this.stopPlayAudio=!1,I=new a(128*w,sampleRate/100*w)}noSABConstructor(){this.audioProcessBuffer=new f(sampleRate,this),this.isRunning=!0}handleMessage(t){const{status:e,data:s}=t.data;switch(e){case"diableSharedArrayBuffer":d=!1;break;case"disableDecoderinworklet":b=!1;break;case"data":console.info("Dropped audio data before initialized");break;case"stopPlayAudio":this.isPlaying=!1;break;case"stopWorklet":Q=!0;break;case"startPlayAudio":this.isPlaying=!0;break;case"StartCaptureAudio":this.isCapturing=!0;break;case"sampleRate":this.sampleRate_=s;break;case"audiowasm":wasm2binary=s;try{initWasm(Module)}catch(t){_workletPrinter.log("init WASM failed, error message:"+t.message+t.stack)}break;case"initData":C=s.userid,T=s.meetingid,P=s.meetingnum,D=s.qoson;break;case"currentSSRC":y=s;break;case"stop_audio_incoming":this.stopPlayAudio=s;break;case"multiView":M=!0;break;case"interpretation_set_lang":Module.HEAPU32.subarray(B/4,B/4+O)[0]=s.lang,k(A,1,B,1);break;case"interpretation_enable":Module.HEAPU32.subarray(B/4,B/4+O)[0]=s.enable?1:0,k(A,0,B,1);break;case"interpretation_mute_origin":Module.HEAPU32.subarray(B/4,B/4+O)[0]=s.mute?1:0,k(A,2,B,1);break;case"interpretation_set_interpreter":{let t=Module.HEAPU32.subarray(B/4,B/4+O),e=B;s.interpreterList.length>=O&&(e=Module._malloc(4*s.interpreterList.length),t=Module.HEAPU32.subarray(e/4,e/4+s.interpreterList.length));for(let e=0;e<s.interpreterList.length;e++)t[e]=s.interpreterList[e];k(A,3,e,s.interpreterList.length),s.interpreterList.length>=O&&Module._free(e);break}case"setSpeechVolumeLevel":if(!A)return;N(A,s.userid,s.volume);break;default:d?this.handleMessageForSAB(t):this.handleMessageForNoSAB(t)}}handleMessageForSAB(t){const{status:e,data:s}=t.data;switch(e){case"encodeAudioPort":this.audioEncodePort&&this.audioEncodePort.close(),this.audioEncodePort=t.ports[0];break;case"decodeAudioPort":this.audioDecodePort&&this.audioDecodePort.close(),this.audioDecodePort=t.ports[0],_workletPrinter.setAudioDecodeWorkerPort(t.ports[0]),this.audioDecodePort.onmessage=function(t){};break;case"decodeVideoPort":this.videoDecodePort&&this.videoDecodePort.close(),this.videoDecodePort=t.ports[0];break;case"close":break;case"sharedBuffer":s&&(this.g_sharedbuffer=s),this.g_sharedbuffer&&(this.encodeSAB=new c(this.g_sharedbuffer.inputState,this.g_sharedbuffer.inputBuffer,128*R),this.decodeSAB=new c(this.g_sharedbuffer.outputState,this.g_sharedbuffer.outputBuffer,128*w),this.rtpSAB=new r(this.g_sharedbuffer.rtpBuffer,1200),this.decodeSAB.onCacheSizeChange=t=>{this.audioDecodePort&&this.audioDecodePort.postMessage({status:3,cacheSize:t,isSAB:!0})});break;default:console.warn("unhanle commands in audioworklet",e)}}handleMessageForNoSAB(t){const{status:e}=t.data;switch(e){case"encodeAudioPort":this.audioProcessBuffer.setEncodePort(t.ports[0]);break;case"decodeAudioPort":_workletPrinter.setAudioDecodeWorkerPort(t.ports[0]),this.audioProcessBuffer.setDecodePort(t.ports[0]);break;case"close":this.audioProcessBuffer.close(),this.isPlaying=!1,this.isRunning=!1;break;default:console.warn("unhanle commands in audioworklet",e)}}onReceivedRTP(){}process(t,e,s){if(Q)return!1;try{return d?b?(h&&(h.OpenStatus()?G%125==0&&h.sendLog():(h.setWorkerType(!1),h.open()),G++),this.SABDecodeProcess(t,e,s)):this.SABProcess(t,e,s):this.NoSABprocess(t,e,s)}catch(t){return _workletPrinter.log("::process() exception: "+t.message+t.stack),!0}}NoSABprocess(t,e,s){return!!this.isRunning&&(!this.isPlaying||(this.inputDataForNoSAB(t),this.outputDataForNoSAB(e),!0))}inputDataForNoSAB(t){if(!t[0]||!t[0][0])return!0;this.audioProcessBuffer.write(t[0])}outputDataForNoSAB(t){let e=this.audioProcessBuffer.read();if(this.stopPlayAudio)return!0;let s=t[0];if(1===w)for(let t=0;t<s.length;t++)s[t].set(e);else for(let t=0;t<w;t++)for(let i=0;s[t]&&i<s[t].length;i++)s[t][i]=e[i*w+t]}inputData(t){if(!this.encodeSAB)return!0;this.encodeSAB.write(t),this.audioEncodePort.postMessage({command:2,buffer:!1})}outputDecodeData(t){try{I.hasData()||S&&(sampleRate!=X&&(globalThis.sampleRateLog(X,sampleRate,"","",3),X=sampleRate),S(A,sampleRate/100,0,sampleRate,w))}catch(t){_workletPrinter.log("::outputDecodeData() get_mixed_Audio exception: "+t.message+t.stack)}try{let e=I.read();if(!e)return;if(1===w)for(let s=0;s<t.length;s++)t[s].set(e);else for(let s=0;s<w;s++)for(let i=0;t[s]&&i<t[s].length;i++)t[s][i]=e[i*w+s]}catch(t){_workletPrinter.log("::outputDecodeData() set outputs exception: "+t.message+t.stack)}}outputData(t){if(!this.decodeSAB)return!0;let e=this.decodeSAB.read();if(null===e||this.stopPlayAudio)return!0;if(1===w)for(let s=0;s<t.length;s++)t[s].set(e);else for(let s=0;s<w;s++)for(let i=0;t[s]&&i<t[s].length;i++)t[s][i]=e[i*w+s]}SABDecodeProcess(t,e,s){try{if(!this.rtpSAB)return!0;{let t=this.rtpSAB.available_read();t>100&&(t=100);let e=this.rtpSAB.getReaderPtr(),s=0;for(;s<t;){s++;let t=this.rtpSAB.get(e);if(e++,A){Module.HEAP8.subarray(U,U+z).set(t);_(A,0,U,t.length)}}this.rtpSAB.setReaderPtr(e)}}catch(t){_workletPrinter.log("::SABDecodeProcess() audio_decode exception: "+t.message+t.stack)}try{let s=t[0],i=e[0];return!this.g_sharedbuffer||(!this.sampleRate_||!i[0]||(s[0]&&this.isCapturing&&this.inputData(s),this.outputDecodeData(i),!0))}catch(t){_workletPrinter.log("::SABDecodeProcess() inputs or outputs exception: "+t.message+t.stack)}}SABProcess(t,e,s){let i=t[0],r=e[0];return!this.g_sharedbuffer||(!this.sampleRate_||!r[0]||(i[0]&&this.isCapturing&&this.inputData(i),this.outputData(r),!0))}}var X=0,G=0,Q=!1;globalThis.LOG_OUT=function(){},globalThis.fsHandler?(globalThis.LOG_OUT_WEBRTC=globalThis.fsHandler.handleFile,globalThis.Get_ExternalRecord=globalThis.fsHandler.handleViperPrint):(globalThis.LOG_OUT_WEBRTC=function(){},globalThis.Get_ExternalRecord=function(){}),globalThis.send_data=function(){},globalThis.monitorLOG=function(t){t&&Z.port.postMessage({status:"MONITOR_LOG",data:t})},globalThis.sampleRateLog=function(t,e,s,i,r){if(!t&&!e)return;let a=null;switch(r){case 1:a="GGDS: ";break;case 2:a="SCAG: ";break;case 3:a="SCIW: "}let o=a+t+"|"+e+"|"+s+"|"+i;globalThis.monitorLOG(o)},globalThis.wcl_trace_log=function(t,e){globalThis.fsHandler&&globalThis.fsHandler.handleAudioSDKUtilPrint(t,e)},registerProcessor("zoomAudioWorklet",V)}]);
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/js_audio_worklet.min.js-3f095dca4f3d5007ce29.map